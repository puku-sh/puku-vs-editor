{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/extensionManagement/test/node/extensionsScannerService.test.ts","vs/platform/extensionManagement/test/node/extensionsScannerService.test.ts"],"names":[],"mappings":"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","file":"extensionsScannerService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { dirname, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { INativeEnvironmentService } from '../../../environment/common/environment.js';\nimport { IExtensionsProfileScannerService, IProfileExtensionsScanOptions } from '../../common/extensionsProfileScannerService.js';\nimport { AbstractExtensionsScannerService, ExtensionScannerInput, IExtensionsScannerService, IScannedExtensionManifest, Translations } from '../../common/extensionsScannerService.js';\nimport { ExtensionsProfileScannerService } from '../../node/extensionsProfileScannerService.js';\nimport { ExtensionType, IExtensionManifest, TargetPlatform } from '../../../extensions/common/extensions.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { IInstantiationService } from '../../../instantiation/common/instantiation.js';\nimport { TestInstantiationService } from '../../../instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../log/common/log.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { IUriIdentityService } from '../../../uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../uriIdentity/common/uriIdentityService.js';\nimport { IUserDataProfilesService, UserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\n\nlet translations: Translations = Object.create(null);\nconst ROOT = URI.file('/ROOT');\n\nclass ExtensionsScannerService extends AbstractExtensionsScannerService implements IExtensionsScannerService {\n\n\tconstructor(\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IExtensionsProfileScannerService extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ILogService logService: ILogService,\n\t\t@INativeEnvironmentService nativeEnvironmentService: INativeEnvironmentService,\n\t\t@IProductService productService: IProductService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(\n\t\t\tURI.file(nativeEnvironmentService.builtinExtensionsPath),\n\t\t\tURI.file(nativeEnvironmentService.extensionsPath),\n\t\t\tjoinPath(nativeEnvironmentService.userHome, '.vscode-oss-dev', 'extensions', 'control.json'),\n\t\t\tuserDataProfilesService.defaultProfile,\n\t\t\tuserDataProfilesService, extensionsProfileScannerService, fileService, logService, nativeEnvironmentService, productService, uriIdentityService, instantiationService);\n\t}\n\n\tprotected async getTranslations(language: string): Promise<Translations> {\n\t\treturn translations;\n\t}\n\n}\n\nsuite('NativeExtensionsScanerService Test', () => {\n\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\ttranslations = {};\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\t\tconst logService = new NullLogService();\n\t\tconst fileService = disposables.add(new FileService(logService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(ROOT.scheme, fileSystemProvider));\n\t\tinstantiationService.stub(ILogService, logService);\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tconst systemExtensionsLocation = joinPath(ROOT, 'system');\n\t\tconst userExtensionsLocation = joinPath(ROOT, 'extensions');\n\t\tconst environmentService = instantiationService.stub(INativeEnvironmentService, {\n\t\t\tuserHome: ROOT,\n\t\t\tuserRoamingDataHome: ROOT,\n\t\t\tbuiltinExtensionsPath: systemExtensionsLocation.fsPath,\n\t\t\textensionsPath: userExtensionsLocation.fsPath,\n\t\t\tcacheHome: joinPath(ROOT, 'cache'),\n\t\t});\n\t\tinstantiationService.stub(IProductService, { version: '1.66.0' });\n\t\tconst uriIdentityService = disposables.add(new UriIdentityService(fileService));\n\t\tinstantiationService.stub(IUriIdentityService, uriIdentityService);\n\t\tconst userDataProfilesService = disposables.add(new UserDataProfilesService(environmentService, fileService, uriIdentityService, logService));\n\t\tinstantiationService.stub(IUserDataProfilesService, userDataProfilesService);\n\t\tinstantiationService.stub(IExtensionsProfileScannerService, disposables.add(new ExtensionsProfileScannerService(environmentService, fileService, userDataProfilesService, uriIdentityService, logService)));\n\t\tawait fileService.createFolder(systemExtensionsLocation);\n\t\tawait fileService.createFolder(userExtensionsLocation);\n\t});\n\n\ttest('scan system extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aSystemExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanSystemExtensions({});\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, true);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.System);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan user extensions', async () => {\n\t\tconst manifest: Partial<IScannedExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, false);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tdelete manifest.__metadata;\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan existing extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.notEqual(actual, null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual!.isBuiltin, false);\n\t\tassert.deepStrictEqual(actual!.type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual!.isValid, true);\n\t\tassert.deepStrictEqual(actual!.validations, []);\n\t\tassert.deepStrictEqual(actual!.metadata, undefined);\n\t\tassert.deepStrictEqual(actual!.targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual!.manifest, manifest);\n\t});\n\n\ttest('scan single extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanOneOrMultipleExtensions(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, false);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan multiple extensions', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub' }));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanOneOrMultipleExtensions(dirname(extensionLocation), ExtensionType.User, {});\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name2' });\n\t});\n\n\ttest('scan all user extensions with different versions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2' }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.2');\n\t});\n\n\ttest('scan all user extensions include all versions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2' }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.1');\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].manifest.version, '1.0.2');\n\t});\n\n\ttest('scan all user extensions with different versions and higher version is not compatible', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.1');\n\t});\n\n\ttest('scan all user extensions exclude invalid extensions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t});\n\n\ttest('scan all user extensions include invalid extensions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: true });\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name2' });\n\t});\n\n\ttest('scan system extensions include additional builtin extensions', async () => {\n\t\tinstantiationService.stub(IProductService, {\n\t\t\tversion: '1.66.0',\n\t\t\tbuiltInExtensions: [\n\t\t\t\t{ name: 'pub.name2', version: '', repo: '', metadata: undefined },\n\t\t\t\t{ name: 'pub.name', version: '', repo: '', metadata: undefined }\n\t\t\t]\n\t\t});\n\t\tawait anExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub' }), joinPath(ROOT, 'additional'));\n\t\tconst extensionLocation = await anExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }), joinPath(ROOT, 'additional'));\n\t\tawait aSystemExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(instantiationService.get(INativeEnvironmentService).userHome, '.vscode-oss-dev', 'extensions', 'control.json'), VSBuffer.fromString(JSON.stringify({ 'pub.name2': 'disabled', 'pub.name': extensionLocation.fsPath })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanSystemExtensions({ checkControlFile: true });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.0');\n\t});\n\n\ttest('scan all user extensions with default nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.displayName, 'Hello World');\n\t});\n\n\ttest('scan extension with en nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst nlsLocation = joinPath(extensionLocation, 'package.en.json');\n\t\tawait instantiationService.get(IFileService).writeFile(nlsLocation, VSBuffer.fromString(JSON.stringify({ contents: { package: { displayName: 'Hello World EN' } } })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\ttranslations = { 'pub.name': nlsLocation.fsPath };\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, { language: 'en' });\n\n\t\tassert.ok(actual !== null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.manifest.displayName, 'Hello World EN');\n\t});\n\n\ttest('scan extension falls back to default nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst nlsLocation = joinPath(extensionLocation, 'package.en.json');\n\t\tawait instantiationService.get(IFileService).writeFile(nlsLocation, VSBuffer.fromString(JSON.stringify({ contents: { package: { displayName: 'Hello World EN' } } })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\ttranslations = { 'pub.name2': nlsLocation.fsPath };\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, { language: 'en' });\n\n\t\tassert.ok(actual !== null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.manifest.displayName, 'Hello World');\n\t});\n\n\ttest('scan single extension with manifest metadata retains manifest metadata', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst expectedMetadata = { size: 12345, installedTimestamp: 1234567890, targetPlatform: TargetPlatform.DARWIN_ARM64 };\n\t\tconst extensionLocation = await aUserExtension({\n\t\t\t...manifest,\n\t\t\t__metadata: expectedMetadata\n\t\t});\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.notStrictEqual(actual, null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual!.isBuiltin, false);\n\t\tassert.deepStrictEqual(actual!.type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual!.isValid, true);\n\t\tassert.deepStrictEqual(actual!.validations, []);\n\t\tassert.deepStrictEqual(actual!.metadata, expectedMetadata);\n\t\tassert.deepStrictEqual(actual!.manifest, manifest);\n\t});\n\n\tasync function aUserExtension(manifest: Partial<IScannedExtensionManifest>): Promise<URI> {\n\t\tconst environmentService = instantiationService.get(INativeEnvironmentService);\n\t\treturn anExtension(manifest, URI.file(environmentService.extensionsPath));\n\t}\n\n\tasync function aSystemExtension(manifest: Partial<IScannedExtensionManifest>): Promise<URI> {\n\t\tconst environmentService = instantiationService.get(INativeEnvironmentService);\n\t\treturn anExtension(manifest, URI.file(environmentService.builtinExtensionsPath));\n\t}\n\n\tasync function anExtension(manifest: Partial<IScannedExtensionManifest>, root: URI): Promise<URI> {\n\t\tconst fileService = instantiationService.get(IFileService);\n\t\tconst extensionLocation = joinPath(root, `${manifest.publisher}.${manifest.name}-${manifest.version}`);\n\t\tawait fileService.writeFile(joinPath(extensionLocation, 'package.json'), VSBuffer.fromString(JSON.stringify(manifest)));\n\t\treturn extensionLocation;\n\t}\n\n\tfunction anExtensionManifest(manifest: Partial<IScannedExtensionManifest>): Partial<IExtensionManifest> {\n\t\treturn { engines: { vscode: '^1.66.0' }, version: '1.0.0', main: 'main.js', activationEvents: ['*'], ...manifest };\n\t}\n});\n\nsuite('ExtensionScannerInput', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('compare inputs - location', () => {\n\t\tconst anInput = (location: URI, mtime: number | undefined) => new ExtensionScannerInput(location, mtime, undefined, undefined, false, undefined, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, undefined)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 100)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(joinPath(ROOT, 'foo'), undefined), anInput(ROOT, undefined)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 200)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, 200)), false);\n\t});\n\n\ttest('compare inputs - application location', () => {\n\t\tconst anInput = (location: URI, mtime: number | undefined) => new ExtensionScannerInput(ROOT, undefined, location, mtime, false, undefined, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, undefined)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 100)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(joinPath(ROOT, 'foo'), undefined), anInput(ROOT, undefined)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 200)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, 200)), false);\n\t});\n\n\ttest('compare inputs - profile', () => {\n\t\tconst anInput = (profile: boolean, profileScanOptions: IProfileExtensionsScanOptions | undefined) => new ExtensionScannerInput(ROOT, undefined, undefined, undefined, profile, profileScanOptions, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: true })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(false, { bailOutWhenFileNotFound: true }), anInput(false, { bailOutWhenFileNotFound: true })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: false }), anInput(true, { bailOutWhenFileNotFound: false })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, {}), anInput(true, {})), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: false })), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, {}), anInput(true, { bailOutWhenFileNotFound: true })), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, undefined), anInput(true, {})), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(false, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: true })), false);\n\t});\n\n\ttest('compare inputs - extension type', () => {\n\t\tconst anInput = (type: ExtensionType) => new ExtensionScannerInput(ROOT, undefined, undefined, undefined, false, undefined, type, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.System), anInput(ExtensionType.System)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.User), anInput(ExtensionType.User)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.User), anInput(ExtensionType.System)), false);\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { dirname, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { INativeEnvironmentService } from '../../../environment/common/environment.js';\nimport { IExtensionsProfileScannerService, IProfileExtensionsScanOptions } from '../../common/extensionsProfileScannerService.js';\nimport { AbstractExtensionsScannerService, ExtensionScannerInput, IExtensionsScannerService, IScannedExtensionManifest, Translations } from '../../common/extensionsScannerService.js';\nimport { ExtensionsProfileScannerService } from '../../node/extensionsProfileScannerService.js';\nimport { ExtensionType, IExtensionManifest, TargetPlatform } from '../../../extensions/common/extensions.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { IInstantiationService } from '../../../instantiation/common/instantiation.js';\nimport { TestInstantiationService } from '../../../instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../log/common/log.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { IUriIdentityService } from '../../../uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../uriIdentity/common/uriIdentityService.js';\nimport { IUserDataProfilesService, UserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\n\nlet translations: Translations = Object.create(null);\nconst ROOT = URI.file('/ROOT');\n\nclass ExtensionsScannerService extends AbstractExtensionsScannerService implements IExtensionsScannerService {\n\n\tconstructor(\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IExtensionsProfileScannerService extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ILogService logService: ILogService,\n\t\t@INativeEnvironmentService nativeEnvironmentService: INativeEnvironmentService,\n\t\t@IProductService productService: IProductService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(\n\t\t\tURI.file(nativeEnvironmentService.builtinExtensionsPath),\n\t\t\tURI.file(nativeEnvironmentService.extensionsPath),\n\t\t\tjoinPath(nativeEnvironmentService.userHome, '.vscode-oss-dev', 'extensions', 'control.json'),\n\t\t\tuserDataProfilesService.defaultProfile,\n\t\t\tuserDataProfilesService, extensionsProfileScannerService, fileService, logService, nativeEnvironmentService, productService, uriIdentityService, instantiationService);\n\t}\n\n\tprotected async getTranslations(language: string): Promise<Translations> {\n\t\treturn translations;\n\t}\n\n}\n\nsuite('NativeExtensionsScanerService Test', () => {\n\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\ttranslations = {};\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\t\tconst logService = new NullLogService();\n\t\tconst fileService = disposables.add(new FileService(logService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(ROOT.scheme, fileSystemProvider));\n\t\tinstantiationService.stub(ILogService, logService);\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tconst systemExtensionsLocation = joinPath(ROOT, 'system');\n\t\tconst userExtensionsLocation = joinPath(ROOT, 'extensions');\n\t\tconst environmentService = instantiationService.stub(INativeEnvironmentService, {\n\t\t\tuserHome: ROOT,\n\t\t\tuserRoamingDataHome: ROOT,\n\t\t\tbuiltinExtensionsPath: systemExtensionsLocation.fsPath,\n\t\t\textensionsPath: userExtensionsLocation.fsPath,\n\t\t\tcacheHome: joinPath(ROOT, 'cache'),\n\t\t});\n\t\tinstantiationService.stub(IProductService, { version: '1.66.0' });\n\t\tconst uriIdentityService = disposables.add(new UriIdentityService(fileService));\n\t\tinstantiationService.stub(IUriIdentityService, uriIdentityService);\n\t\tconst userDataProfilesService = disposables.add(new UserDataProfilesService(environmentService, fileService, uriIdentityService, logService));\n\t\tinstantiationService.stub(IUserDataProfilesService, userDataProfilesService);\n\t\tinstantiationService.stub(IExtensionsProfileScannerService, disposables.add(new ExtensionsProfileScannerService(environmentService, fileService, userDataProfilesService, uriIdentityService, logService)));\n\t\tawait fileService.createFolder(systemExtensionsLocation);\n\t\tawait fileService.createFolder(userExtensionsLocation);\n\t});\n\n\ttest('scan system extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aSystemExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanSystemExtensions({});\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, true);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.System);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan user extensions', async () => {\n\t\tconst manifest: Partial<IScannedExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, false);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tdelete manifest.__metadata;\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan existing extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.notEqual(actual, null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual!.isBuiltin, false);\n\t\tassert.deepStrictEqual(actual!.type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual!.isValid, true);\n\t\tassert.deepStrictEqual(actual!.validations, []);\n\t\tassert.deepStrictEqual(actual!.metadata, undefined);\n\t\tassert.deepStrictEqual(actual!.targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual!.manifest, manifest);\n\t});\n\n\ttest('scan single extension', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst extensionLocation = await aUserExtension(manifest);\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanOneOrMultipleExtensions(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual[0].isBuiltin, false);\n\t\tassert.deepStrictEqual(actual[0].type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual[0].isValid, true);\n\t\tassert.deepStrictEqual(actual[0].validations, []);\n\t\tassert.deepStrictEqual(actual[0].metadata, undefined);\n\t\tassert.deepStrictEqual(actual[0].targetPlatform, TargetPlatform.UNDEFINED);\n\t\tassert.deepStrictEqual(actual[0].manifest, manifest);\n\t});\n\n\ttest('scan multiple extensions', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub' }));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanOneOrMultipleExtensions(dirname(extensionLocation), ExtensionType.User, {});\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name2' });\n\t});\n\n\ttest('scan all user extensions with different versions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2' }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.2');\n\t});\n\n\ttest('scan all user extensions include all versions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2' }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.1');\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].manifest.version, '1.0.2');\n\t});\n\n\ttest('scan all user extensions with different versions and higher version is not compatible', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.2', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.1');\n\t});\n\n\ttest('scan all user extensions exclude invalid extensions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: false });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t});\n\n\ttest('scan all user extensions include invalid extensions', async () => {\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }));\n\t\tawait aUserExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub', engines: { vscode: '^1.67.0' } }));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions({ includeAllVersions: false, includeInvalid: true });\n\n\t\tassert.deepStrictEqual(actual.length, 2);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[1].identifier, { id: 'pub.name2' });\n\t});\n\n\ttest('scan system extensions include additional builtin extensions', async () => {\n\t\tinstantiationService.stub(IProductService, {\n\t\t\tversion: '1.66.0',\n\t\t\tbuiltInExtensions: [\n\t\t\t\t{ name: 'pub.name2', version: '', repo: '', metadata: undefined },\n\t\t\t\t{ name: 'pub.name', version: '', repo: '', metadata: undefined }\n\t\t\t]\n\t\t});\n\t\tawait anExtension(anExtensionManifest({ 'name': 'name2', 'publisher': 'pub' }), joinPath(ROOT, 'additional'));\n\t\tconst extensionLocation = await anExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub' }), joinPath(ROOT, 'additional'));\n\t\tawait aSystemExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', version: '1.0.1' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(instantiationService.get(INativeEnvironmentService).userHome, '.vscode-oss-dev', 'extensions', 'control.json'), VSBuffer.fromString(JSON.stringify({ 'pub.name2': 'disabled', 'pub.name': extensionLocation.fsPath })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanSystemExtensions({ checkControlFile: true });\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.version, '1.0.0');\n\t});\n\n\ttest('scan all user extensions with default nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst testObject = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanAllUserExtensions();\n\n\t\tassert.deepStrictEqual(actual.length, 1);\n\t\tassert.deepStrictEqual(actual[0].identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual[0].manifest.displayName, 'Hello World');\n\t});\n\n\ttest('scan extension with en nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst nlsLocation = joinPath(extensionLocation, 'package.en.json');\n\t\tawait instantiationService.get(IFileService).writeFile(nlsLocation, VSBuffer.fromString(JSON.stringify({ contents: { package: { displayName: 'Hello World EN' } } })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\ttranslations = { 'pub.name': nlsLocation.fsPath };\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, { language: 'en' });\n\n\t\tassert.ok(actual !== null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.manifest.displayName, 'Hello World EN');\n\t});\n\n\ttest('scan extension falls back to default nls replacements', async () => {\n\t\tconst extensionLocation = await aUserExtension(anExtensionManifest({ 'name': 'name', 'publisher': 'pub', displayName: '%displayName%' }));\n\t\tawait instantiationService.get(IFileService).writeFile(joinPath(extensionLocation, 'package.nls.json'), VSBuffer.fromString(JSON.stringify({ displayName: 'Hello World' })));\n\t\tconst nlsLocation = joinPath(extensionLocation, 'package.en.json');\n\t\tawait instantiationService.get(IFileService).writeFile(nlsLocation, VSBuffer.fromString(JSON.stringify({ contents: { package: { displayName: 'Hello World EN' } } })));\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\ttranslations = { 'pub.name2': nlsLocation.fsPath };\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, { language: 'en' });\n\n\t\tassert.ok(actual !== null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.manifest.displayName, 'Hello World');\n\t});\n\n\ttest('scan single extension with manifest metadata retains manifest metadata', async () => {\n\t\tconst manifest: Partial<IExtensionManifest> = anExtensionManifest({ 'name': 'name', 'publisher': 'pub' });\n\t\tconst expectedMetadata = { size: 12345, installedTimestamp: 1234567890, targetPlatform: TargetPlatform.DARWIN_ARM64 };\n\t\tconst extensionLocation = await aUserExtension({\n\t\t\t...manifest,\n\t\t\t__metadata: expectedMetadata\n\t\t});\n\t\tconst testObject: IExtensionsScannerService = disposables.add(instantiationService.createInstance(ExtensionsScannerService));\n\n\t\tconst actual = await testObject.scanExistingExtension(extensionLocation, ExtensionType.User, {});\n\n\t\tassert.notStrictEqual(actual, null);\n\t\tassert.deepStrictEqual(actual!.identifier, { id: 'pub.name' });\n\t\tassert.deepStrictEqual(actual!.location.toString(), extensionLocation.toString());\n\t\tassert.deepStrictEqual(actual!.isBuiltin, false);\n\t\tassert.deepStrictEqual(actual!.type, ExtensionType.User);\n\t\tassert.deepStrictEqual(actual!.isValid, true);\n\t\tassert.deepStrictEqual(actual!.validations, []);\n\t\tassert.deepStrictEqual(actual!.metadata, expectedMetadata);\n\t\tassert.deepStrictEqual(actual!.manifest, manifest);\n\t});\n\n\tasync function aUserExtension(manifest: Partial<IScannedExtensionManifest>): Promise<URI> {\n\t\tconst environmentService = instantiationService.get(INativeEnvironmentService);\n\t\treturn anExtension(manifest, URI.file(environmentService.extensionsPath));\n\t}\n\n\tasync function aSystemExtension(manifest: Partial<IScannedExtensionManifest>): Promise<URI> {\n\t\tconst environmentService = instantiationService.get(INativeEnvironmentService);\n\t\treturn anExtension(manifest, URI.file(environmentService.builtinExtensionsPath));\n\t}\n\n\tasync function anExtension(manifest: Partial<IScannedExtensionManifest>, root: URI): Promise<URI> {\n\t\tconst fileService = instantiationService.get(IFileService);\n\t\tconst extensionLocation = joinPath(root, `${manifest.publisher}.${manifest.name}-${manifest.version}`);\n\t\tawait fileService.writeFile(joinPath(extensionLocation, 'package.json'), VSBuffer.fromString(JSON.stringify(manifest)));\n\t\treturn extensionLocation;\n\t}\n\n\tfunction anExtensionManifest(manifest: Partial<IScannedExtensionManifest>): Partial<IExtensionManifest> {\n\t\treturn { engines: { vscode: '^1.66.0' }, version: '1.0.0', main: 'main.js', activationEvents: ['*'], ...manifest };\n\t}\n});\n\nsuite('ExtensionScannerInput', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('compare inputs - location', () => {\n\t\tconst anInput = (location: URI, mtime: number | undefined) => new ExtensionScannerInput(location, mtime, undefined, undefined, false, undefined, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, undefined)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 100)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(joinPath(ROOT, 'foo'), undefined), anInput(ROOT, undefined)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 200)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, 200)), false);\n\t});\n\n\ttest('compare inputs - application location', () => {\n\t\tconst anInput = (location: URI, mtime: number | undefined) => new ExtensionScannerInput(ROOT, undefined, location, mtime, false, undefined, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, undefined)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 100)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(joinPath(ROOT, 'foo'), undefined), anInput(ROOT, undefined)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, 100), anInput(ROOT, 200)), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ROOT, undefined), anInput(ROOT, 200)), false);\n\t});\n\n\ttest('compare inputs - profile', () => {\n\t\tconst anInput = (profile: boolean, profileScanOptions: IProfileExtensionsScanOptions | undefined) => new ExtensionScannerInput(ROOT, undefined, undefined, undefined, profile, profileScanOptions, ExtensionType.User, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: true })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(false, { bailOutWhenFileNotFound: true }), anInput(false, { bailOutWhenFileNotFound: true })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: false }), anInput(true, { bailOutWhenFileNotFound: false })), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, {}), anInput(true, {})), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: false })), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, {}), anInput(true, { bailOutWhenFileNotFound: true })), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(true, undefined), anInput(true, {})), false);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(false, { bailOutWhenFileNotFound: true }), anInput(true, { bailOutWhenFileNotFound: true })), false);\n\t});\n\n\ttest('compare inputs - extension type', () => {\n\t\tconst anInput = (type: ExtensionType) => new ExtensionScannerInput(ROOT, undefined, undefined, undefined, false, undefined, type, true, '1.1.1', undefined, undefined, true, undefined, {});\n\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.System), anInput(ExtensionType.System)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.User), anInput(ExtensionType.User)), true);\n\t\tassert.strictEqual(ExtensionScannerInput.equals(anInput(ExtensionType.User), anInput(ExtensionType.System)), false);\n\t});\n\n});\n"]}