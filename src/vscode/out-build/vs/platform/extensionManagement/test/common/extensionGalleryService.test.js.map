{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/extensionManagement/test/common/extensionGalleryService.test.ts","vs/platform/extensionManagement/test/common/extensionGalleryService.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,QAAQ,EAAE,MAAM,sCAAsC,CAAC;AAChE,OAAO,EAAE,GAAG,EAAE,MAAM,gCAAgC,CAAC;AACrD,OAAO,EAAE,MAAM,EAAE,MAAM,iCAAiC,CAAC;AACzD,OAAO,EAAE,IAAI,EAAE,MAAM,sCAAsC,CAAC;AAE5D,OAAO,EAAE,wBAAwB,EAAE,MAAM,gEAAgE,CAAC;AAE1G,OAAO,EAA+B,qBAAqB,EAAE,8CAA8C,EAAE,MAAM,yCAAyC,CAAC;AAE7J,OAAO,EAAE,WAAW,EAAE,MAAM,sCAAsC,CAAC;AACnE,OAAO,EAAE,0BAA0B,EAAE,MAAM,qDAAqD,CAAC;AACjG,OAAO,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAC5D,OAAO,OAAO,MAAM,oCAAoC,CAAC;AAEzD,OAAO,EAAE,yBAAyB,EAAE,MAAM,iDAAiD,CAAC;AAC5F,OAAO,EAAE,sBAAsB,EAAmB,MAAM,oCAAoC,CAAC;AAC7F,OAAO,EAA0B,oBAAoB,EAAE,MAAM,wCAAwC,CAAC;AAEtG,OAAO,EAAE,oBAAoB,EAAE,MAAM,6CAA6C,CAAC;AACnF,OAAO,EAAE,uCAAuC,EAAE,MAAM,uCAAuC,CAAC;AAEhG,MAAM,sBAAuB,SAAQ,IAAI,EAAuB;IAE/D,YAAY,wBAA6B;QACxC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,wBAAwB,GAAG,wBAAwB,CAAC;QACzD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACrB,CAAC;CACD;AAED,KAAK,CAAC,2BAA2B,EAAE,GAAG,EAAE;IACvC,MAAM,WAAW,GAAG,uCAAuC,EAAE,CAAC;IAC9D,IAAI,WAAyB,EAAE,kBAAuC,EAAE,cAA+B,EAAE,cAA+B,EAAE,oBAA2C,CAAC;IAEtL,KAAK,CAAC,GAAG,EAAE;QACV,MAAM,wBAAwB,GAAG,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE,CAAC,EAAE,WAAW,CAAC,CAAC;QAC3G,kBAAkB,GAAG,IAAI,sBAAsB,CAAC,wBAAwB,CAAC,CAAC;QAC1E,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,IAAI,cAAc,EAAE,CAAC,CAAC,CAAC;QACrE,MAAM,kBAAkB,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,0BAA0B,EAAE,CAAC,CAAC;QAC7E,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC;QACnG,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,sBAAsB,EAAE,CAAC,CAAC;QAC/D,oBAAoB,GAAG,IAAI,wBAAwB,CAAC,EAAE,CAAC,oBAAoB,CAAC,uCAA2B,EAAE,CAAC,CAAC;QAC3G,oBAAoB,CAAC,WAAW,CAAC,oBAAoB,wCAA4B,CAAC;QAClF,cAAc,GAAG,EAAE,aAAa,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC;IAClF,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;QACzC,MAAM,OAAO,GAAG,MAAM,yBAAyB,CAAC,OAAO,CAAC,OAAO,EAAE,cAAc,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,WAAW,EAAE,cAAc,EAAE,oBAAoB,CAAC,CAAC;QAC9K,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAC/C,MAAM,QAAQ,GAAG,MAAM,yBAAyB,CAAC,OAAO,CAAC,OAAO,EAAE,cAAc,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,WAAW,EAAE,cAAc,EAAE,oBAAoB,CAAC,CAAC;QAC/K,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE,QAAQ,CAAC,kBAAkB,CAAC,CAAC,CAAC;IAC/E,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0DAA0D,EAAE,KAAK,IAAI,EAAE;QAC3E,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5C,MAAM,QAAQ,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;QAC7B,qBAAqB,CAAC,MAAM,+CAA4B,CAAC;QACzD,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE;QAClF,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,+CAA4B,CAAC,CAAC;QACvE,MAAM,QAAQ,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;QAC7B,qBAAqB,CAAC,MAAM,+CAA4B,CAAC;QACzD,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;QACvF,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,mDAA8B,CAAC,CAAC;QACzE,MAAM,QAAQ,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;QAC7B,qBAAqB,CAAC,MAAM,6CAA2B,CAAC;QACxD,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE;QAC/E,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;QAChI,MAAM,QAAQ,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;QAC7B,qBAAqB,CAAC,MAAM,iDAA6B,CAAC;QAC1D,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE;QAChF,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,mDAA8B,EAAE,iBAAiB,CAAC,OAAO,iDAA6B,EAAE,iBAAiB,CAAC,OAAO,iDAA6B,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;QAC7Q,MAAM,QAAQ,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QACpF,qBAAqB,CAAC,MAAM,iDAA6B,CAAC;QAC1D,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE;QAChF,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,mDAA8B,EAAE,iBAAiB,CAAC,OAAO,iDAA6B,EAAE,iBAAiB,CAAC,OAAO,iDAA6B,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;QAC7Q,MAAM,QAAQ,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QACpF,qBAAqB,CAAC,MAAM,iDAA6B,CAAC;QAC1D,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE;QAChF,MAAM,MAAM,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,CAAC,EAAE,iBAAiB,CAAC,OAAO,mDAA8B,EAAE,iBAAiB,CAAC,OAAO,iDAA6B,CAAC,CAAC;QACrN,MAAM,QAAQ,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QACzE,qBAAqB,CAAC,MAAM,iDAA6B,CAAC;QAC1D,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,SAAS,iBAAiB,CAAC,OAAe,EAAE,cAA+B;QAC1E,OAAO,EAAE,OAAO,EAAE,cAAc,EAAiC,CAAC;IACnE,CAAC;IAED,SAAS,2BAA2B,CAAC,OAAe,EAAE,cAA+B;QACpF,OAAO;YACN,OAAO;YACP,cAAc;YACd,UAAU,EAAE,CAAC,EAAE,GAAG,EAAE,wCAAwC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC;SAC/C,CAAC;IAClC,CAAC;IAED,KAAK,CAAC,gDAAgD,EAAE,GAAG,EAAE;QAE5D,IAAI,CAAC,2CAA2C,EAAE,GAAG,EAAE;YACtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,EAAE,8CAA4B,4CAA0B,CAAC,CAAC;YACxH,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,6DAA6D,EAAE,GAAG,EAAE;YACxE,MAAM,QAAQ,GAAG,CAAC,iBAAiB,CAAC,OAAO,6CAA2B,CAAC,CAAC;YACxE,MAAM,kBAAkB,GAAG,4CAA0B,CAAC;YACtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YACtH,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mEAAmE,EAAE,GAAG,EAAE;YAC9E,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YACtE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC,CAAC,+BAA+B;YACtG,MAAM,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YACtC,MAAM,kBAAkB,GAAG,4CAA0B,CAAC;YAEtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,mEAAmE;YACnE,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;QACzC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,qEAAqE,EAAE,GAAG,EAAE;YAChF,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YACtE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,+CAA4B,CAAC;YACvE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YACtE,MAAM,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAChD,MAAM,kBAAkB,GAAG,sIAA+E,CAAC;YAE3G,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,qHAAqH;YACrH,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,kCAAkC;YACxE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACjE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,2BAA2B;QAClE,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,kDAAkD,EAAE,GAAG,EAAE;YAC7D,MAAM,cAAc,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YAC5E,MAAM,iBAAiB,GAAG,2BAA2B,CAAC,OAAO,6CAA2B,CAAC;YACzF,MAAM,QAAQ,GAAG,CAAC,cAAc,EAAE,iBAAiB,CAAC,CAAC;YACrD,MAAM,kBAAkB,GAAG,4CAA0B,CAAC;YAEtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,8EAA8E;YAC9E,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;YAC3C,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,iEAAiE,EAAE,GAAG,EAAE;YAC5E,MAAM,WAAW,GAAG,2BAA2B,CAAC,OAAO,6CAA2B,CAAC;YACnF,MAAM,WAAW,GAAG,2BAA2B,CAAC,OAAO,6CAA2B,CAAC,CAAC,uBAAuB;YAC3G,MAAM,QAAQ,GAAG,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;YAC5C,MAAM,kBAAkB,GAAG,4CAA0B,CAAC;YAEtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,sEAAsE;YACtE,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,4DAA4D,EAAE,GAAG,EAAE;YACvE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B;YAC5E,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B;YAC5E,MAAM,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YACtC,MAAM,kBAAkB,GAAG,4CAA0B,CAAC;YAEtD,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,gFAAgF;YAChF,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;QACzC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gFAAgF,EAAE,GAAG,EAAE;YAC3F,MAAM,UAAU,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YACxE,MAAM,UAAU,GAAG,iBAAiB,CAAC,OAAO,+CAA4B,CAAC;YACzE,MAAM,aAAa,GAAG,2BAA2B,CAAC,OAAO,6CAA2B,CAAC;YACrF,MAAM,aAAa,GAAG,2BAA2B,CAAC,OAAO,+CAA4B,CAAC;YACtF,MAAM,aAAa,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC,CAAC,yBAAyB;YAErG,MAAM,QAAQ,GAAG,CAAC,UAAU,EAAE,UAAU,EAAE,aAAa,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC;YACvF,MAAM,kBAAkB,GAAG,0FAAqD,CAAC;YAEjF,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,yGAAyG;YACzG,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,qBAAqB;YAC7D,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACnE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,yBAAyB;YACpE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACtE,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,sCAAsC;QACnF,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,qEAAqE,EAAE,GAAG,EAAE;YAChF,MAAM,QAAQ,GAAG;gBAChB,iBAAiB,CAAC,OAAO,6CAA2B;gBACpD,iBAAiB,CAAC,OAAO,+CAA4B;gBACrD,iBAAiB,CAAC,OAAO,6CAA2B,EAAE,+BAA+B;gBACrF,2BAA2B,CAAC,OAAO,6CAA2B;gBAC9D,2BAA2B,CAAC,OAAO,6CAA2B,EAAE,mCAAmC;gBACnG,2BAA2B,CAAC,OAAO,6CAA2B;gBAC9D,iBAAiB,CAAC,OAAO,CAAC,EAAE,wBAAwB;gBACpD,2BAA2B,CAAC,OAAO,CAAC,EAAE,qCAAqC;aAC3E,CAAC;YACF,MAAM,kBAAkB,GAAG,sIAA+E,CAAC;YAE3G,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,0CAA0C;YAC1C,iFAAiF;YACjF,8DAA8D;YAC9D,yFAAyF;YACzF,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAErC,uCAAuC;YACvC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,6CAA6C;YACtF,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,oCAAoC;YAC7E,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,iDAAiD;YAC1F,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,mCAAmC;QAC7E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,sEAAsE,EAAE,GAAG,EAAE;YACjF,gEAAgE;YAChE,MAAM,QAAQ,GAAG;gBAChB,iBAAiB,CAAC,OAAO,6CAA2B;gBACpD,iBAAiB,CAAC,OAAO,CAAC,EAAE,2CAA2C;aACvE,CAAC;YACF,MAAM,kBAAkB,GAAG,0FAAqD,CAAC;YAEjF,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,yFAAyF;YACzF,yEAAyE;YACzE,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,+CAA+C;QACzF,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,8FAA8F,EAAE,GAAG,EAAE;YACzG,8FAA8F;YAC9F,MAAM,6BAA6B,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YAC3F,MAAM,qBAAqB,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B;YAEzF,MAAM,QAAQ,GAAG,CAAC,6BAA6B,EAAE,qBAAqB,CAAC,CAAC;YACxE,MAAM,kBAAkB,GAAG,0FAAqD,CAAC;YAEjF,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,4FAA4F;YAC5F,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,6BAA6B,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACtF,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,uCAAuC;QAC5F,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,8FAA8F,EAAE,GAAG,EAAE;YACzG,sGAAsG;YACtG,MAAM,4BAA4B,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YAC1F,MAAM,sBAAsB,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B;YAE1F,MAAM,QAAQ,GAAG,CAAC,4BAA4B,EAAE,sBAAsB,CAAC,CAAC;YACxE,MAAM,kBAAkB,GAAG,0FAAqD,CAAC;YAEjF,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,4FAA4F;YAC5F,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,4BAA4B,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACrF,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,uCAAuC;QAC7F,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,0FAA0F,EAAE,GAAG,EAAE;YACrG,uEAAuE;YACvE,MAAM,QAAQ,GAAG;gBAChB,iBAAiB,CAAC,OAAO,6CAA2B,EAAK,qCAAqC;gBAC9F,iBAAiB,CAAC,OAAO,+CAA4B,EAAG,6CAA6C;gBACrG,iBAAiB,CAAC,OAAO,CAAC,EAA8B,qCAAqC;gBAC7F,iBAAiB,CAAC,OAAO,6CAA2B,EAAI,0DAA0D;aAClH,CAAC;YACF,MAAM,kBAAkB,GAAG,sIAA+E,CAAC;YAE3G,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,kBAAkB;YAClB,6DAA6D;YAC7D,gDAAgD;YAChD,0DAA0D;YAC1D,sBAAsB;YACtB,yDAAyD;YACzD,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,kBAAkB;YAC3D,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,mBAAmB;YAC5D,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,qCAAqC;YAC/E,MAAM,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,qCAAqC;QAChF,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,uEAAuE,EAAE,GAAG,EAAE;YAClF,mFAAmF;YACnF,MAAM,gBAAgB,GAAG,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B;YACpF,MAAM,eAAe,GAAG,iBAAiB,CAAC,OAAO,iDAA6B,CAAC;YAE/E,MAAM,QAAQ,GAAG,CAAC,gBAAgB,EAAE,eAAe,CAAC,CAAC;YACrD,MAAM,kBAAkB,GAAG,0FAAqD,CAAC,CAAC,4CAA4C;YAE9H,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,6EAA6E;YAC7E,qFAAqF;YACrF,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,4BAA4B;YAC1E,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,2BAA2B;QACzE,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,yDAAyD,EAAE,GAAG,EAAE;YACpE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,6CAA2B,CAAC;YACtE,MAAM,QAAQ,GAAG,iBAAiB,CAAC,OAAO,+CAA4B,CAAC;YACvE,MAAM,QAAQ,GAAG,2BAA2B,CAAC,OAAO,6CAA2B,CAAC;YAChF,MAAM,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAChD,MAAM,kBAAkB,GAAG,sIAA+E,CAAC;YAE3G,MAAM,MAAM,GAAG,8CAA8C,CAAC,QAAQ,8CAA4B,kBAAkB,CAAC,CAAC;YAEtH,4FAA4F;YAC5F,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACrC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,qBAAqB;YAC3D,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,2BAA2B;YACjE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,2BAA2B;QAClE,CAAC,CAAC,CAAC;IAEJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","file":"extensionGalleryService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { isUUID } from '../../../../base/common/uuid.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../configuration/test/common/testConfigurationService.js';\nimport { IEnvironmentService } from '../../../environment/common/environment.js';\nimport { IRawGalleryExtensionVersion, sortExtensionVersions, filterLatestExtensionVersionsForTargetPlatform } from '../../common/extensionGalleryService.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { NullLogService } from '../../../log/common/log.js';\nimport product from '../../../product/common/product.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { resolveMarketplaceHeaders } from '../../../externalServices/common/marketplace.js';\nimport { InMemoryStorageService, IStorageService } from '../../../storage/common/storage.js';\nimport { TelemetryConfiguration, TELEMETRY_SETTING_ID } from '../../../telemetry/common/telemetry.js';\nimport { TargetPlatform } from '../../../extensions/common/extensions.js';\nimport { NullTelemetryService } from '../../../telemetry/common/telemetryUtils.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\n\nclass EnvironmentServiceMock extends mock<IEnvironmentService>() {\n\toverride readonly serviceMachineIdResource: URI;\n\tconstructor(serviceMachineIdResource: URI) {\n\t\tsuper();\n\t\tthis.serviceMachineIdResource = serviceMachineIdResource;\n\t\tthis.isBuilt = true;\n\t}\n}\n\nsuite('Extension Gallery Service', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet fileService: IFileService, environmentService: IEnvironmentService, storageService: IStorageService, productService: IProductService, configurationService: IConfigurationService;\n\n\tsetup(() => {\n\t\tconst serviceMachineIdResource = joinPath(URI.file('tests').with({ scheme: 'vscode-tests' }), 'machineid');\n\t\tenvironmentService = new EnvironmentServiceMock(serviceMachineIdResource);\n\t\tfileService = disposables.add(new FileService(new NullLogService()));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(serviceMachineIdResource.scheme, fileSystemProvider));\n\t\tstorageService = disposables.add(new InMemoryStorageService());\n\t\tconfigurationService = new TestConfigurationService({ [TELEMETRY_SETTING_ID]: TelemetryConfiguration.ON });\n\t\tconfigurationService.updateValue(TELEMETRY_SETTING_ID, TelemetryConfiguration.ON);\n\t\tproductService = { _serviceBrand: undefined, ...product, enableTelemetry: true };\n\t});\n\n\ttest('marketplace machine id', async () => {\n\t\tconst headers = await resolveMarketplaceHeaders(product.version, productService, environmentService, configurationService, fileService, storageService, NullTelemetryService);\n\t\tassert.ok(headers['X-Market-User-Id']);\n\t\tassert.ok(isUUID(headers['X-Market-User-Id']));\n\t\tconst headers2 = await resolveMarketplaceHeaders(product.version, productService, environmentService, configurationService, fileService, storageService, NullTelemetryService);\n\t\tassert.strictEqual(headers['X-Market-User-Id'], headers2['X-Market-User-Id']);\n\t});\n\n\ttest('sorting single extension version without target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2')];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.DARWIN_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting single extension version with preferred target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2', TargetPlatform.DARWIN_X64)];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.DARWIN_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting single extension version with not compatible target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2', TargetPlatform.DARWIN_ARM64)];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions without target platforms', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.1.3'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 1', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.2.4', TargetPlatform.WIN32_ARM64), aExtensionVersion('1.2.4', TargetPlatform.LINUX_ARM64), aExtensionVersion('1.1.3'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [actual[1], actual[0], actual[2], actual[3], actual[4], actual[5]];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 2', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.2.3', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.2.3', TargetPlatform.WIN32_ARM64), aExtensionVersion('1.2.3', TargetPlatform.LINUX_ARM64), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [actual[0], actual[3], actual[1], actual[2], actual[4], actual[5]];\n\t\tsortExtensionVersions(actual, TargetPlatform.LINUX_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 3', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1'), aExtensionVersion('1.0.0', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.0.0', TargetPlatform.WIN32_ARM64)];\n\t\tconst expected = [actual[0], actual[1], actual[2], actual[4], actual[3]];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\tfunction aExtensionVersion(version: string, targetPlatform?: TargetPlatform): IRawGalleryExtensionVersion {\n\t\treturn { version, targetPlatform } as IRawGalleryExtensionVersion;\n\t}\n\n\tfunction aPreReleaseExtensionVersion(version: string, targetPlatform?: TargetPlatform): IRawGalleryExtensionVersion {\n\t\treturn {\n\t\t\tversion,\n\t\t\ttargetPlatform,\n\t\t\tproperties: [{ key: 'Microsoft.VisualStudio.Code.PreRelease', value: 'true' }]\n\t\t} as IRawGalleryExtensionVersion;\n\t}\n\n\tsuite('filterLatestExtensionVersionsForTargetPlatform', () => {\n\n\t\ttest('should return empty array for empty input', () => {\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform([], TargetPlatform.WIN32_X64, [TargetPlatform.WIN32_X64]);\n\t\t\tassert.deepStrictEqual(result, []);\n\t\t});\n\n\t\ttest('should return single version when only one version provided', () => {\n\t\t\tconst versions = [aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64)];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\t\t\tassert.deepStrictEqual(result, versions);\n\t\t});\n\n\t\ttest('should filter out duplicate target platforms for release versions', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('0.9.0', TargetPlatform.WIN32_X64); // Same platform, older version\n\t\t\tconst versions = [version1, version2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first version (latest) for this platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], version1);\n\t\t});\n\n\t\ttest('should include one version per target platform for release versions', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst version3 = aExtensionVersion('1.0.0', TargetPlatform.LINUX_X64);\n\t\t\tconst versions = [version1, version2, version3];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include all three versions: WIN32_X64 (compatible, first of type) + DARWIN_X64 & LINUX_X64 (non-compatible)\n\t\t\tassert.strictEqual(result.length, 3);\n\t\t\tassert.ok(result.includes(version1)); // Compatible with target platform\n\t\t\tassert.ok(result.includes(version2)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(version3)); // Non-compatible, included\n\t\t});\n\n\t\ttest('should separate release and pre-release versions', () => {\n\t\t\tconst releaseVersion = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preReleaseVersion = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst versions = [releaseVersion, preReleaseVersion];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include both since they are different types (release vs pre-release)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(releaseVersion));\n\t\t\tassert.ok(result.includes(preReleaseVersion));\n\t\t});\n\n\t\ttest('should filter duplicate pre-release versions by target platform', () => {\n\t\t\tconst preRelease1 = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preRelease2 = aPreReleaseExtensionVersion('1.0.0', TargetPlatform.WIN32_X64); // Same platform, older\n\t\t\tconst versions = [preRelease1, preRelease2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first pre-release version for this platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], preRelease1);\n\t\t});\n\n\t\ttest('should handle versions without target platform (UNDEFINED)', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0'); // No target platform specified\n\t\t\tconst version2 = aExtensionVersion('0.9.0'); // No target platform specified\n\t\t\tconst versions = [version1, version2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first version since they both have UNDEFINED platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], version1);\n\t\t});\n\n\t\ttest('should handle mixed release and pre-release versions across multiple platforms', () => {\n\t\t\tconst releaseWin = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst releaseMac = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst preReleaseWin = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preReleaseMac = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst oldReleaseWin = aExtensionVersion('0.9.0', TargetPlatform.WIN32_X64); // Should be filtered out\n\n\t\t\tconst versions = [releaseWin, releaseMac, preReleaseWin, preReleaseMac, oldReleaseWin];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include: WIN32_X64 compatible (release + prerelease) + DARWIN_X64 non-compatible (all versions)\n\t\t\tassert.strictEqual(result.length, 4);\n\t\t\tassert.ok(result.includes(releaseWin)); // Compatible release\n\t\t\tassert.ok(result.includes(releaseMac)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(preReleaseWin)); // Compatible pre-release\n\t\t\tassert.ok(result.includes(preReleaseMac)); // Non-compatible, included\n\t\t\tassert.ok(!result.includes(oldReleaseWin)); // Filtered (older compatible release)\n\t\t});\n\n\t\ttest('should handle complex scenario with multiple versions and platforms', () => {\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.WIN32_X64),\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.DARWIN_X64),\n\t\t\t\taExtensionVersion('1.9.0', TargetPlatform.WIN32_X64), // Older release, same platform\n\t\t\t\taPreReleaseExtensionVersion('2.1.0', TargetPlatform.WIN32_X64),\n\t\t\t\taPreReleaseExtensionVersion('2.0.5', TargetPlatform.WIN32_X64), // Older pre-release, same platform\n\t\t\t\taPreReleaseExtensionVersion('2.1.0', TargetPlatform.LINUX_X64),\n\t\t\t\taExtensionVersion('2.0.0'), // No platform specified\n\t\t\t\taPreReleaseExtensionVersion('2.1.0'), // Pre-release, no platform specified\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Expected for WIN32_X64 target platform:\n\t\t\t// - Compatible (WIN32_X64 + UNDEFINED): Only first release and first pre-release\n\t\t\t// - Non-compatible: DARWIN_X64 release, LINUX_X64 pre-release\n\t\t\t// Total: 4 versions (1 compatible release + 1 compatible pre-release + 2 non-compatible)\n\t\t\tassert.strictEqual(result.length, 4);\n\n\t\t\t// Check specific versions are included\n\t\t\tassert.ok(result.includes(versions[0])); // 2.0.0 WIN32_X64 (first compatible release)\n\t\t\tassert.ok(result.includes(versions[1])); // 2.0.0 DARWIN_X64 (non-compatible)\n\t\t\tassert.ok(result.includes(versions[3])); // 2.1.0 WIN32_X64 (first compatible pre-release)\n\t\t\tassert.ok(result.includes(versions[5])); // 2.1.0 LINUX_X64 (non-compatible)\n\t\t});\n\n\t\ttest('should handle UNDEFINED platform interaction with specific platforms', () => {\n\t\t\t// Test how UNDEFINED platform interacts with specific platforms\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('1.0.0', TargetPlatform.WIN32_X64),\n\t\t\t\taExtensionVersion('1.0.0'), // UNDEFINED platform - compatible with all\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first of each type should be included\n\t\t\t// Since both are release versions, only the first one should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(versions[0])); // WIN32_X64 should be included (first release)\n\t\t});\n\n\t\ttest('should handle higher version with specific platform vs lower version with universal platform', () => {\n\t\t\t// Scenario: newer version for specific platform vs older version with universal compatibility\n\t\t\tconst higherVersionSpecificPlatform = aExtensionVersion('2.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst lowerVersionUniversal = aExtensionVersion('1.5.0'); // UNDEFINED/universal platform\n\n\t\t\tconst versions = [higherVersionSpecificPlatform, lowerVersionUniversal];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first release version should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(higherVersionSpecificPlatform)); // First compatible release\n\t\t\tassert.ok(!result.includes(lowerVersionUniversal)); // Filtered (second compatible release)\n\t\t});\n\n\t\ttest('should handle lower version with specific platform vs higher version with universal platform', () => {\n\t\t\t// Reverse scenario: older version for specific platform vs newer version with universal compatibility\n\t\t\tconst lowerVersionSpecificPlatform = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst higherVersionUniversal = aExtensionVersion('2.0.0'); // UNDEFINED/universal platform\n\n\t\t\tconst versions = [lowerVersionSpecificPlatform, higherVersionUniversal];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first release version should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(lowerVersionSpecificPlatform)); // First compatible release\n\t\t\tassert.ok(!result.includes(higherVersionUniversal)); // Filtered (second compatible release)\n\t\t});\n\n\t\ttest('should handle multiple specific platforms vs universal platform with version differences', () => {\n\t\t\t// Complex scenario with multiple platforms and universal compatibility\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.WIN32_X64),    // Highest version, specific platform\n\t\t\t\taExtensionVersion('1.9.0', TargetPlatform.DARWIN_X64),  // Lower version, different specific platform\n\t\t\t\taExtensionVersion('1.8.0'),                             // Lowest version, universal platform\n\t\t\t\taExtensionVersion('1.7.0', TargetPlatform.WIN32_X64),   // Even older, same platform as first - should be filtered\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include:\n\t\t\t// - 2.0.0 WIN32_X64 (first compatible release for WIN32_X64)\n\t\t\t// - 1.9.0 DARWIN_X64 (non-compatible, included)\n\t\t\t// - 1.8.0 UNDEFINED (second compatible release, filtered)\n\t\t\t// Should NOT include:\n\t\t\t// - 1.7.0 WIN32_X64 (third compatible release, filtered)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(versions[0])); // 2.0.0 WIN32_X64\n\t\t\tassert.ok(result.includes(versions[1])); // 1.9.0 DARWIN_X64\n\t\t\tassert.ok(!result.includes(versions[2])); // 1.8.0 UNDEFINED should be filtered\n\t\t\tassert.ok(!result.includes(versions[3])); // 1.7.0 WIN32_X64 should be filtered\n\t\t});\n\n\t\ttest('should include universal platform when no specific platforms conflict', () => {\n\t\t\t// Test where universal platform is included because no specific platforms conflict\n\t\t\tconst universalVersion = aExtensionVersion('1.0.0'); // UNDEFINED/universal platform\n\t\t\tconst specificVersion = aExtensionVersion('1.0.0', TargetPlatform.LINUX_ARM64);\n\n\t\t\tconst versions = [universalVersion, specificVersion];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64]; // Note: LINUX_ARM64 not in target platforms\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Universal is compatible with WIN32_X64, specific version is not compatible\n\t\t\t// So we should get: universal (first compatible release) + specific (non-compatible)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(universalVersion)); // Compatible with WIN32_X64\n\t\t\tassert.ok(result.includes(specificVersion)); // Non-compatible, included\n\t\t});\n\n\t\ttest('should preserve order of input when no filtering occurs', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst version3 = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.LINUX_X64);\n\t\t\tconst versions = [version1, version2, version3];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// For WIN32_X64 target: version1 (compatible release) + version2, version3 (non-compatible)\n\t\t\tassert.strictEqual(result.length, 3);\n\t\t\tassert.ok(result.includes(version1)); // Compatible release\n\t\t\tassert.ok(result.includes(version2)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(version3)); // Non-compatible, included\n\t\t});\n\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { isUUID } from '../../../../base/common/uuid.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../configuration/test/common/testConfigurationService.js';\nimport { IEnvironmentService } from '../../../environment/common/environment.js';\nimport { IRawGalleryExtensionVersion, sortExtensionVersions, filterLatestExtensionVersionsForTargetPlatform } from '../../common/extensionGalleryService.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { NullLogService } from '../../../log/common/log.js';\nimport product from '../../../product/common/product.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { resolveMarketplaceHeaders } from '../../../externalServices/common/marketplace.js';\nimport { InMemoryStorageService, IStorageService } from '../../../storage/common/storage.js';\nimport { TelemetryConfiguration, TELEMETRY_SETTING_ID } from '../../../telemetry/common/telemetry.js';\nimport { TargetPlatform } from '../../../extensions/common/extensions.js';\nimport { NullTelemetryService } from '../../../telemetry/common/telemetryUtils.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\n\nclass EnvironmentServiceMock extends mock<IEnvironmentService>() {\n\toverride readonly serviceMachineIdResource: URI;\n\tconstructor(serviceMachineIdResource: URI) {\n\t\tsuper();\n\t\tthis.serviceMachineIdResource = serviceMachineIdResource;\n\t\tthis.isBuilt = true;\n\t}\n}\n\nsuite('Extension Gallery Service', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet fileService: IFileService, environmentService: IEnvironmentService, storageService: IStorageService, productService: IProductService, configurationService: IConfigurationService;\n\n\tsetup(() => {\n\t\tconst serviceMachineIdResource = joinPath(URI.file('tests').with({ scheme: 'vscode-tests' }), 'machineid');\n\t\tenvironmentService = new EnvironmentServiceMock(serviceMachineIdResource);\n\t\tfileService = disposables.add(new FileService(new NullLogService()));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(serviceMachineIdResource.scheme, fileSystemProvider));\n\t\tstorageService = disposables.add(new InMemoryStorageService());\n\t\tconfigurationService = new TestConfigurationService({ [TELEMETRY_SETTING_ID]: TelemetryConfiguration.ON });\n\t\tconfigurationService.updateValue(TELEMETRY_SETTING_ID, TelemetryConfiguration.ON);\n\t\tproductService = { _serviceBrand: undefined, ...product, enableTelemetry: true };\n\t});\n\n\ttest('marketplace machine id', async () => {\n\t\tconst headers = await resolveMarketplaceHeaders(product.version, productService, environmentService, configurationService, fileService, storageService, NullTelemetryService);\n\t\tassert.ok(headers['X-Market-User-Id']);\n\t\tassert.ok(isUUID(headers['X-Market-User-Id']));\n\t\tconst headers2 = await resolveMarketplaceHeaders(product.version, productService, environmentService, configurationService, fileService, storageService, NullTelemetryService);\n\t\tassert.strictEqual(headers['X-Market-User-Id'], headers2['X-Market-User-Id']);\n\t});\n\n\ttest('sorting single extension version without target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2')];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.DARWIN_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting single extension version with preferred target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2', TargetPlatform.DARWIN_X64)];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.DARWIN_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting single extension version with not compatible target platform', async () => {\n\t\tconst actual = [aExtensionVersion('1.1.2', TargetPlatform.DARWIN_ARM64)];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_X64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions without target platforms', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.1.3'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [...actual];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 1', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.2.4', TargetPlatform.WIN32_ARM64), aExtensionVersion('1.2.4', TargetPlatform.LINUX_ARM64), aExtensionVersion('1.1.3'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [actual[1], actual[0], actual[2], actual[3], actual[4], actual[5]];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 2', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.2.3', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.2.3', TargetPlatform.WIN32_ARM64), aExtensionVersion('1.2.3', TargetPlatform.LINUX_ARM64), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1')];\n\t\tconst expected = [actual[0], actual[3], actual[1], actual[2], actual[4], actual[5]];\n\t\tsortExtensionVersions(actual, TargetPlatform.LINUX_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\ttest('sorting multiple extension versions with target platforms - 3', async () => {\n\t\tconst actual = [aExtensionVersion('1.2.4'), aExtensionVersion('1.1.2'), aExtensionVersion('1.1.1'), aExtensionVersion('1.0.0', TargetPlatform.DARWIN_ARM64), aExtensionVersion('1.0.0', TargetPlatform.WIN32_ARM64)];\n\t\tconst expected = [actual[0], actual[1], actual[2], actual[4], actual[3]];\n\t\tsortExtensionVersions(actual, TargetPlatform.WIN32_ARM64);\n\t\tassert.deepStrictEqual(actual, expected);\n\t});\n\n\tfunction aExtensionVersion(version: string, targetPlatform?: TargetPlatform): IRawGalleryExtensionVersion {\n\t\treturn { version, targetPlatform } as IRawGalleryExtensionVersion;\n\t}\n\n\tfunction aPreReleaseExtensionVersion(version: string, targetPlatform?: TargetPlatform): IRawGalleryExtensionVersion {\n\t\treturn {\n\t\t\tversion,\n\t\t\ttargetPlatform,\n\t\t\tproperties: [{ key: 'Microsoft.VisualStudio.Code.PreRelease', value: 'true' }]\n\t\t} as IRawGalleryExtensionVersion;\n\t}\n\n\tsuite('filterLatestExtensionVersionsForTargetPlatform', () => {\n\n\t\ttest('should return empty array for empty input', () => {\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform([], TargetPlatform.WIN32_X64, [TargetPlatform.WIN32_X64]);\n\t\t\tassert.deepStrictEqual(result, []);\n\t\t});\n\n\t\ttest('should return single version when only one version provided', () => {\n\t\t\tconst versions = [aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64)];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\t\t\tassert.deepStrictEqual(result, versions);\n\t\t});\n\n\t\ttest('should filter out duplicate target platforms for release versions', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('0.9.0', TargetPlatform.WIN32_X64); // Same platform, older version\n\t\t\tconst versions = [version1, version2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first version (latest) for this platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], version1);\n\t\t});\n\n\t\ttest('should include one version per target platform for release versions', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst version3 = aExtensionVersion('1.0.0', TargetPlatform.LINUX_X64);\n\t\t\tconst versions = [version1, version2, version3];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include all three versions: WIN32_X64 (compatible, first of type) + DARWIN_X64 & LINUX_X64 (non-compatible)\n\t\t\tassert.strictEqual(result.length, 3);\n\t\t\tassert.ok(result.includes(version1)); // Compatible with target platform\n\t\t\tassert.ok(result.includes(version2)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(version3)); // Non-compatible, included\n\t\t});\n\n\t\ttest('should separate release and pre-release versions', () => {\n\t\t\tconst releaseVersion = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preReleaseVersion = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst versions = [releaseVersion, preReleaseVersion];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include both since they are different types (release vs pre-release)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(releaseVersion));\n\t\t\tassert.ok(result.includes(preReleaseVersion));\n\t\t});\n\n\t\ttest('should filter duplicate pre-release versions by target platform', () => {\n\t\t\tconst preRelease1 = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preRelease2 = aPreReleaseExtensionVersion('1.0.0', TargetPlatform.WIN32_X64); // Same platform, older\n\t\t\tconst versions = [preRelease1, preRelease2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first pre-release version for this platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], preRelease1);\n\t\t});\n\n\t\ttest('should handle versions without target platform (UNDEFINED)', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0'); // No target platform specified\n\t\t\tconst version2 = aExtensionVersion('0.9.0'); // No target platform specified\n\t\t\tconst versions = [version1, version2];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should only include the first version since they both have UNDEFINED platform\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0], version1);\n\t\t});\n\n\t\ttest('should handle mixed release and pre-release versions across multiple platforms', () => {\n\t\t\tconst releaseWin = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst releaseMac = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst preReleaseWin = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.WIN32_X64);\n\t\t\tconst preReleaseMac = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst oldReleaseWin = aExtensionVersion('0.9.0', TargetPlatform.WIN32_X64); // Should be filtered out\n\n\t\t\tconst versions = [releaseWin, releaseMac, preReleaseWin, preReleaseMac, oldReleaseWin];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include: WIN32_X64 compatible (release + prerelease) + DARWIN_X64 non-compatible (all versions)\n\t\t\tassert.strictEqual(result.length, 4);\n\t\t\tassert.ok(result.includes(releaseWin)); // Compatible release\n\t\t\tassert.ok(result.includes(releaseMac)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(preReleaseWin)); // Compatible pre-release\n\t\t\tassert.ok(result.includes(preReleaseMac)); // Non-compatible, included\n\t\t\tassert.ok(!result.includes(oldReleaseWin)); // Filtered (older compatible release)\n\t\t});\n\n\t\ttest('should handle complex scenario with multiple versions and platforms', () => {\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.WIN32_X64),\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.DARWIN_X64),\n\t\t\t\taExtensionVersion('1.9.0', TargetPlatform.WIN32_X64), // Older release, same platform\n\t\t\t\taPreReleaseExtensionVersion('2.1.0', TargetPlatform.WIN32_X64),\n\t\t\t\taPreReleaseExtensionVersion('2.0.5', TargetPlatform.WIN32_X64), // Older pre-release, same platform\n\t\t\t\taPreReleaseExtensionVersion('2.1.0', TargetPlatform.LINUX_X64),\n\t\t\t\taExtensionVersion('2.0.0'), // No platform specified\n\t\t\t\taPreReleaseExtensionVersion('2.1.0'), // Pre-release, no platform specified\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Expected for WIN32_X64 target platform:\n\t\t\t// - Compatible (WIN32_X64 + UNDEFINED): Only first release and first pre-release\n\t\t\t// - Non-compatible: DARWIN_X64 release, LINUX_X64 pre-release\n\t\t\t// Total: 4 versions (1 compatible release + 1 compatible pre-release + 2 non-compatible)\n\t\t\tassert.strictEqual(result.length, 4);\n\n\t\t\t// Check specific versions are included\n\t\t\tassert.ok(result.includes(versions[0])); // 2.0.0 WIN32_X64 (first compatible release)\n\t\t\tassert.ok(result.includes(versions[1])); // 2.0.0 DARWIN_X64 (non-compatible)\n\t\t\tassert.ok(result.includes(versions[3])); // 2.1.0 WIN32_X64 (first compatible pre-release)\n\t\t\tassert.ok(result.includes(versions[5])); // 2.1.0 LINUX_X64 (non-compatible)\n\t\t});\n\n\t\ttest('should handle UNDEFINED platform interaction with specific platforms', () => {\n\t\t\t// Test how UNDEFINED platform interacts with specific platforms\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('1.0.0', TargetPlatform.WIN32_X64),\n\t\t\t\taExtensionVersion('1.0.0'), // UNDEFINED platform - compatible with all\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first of each type should be included\n\t\t\t// Since both are release versions, only the first one should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(versions[0])); // WIN32_X64 should be included (first release)\n\t\t});\n\n\t\ttest('should handle higher version with specific platform vs lower version with universal platform', () => {\n\t\t\t// Scenario: newer version for specific platform vs older version with universal compatibility\n\t\t\tconst higherVersionSpecificPlatform = aExtensionVersion('2.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst lowerVersionUniversal = aExtensionVersion('1.5.0'); // UNDEFINED/universal platform\n\n\t\t\tconst versions = [higherVersionSpecificPlatform, lowerVersionUniversal];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first release version should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(higherVersionSpecificPlatform)); // First compatible release\n\t\t\tassert.ok(!result.includes(lowerVersionUniversal)); // Filtered (second compatible release)\n\t\t});\n\n\t\ttest('should handle lower version with specific platform vs higher version with universal platform', () => {\n\t\t\t// Reverse scenario: older version for specific platform vs newer version with universal compatibility\n\t\t\tconst lowerVersionSpecificPlatform = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst higherVersionUniversal = aExtensionVersion('2.0.0'); // UNDEFINED/universal platform\n\n\t\t\tconst versions = [lowerVersionSpecificPlatform, higherVersionUniversal];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Both are compatible with WIN32_X64, but only the first release version should be included\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.ok(result.includes(lowerVersionSpecificPlatform)); // First compatible release\n\t\t\tassert.ok(!result.includes(higherVersionUniversal)); // Filtered (second compatible release)\n\t\t});\n\n\t\ttest('should handle multiple specific platforms vs universal platform with version differences', () => {\n\t\t\t// Complex scenario with multiple platforms and universal compatibility\n\t\t\tconst versions = [\n\t\t\t\taExtensionVersion('2.0.0', TargetPlatform.WIN32_X64),    // Highest version, specific platform\n\t\t\t\taExtensionVersion('1.9.0', TargetPlatform.DARWIN_X64),  // Lower version, different specific platform\n\t\t\t\taExtensionVersion('1.8.0'),                             // Lowest version, universal platform\n\t\t\t\taExtensionVersion('1.7.0', TargetPlatform.WIN32_X64),   // Even older, same platform as first - should be filtered\n\t\t\t];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Should include:\n\t\t\t// - 2.0.0 WIN32_X64 (first compatible release for WIN32_X64)\n\t\t\t// - 1.9.0 DARWIN_X64 (non-compatible, included)\n\t\t\t// - 1.8.0 UNDEFINED (second compatible release, filtered)\n\t\t\t// Should NOT include:\n\t\t\t// - 1.7.0 WIN32_X64 (third compatible release, filtered)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(versions[0])); // 2.0.0 WIN32_X64\n\t\t\tassert.ok(result.includes(versions[1])); // 1.9.0 DARWIN_X64\n\t\t\tassert.ok(!result.includes(versions[2])); // 1.8.0 UNDEFINED should be filtered\n\t\t\tassert.ok(!result.includes(versions[3])); // 1.7.0 WIN32_X64 should be filtered\n\t\t});\n\n\t\ttest('should include universal platform when no specific platforms conflict', () => {\n\t\t\t// Test where universal platform is included because no specific platforms conflict\n\t\t\tconst universalVersion = aExtensionVersion('1.0.0'); // UNDEFINED/universal platform\n\t\t\tconst specificVersion = aExtensionVersion('1.0.0', TargetPlatform.LINUX_ARM64);\n\n\t\t\tconst versions = [universalVersion, specificVersion];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64]; // Note: LINUX_ARM64 not in target platforms\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// Universal is compatible with WIN32_X64, specific version is not compatible\n\t\t\t// So we should get: universal (first compatible release) + specific (non-compatible)\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.ok(result.includes(universalVersion)); // Compatible with WIN32_X64\n\t\t\tassert.ok(result.includes(specificVersion)); // Non-compatible, included\n\t\t});\n\n\t\ttest('should preserve order of input when no filtering occurs', () => {\n\t\t\tconst version1 = aExtensionVersion('1.0.0', TargetPlatform.WIN32_X64);\n\t\t\tconst version2 = aExtensionVersion('1.0.0', TargetPlatform.DARWIN_X64);\n\t\t\tconst version3 = aPreReleaseExtensionVersion('1.1.0', TargetPlatform.LINUX_X64);\n\t\t\tconst versions = [version1, version2, version3];\n\t\t\tconst allTargetPlatforms = [TargetPlatform.WIN32_X64, TargetPlatform.DARWIN_X64, TargetPlatform.LINUX_X64];\n\n\t\t\tconst result = filterLatestExtensionVersionsForTargetPlatform(versions, TargetPlatform.WIN32_X64, allTargetPlatforms);\n\n\t\t\t// For WIN32_X64 target: version1 (compatible release) + version2, version3 (non-compatible)\n\t\t\tassert.strictEqual(result.length, 3);\n\t\t\tassert.ok(result.includes(version1)); // Compatible release\n\t\t\tassert.ok(result.includes(version2)); // Non-compatible, included\n\t\t\tassert.ok(result.includes(version3)); // Non-compatible, included\n\t\t});\n\n\t});\n});\n"]}