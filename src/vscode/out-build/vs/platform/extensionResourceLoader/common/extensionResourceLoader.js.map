{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/extensionResourceLoader/common/extensionResourceLoader.ts","vs/platform/extensionResourceLoader/common/extensionResourceLoader.ts"],"names":[],"mappings":"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","file":"extensionResourceLoader.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isWeb } from '../../../base/common/platform.js';\nimport { format2 } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { getServiceMachineId } from '../../externalServices/common/serviceMachineId.js';\nimport { IStorageService } from '../../storage/common/storage.js';\nimport { TelemetryLevel } from '../../telemetry/common/telemetry.js';\nimport { getTelemetryLevel, supportsTelemetry } from '../../telemetry/common/telemetryUtils.js';\nimport { RemoteAuthorities } from '../../../base/common/network.js';\nimport { TargetPlatform } from '../../extensions/common/extensions.js';\nimport { ExtensionGalleryResourceType, getExtensionGalleryManifestResourceUri, IExtensionGalleryManifest, IExtensionGalleryManifestService } from '../../extensionManagement/common/extensionGalleryManifest.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\n\nconst WEB_EXTENSION_RESOURCE_END_POINT_SEGMENT = '/web-extension-resource/';\n\nexport const IExtensionResourceLoaderService = createDecorator<IExtensionResourceLoaderService>('extensionResourceLoaderService');\n\n/**\n * A service useful for reading resources from within extensions.\n */\nexport interface IExtensionResourceLoaderService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Read a certain resource within an extension.\n\t */\n\treadExtensionResource(uri: URI): Promise<string>;\n\n\t/**\n\t * Returns whether the gallery provides extension resources.\n\t */\n\tsupportsExtensionGalleryResources(): Promise<boolean>;\n\n\t/**\n\t * Return true if the given URI is a extension gallery resource.\n\t */\n\tisExtensionGalleryResource(uri: URI): Promise<boolean>;\n\n\t/**\n\t * Computes the URL of a extension gallery resource. Returns `undefined` if gallery does not provide extension resources.\n\t */\n\tgetExtensionGalleryResourceURL(galleryExtension: { publisher: string; name: string; version: string; targetPlatform?: TargetPlatform }, path?: string): Promise<URI | undefined>;\n}\n\nexport function migratePlatformSpecificExtensionGalleryResourceURL(resource: URI, targetPlatform: TargetPlatform): URI | undefined {\n\tif (resource.query !== `target=${targetPlatform}`) {\n\t\treturn undefined;\n\t}\n\tconst paths = resource.path.split('/');\n\tif (!paths[3]) {\n\t\treturn undefined;\n\t}\n\tpaths[3] = `${paths[3]}+${targetPlatform}`;\n\treturn resource.with({ query: null, path: paths.join('/') });\n}\n\nexport abstract class AbstractExtensionResourceLoaderService extends Disposable implements IExtensionResourceLoaderService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _initPromise: Promise<void>;\n\n\tprivate _extensionGalleryResourceUrlTemplate: string | undefined;\n\tprivate _extensionGalleryAuthority: string | undefined;\n\n\tconstructor(\n\t\tprotected readonly _fileService: IFileService,\n\t\tprivate readonly _storageService: IStorageService,\n\t\tprivate readonly _productService: IProductService,\n\t\tprivate readonly _environmentService: IEnvironmentService,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\tprivate readonly _extensionGalleryManifestService: IExtensionGalleryManifestService,\n\t\tprotected readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._initPromise = this._init();\n\t}\n\n\tprivate async _init(): Promise<void> {\n\t\ttry {\n\t\t\tconst manifest = await this._extensionGalleryManifestService.getExtensionGalleryManifest();\n\t\t\tthis.resolve(manifest);\n\t\t\tthis._register(this._extensionGalleryManifestService.onDidChangeExtensionGalleryManifest(() => this.resolve(manifest)));\n\t\t} catch (error) {\n\t\t\tthis._logService.error(error);\n\t\t}\n\t}\n\n\tprivate resolve(manifest: IExtensionGalleryManifest | null): void {\n\t\tthis._extensionGalleryResourceUrlTemplate = manifest ? getExtensionGalleryManifestResourceUri(manifest, ExtensionGalleryResourceType.ExtensionResourceUri) : undefined;\n\t\tthis._extensionGalleryAuthority = this._extensionGalleryResourceUrlTemplate ? this._getExtensionGalleryAuthority(URI.parse(this._extensionGalleryResourceUrlTemplate)) : undefined;\n\t}\n\n\tpublic async supportsExtensionGalleryResources(): Promise<boolean> {\n\t\tawait this._initPromise;\n\t\treturn this._extensionGalleryResourceUrlTemplate !== undefined;\n\t}\n\n\tpublic async getExtensionGalleryResourceURL({ publisher, name, version, targetPlatform }: { publisher: string; name: string; version: string; targetPlatform?: TargetPlatform }, path?: string): Promise<URI | undefined> {\n\t\tawait this._initPromise;\n\t\tif (this._extensionGalleryResourceUrlTemplate) {\n\t\t\tconst uri = URI.parse(format2(this._extensionGalleryResourceUrlTemplate, {\n\t\t\t\tpublisher,\n\t\t\t\tname,\n\t\t\t\tversion: targetPlatform !== undefined\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNDEFINED\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNKNOWN\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNIVERSAL\n\t\t\t\t\t? `${version}+${targetPlatform}`\n\t\t\t\t\t: version,\n\t\t\t\tpath: 'extension'\n\t\t\t}));\n\t\t\treturn this._isWebExtensionResourceEndPoint(uri) ? uri.with({ scheme: RemoteAuthorities.getPreferredWebSchema() }) : uri;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic abstract readExtensionResource(uri: URI): Promise<string>;\n\n\tasync isExtensionGalleryResource(uri: URI): Promise<boolean> {\n\t\tawait this._initPromise;\n\t\treturn !!this._extensionGalleryAuthority && this._extensionGalleryAuthority === this._getExtensionGalleryAuthority(uri);\n\t}\n\n\tprotected async getExtensionGalleryRequestHeaders(): Promise<Record<string, string>> {\n\t\tconst headers: Record<string, string> = {\n\t\t\t'X-Client-Name': `${this._productService.applicationName}${isWeb ? '-web' : ''}`,\n\t\t\t'X-Client-Version': this._productService.version\n\t\t};\n\t\tif (supportsTelemetry(this._productService, this._environmentService) && getTelemetryLevel(this._configurationService) === TelemetryLevel.USAGE) {\n\t\t\theaders['X-Machine-Id'] = await this._getServiceMachineId();\n\t\t}\n\t\tif (this._productService.commit) {\n\t\t\theaders['X-Client-Commit'] = this._productService.commit;\n\t\t}\n\t\treturn headers;\n\t}\n\n\tprivate _serviceMachineIdPromise: Promise<string> | undefined;\n\tprivate _getServiceMachineId(): Promise<string> {\n\t\tif (!this._serviceMachineIdPromise) {\n\t\t\tthis._serviceMachineIdPromise = getServiceMachineId(this._environmentService, this._fileService, this._storageService);\n\t\t}\n\t\treturn this._serviceMachineIdPromise;\n\t}\n\n\tprivate _getExtensionGalleryAuthority(uri: URI): string | undefined {\n\t\tif (this._isWebExtensionResourceEndPoint(uri)) {\n\t\t\treturn uri.authority;\n\t\t}\n\t\tconst index = uri.authority.indexOf('.');\n\t\treturn index !== -1 ? uri.authority.substring(index + 1) : undefined;\n\t}\n\n\tprotected _isWebExtensionResourceEndPoint(uri: URI): boolean {\n\t\tconst uriPath = uri.path, serverRootPath = RemoteAuthorities.getServerRootPath();\n\t\t// test if the path starts with the server root path followed by the web extension resource end point segment\n\t\treturn uriPath.startsWith(serverRootPath) && uriPath.startsWith(WEB_EXTENSION_RESOURCE_END_POINT_SEGMENT, serverRootPath.length);\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isWeb } from '../../../base/common/platform.js';\nimport { format2 } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { getServiceMachineId } from '../../externalServices/common/serviceMachineId.js';\nimport { IStorageService } from '../../storage/common/storage.js';\nimport { TelemetryLevel } from '../../telemetry/common/telemetry.js';\nimport { getTelemetryLevel, supportsTelemetry } from '../../telemetry/common/telemetryUtils.js';\nimport { RemoteAuthorities } from '../../../base/common/network.js';\nimport { TargetPlatform } from '../../extensions/common/extensions.js';\nimport { ExtensionGalleryResourceType, getExtensionGalleryManifestResourceUri, IExtensionGalleryManifest, IExtensionGalleryManifestService } from '../../extensionManagement/common/extensionGalleryManifest.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\n\nconst WEB_EXTENSION_RESOURCE_END_POINT_SEGMENT = '/web-extension-resource/';\n\nexport const IExtensionResourceLoaderService = createDecorator<IExtensionResourceLoaderService>('extensionResourceLoaderService');\n\n/**\n * A service useful for reading resources from within extensions.\n */\nexport interface IExtensionResourceLoaderService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Read a certain resource within an extension.\n\t */\n\treadExtensionResource(uri: URI): Promise<string>;\n\n\t/**\n\t * Returns whether the gallery provides extension resources.\n\t */\n\tsupportsExtensionGalleryResources(): Promise<boolean>;\n\n\t/**\n\t * Return true if the given URI is a extension gallery resource.\n\t */\n\tisExtensionGalleryResource(uri: URI): Promise<boolean>;\n\n\t/**\n\t * Computes the URL of a extension gallery resource. Returns `undefined` if gallery does not provide extension resources.\n\t */\n\tgetExtensionGalleryResourceURL(galleryExtension: { publisher: string; name: string; version: string; targetPlatform?: TargetPlatform }, path?: string): Promise<URI | undefined>;\n}\n\nexport function migratePlatformSpecificExtensionGalleryResourceURL(resource: URI, targetPlatform: TargetPlatform): URI | undefined {\n\tif (resource.query !== `target=${targetPlatform}`) {\n\t\treturn undefined;\n\t}\n\tconst paths = resource.path.split('/');\n\tif (!paths[3]) {\n\t\treturn undefined;\n\t}\n\tpaths[3] = `${paths[3]}+${targetPlatform}`;\n\treturn resource.with({ query: null, path: paths.join('/') });\n}\n\nexport abstract class AbstractExtensionResourceLoaderService extends Disposable implements IExtensionResourceLoaderService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _initPromise: Promise<void>;\n\n\tprivate _extensionGalleryResourceUrlTemplate: string | undefined;\n\tprivate _extensionGalleryAuthority: string | undefined;\n\n\tconstructor(\n\t\tprotected readonly _fileService: IFileService,\n\t\tprivate readonly _storageService: IStorageService,\n\t\tprivate readonly _productService: IProductService,\n\t\tprivate readonly _environmentService: IEnvironmentService,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\tprivate readonly _extensionGalleryManifestService: IExtensionGalleryManifestService,\n\t\tprotected readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._initPromise = this._init();\n\t}\n\n\tprivate async _init(): Promise<void> {\n\t\ttry {\n\t\t\tconst manifest = await this._extensionGalleryManifestService.getExtensionGalleryManifest();\n\t\t\tthis.resolve(manifest);\n\t\t\tthis._register(this._extensionGalleryManifestService.onDidChangeExtensionGalleryManifest(() => this.resolve(manifest)));\n\t\t} catch (error) {\n\t\t\tthis._logService.error(error);\n\t\t}\n\t}\n\n\tprivate resolve(manifest: IExtensionGalleryManifest | null): void {\n\t\tthis._extensionGalleryResourceUrlTemplate = manifest ? getExtensionGalleryManifestResourceUri(manifest, ExtensionGalleryResourceType.ExtensionResourceUri) : undefined;\n\t\tthis._extensionGalleryAuthority = this._extensionGalleryResourceUrlTemplate ? this._getExtensionGalleryAuthority(URI.parse(this._extensionGalleryResourceUrlTemplate)) : undefined;\n\t}\n\n\tpublic async supportsExtensionGalleryResources(): Promise<boolean> {\n\t\tawait this._initPromise;\n\t\treturn this._extensionGalleryResourceUrlTemplate !== undefined;\n\t}\n\n\tpublic async getExtensionGalleryResourceURL({ publisher, name, version, targetPlatform }: { publisher: string; name: string; version: string; targetPlatform?: TargetPlatform }, path?: string): Promise<URI | undefined> {\n\t\tawait this._initPromise;\n\t\tif (this._extensionGalleryResourceUrlTemplate) {\n\t\t\tconst uri = URI.parse(format2(this._extensionGalleryResourceUrlTemplate, {\n\t\t\t\tpublisher,\n\t\t\t\tname,\n\t\t\t\tversion: targetPlatform !== undefined\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNDEFINED\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNKNOWN\n\t\t\t\t\t&& targetPlatform !== TargetPlatform.UNIVERSAL\n\t\t\t\t\t? `${version}+${targetPlatform}`\n\t\t\t\t\t: version,\n\t\t\t\tpath: 'extension'\n\t\t\t}));\n\t\t\treturn this._isWebExtensionResourceEndPoint(uri) ? uri.with({ scheme: RemoteAuthorities.getPreferredWebSchema() }) : uri;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic abstract readExtensionResource(uri: URI): Promise<string>;\n\n\tasync isExtensionGalleryResource(uri: URI): Promise<boolean> {\n\t\tawait this._initPromise;\n\t\treturn !!this._extensionGalleryAuthority && this._extensionGalleryAuthority === this._getExtensionGalleryAuthority(uri);\n\t}\n\n\tprotected async getExtensionGalleryRequestHeaders(): Promise<Record<string, string>> {\n\t\tconst headers: Record<string, string> = {\n\t\t\t'X-Client-Name': `${this._productService.applicationName}${isWeb ? '-web' : ''}`,\n\t\t\t'X-Client-Version': this._productService.version\n\t\t};\n\t\tif (supportsTelemetry(this._productService, this._environmentService) && getTelemetryLevel(this._configurationService) === TelemetryLevel.USAGE) {\n\t\t\theaders['X-Machine-Id'] = await this._getServiceMachineId();\n\t\t}\n\t\tif (this._productService.commit) {\n\t\t\theaders['X-Client-Commit'] = this._productService.commit;\n\t\t}\n\t\treturn headers;\n\t}\n\n\tprivate _serviceMachineIdPromise: Promise<string> | undefined;\n\tprivate _getServiceMachineId(): Promise<string> {\n\t\tif (!this._serviceMachineIdPromise) {\n\t\t\tthis._serviceMachineIdPromise = getServiceMachineId(this._environmentService, this._fileService, this._storageService);\n\t\t}\n\t\treturn this._serviceMachineIdPromise;\n\t}\n\n\tprivate _getExtensionGalleryAuthority(uri: URI): string | undefined {\n\t\tif (this._isWebExtensionResourceEndPoint(uri)) {\n\t\t\treturn uri.authority;\n\t\t}\n\t\tconst index = uri.authority.indexOf('.');\n\t\treturn index !== -1 ? uri.authority.substring(index + 1) : undefined;\n\t}\n\n\tprotected _isWebExtensionResourceEndPoint(uri: URI): boolean {\n\t\tconst uriPath = uri.path, serverRootPath = RemoteAuthorities.getServerRootPath();\n\t\t// test if the path starts with the server root path followed by the web extension resource end point segment\n\t\treturn uriPath.startsWith(serverRootPath) && uriPath.startsWith(WEB_EXTENSION_RESOURCE_END_POINT_SEGMENT, serverRootPath.length);\n\t}\n\n}\n"]}