{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/telemetry/node/1dsAppender.ts","vs/platform/telemetry/node/1dsAppender.ts"],"names":[],"mappings":"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","file":"1dsAppender.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IPayloadData, IXHROverride } from '@microsoft/1ds-post-js';\nimport { streamToBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IRequestOptions } from '../../../base/parts/request/common/request.js';\nimport { IRequestService } from '../../request/common/request.js';\nimport { AbstractOneDataSystemAppender, IAppInsightsCore } from '../common/1dsAppender.js';\n\ntype OnCompleteFunc = (status: number, headers: { [headerName: string]: string }, response?: string) => void;\n\ninterface IResponseData {\n\theaders: { [headerName: string]: string };\n\tstatusCode: number;\n\tresponseData: string;\n}\n\n/**\n * Completes a request to submit telemetry to the server utilizing the request service\n * @param options The options which will be used to make the request\n * @param requestService The request service\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeTelemetryRequest(options: IRequestOptions, requestService: IRequestService): Promise<IResponseData> {\n\tconst response = await requestService.request(options, CancellationToken.None);\n\tconst responseData = (await streamToBuffer(response.stream)).toString();\n\tconst statusCode = response.res.statusCode ?? 200;\n\tconst headers = response.res.headers as Record<string, string>;\n\treturn {\n\t\theaders,\n\t\tstatusCode,\n\t\tresponseData\n\t};\n}\n\n/**\n * Complete a request to submit telemetry to the server utilizing the https module. Only used when the request service is not available\n * @param options The options which will be used to make the request\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeLegacyTelemetryRequest(options: IRequestOptions): Promise<IResponseData> {\n\tconst https = await import('https'); // Lazy due to https://github.com/nodejs/node/issues/59686\n\tconst httpsOptions = {\n\t\tmethod: options.type,\n\t\theaders: options.headers\n\t};\n\tconst responsePromise = new Promise<IResponseData>((resolve, reject) => {\n\t\tconst req = https.request(options.url ?? '', httpsOptions, res => {\n\t\t\tres.on('data', function (responseData) {\n\t\t\t\tresolve({\n\t\t\t\t\theaders: res.headers as Record<string, string>,\n\t\t\t\t\tstatusCode: res.statusCode ?? 200,\n\t\t\t\t\tresponseData: responseData.toString()\n\t\t\t\t});\n\t\t\t});\n\t\t\t// On response with error send status of 0 and a blank response to oncomplete so we can retry events\n\t\t\tres.on('error', function (err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t\treq.write(options.data, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t\treq.end();\n\t});\n\treturn responsePromise;\n}\n\nasync function sendPostAsync(requestService: IRequestService | undefined, payload: IPayloadData, oncomplete: OnCompleteFunc) {\n\tconst telemetryRequestData = typeof payload.data === 'string' ? payload.data : new TextDecoder().decode(payload.data);\n\tconst requestOptions: IRequestOptions = {\n\t\ttype: 'POST',\n\t\theaders: {\n\t\t\t...payload.headers,\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Content-Length': Buffer.byteLength(payload.data).toString()\n\t\t},\n\t\turl: payload.urlString,\n\t\tdata: telemetryRequestData\n\t};\n\n\ttry {\n\t\tconst responseData = requestService ? await makeTelemetryRequest(requestOptions, requestService) : await makeLegacyTelemetryRequest(requestOptions);\n\t\toncomplete(responseData.statusCode, responseData.headers, responseData.responseData);\n\t} catch {\n\t\t// If it errors out, send status of 0 and a blank response to oncomplete so we can retry events\n\t\toncomplete(0, {});\n\t}\n}\n\n\nexport class OneDataSystemAppender extends AbstractOneDataSystemAppender {\n\n\tconstructor(\n\t\trequestService: IRequestService | undefined,\n\t\tisInternalTelemetry: boolean,\n\t\teventPrefix: string,\n\t\tdefaultData: { [key: string]: unknown } | null,\n\t\tiKeyOrClientFactory: string | (() => IAppInsightsCore), // allow factory function for testing\n\t) {\n\t\t// Override the way events get sent since node doesn't have XHTMLRequest\n\t\tconst customHttpXHROverride: IXHROverride = {\n\t\t\tsendPOST: (payload: IPayloadData, oncomplete: OnCompleteFunc) => {\n\t\t\t\t// Fire off the async request without awaiting it\n\t\t\t\tsendPostAsync(requestService, payload, oncomplete);\n\t\t\t}\n\t\t};\n\n\t\tsuper(isInternalTelemetry, eventPrefix, defaultData, iKeyOrClientFactory, customHttpXHROverride);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IPayloadData, IXHROverride } from '@microsoft/1ds-post-js';\nimport { streamToBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IRequestOptions } from '../../../base/parts/request/common/request.js';\nimport { IRequestService } from '../../request/common/request.js';\nimport { AbstractOneDataSystemAppender, IAppInsightsCore } from '../common/1dsAppender.js';\n\ntype OnCompleteFunc = (status: number, headers: { [headerName: string]: string }, response?: string) => void;\n\ninterface IResponseData {\n\theaders: { [headerName: string]: string };\n\tstatusCode: number;\n\tresponseData: string;\n}\n\n/**\n * Completes a request to submit telemetry to the server utilizing the request service\n * @param options The options which will be used to make the request\n * @param requestService The request service\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeTelemetryRequest(options: IRequestOptions, requestService: IRequestService): Promise<IResponseData> {\n\tconst response = await requestService.request(options, CancellationToken.None);\n\tconst responseData = (await streamToBuffer(response.stream)).toString();\n\tconst statusCode = response.res.statusCode ?? 200;\n\tconst headers = response.res.headers as Record<string, string>;\n\treturn {\n\t\theaders,\n\t\tstatusCode,\n\t\tresponseData\n\t};\n}\n\n/**\n * Complete a request to submit telemetry to the server utilizing the https module. Only used when the request service is not available\n * @param options The options which will be used to make the request\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeLegacyTelemetryRequest(options: IRequestOptions): Promise<IResponseData> {\n\tconst https = await import('https'); // Lazy due to https://github.com/nodejs/node/issues/59686\n\tconst httpsOptions = {\n\t\tmethod: options.type,\n\t\theaders: options.headers\n\t};\n\tconst responsePromise = new Promise<IResponseData>((resolve, reject) => {\n\t\tconst req = https.request(options.url ?? '', httpsOptions, res => {\n\t\t\tres.on('data', function (responseData) {\n\t\t\t\tresolve({\n\t\t\t\t\theaders: res.headers as Record<string, string>,\n\t\t\t\t\tstatusCode: res.statusCode ?? 200,\n\t\t\t\t\tresponseData: responseData.toString()\n\t\t\t\t});\n\t\t\t});\n\t\t\t// On response with error send status of 0 and a blank response to oncomplete so we can retry events\n\t\t\tres.on('error', function (err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t\treq.write(options.data, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t\treq.end();\n\t});\n\treturn responsePromise;\n}\n\nasync function sendPostAsync(requestService: IRequestService | undefined, payload: IPayloadData, oncomplete: OnCompleteFunc) {\n\tconst telemetryRequestData = typeof payload.data === 'string' ? payload.data : new TextDecoder().decode(payload.data);\n\tconst requestOptions: IRequestOptions = {\n\t\ttype: 'POST',\n\t\theaders: {\n\t\t\t...payload.headers,\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Content-Length': Buffer.byteLength(payload.data).toString()\n\t\t},\n\t\turl: payload.urlString,\n\t\tdata: telemetryRequestData\n\t};\n\n\ttry {\n\t\tconst responseData = requestService ? await makeTelemetryRequest(requestOptions, requestService) : await makeLegacyTelemetryRequest(requestOptions);\n\t\toncomplete(responseData.statusCode, responseData.headers, responseData.responseData);\n\t} catch {\n\t\t// If it errors out, send status of 0 and a blank response to oncomplete so we can retry events\n\t\toncomplete(0, {});\n\t}\n}\n\n\nexport class OneDataSystemAppender extends AbstractOneDataSystemAppender {\n\n\tconstructor(\n\t\trequestService: IRequestService | undefined,\n\t\tisInternalTelemetry: boolean,\n\t\teventPrefix: string,\n\t\tdefaultData: { [key: string]: unknown } | null,\n\t\tiKeyOrClientFactory: string | (() => IAppInsightsCore), // allow factory function for testing\n\t) {\n\t\t// Override the way events get sent since node doesn't have XHTMLRequest\n\t\tconst customHttpXHROverride: IXHROverride = {\n\t\t\tsendPOST: (payload: IPayloadData, oncomplete: OnCompleteFunc) => {\n\t\t\t\t// Fire off the async request without awaiting it\n\t\t\t\tsendPostAsync(requestService, payload, oncomplete);\n\t\t\t}\n\t\t};\n\n\t\tsuper(isInternalTelemetry, eventPrefix, defaultData, iKeyOrClientFactory, customHttpXHROverride);\n\t}\n}\n"]}