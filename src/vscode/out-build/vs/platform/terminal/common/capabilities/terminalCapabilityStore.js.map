{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/terminal/common/capabilities/terminalCapabilityStore.ts","vs/platform/terminal/common/capabilities/terminalCapabilityStore.ts"],"names":[],"mappings":"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","file":"terminalCapabilityStore.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ICommandDetectionCapability, ITerminalCapabilityImplMap, ITerminalCapabilityStore, TerminalCapability, type AnyTerminalCapabilityChangeEvent, type ICwdDetectionCapability } from './capabilities.js';\n\nexport class TerminalCapabilityStore extends Disposable implements ITerminalCapabilityStore {\n\tprivate _map: Map<TerminalCapability, ITerminalCapabilityImplMap[TerminalCapability]> = new Map();\n\n\tprivate readonly _onDidAddCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidAddCapability() { return this._onDidAddCapability.event; }\n\tprivate readonly _onDidRemoveCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidRemoveCapability() { return this._onDidRemoveCapability.event; }\n\n\t@memoize\n\tget onDidChangeCapabilities() {\n\t\treturn Event.map(Event.any(\n\t\t\tthis._onDidAddCapability.event,\n\t\t\tthis._onDidRemoveCapability.event\n\t\t), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CommandDetection, this._store), e => e.capability as ICommandDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CommandDetection, this._store), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CwdDetection, this._store), e => e.capability as ICwdDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CwdDetection, this._store), () => void 0, this._store);\n\t}\n\n\tget items(): IterableIterator<TerminalCapability> {\n\t\treturn this._map.keys();\n\t}\n\n\tcreateOnDidRemoveCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\tcreateOnDidAddCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\n\tadd<T extends TerminalCapability>(capability: T, impl: ITerminalCapabilityImplMap[T]) {\n\t\tthis._map.set(capability, impl);\n\t\tthis._onDidAddCapability.fire(createCapabilityEvent(capability, impl));\n\t}\n\n\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\t// HACK: This isn't totally safe since the Map key and value are not connected\n\t\treturn this._map.get(capability) as ITerminalCapabilityImplMap[T] | undefined;\n\t}\n\n\tremove(capability: TerminalCapability) {\n\t\tconst impl = this._map.get(capability);\n\t\tif (!impl) {\n\t\t\treturn;\n\t\t}\n\t\tthis._map.delete(capability);\n\t\tthis._onDidRemoveCapability.fire(createCapabilityEvent(capability, impl));\n\t}\n\n\thas(capability: TerminalCapability) {\n\t\treturn this._map.has(capability);\n\t}\n}\n\nexport class TerminalCapabilityStoreMultiplexer extends Disposable implements ITerminalCapabilityStore {\n\treadonly _stores: ITerminalCapabilityStore[] = [];\n\n\tprivate readonly _onDidAddCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidAddCapability() { return this._onDidAddCapability.event; }\n\tprivate readonly _onDidRemoveCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidRemoveCapability() { return this._onDidRemoveCapability.event; }\n\n\t@memoize\n\tget onDidChangeCapabilities() {\n\t\treturn Event.map(Event.any(\n\t\t\tthis._onDidAddCapability.event,\n\t\t\tthis._onDidRemoveCapability.event\n\t\t), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CommandDetection, this._store), e => e.capability as ICommandDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CommandDetection, this._store), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CwdDetection, this._store), e => e.capability as ICwdDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CwdDetection, this._store), () => void 0, this._store);\n\t}\n\n\tget items(): IterableIterator<TerminalCapability> {\n\t\treturn this._items();\n\t}\n\n\tcreateOnDidRemoveCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\tcreateOnDidAddCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\n\tprivate *_items(): IterableIterator<TerminalCapability> {\n\t\tfor (const store of this._stores) {\n\t\t\tfor (const c of store.items) {\n\t\t\t\tyield c;\n\t\t\t}\n\t\t}\n\t}\n\n\thas(capability: TerminalCapability): boolean {\n\t\tfor (const store of this._stores) {\n\t\t\tfor (const c of store.items) {\n\t\t\t\tif (c === capability) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\tfor (const store of this._stores) {\n\t\t\tconst c = store.get(capability);\n\t\t\tif (c) {\n\t\t\t\treturn c;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tadd(store: ITerminalCapabilityStore) {\n\t\tthis._stores.push(store);\n\t\tfor (const capability of store.items) {\n\t\t\tthis._onDidAddCapability.fire(createCapabilityEvent(capability, store.get(capability)!));\n\t\t}\n\t\tthis._register(store.onDidAddCapability(e => this._onDidAddCapability.fire(e)));\n\t\tthis._register(store.onDidRemoveCapability(e => this._onDidRemoveCapability.fire(e)));\n\t}\n}\n\nfunction createCapabilityEvent<T extends TerminalCapability>(capability: T, impl: ITerminalCapabilityImplMap[T]): AnyTerminalCapabilityChangeEvent {\n\t// HACK: This cast is required to convert a generic type to a discriminated union, this is\n\t// necessary in order to enable type narrowing on the event consumer side.\n\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\treturn { id: capability, capability: impl } as AnyTerminalCapabilityChangeEvent;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ICommandDetectionCapability, ITerminalCapabilityImplMap, ITerminalCapabilityStore, TerminalCapability, type AnyTerminalCapabilityChangeEvent, type ICwdDetectionCapability } from './capabilities.js';\n\nexport class TerminalCapabilityStore extends Disposable implements ITerminalCapabilityStore {\n\tprivate _map: Map<TerminalCapability, ITerminalCapabilityImplMap[TerminalCapability]> = new Map();\n\n\tprivate readonly _onDidAddCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidAddCapability() { return this._onDidAddCapability.event; }\n\tprivate readonly _onDidRemoveCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidRemoveCapability() { return this._onDidRemoveCapability.event; }\n\n\t@memoize\n\tget onDidChangeCapabilities() {\n\t\treturn Event.map(Event.any(\n\t\t\tthis._onDidAddCapability.event,\n\t\t\tthis._onDidRemoveCapability.event\n\t\t), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CommandDetection, this._store), e => e.capability as ICommandDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CommandDetection, this._store), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CwdDetection, this._store), e => e.capability as ICwdDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CwdDetection, this._store), () => void 0, this._store);\n\t}\n\n\tget items(): IterableIterator<TerminalCapability> {\n\t\treturn this._map.keys();\n\t}\n\n\tcreateOnDidRemoveCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\tcreateOnDidAddCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\n\tadd<T extends TerminalCapability>(capability: T, impl: ITerminalCapabilityImplMap[T]) {\n\t\tthis._map.set(capability, impl);\n\t\tthis._onDidAddCapability.fire(createCapabilityEvent(capability, impl));\n\t}\n\n\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\t// HACK: This isn't totally safe since the Map key and value are not connected\n\t\treturn this._map.get(capability) as ITerminalCapabilityImplMap[T] | undefined;\n\t}\n\n\tremove(capability: TerminalCapability) {\n\t\tconst impl = this._map.get(capability);\n\t\tif (!impl) {\n\t\t\treturn;\n\t\t}\n\t\tthis._map.delete(capability);\n\t\tthis._onDidRemoveCapability.fire(createCapabilityEvent(capability, impl));\n\t}\n\n\thas(capability: TerminalCapability) {\n\t\treturn this._map.has(capability);\n\t}\n}\n\nexport class TerminalCapabilityStoreMultiplexer extends Disposable implements ITerminalCapabilityStore {\n\treadonly _stores: ITerminalCapabilityStore[] = [];\n\n\tprivate readonly _onDidAddCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidAddCapability() { return this._onDidAddCapability.event; }\n\tprivate readonly _onDidRemoveCapability = this._register(new Emitter<AnyTerminalCapabilityChangeEvent>());\n\tget onDidRemoveCapability() { return this._onDidRemoveCapability.event; }\n\n\t@memoize\n\tget onDidChangeCapabilities() {\n\t\treturn Event.map(Event.any(\n\t\t\tthis._onDidAddCapability.event,\n\t\t\tthis._onDidRemoveCapability.event\n\t\t), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CommandDetection, this._store), e => e.capability as ICommandDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCommandDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CommandDetection, this._store), () => void 0, this._store);\n\t}\n\t@memoize\n\tget onDidAddCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === TerminalCapability.CwdDetection, this._store), e => e.capability as ICwdDetectionCapability, this._store);\n\t}\n\t@memoize\n\tget onDidRemoveCwdDetectionCapability() {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === TerminalCapability.CwdDetection, this._store), () => void 0, this._store);\n\t}\n\n\tget items(): IterableIterator<TerminalCapability> {\n\t\treturn this._items();\n\t}\n\n\tcreateOnDidRemoveCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidRemoveCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\tcreateOnDidAddCapabilityOfTypeEvent<T extends TerminalCapability>(type: T): Event<ITerminalCapabilityImplMap[T]> {\n\t\treturn Event.map(Event.filter(this.onDidAddCapability, e => e.id === type), e => e.capability as ITerminalCapabilityImplMap[T]);\n\t}\n\n\tprivate *_items(): IterableIterator<TerminalCapability> {\n\t\tfor (const store of this._stores) {\n\t\t\tfor (const c of store.items) {\n\t\t\t\tyield c;\n\t\t\t}\n\t\t}\n\t}\n\n\thas(capability: TerminalCapability): boolean {\n\t\tfor (const store of this._stores) {\n\t\t\tfor (const c of store.items) {\n\t\t\t\tif (c === capability) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\tfor (const store of this._stores) {\n\t\t\tconst c = store.get(capability);\n\t\t\tif (c) {\n\t\t\t\treturn c;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tadd(store: ITerminalCapabilityStore) {\n\t\tthis._stores.push(store);\n\t\tfor (const capability of store.items) {\n\t\t\tthis._onDidAddCapability.fire(createCapabilityEvent(capability, store.get(capability)!));\n\t\t}\n\t\tthis._register(store.onDidAddCapability(e => this._onDidAddCapability.fire(e)));\n\t\tthis._register(store.onDidRemoveCapability(e => this._onDidRemoveCapability.fire(e)));\n\t}\n}\n\nfunction createCapabilityEvent<T extends TerminalCapability>(capability: T, impl: ITerminalCapabilityImplMap[T]): AnyTerminalCapabilityChangeEvent {\n\t// HACK: This cast is required to convert a generic type to a discriminated union, this is\n\t// necessary in order to enable type narrowing on the event consumer side.\n\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\treturn { id: capability, capability: impl } as AnyTerminalCapabilityChangeEvent;\n}\n"]}