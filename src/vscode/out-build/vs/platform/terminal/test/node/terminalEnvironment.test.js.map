{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/terminal/test/node/terminalEnvironment.test.ts","vs/platform/terminal/test/node/terminalEnvironment.test.ts"],"names":[],"mappings":"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","file":"terminalEnvironment.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-test-async-suite */\nimport { deepStrictEqual, ok, strictEqual } from 'assert';\nimport { homedir, userInfo } from 'os';\nimport { isWindows } from '../../../../base/common/platform.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../log/common/log.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { ITerminalProcessOptions } from '../../common/terminal.js';\nimport { getShellIntegrationInjection, getWindowsBuildNumber, IShellIntegrationConfigInjection, type IShellIntegrationInjectionFailure } from '../../node/terminalEnvironment.js';\n\nconst enabledProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: true, suggestEnabled: false, nonce: '' }, windowsEnableConpty: true, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst disabledProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: false, suggestEnabled: false, nonce: '' }, windowsEnableConpty: true, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst winptyProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: true, suggestEnabled: false, nonce: '' }, windowsEnableConpty: false, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst pwshExe = process.platform === 'win32' ? 'pwsh.exe' : 'pwsh';\nconst repoRoot = process.platform === 'win32' ? process.cwd()[0].toLowerCase() + process.cwd().substring(1) : process.cwd();\nconst logService = new NullLogService();\nconst productService = { applicationName: 'vscode' } as IProductService;\nconst defaultEnvironment = {};\n\nfunction deepStrictEqualIgnoreStableVar(actual: IShellIntegrationConfigInjection | IShellIntegrationInjectionFailure | undefined, expected: IShellIntegrationConfigInjection) {\n\tif (actual?.type === 'injection' && actual.envMixin) {\n\t\tdelete actual.envMixin['VSCODE_STABLE'];\n\t}\n\tdeepStrictEqual(actual, expected);\n}\n\nsuite('platform - terminalEnvironment', async () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\tsuite('getShellIntegrationInjection', async () => {\n\t\tsuite('should not enable', async () => {\n\t\t\t// This test is only expected to work on Windows 10 build 18309 and above\n\t\t\t(getWindowsBuildNumber() < 18309 ? test.skip : test)('when isFeatureTerminal or when no executable is provided', async () => {\n\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'], isFeatureTerminal: true }, enabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'], isFeatureTerminal: false }, enabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'injection');\n\t\t\t});\n\t\t\tif (isWindows) {\n\t\t\t\ttest('when on windows with conpty false', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l'], isFeatureTerminal: false }, winptyProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// These tests are only expected to work on Windows 10 build 18309 and above\n\t\t(getWindowsBuildNumber() < 18309 ? suite.skip : suite)('pwsh', async () => {\n\t\t\tconst expectedPs1 = process.platform === 'win32'\n\t\t\t\t? `try { . \"${repoRoot}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\" } catch {}`\n\t\t\t\t: `. \"${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"`;\n\t\t\tsuite('should override args', async () => {\n\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\ttype: 'injection',\n\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t'-noexit',\n\t\t\t\t\t\t'-command',\n\t\t\t\t\t\texpectedPs1\n\t\t\t\t\t],\n\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\tVSCODE_A11Y_MODE: '0',\n\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('when undefined, []', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t\tsuite('when no logo', async () => {\n\t\t\t\t\ttest('array - case insensitive', async () => {\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NoLogo'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NOLOGO'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-nol'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NOL'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t\ttest('string - case insensitive', async () => {\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NoLogo' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NOLOGO' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-nol' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NOL' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('should incorporate login arg', async () => {\n\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\ttype: 'injection',\n\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t'-l',\n\t\t\t\t\t\t'-noexit',\n\t\t\t\t\t\t'-command',\n\t\t\t\t\t\texpectedPs1\n\t\t\t\t\t],\n\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\tVSCODE_A11Y_MODE: '0',\n\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('when array contains no logo and login', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t\ttest('when string', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-l' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('should not modify args', async () => {\n\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: '-l' }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t\ttest('when using unrecognized arg', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo', '-i'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t\ttest('when using unrecognized arg (string)', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: '-i' }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tif (process.platform !== 'win32') {\n\t\t\tsuite('zsh', async () => {\n\t\t\t\tsuite('should override args', async () => {\n\t\t\t\t\tconst username = userInfo().username;\n\t\t\t\t\tconst expectedDir = new RegExp(`.+\\/${username}-vscode-zsh`);\n\t\t\t\t\tconst customZdotdir = '/custom/zsh/dotdir';\n\t\t\t\t\tconst expectedDests = [\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zshrc`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zprofile`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zshenv`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zlogin`)\n\t\t\t\t\t];\n\t\t\t\t\tconst expectedSources = [\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-rc.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-profile.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-env.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-login.zsh/\n\t\t\t\t\t];\n\t\t\t\t\tfunction assertIsEnabled(result: IShellIntegrationConfigInjection, globalZdotdir = homedir()) {\n\t\t\t\t\t\tstrictEqual(Object.keys(result.envMixin!).length, 3);\n\t\t\t\t\t\tok(result.envMixin!['ZDOTDIR']?.match(expectedDir));\n\t\t\t\t\t\tstrictEqual(result.envMixin!['USER_ZDOTDIR'], globalZdotdir);\n\t\t\t\t\t\tok(result.envMixin!['VSCODE_INJECTION']?.match('1'));\n\t\t\t\t\t\tstrictEqual(result.filesToCopy?.length, 4);\n\t\t\t\t\t\tok(result.filesToCopy[0].dest.match(expectedDests[0]));\n\t\t\t\t\t\tok(result.filesToCopy[1].dest.match(expectedDests[1]));\n\t\t\t\t\t\tok(result.filesToCopy[2].dest.match(expectedDests[2]));\n\t\t\t\t\t\tok(result.filesToCopy[3].dest.match(expectedDests[3]));\n\t\t\t\t\t\tok(result.filesToCopy[0].source.match(expectedSources[0]));\n\t\t\t\t\t\tok(result.filesToCopy[1].source.match(expectedSources[1]));\n\t\t\t\t\t\tok(result.filesToCopy[2].source.match(expectedSources[2]));\n\t\t\t\t\t\tok(result.filesToCopy[3].source.match(expectedSources[3]));\n\t\t\t\t\t}\n\t\t\t\t\ttest('when undefined, []', async () => {\n\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\tassertIsEnabled(result1);\n\t\t\t\t\t\tconst result2 = await getShellIntegrationInjection({ executable: 'zsh', args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\tdeepStrictEqual(result2?.newArgs, ['-i']);\n\t\t\t\t\t\tassertIsEnabled(result2);\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should incorporate login arg', async () => {\n\t\t\t\t\t\ttest('when array', async () => {\n\t\t\t\t\t\t\tconst result = await getShellIntegrationInjection({ executable: 'zsh', args: ['-l'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result?.newArgs, ['-il']);\n\t\t\t\t\t\t\tassertIsEnabled(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should not modify args', async () => {\n\t\t\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when using unrecognized arg', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: ['-l', '-fake'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should incorporate global ZDOTDIR env variable', async () => {\n\t\t\t\t\t\ttest('when custom ZDOTDIR', async () => {\n\t\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, { ...defaultEnvironment, ZDOTDIR: customZdotdir }, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\t\tassertIsEnabled(result1, customZdotdir);\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when undefined', async () => {\n\t\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, undefined, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\t\tassertIsEnabled(result1);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('bash', async () => {\n\t\t\t\tsuite('should override args', async () => {\n\t\t\t\t\ttest('when undefined, [], empty string', async () => {\n\t\t\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\t\t\ttype: 'injection',\n\t\t\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t\t\t'--init-file',\n\t\t\t\t\t\t\t\t`${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh`\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: '' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should set login env variable and not modify args', async () => {\n\t\t\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\t\t\ttype: 'injection',\n\t\t\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t\t\t'--init-file',\n\t\t\t\t\t\t\t\t`${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh`\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\t\t\tVSCODE_INJECTION: '1',\n\t\t\t\t\t\t\t\tVSCODE_SHELL_LOGIN: '1'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when array', async () => {\n\t\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: ['-l'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should not modify args', async () => {\n\t\t\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when custom array entry', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: ['-l', '-i'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tsuite('custom shell integration nonce', async () => {\n\t\t\ttest('should fail for unsupported shell but nonce should still be available', async () => {\n\t\t\t\tconst customProcessOptions: ITerminalProcessOptions = {\n\t\t\t\t\tshellIntegration: { enabled: true, suggestEnabled: false, nonce: 'custom-nonce-12345' },\n\t\t\t\t\twindowsEnableConpty: true,\n\t\t\t\t\twindowsUseConptyDll: false,\n\t\t\t\t\tenvironmentVariableCollections: undefined,\n\t\t\t\t\tworkspaceFolder: undefined,\n\t\t\t\t\tisScreenReaderOptimized: false\n\t\t\t\t};\n\n\t\t\t\t// Test with an unsupported shell (julia)\n\t\t\t\tconst result = await getShellIntegrationInjection(\n\t\t\t\t\t{ executable: 'julia', args: ['-i'] },\n\t\t\t\t\tcustomProcessOptions,\n\t\t\t\t\tdefaultEnvironment,\n\t\t\t\t\tlogService,\n\t\t\t\t\tproductService,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\t// Should fail due to unsupported shell\n\t\t\t\tstrictEqual(result.type, 'failure');\n\n\t\t\t\t// But the nonce should be available in the process options for the terminal process to use\n\t\t\t\tstrictEqual(customProcessOptions.shellIntegration.nonce, 'custom-nonce-12345');\n\t\t\t});\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-test-async-suite */\nimport { deepStrictEqual, ok, strictEqual } from 'assert';\nimport { homedir, userInfo } from 'os';\nimport { isWindows } from '../../../../base/common/platform.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../log/common/log.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { ITerminalProcessOptions } from '../../common/terminal.js';\nimport { getShellIntegrationInjection, getWindowsBuildNumber, IShellIntegrationConfigInjection, type IShellIntegrationInjectionFailure } from '../../node/terminalEnvironment.js';\n\nconst enabledProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: true, suggestEnabled: false, nonce: '' }, windowsEnableConpty: true, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst disabledProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: false, suggestEnabled: false, nonce: '' }, windowsEnableConpty: true, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst winptyProcessOptions: ITerminalProcessOptions = { shellIntegration: { enabled: true, suggestEnabled: false, nonce: '' }, windowsEnableConpty: false, windowsUseConptyDll: false, environmentVariableCollections: undefined, workspaceFolder: undefined, isScreenReaderOptimized: false };\nconst pwshExe = process.platform === 'win32' ? 'pwsh.exe' : 'pwsh';\nconst repoRoot = process.platform === 'win32' ? process.cwd()[0].toLowerCase() + process.cwd().substring(1) : process.cwd();\nconst logService = new NullLogService();\nconst productService = { applicationName: 'vscode' } as IProductService;\nconst defaultEnvironment = {};\n\nfunction deepStrictEqualIgnoreStableVar(actual: IShellIntegrationConfigInjection | IShellIntegrationInjectionFailure | undefined, expected: IShellIntegrationConfigInjection) {\n\tif (actual?.type === 'injection' && actual.envMixin) {\n\t\tdelete actual.envMixin['VSCODE_STABLE'];\n\t}\n\tdeepStrictEqual(actual, expected);\n}\n\nsuite('platform - terminalEnvironment', async () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\tsuite('getShellIntegrationInjection', async () => {\n\t\tsuite('should not enable', async () => {\n\t\t\t// This test is only expected to work on Windows 10 build 18309 and above\n\t\t\t(getWindowsBuildNumber() < 18309 ? test.skip : test)('when isFeatureTerminal or when no executable is provided', async () => {\n\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'], isFeatureTerminal: true }, enabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'], isFeatureTerminal: false }, enabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'injection');\n\t\t\t});\n\t\t\tif (isWindows) {\n\t\t\t\ttest('when on windows with conpty false', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l'], isFeatureTerminal: false }, winptyProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// These tests are only expected to work on Windows 10 build 18309 and above\n\t\t(getWindowsBuildNumber() < 18309 ? suite.skip : suite)('pwsh', async () => {\n\t\t\tconst expectedPs1 = process.platform === 'win32'\n\t\t\t\t? `try { . \"${repoRoot}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\" } catch {}`\n\t\t\t\t: `. \"${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"`;\n\t\t\tsuite('should override args', async () => {\n\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\ttype: 'injection',\n\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t'-noexit',\n\t\t\t\t\t\t'-command',\n\t\t\t\t\t\texpectedPs1\n\t\t\t\t\t],\n\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\tVSCODE_A11Y_MODE: '0',\n\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('when undefined, []', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t\tsuite('when no logo', async () => {\n\t\t\t\t\ttest('array - case insensitive', async () => {\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NoLogo'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NOLOGO'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-nol'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-NOL'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t\ttest('string - case insensitive', async () => {\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NoLogo' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NOLOGO' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-nol' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-NOL' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('should incorporate login arg', async () => {\n\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\ttype: 'injection',\n\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t'-l',\n\t\t\t\t\t\t'-noexit',\n\t\t\t\t\t\t'-command',\n\t\t\t\t\t\texpectedPs1\n\t\t\t\t\t],\n\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\tVSCODE_A11Y_MODE: '0',\n\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('when array contains no logo and login', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t\ttest('when string', async () => {\n\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: pwshExe, args: '-l' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('should not modify args', async () => {\n\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: '-l' }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t\ttest('when using unrecognized arg', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: ['-l', '-NoLogo', '-i'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t\ttest('when using unrecognized arg (string)', async () => {\n\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: pwshExe, args: '-i' }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tif (process.platform !== 'win32') {\n\t\t\tsuite('zsh', async () => {\n\t\t\t\tsuite('should override args', async () => {\n\t\t\t\t\tconst username = userInfo().username;\n\t\t\t\t\tconst expectedDir = new RegExp(`.+\\/${username}-vscode-zsh`);\n\t\t\t\t\tconst customZdotdir = '/custom/zsh/dotdir';\n\t\t\t\t\tconst expectedDests = [\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zshrc`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zprofile`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zshenv`),\n\t\t\t\t\t\tnew RegExp(`.+\\\\/${username}-vscode-zsh\\\\/\\\\.zlogin`)\n\t\t\t\t\t];\n\t\t\t\t\tconst expectedSources = [\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-rc.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-profile.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-env.zsh/,\n\t\t\t\t\t\t/.+\\/out\\/vs\\/workbench\\/contrib\\/terminal\\/common\\/scripts\\/shellIntegration-login.zsh/\n\t\t\t\t\t];\n\t\t\t\t\tfunction assertIsEnabled(result: IShellIntegrationConfigInjection, globalZdotdir = homedir()) {\n\t\t\t\t\t\tstrictEqual(Object.keys(result.envMixin!).length, 3);\n\t\t\t\t\t\tok(result.envMixin!['ZDOTDIR']?.match(expectedDir));\n\t\t\t\t\t\tstrictEqual(result.envMixin!['USER_ZDOTDIR'], globalZdotdir);\n\t\t\t\t\t\tok(result.envMixin!['VSCODE_INJECTION']?.match('1'));\n\t\t\t\t\t\tstrictEqual(result.filesToCopy?.length, 4);\n\t\t\t\t\t\tok(result.filesToCopy[0].dest.match(expectedDests[0]));\n\t\t\t\t\t\tok(result.filesToCopy[1].dest.match(expectedDests[1]));\n\t\t\t\t\t\tok(result.filesToCopy[2].dest.match(expectedDests[2]));\n\t\t\t\t\t\tok(result.filesToCopy[3].dest.match(expectedDests[3]));\n\t\t\t\t\t\tok(result.filesToCopy[0].source.match(expectedSources[0]));\n\t\t\t\t\t\tok(result.filesToCopy[1].source.match(expectedSources[1]));\n\t\t\t\t\t\tok(result.filesToCopy[2].source.match(expectedSources[2]));\n\t\t\t\t\t\tok(result.filesToCopy[3].source.match(expectedSources[3]));\n\t\t\t\t\t}\n\t\t\t\t\ttest('when undefined, []', async () => {\n\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\tassertIsEnabled(result1);\n\t\t\t\t\t\tconst result2 = await getShellIntegrationInjection({ executable: 'zsh', args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\tdeepStrictEqual(result2?.newArgs, ['-i']);\n\t\t\t\t\t\tassertIsEnabled(result2);\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should incorporate login arg', async () => {\n\t\t\t\t\t\ttest('when array', async () => {\n\t\t\t\t\t\t\tconst result = await getShellIntegrationInjection({ executable: 'zsh', args: ['-l'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result?.newArgs, ['-il']);\n\t\t\t\t\t\t\tassertIsEnabled(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should not modify args', async () => {\n\t\t\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when using unrecognized arg', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'zsh', args: ['-l', '-fake'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should incorporate global ZDOTDIR env variable', async () => {\n\t\t\t\t\t\ttest('when custom ZDOTDIR', async () => {\n\t\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, { ...defaultEnvironment, ZDOTDIR: customZdotdir }, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\t\tassertIsEnabled(result1, customZdotdir);\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when undefined', async () => {\n\t\t\t\t\t\t\tconst result1 = await getShellIntegrationInjection({ executable: 'zsh', args: [] }, enabledProcessOptions, undefined, logService, productService, true) as IShellIntegrationConfigInjection;\n\t\t\t\t\t\t\tdeepStrictEqual(result1?.newArgs, ['-i']);\n\t\t\t\t\t\t\tassertIsEnabled(result1);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tsuite('bash', async () => {\n\t\t\t\tsuite('should override args', async () => {\n\t\t\t\t\ttest('when undefined, [], empty string', async () => {\n\t\t\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\t\t\ttype: 'injection',\n\t\t\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t\t\t'--init-file',\n\t\t\t\t\t\t\t\t`${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh`\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\t\t\tVSCODE_INJECTION: '1'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: [] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: '' }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: undefined }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should set login env variable and not modify args', async () => {\n\t\t\t\t\t\tconst enabledExpectedResult = Object.freeze<IShellIntegrationConfigInjection>({\n\t\t\t\t\t\t\ttype: 'injection',\n\t\t\t\t\t\t\tnewArgs: [\n\t\t\t\t\t\t\t\t'--init-file',\n\t\t\t\t\t\t\t\t`${repoRoot}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh`\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tenvMixin: {\n\t\t\t\t\t\t\t\tVSCODE_INJECTION: '1',\n\t\t\t\t\t\t\t\tVSCODE_SHELL_LOGIN: '1'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when array', async () => {\n\t\t\t\t\t\t\tdeepStrictEqualIgnoreStableVar(await getShellIntegrationInjection({ executable: 'bash', args: ['-l'] }, enabledProcessOptions, defaultEnvironment, logService, productService, true), enabledExpectedResult);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tsuite('should not modify args', async () => {\n\t\t\t\t\t\ttest('when shell integration is disabled', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: ['-l'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: undefined }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('when custom array entry', async () => {\n\t\t\t\t\t\t\tstrictEqual((await getShellIntegrationInjection({ executable: 'bash', args: ['-l', '-i'] }, disabledProcessOptions, defaultEnvironment, logService, productService, true)).type, 'failure');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tsuite('custom shell integration nonce', async () => {\n\t\t\ttest('should fail for unsupported shell but nonce should still be available', async () => {\n\t\t\t\tconst customProcessOptions: ITerminalProcessOptions = {\n\t\t\t\t\tshellIntegration: { enabled: true, suggestEnabled: false, nonce: 'custom-nonce-12345' },\n\t\t\t\t\twindowsEnableConpty: true,\n\t\t\t\t\twindowsUseConptyDll: false,\n\t\t\t\t\tenvironmentVariableCollections: undefined,\n\t\t\t\t\tworkspaceFolder: undefined,\n\t\t\t\t\tisScreenReaderOptimized: false\n\t\t\t\t};\n\n\t\t\t\t// Test with an unsupported shell (julia)\n\t\t\t\tconst result = await getShellIntegrationInjection(\n\t\t\t\t\t{ executable: 'julia', args: ['-i'] },\n\t\t\t\t\tcustomProcessOptions,\n\t\t\t\t\tdefaultEnvironment,\n\t\t\t\t\tlogService,\n\t\t\t\t\tproductService,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\t// Should fail due to unsupported shell\n\t\t\t\tstrictEqual(result.type, 'failure');\n\n\t\t\t\t// But the nonce should be available in the process options for the terminal process to use\n\t\t\t\tstrictEqual(customProcessOptions.shellIntegration.nonce, 'custom-nonce-12345');\n\t\t\t});\n\t\t});\n\t});\n});\n"]}