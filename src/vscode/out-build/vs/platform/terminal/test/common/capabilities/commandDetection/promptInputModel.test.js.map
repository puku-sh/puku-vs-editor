{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/terminal/test/common/capabilities/commandDetection/promptInputModel.test.ts","vs/platform/terminal/test/common/capabilities/commandDetection/promptInputModel.test.ts"],"names":[],"mappings":"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","file":"promptInputModel.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal } from '@xterm/headless';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../../log/common/log.js';\nimport { PromptInputModel, type IPromptInputModelState } from '../../../../common/capabilities/commandDetection/promptInputModel.js';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport type { ITerminalCommand } from '../../../../common/capabilities/capabilities.js';\nimport { ok, notDeepStrictEqual, strictEqual } from 'assert';\nimport { timeout } from '../../../../../../base/common/async.js';\nimport { importAMDNodeModule } from '../../../../../../amdX.js';\nimport { GeneralShellType, PosixShellType } from '../../../../common/terminal.js';\nimport { runWithFakedTimers } from '../../../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('PromptInputModel', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet promptInputModel: PromptInputModel;\n\tlet xterm: Terminal;\n\tlet onCommandStart: Emitter<ITerminalCommand>;\n\tlet onCommandStartChanged: Emitter<void>;\n\tlet onCommandExecuted: Emitter<ITerminalCommand>;\n\n\tasync function writePromise(data: string) {\n\t\tawait new Promise<void>(r => xterm.write(data, r));\n\t}\n\n\tfunction fireCommandStart() {\n\t\tonCommandStart.fire({ marker: xterm.registerMarker() } as ITerminalCommand);\n\t}\n\n\tfunction fireCommandExecuted() {\n\t\tonCommandExecuted.fire(null!);\n\t}\n\n\tfunction setContinuationPrompt(prompt: string) {\n\t\tpromptInputModel.setContinuationPrompt(prompt);\n\t}\n\n\tasync function assertPromptInput(valueWithCursor: string) {\n\t\tawait timeout(0);\n\n\t\tif (promptInputModel.cursorIndex !== -1 && !valueWithCursor.includes('|')) {\n\t\t\tthrow new Error('assertPromptInput must contain | character');\n\t\t}\n\n\t\tconst actualValueWithCursor = promptInputModel.getCombinedString();\n\t\tstrictEqual(\n\t\t\tactualValueWithCursor,\n\t\t\tvalueWithCursor.replaceAll('\\n', '\\u23CE')\n\t\t);\n\n\t\t// This is required to ensure the cursor index is correctly resolved for non-ascii characters\n\t\tconst value = valueWithCursor.replace(/[\\|\\[\\]]/g, '');\n\t\tconst cursorIndex = valueWithCursor.indexOf('|');\n\t\tstrictEqual(promptInputModel.value, value);\n\t\tstrictEqual(promptInputModel.cursorIndex, cursorIndex, `value=${promptInputModel.value}`);\n\t\tok(promptInputModel.ghostTextIndex === -1 || cursorIndex <= promptInputModel.ghostTextIndex, `cursorIndex (${cursorIndex}) must be before ghostTextIndex (${promptInputModel.ghostTextIndex})`);\n\t}\n\n\tsetup(async () => {\n\t\tconst TerminalCtor = (await importAMDNodeModule<typeof import('@xterm/xterm')>('@xterm/xterm', 'lib/xterm.js')).Terminal;\n\t\txterm = store.add(new TerminalCtor({ allowProposedApi: true }));\n\t\tonCommandStart = store.add(new Emitter());\n\t\tonCommandStartChanged = store.add(new Emitter());\n\t\tonCommandExecuted = store.add(new Emitter());\n\t\tpromptInputModel = store.add(new PromptInputModel(xterm, onCommandStart.event, onCommandStartChanged.event, onCommandExecuted.event, new NullLogService));\n\t});\n\n\ttest('basic input and execute', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\r\\n');\n\t\tfireCommandExecuted();\n\t\tawait assertPromptInput('foo bar');\n\n\t\tawait writePromise('(command output)\\r\\n$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\t});\n\n\ttest('should not fire onDidChangeInput events when nothing changes', async () => {\n\t\tconst events: IPromptInputModelState[] = [];\n\t\tstore.add(promptInputModel.onDidChangeInput(e => events.push(e)));\n\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo');\n\t\tawait assertPromptInput('foo|');\n\n\t\tawait writePromise(' bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\r\\n');\n\t\tfireCommandExecuted();\n\t\tawait assertPromptInput('foo bar');\n\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tfor (let i = 0; i < events.length - 1; i++) {\n\t\t\tnotDeepStrictEqual(events[i], events[i + 1], 'not adjacent events should fire with the same value');\n\t\t}\n\t});\n\n\ttest('should fire onDidInterrupt followed by onDidFinish when ctrl+c is pressed', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo');\n\t\tawait assertPromptInput('foo|');\n\n\t\tawait new Promise<void>(r => {\n\t\t\tstore.add(promptInputModel.onDidInterrupt(() => {\n\t\t\t\t// Fire onDidFinishInput immediately after onDidInterrupt\n\t\t\t\tstore.add(promptInputModel.onDidFinishInput(() => {\n\t\t\t\t\tr();\n\t\t\t\t}));\n\t\t\t}));\n\t\t\txterm.input('\\x03');\n\t\t\twritePromise('^C').then(() => fireCommandExecuted());\n\t\t});\n\t});\n\n\ttest('cursor navigation', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\x1b[3D');\n\t\tawait assertPromptInput('foo |bar');\n\n\t\tawait writePromise('\\x1b[4D');\n\t\tawait assertPromptInput('|foo bar');\n\n\t\tawait writePromise('\\x1b[3C');\n\t\tawait assertPromptInput('foo| bar');\n\n\t\tawait writePromise('\\x1b[4C');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('foo ba|r');\n\n\t\tawait writePromise('\\x1b[C');\n\t\tawait assertPromptInput('foo bar|');\n\t});\n\n\tsuite('ghost text', () => {\n\t\ttest('basic ghost text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[2m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\t\t});\n\t\ttest('trailing whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('foo    ');\n\t\t\tawait writePromise('\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|    ');\n\t\t});\n\t\ttest('basic ghost text one word', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('pw\\x1b[2md\\x1b[1D');\n\t\t\tawait assertPromptInput('pw|[d]');\n\t\t});\n\t\ttest('ghost text with cursor navigation', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[2m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('fo|o[ bar]');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\t\t});\n\t\ttest('ghost text with different foreground colors only', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[38;2;255;0;0m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\t\t});\n\t\ttest('no ghost text when foreground color matches earlier text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[38;2;255;0;0mred1\\x1b[0m ' +  // Red \"red1\"\n\t\t\t\t'\\x1b[38;2;0;255;0mgreen\\x1b[0m ' + // Green \"green\"\n\t\t\t\t'\\x1b[38;2;255;0;0mred2\\x1b[0m'     // Red \"red2\" (same as red1)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red1 green red2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when foreground color is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[38;2;255;0;0mcmd\\x1b[0m ' +   // Red \"cmd\"\n\t\t\t\t'\\x1b[38;2;0;255;0marg\\x1b[0m ' +   // Green \"arg\"\n\t\t\t\t'\\x1b[38;2;0;0;255mfinal\\x1b[5D'    // Blue \"final\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('cmd arg |[final]');\n\t\t});\n\n\t\ttest('no ghost text when background color matches earlier text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg1\\x1b[0m ' +  // Red background\n\t\t\t\t'\\x1b[48;2;0;255;0mgreen_bg\\x1b[0m ' + // Green background\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg2\\x1b[0m'     // Red background again\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red_bg1 green_bg red_bg2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when background color is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg\\x1b[0m ' +  // Red background\n\t\t\t\t'\\x1b[48;2;0;255;0mgreen_bg\\x1b[0m ' + // Green background\n\t\t\t\t'\\x1b[48;2;0;0;255mblue_bg\\x1b[7D'     // Blue background (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red_bg green_bg |[blue_bg]');\n\t\t});\n\n\t\ttest('ghost text detected when bold style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[1mBOLD\\x1b[4D' // Bold \"BOLD\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[BOLD]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same bold style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[1mBOLD1\\x1b[0m ' + // Bold \"BOLD1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[1mBOLD2\\x1b[0m'    // Bold \"BOLD2\" (same style as \"BOLD1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('BOLD1 normal BOLD2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when italic style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[3mITALIC\\x1b[6D' // Italic \"ITALIC\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[ITALIC]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same italic style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[3mITALIC1\\x1b[0m ' + // Italic \"ITALIC1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[3mITALIC2\\x1b[0m'    // Italic \"ITALIC2\" (same style as \"ITALIC1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('ITALIC1 normal ITALIC2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when underline style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[4mUNDERLINE\\x1b[9D' // Underlined \"UNDERLINE\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[UNDERLINE]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same underline style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[4mUNDERLINE1\\x1b[0m ' + // Underlined \"UNDERLINE1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[4mUNDERLINE2\\x1b[0m'    // Underlined \"UNDERLINE2\" (same style as \"UNDERLINE1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('UNDERLINE1 normal UNDERLINE2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when strikethrough style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[9mSTRIKE\\x1b[6D' // Strikethrough \"STRIKE\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[STRIKE]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same strikethrough style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[9mSTRIKE1\\x1b[0m ' + // Strikethrough \"STRIKE1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[9mSTRIKE2\\x1b[0m'    // Strikethrough \"STRIKE2\" (same style as \"STRIKE1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('STRIKE1 normal STRIKE2|'); // No ghost text expected\n\t\t});\n\t\tsuite('With wrapping', () => {\n\t\t\ttest('Fish ghost text in long line with wrapped content', async () => {\n\t\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t// Write a command with ghost text that will wrap\n\t\t\t\tawait writePromise('find . -name');\n\t\t\t\tawait assertPromptInput(`find . -name|`);\n\n\t\t\t\t// Add ghost text with dim style\n\t\t\t\tawait writePromise('\\x1b[2m test\\x1b[0m\\x1b[4D');\n\t\t\t\tawait assertPromptInput(`find . -name |[test]`);\n\n\t\t\t\t// Move cursor within the ghost text\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name t|[est]`);\n\n\t\t\t\t// Accept ghost text\n\t\t\t\tawait writePromise('\\x1b[C\\x1b[C\\x1b[C\\x1b[C\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name test|`);\n\t\t\t});\n\t\t\ttest('Pwsh ghost text in long line with wrapped content', async () => {\n\t\t\t\tpromptInputModel.setShellType(GeneralShellType.PowerShell);\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t// Write a command with ghost text that will wrap\n\t\t\t\tawait writePromise('find . -name');\n\t\t\t\tawait assertPromptInput(`find . -name|`);\n\n\t\t\t\t// Add ghost text with dim style\n\t\t\t\tawait writePromise('\\x1b[2m test\\x1b[0m\\x1b[4D');\n\t\t\t\tawait assertPromptInput(`find . -name |[test]`);\n\n\t\t\t\t// Move cursor within the ghost text\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name t|[est]`);\n\n\t\t\t\t// Accept ghost text\n\t\t\t\tawait writePromise('\\x1b[C\\x1b[C\\x1b[C\\x1b[C\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name test|`);\n\t\t\t});\n\t\t});\n\t\ttest('Does not detect right prompt as ghost text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('cmd' + ' '.repeat(6) + '\\x1b[38;2;255;0;0mRP\\x1b[0m\\x1b[8D');\n\t\t\tawait assertPromptInput('cmd|' + ' '.repeat(6) + 'RP');\n\t\t});\n\t});\n\n\ttest('wide input (Korean)', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('ì•ˆì˜');\n\t\tawait assertPromptInput('ì•ˆì˜|');\n\n\t\tawait writePromise('\\r\\nì»´í“¨í„°');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°|');\n\n\t\tawait writePromise('\\r\\nì‚¬ëžŒ');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ|');\n\n\t\tawait writePromise('\\x1b[G');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°\\n|ì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[A');\n\t\tawait assertPromptInput('ì•ˆì˜\\n|ì»´í“¨í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[4C');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨|í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[1;4H');\n\t\tawait assertPromptInput('ì•ˆ|ì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('|ì•ˆì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ');\n\t});\n\n\ttest('emoji input', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('âœŒï¸ðŸ‘');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘|');\n\n\t\tawait writePromise('\\r\\nðŸ˜ŽðŸ˜•ðŸ˜…');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…|');\n\n\t\tawait writePromise('\\r\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©|');\n\n\t\tawait writePromise('\\x1b[G');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\n|ðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[A');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\n|ðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[2C');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•|ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[1;4H');\n\t\tawait assertPromptInput('âœŒï¸|ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('|âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\t});\n\n\tsuite('trailing whitespace', () => {\n\t\ttest('cursor index calculation with whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo   ');\n\t\t\tawait assertPromptInput('echo   |');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('echo|   ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo |  ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo  | ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo   |');\n\t\t});\n\n\t\ttest('cursor index should not exceed command line length', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('cmd');\n\t\t\tawait assertPromptInput('cmd|');\n\n\t\t\tawait writePromise('\\x1b[10C');\n\t\t\tawait assertPromptInput('cmd|');\n\t\t});\n\n\t\ttest('whitespace preservation in cursor calculation', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('ls   -la');\n\t\t\tawait assertPromptInput('ls   -la|');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('ls   |-la');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('ls|   -la');\n\n\t\t\tawait writePromise('\\x1b[2C');\n\t\t\tawait assertPromptInput('ls  | -la');\n\t\t});\n\n\t\ttest('delete whitespace with backspace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(` |`);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput('|');\n\n\t\t\txterm.input(' '.repeat(4), true);\n\t\t\tawait writePromise(' '.repeat(4));\n\t\t\tawait assertPromptInput(`    |`);\n\n\t\t\txterm.input('\\x1b[D'.repeat(2), true); // Left\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput(`  |  `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(` |  `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`|  `);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(` |  `);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(`  |  `);\n\n\t\t\txterm.input('\\x1b[C', true); // Right\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput(`   | `);\n\n\t\t\txterm.input('a', true);\n\t\t\tawait writePromise('a');\n\t\t\tawait assertPromptInput(`   a| `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D\\x1b[K');\n\t\t\tawait assertPromptInput(`   | `);\n\n\t\t\txterm.input('\\x1b[D'.repeat(2), true); // Left\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput(` |   `);\n\n\t\t\txterm.input('\\x1b[3~', true); // Delete\n\t\t\tawait writePromise('');\n\t\t\tawait assertPromptInput(` |  `);\n\t\t});\n\n\t\t// TODO: This doesn't work correctly but it doesn't matter too much as it only happens when\n\t\t// there is a lot of whitespace at the end of a prompt input\n\t\ttest.skip('track whitespace when ConPTY deletes whitespace unexpectedly', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\txterm.input('ls', true);\n\t\t\tawait writePromise('ls');\n\t\t\tawait assertPromptInput(`ls|`);\n\n\t\t\txterm.input(' '.repeat(4), true);\n\t\t\tawait writePromise(' '.repeat(4));\n\t\t\tawait assertPromptInput(`ls    |`);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise('\\x1b[4D\\x1b[5X\\x1b[5C'); // Cursor left x(N-1), delete xN, cursor right xN\n\t\t\tawait assertPromptInput(`ls     |`);\n\t\t});\n\n\t\ttest('track whitespace beyond cursor', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(' '.repeat(8));\n\t\t\tawait assertPromptInput(`${' '.repeat(8)}|`);\n\n\t\t\tawait writePromise('\\x1b[4D');\n\t\t\tawait assertPromptInput(`${' '.repeat(4)}|${' '.repeat(4)}`);\n\t\t});\n\t});\n\n\tsuite('multi-line', () => {\n\t\ttest('basic 2 line', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"a');\n\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\t\t});\n\n\t\ttest('basic 3 line', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"a');\n\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\nb\\n|`);\n\n\t\t\tawait writePromise('c');\n\t\t\tawait assertPromptInput(`echo \"a\\nb\\nc|`);\n\t\t});\n\n\t\ttest('navigate left in multi-line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('echo \"a');\n\t\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\t\tawait writePromise('b');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"a\\n|b`);\n\n\t\t\t\tawait writePromise('\\x1b[@c');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc|b`);\n\n\t\t\t\tawait writePromise('\\x1b[K\\n\\r\\âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\n|`);\n\n\t\t\t\tawait writePromise('b');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb|`);\n\n\t\t\t\tawait writePromise(' foo');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb foo|`);\n\n\t\t\t\tawait writePromise('\\x1b[3D');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb |foo`);\n\t\t\t});\n\t\t});\n\n\t\ttest('navigate up in multi-line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('echo \"foo');\n\t\t\t\tawait assertPromptInput(`echo \"foo|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\n|`);\n\n\t\t\t\tawait writePromise('bar');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar\\n|`);\n\n\t\t\t\tawait writePromise('baz');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar\\nbaz|`);\n\n\t\t\t\tawait writePromise('\\x1b[A');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar|\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nba|r\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nb|ar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\n|bar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[1;9H');\n\t\t\t\tawait assertPromptInput(`echo \"|foo\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"f|oo\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"fo|o\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"foo|\\nbar\\nbaz`);\n\t\t\t});\n\t\t});\n\n\t\ttest('navigating up when first line contains invalid/stale trailing whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"foo      \\x1b[6D');\n\t\t\tawait assertPromptInput(`echo \"foo|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"foo\\n|`);\n\n\t\t\tawait writePromise('bar');\n\t\t\tawait assertPromptInput(`echo \"foo\\nbar|`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\nba|r`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\nb|ar`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\n|bar`);\n\t\t});\n\t});\n\n\tsuite('multi-line wrapped (no continuation prompt)', () => {\n\t\ttest('basic wrapped line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\txterm.resize(5, 10);\n\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('ech');\n\t\t\t\tawait assertPromptInput(`ech|`);\n\n\t\t\t\tawait writePromise('o ');\n\t\t\t\tawait assertPromptInput(`echo |`);\n\n\t\t\t\tawait writePromise('\"a\"');\n\t\t\t\t// HACK: Trailing whitespace is due to flaky detection in wrapped lines (but it doesn't matter much)\n\t\t\t\tawait assertPromptInput(`echo \"a\"| `);\n\t\t\t\tawait writePromise('\\n\\r\\ b');\n\t\t\t\tawait assertPromptInput(`echo \"a\"\\n b|`);\n\t\t\t\tawait writePromise('\\n\\r\\ c');\n\t\t\t\tawait assertPromptInput(`echo \"a\"\\n b\\n c|`);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('multi-line wrapped (continuation prompt)', () => {\n\t\ttest('basic wrapped line', async () => {\n\t\t\txterm.resize(5, 10);\n\t\t\tpromptInputModel.setContinuationPrompt('âˆ™ ');\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('ech');\n\t\t\tawait assertPromptInput(`ech|`);\n\n\t\t\tawait writePromise('o ');\n\t\t\tawait assertPromptInput(`echo |`);\n\n\t\t\tawait writePromise('\"a\"');\n\t\t\t// HACK: Trailing whitespace is due to flaky detection in wrapped lines (but it doesn't matter much)\n\t\t\tawait assertPromptInput(`echo \"a\"| `);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\n|`);\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb|`);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\n|`);\n\t\t\tawait writePromise('c');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\nc|`);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\nc\\n|`);\n\t\t});\n\t});\n\tsuite('multi-line wrapped fish', () => {\n\t\ttest('forward slash continuation', async () => {\n\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\tawait writePromise('$ ');\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('[I] meganrogge@Megans-MacBook-Pro ~ (main|BISECTING)>');\n\t\t\tfireCommandStart();\n\n\t\t\tawait writePromise('ech\\\\');\n\t\t\tawait assertPromptInput(`ech\\\\|`);\n\t\t\tawait writePromise('\\no bye');\n\t\t\tawait assertPromptInput(`echo bye|`);\n\t\t});\n\t\ttest('newline with no continuation', async () => {\n\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\tawait writePromise('$ ');\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('[I] meganrogge@Megans-MacBook-Pro ~ (main|BISECTING)>');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"hi');\n\t\t\tawait assertPromptInput(`echo \"hi|`);\n\t\t\tawait writePromise('\\nand bye\\nwhy\"');\n\t\t\tawait assertPromptInput(`echo \"hi\\nand bye\\nwhy\"|`);\n\t\t});\n\t});\n\n\t// To \"record a session\" for these tests:\n\t// - Enable debug logging\n\t// - Open and clear Terminal output channel\n\t// - Open terminal and perform the test\n\t// - Extract all \"parsing data\" lines from the terminal\n\tsuite('recorded sessions', () => {\n\t\tasync function replayEvents(events: string[]) {\n\t\t\tfor (const data of events) {\n\t\t\t\tawait writePromise(data);\n\t\t\t}\n\t\t}\n\n\t\tsuite('Windows 11 (10.0.22621.3447), pwsh 7.4.2, starship prompt 1.10.2', () => {\n\t\t\ttest('input with ignored ghost text', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:13:47 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$â‡¡ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93mf\u001b[97m\u001b[2m\u001b[3makecommand\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[93m\bfo\u001b[9X',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hfoo\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('foo|');\n\t\t\t\t});\n\t\t\t});\n\t\t\ttest('input with accepted and run ghost text', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:41:36 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tpromptInputModel.setContinuationPrompt('âˆ™ ');\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93me\u001b[97m\u001b[2m\u001b[3mcho \"hello world\"\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('e|[cho \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\bec\u001b[97m\u001b[2m\u001b[3mho \"hello world\"\u001b[3;5H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('ec|[ho \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hech\u001b[97m\u001b[2m\u001b[3mo \"hello world\"\u001b[3;6H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('ech|[o \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho\u001b[97m\u001b[2m\u001b[3m \"hello world\"\u001b[3;7H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo|[ \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho \u001b[97m\u001b[2m\u001b[3m\"hello world\"\u001b[3;8H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo |[\"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho \u001b[36m\"hello world\"\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b]633;E;echo \"hello world\";ff464d39-bc80-4bae-9ead-b1cafc4adf6f\u0007\u001b]633;C\u0007',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandExecuted();\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\\r\\n',\n\t\t\t\t\t\t'hello world\\r\\n',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b]633;D;0\u0007\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:41:42 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\t\t\t\t});\n\t\t\t});\n\n\t\t\ttest('input, go to start (ctrl+home), delete word in front (ctrl+delete)', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\Program Files\\WindowsApps\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m16:07:06 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/210662 \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$! \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93mG\u001b[97m\u001b[2m\u001b[3mit push\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\bGe\u001b[97m\u001b[2m\u001b[3mt-ChildItem -Path a\u001b[3;5H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3HGet\u001b[97m\u001b[2m\u001b[3m-ChildItem -Path a\u001b[3;6H\u001b[?25h',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('Get|[-ChildItem -Path a]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[3;3H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[21X',\n\t\t\t\t\t]);\n\n\t\t\t\t\t// Don't force a sync, the prompt input model should update by itself\n\t\t\t\t\tawait timeout(0);\n\t\t\t\t\tconst actualValueWithCursor = promptInputModel.getCombinedString();\n\t\t\t\t\tstrictEqual(\n\t\t\t\t\t\tactualValueWithCursor,\n\t\t\t\t\t\t'|'.replaceAll('\\n', '\\u23CE')\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal } from '@xterm/headless';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../../log/common/log.js';\nimport { PromptInputModel, type IPromptInputModelState } from '../../../../common/capabilities/commandDetection/promptInputModel.js';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport type { ITerminalCommand } from '../../../../common/capabilities/capabilities.js';\nimport { ok, notDeepStrictEqual, strictEqual } from 'assert';\nimport { timeout } from '../../../../../../base/common/async.js';\nimport { importAMDNodeModule } from '../../../../../../amdX.js';\nimport { GeneralShellType, PosixShellType } from '../../../../common/terminal.js';\nimport { runWithFakedTimers } from '../../../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('PromptInputModel', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet promptInputModel: PromptInputModel;\n\tlet xterm: Terminal;\n\tlet onCommandStart: Emitter<ITerminalCommand>;\n\tlet onCommandStartChanged: Emitter<void>;\n\tlet onCommandExecuted: Emitter<ITerminalCommand>;\n\n\tasync function writePromise(data: string) {\n\t\tawait new Promise<void>(r => xterm.write(data, r));\n\t}\n\n\tfunction fireCommandStart() {\n\t\tonCommandStart.fire({ marker: xterm.registerMarker() } as ITerminalCommand);\n\t}\n\n\tfunction fireCommandExecuted() {\n\t\tonCommandExecuted.fire(null!);\n\t}\n\n\tfunction setContinuationPrompt(prompt: string) {\n\t\tpromptInputModel.setContinuationPrompt(prompt);\n\t}\n\n\tasync function assertPromptInput(valueWithCursor: string) {\n\t\tawait timeout(0);\n\n\t\tif (promptInputModel.cursorIndex !== -1 && !valueWithCursor.includes('|')) {\n\t\t\tthrow new Error('assertPromptInput must contain | character');\n\t\t}\n\n\t\tconst actualValueWithCursor = promptInputModel.getCombinedString();\n\t\tstrictEqual(\n\t\t\tactualValueWithCursor,\n\t\t\tvalueWithCursor.replaceAll('\\n', '\\u23CE')\n\t\t);\n\n\t\t// This is required to ensure the cursor index is correctly resolved for non-ascii characters\n\t\tconst value = valueWithCursor.replace(/[\\|\\[\\]]/g, '');\n\t\tconst cursorIndex = valueWithCursor.indexOf('|');\n\t\tstrictEqual(promptInputModel.value, value);\n\t\tstrictEqual(promptInputModel.cursorIndex, cursorIndex, `value=${promptInputModel.value}`);\n\t\tok(promptInputModel.ghostTextIndex === -1 || cursorIndex <= promptInputModel.ghostTextIndex, `cursorIndex (${cursorIndex}) must be before ghostTextIndex (${promptInputModel.ghostTextIndex})`);\n\t}\n\n\tsetup(async () => {\n\t\tconst TerminalCtor = (await importAMDNodeModule<typeof import('@xterm/xterm')>('@xterm/xterm', 'lib/xterm.js')).Terminal;\n\t\txterm = store.add(new TerminalCtor({ allowProposedApi: true }));\n\t\tonCommandStart = store.add(new Emitter());\n\t\tonCommandStartChanged = store.add(new Emitter());\n\t\tonCommandExecuted = store.add(new Emitter());\n\t\tpromptInputModel = store.add(new PromptInputModel(xterm, onCommandStart.event, onCommandStartChanged.event, onCommandExecuted.event, new NullLogService));\n\t});\n\n\ttest('basic input and execute', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\r\\n');\n\t\tfireCommandExecuted();\n\t\tawait assertPromptInput('foo bar');\n\n\t\tawait writePromise('(command output)\\r\\n$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\t});\n\n\ttest('should not fire onDidChangeInput events when nothing changes', async () => {\n\t\tconst events: IPromptInputModelState[] = [];\n\t\tstore.add(promptInputModel.onDidChangeInput(e => events.push(e)));\n\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo');\n\t\tawait assertPromptInput('foo|');\n\n\t\tawait writePromise(' bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\r\\n');\n\t\tfireCommandExecuted();\n\t\tawait assertPromptInput('foo bar');\n\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tfor (let i = 0; i < events.length - 1; i++) {\n\t\t\tnotDeepStrictEqual(events[i], events[i + 1], 'not adjacent events should fire with the same value');\n\t\t}\n\t});\n\n\ttest('should fire onDidInterrupt followed by onDidFinish when ctrl+c is pressed', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo');\n\t\tawait assertPromptInput('foo|');\n\n\t\tawait new Promise<void>(r => {\n\t\t\tstore.add(promptInputModel.onDidInterrupt(() => {\n\t\t\t\t// Fire onDidFinishInput immediately after onDidInterrupt\n\t\t\t\tstore.add(promptInputModel.onDidFinishInput(() => {\n\t\t\t\t\tr();\n\t\t\t\t}));\n\t\t\t}));\n\t\t\txterm.input('\\x03');\n\t\t\twritePromise('^C').then(() => fireCommandExecuted());\n\t\t});\n\t});\n\n\ttest('cursor navigation', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('foo bar');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\x1b[3D');\n\t\tawait assertPromptInput('foo |bar');\n\n\t\tawait writePromise('\\x1b[4D');\n\t\tawait assertPromptInput('|foo bar');\n\n\t\tawait writePromise('\\x1b[3C');\n\t\tawait assertPromptInput('foo| bar');\n\n\t\tawait writePromise('\\x1b[4C');\n\t\tawait assertPromptInput('foo bar|');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('foo ba|r');\n\n\t\tawait writePromise('\\x1b[C');\n\t\tawait assertPromptInput('foo bar|');\n\t});\n\n\tsuite('ghost text', () => {\n\t\ttest('basic ghost text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[2m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\t\t});\n\t\ttest('trailing whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('foo    ');\n\t\t\tawait writePromise('\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|    ');\n\t\t});\n\t\ttest('basic ghost text one word', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('pw\\x1b[2md\\x1b[1D');\n\t\t\tawait assertPromptInput('pw|[d]');\n\t\t});\n\t\ttest('ghost text with cursor navigation', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[2m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('fo|o[ bar]');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\t\t});\n\t\ttest('ghost text with different foreground colors only', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('foo\\x1b[38;2;255;0;0m bar\\x1b[0m\\x1b[4D');\n\t\t\tawait assertPromptInput('foo|[ bar]');\n\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput('f|oo[ bar]');\n\t\t});\n\t\ttest('no ghost text when foreground color matches earlier text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[38;2;255;0;0mred1\\x1b[0m ' +  // Red \"red1\"\n\t\t\t\t'\\x1b[38;2;0;255;0mgreen\\x1b[0m ' + // Green \"green\"\n\t\t\t\t'\\x1b[38;2;255;0;0mred2\\x1b[0m'     // Red \"red2\" (same as red1)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red1 green red2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when foreground color is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[38;2;255;0;0mcmd\\x1b[0m ' +   // Red \"cmd\"\n\t\t\t\t'\\x1b[38;2;0;255;0marg\\x1b[0m ' +   // Green \"arg\"\n\t\t\t\t'\\x1b[38;2;0;0;255mfinal\\x1b[5D'    // Blue \"final\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('cmd arg |[final]');\n\t\t});\n\n\t\ttest('no ghost text when background color matches earlier text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg1\\x1b[0m ' +  // Red background\n\t\t\t\t'\\x1b[48;2;0;255;0mgreen_bg\\x1b[0m ' + // Green background\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg2\\x1b[0m'     // Red background again\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red_bg1 green_bg red_bg2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when background color is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[48;2;255;0;0mred_bg\\x1b[0m ' +  // Red background\n\t\t\t\t'\\x1b[48;2;0;255;0mgreen_bg\\x1b[0m ' + // Green background\n\t\t\t\t'\\x1b[48;2;0;0;255mblue_bg\\x1b[7D'     // Blue background (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('red_bg green_bg |[blue_bg]');\n\t\t});\n\n\t\ttest('ghost text detected when bold style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[1mBOLD\\x1b[4D' // Bold \"BOLD\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[BOLD]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same bold style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[1mBOLD1\\x1b[0m ' + // Bold \"BOLD1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[1mBOLD2\\x1b[0m'    // Bold \"BOLD2\" (same style as \"BOLD1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('BOLD1 normal BOLD2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when italic style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[3mITALIC\\x1b[6D' // Italic \"ITALIC\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[ITALIC]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same italic style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[3mITALIC1\\x1b[0m ' + // Italic \"ITALIC1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[3mITALIC2\\x1b[0m'    // Italic \"ITALIC2\" (same style as \"ITALIC1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('ITALIC1 normal ITALIC2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when underline style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[4mUNDERLINE\\x1b[9D' // Underlined \"UNDERLINE\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[UNDERLINE]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same underline style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[4mUNDERLINE1\\x1b[0m ' + // Underlined \"UNDERLINE1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[4mUNDERLINE2\\x1b[0m'    // Underlined \"UNDERLINE2\" (same style as \"UNDERLINE1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('UNDERLINE1 normal UNDERLINE2|'); // No ghost text expected\n\t\t});\n\n\t\ttest('ghost text detected when strikethrough style is unique at the end', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'text ' +\n\t\t\t\t'\\x1b[9mSTRIKE\\x1b[6D' // Strikethrough \"STRIKE\" (ghost text)\n\t\t\t);\n\n\t\t\tawait assertPromptInput('text |[STRIKE]');\n\t\t});\n\n\t\ttest('no ghost text when earlier text has the same strikethrough style', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(\n\t\t\t\t'\\x1b[9mSTRIKE1\\x1b[0m ' + // Strikethrough \"STRIKE1\"\n\t\t\t\t'normal ' +\n\t\t\t\t'\\x1b[9mSTRIKE2\\x1b[0m'    // Strikethrough \"STRIKE2\" (same style as \"STRIKE1\")\n\t\t\t);\n\n\t\t\tawait assertPromptInput('STRIKE1 normal STRIKE2|'); // No ghost text expected\n\t\t});\n\t\tsuite('With wrapping', () => {\n\t\t\ttest('Fish ghost text in long line with wrapped content', async () => {\n\t\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t// Write a command with ghost text that will wrap\n\t\t\t\tawait writePromise('find . -name');\n\t\t\t\tawait assertPromptInput(`find . -name|`);\n\n\t\t\t\t// Add ghost text with dim style\n\t\t\t\tawait writePromise('\\x1b[2m test\\x1b[0m\\x1b[4D');\n\t\t\t\tawait assertPromptInput(`find . -name |[test]`);\n\n\t\t\t\t// Move cursor within the ghost text\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name t|[est]`);\n\n\t\t\t\t// Accept ghost text\n\t\t\t\tawait writePromise('\\x1b[C\\x1b[C\\x1b[C\\x1b[C\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name test|`);\n\t\t\t});\n\t\t\ttest('Pwsh ghost text in long line with wrapped content', async () => {\n\t\t\t\tpromptInputModel.setShellType(GeneralShellType.PowerShell);\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t// Write a command with ghost text that will wrap\n\t\t\t\tawait writePromise('find . -name');\n\t\t\t\tawait assertPromptInput(`find . -name|`);\n\n\t\t\t\t// Add ghost text with dim style\n\t\t\t\tawait writePromise('\\x1b[2m test\\x1b[0m\\x1b[4D');\n\t\t\t\tawait assertPromptInput(`find . -name |[test]`);\n\n\t\t\t\t// Move cursor within the ghost text\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name t|[est]`);\n\n\t\t\t\t// Accept ghost text\n\t\t\t\tawait writePromise('\\x1b[C\\x1b[C\\x1b[C\\x1b[C\\x1b[C');\n\t\t\t\tawait assertPromptInput(`find . -name test|`);\n\t\t\t});\n\t\t});\n\t\ttest('Does not detect right prompt as ghost text', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('cmd' + ' '.repeat(6) + '\\x1b[38;2;255;0;0mRP\\x1b[0m\\x1b[8D');\n\t\t\tawait assertPromptInput('cmd|' + ' '.repeat(6) + 'RP');\n\t\t});\n\t});\n\n\ttest('wide input (Korean)', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('ì•ˆì˜');\n\t\tawait assertPromptInput('ì•ˆì˜|');\n\n\t\tawait writePromise('\\r\\nì»´í“¨í„°');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°|');\n\n\t\tawait writePromise('\\r\\nì‚¬ëžŒ');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ|');\n\n\t\tawait writePromise('\\x1b[G');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨í„°\\n|ì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[A');\n\t\tawait assertPromptInput('ì•ˆì˜\\n|ì»´í“¨í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[4C');\n\t\tawait assertPromptInput('ì•ˆì˜\\nì»´í“¨|í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[1;4H');\n\t\tawait assertPromptInput('ì•ˆ|ì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('|ì•ˆì˜\\nì»´í“¨í„°\\nì‚¬ëžŒ');\n\t});\n\n\ttest('emoji input', async () => {\n\t\tawait writePromise('$ ');\n\t\tfireCommandStart();\n\t\tawait assertPromptInput('|');\n\n\t\tawait writePromise('âœŒï¸ðŸ‘');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘|');\n\n\t\tawait writePromise('\\r\\nðŸ˜ŽðŸ˜•ðŸ˜…');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…|');\n\n\t\tawait writePromise('\\r\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©|');\n\n\t\tawait writePromise('\\x1b[G');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\n|ðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[A');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\n|ðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[2C');\n\t\tawait assertPromptInput('âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•|ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[1;4H');\n\t\tawait assertPromptInput('âœŒï¸|ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\n\t\tawait writePromise('\\x1b[D');\n\t\tawait assertPromptInput('|âœŒï¸ðŸ‘\\nðŸ˜ŽðŸ˜•ðŸ˜…\\nðŸ¤”ðŸ¤·ðŸ˜©');\n\t});\n\n\tsuite('trailing whitespace', () => {\n\t\ttest('cursor index calculation with whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo   ');\n\t\t\tawait assertPromptInput('echo   |');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('echo|   ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo |  ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo  | ');\n\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput('echo   |');\n\t\t});\n\n\t\ttest('cursor index should not exceed command line length', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('cmd');\n\t\t\tawait assertPromptInput('cmd|');\n\n\t\t\tawait writePromise('\\x1b[10C');\n\t\t\tawait assertPromptInput('cmd|');\n\t\t});\n\n\t\ttest('whitespace preservation in cursor calculation', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('ls   -la');\n\t\t\tawait assertPromptInput('ls   -la|');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('ls   |-la');\n\n\t\t\tawait writePromise('\\x1b[3D');\n\t\t\tawait assertPromptInput('ls|   -la');\n\n\t\t\tawait writePromise('\\x1b[2C');\n\t\t\tawait assertPromptInput('ls  | -la');\n\t\t});\n\n\t\ttest('delete whitespace with backspace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(` |`);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput('|');\n\n\t\t\txterm.input(' '.repeat(4), true);\n\t\t\tawait writePromise(' '.repeat(4));\n\t\t\tawait assertPromptInput(`    |`);\n\n\t\t\txterm.input('\\x1b[D'.repeat(2), true); // Left\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput(`  |  `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(` |  `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`|  `);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(` |  `);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise(' ');\n\t\t\tawait assertPromptInput(`  |  `);\n\n\t\t\txterm.input('\\x1b[C', true); // Right\n\t\t\tawait writePromise('\\x1b[C');\n\t\t\tawait assertPromptInput(`   | `);\n\n\t\t\txterm.input('a', true);\n\t\t\tawait writePromise('a');\n\t\t\tawait assertPromptInput(`   a| `);\n\n\t\t\txterm.input('\\x7F', true); // Backspace\n\t\t\tawait writePromise('\\x1b[D\\x1b[K');\n\t\t\tawait assertPromptInput(`   | `);\n\n\t\t\txterm.input('\\x1b[D'.repeat(2), true); // Left\n\t\t\tawait writePromise('\\x1b[2D');\n\t\t\tawait assertPromptInput(` |   `);\n\n\t\t\txterm.input('\\x1b[3~', true); // Delete\n\t\t\tawait writePromise('');\n\t\t\tawait assertPromptInput(` |  `);\n\t\t});\n\n\t\t// TODO: This doesn't work correctly but it doesn't matter too much as it only happens when\n\t\t// there is a lot of whitespace at the end of a prompt input\n\t\ttest.skip('track whitespace when ConPTY deletes whitespace unexpectedly', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\txterm.input('ls', true);\n\t\t\tawait writePromise('ls');\n\t\t\tawait assertPromptInput(`ls|`);\n\n\t\t\txterm.input(' '.repeat(4), true);\n\t\t\tawait writePromise(' '.repeat(4));\n\t\t\tawait assertPromptInput(`ls    |`);\n\n\t\t\txterm.input(' ', true);\n\t\t\tawait writePromise('\\x1b[4D\\x1b[5X\\x1b[5C'); // Cursor left x(N-1), delete xN, cursor right xN\n\t\t\tawait assertPromptInput(`ls     |`);\n\t\t});\n\n\t\ttest('track whitespace beyond cursor', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise(' '.repeat(8));\n\t\t\tawait assertPromptInput(`${' '.repeat(8)}|`);\n\n\t\t\tawait writePromise('\\x1b[4D');\n\t\t\tawait assertPromptInput(`${' '.repeat(4)}|${' '.repeat(4)}`);\n\t\t});\n\t});\n\n\tsuite('multi-line', () => {\n\t\ttest('basic 2 line', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"a');\n\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\t\t});\n\n\t\ttest('basic 3 line', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"a');\n\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\\nb\\n|`);\n\n\t\t\tawait writePromise('c');\n\t\t\tawait assertPromptInput(`echo \"a\\nb\\nc|`);\n\t\t});\n\n\t\ttest('navigate left in multi-line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('echo \"a');\n\t\t\t\tawait assertPromptInput(`echo \"a|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"a\\n|`);\n\n\t\t\t\tawait writePromise('b');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nb|`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"a\\n|b`);\n\n\t\t\t\tawait writePromise('\\x1b[@c');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc|b`);\n\n\t\t\t\tawait writePromise('\\x1b[K\\n\\r\\âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\n|`);\n\n\t\t\t\tawait writePromise('b');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb|`);\n\n\t\t\t\tawait writePromise(' foo');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb foo|`);\n\n\t\t\t\tawait writePromise('\\x1b[3D');\n\t\t\t\tawait assertPromptInput(`echo \"a\\nc\\nb |foo`);\n\t\t\t});\n\t\t});\n\n\t\ttest('navigate up in multi-line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('echo \"foo');\n\t\t\t\tawait assertPromptInput(`echo \"foo|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\n|`);\n\n\t\t\t\tawait writePromise('bar');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar|`);\n\n\t\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar\\n|`);\n\n\t\t\t\tawait writePromise('baz');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar\\nbaz|`);\n\n\t\t\t\tawait writePromise('\\x1b[A');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nbar|\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nba|r\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\nb|ar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[D');\n\t\t\t\tawait assertPromptInput(`echo \"foo\\n|bar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[1;9H');\n\t\t\t\tawait assertPromptInput(`echo \"|foo\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"f|oo\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"fo|o\\nbar\\nbaz`);\n\n\t\t\t\tawait writePromise('\\x1b[C');\n\t\t\t\tawait assertPromptInput(`echo \"foo|\\nbar\\nbaz`);\n\t\t\t});\n\t\t});\n\n\t\ttest('navigating up when first line contains invalid/stale trailing whitespace', async () => {\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"foo      \\x1b[6D');\n\t\t\tawait assertPromptInput(`echo \"foo|`);\n\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tsetContinuationPrompt('âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"foo\\n|`);\n\n\t\t\tawait writePromise('bar');\n\t\t\tawait assertPromptInput(`echo \"foo\\nbar|`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\nba|r`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\nb|ar`);\n\n\t\t\tawait writePromise('\\x1b[D');\n\t\t\tawait assertPromptInput(`echo \"foo\\n|bar`);\n\t\t});\n\t});\n\n\tsuite('multi-line wrapped (no continuation prompt)', () => {\n\t\ttest('basic wrapped line', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\txterm.resize(5, 10);\n\n\t\t\t\tawait writePromise('$ ');\n\t\t\t\tfireCommandStart();\n\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\tawait writePromise('ech');\n\t\t\t\tawait assertPromptInput(`ech|`);\n\n\t\t\t\tawait writePromise('o ');\n\t\t\t\tawait assertPromptInput(`echo |`);\n\n\t\t\t\tawait writePromise('\"a\"');\n\t\t\t\t// HACK: Trailing whitespace is due to flaky detection in wrapped lines (but it doesn't matter much)\n\t\t\t\tawait assertPromptInput(`echo \"a\"| `);\n\t\t\t\tawait writePromise('\\n\\r\\ b');\n\t\t\t\tawait assertPromptInput(`echo \"a\"\\n b|`);\n\t\t\t\tawait writePromise('\\n\\r\\ c');\n\t\t\t\tawait assertPromptInput(`echo \"a\"\\n b\\n c|`);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('multi-line wrapped (continuation prompt)', () => {\n\t\ttest('basic wrapped line', async () => {\n\t\t\txterm.resize(5, 10);\n\t\t\tpromptInputModel.setContinuationPrompt('âˆ™ ');\n\t\t\tawait writePromise('$ ');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('ech');\n\t\t\tawait assertPromptInput(`ech|`);\n\n\t\t\tawait writePromise('o ');\n\t\t\tawait assertPromptInput(`echo |`);\n\n\t\t\tawait writePromise('\"a\"');\n\t\t\t// HACK: Trailing whitespace is due to flaky detection in wrapped lines (but it doesn't matter much)\n\t\t\tawait assertPromptInput(`echo \"a\"| `);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\n|`);\n\t\t\tawait writePromise('b');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb|`);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\n|`);\n\t\t\tawait writePromise('c');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\nc|`);\n\t\t\tawait writePromise('\\n\\r\\âˆ™ ');\n\t\t\tawait assertPromptInput(`echo \"a\"\\nb\\nc\\n|`);\n\t\t});\n\t});\n\tsuite('multi-line wrapped fish', () => {\n\t\ttest('forward slash continuation', async () => {\n\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\tawait writePromise('$ ');\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('[I] meganrogge@Megans-MacBook-Pro ~ (main|BISECTING)>');\n\t\t\tfireCommandStart();\n\n\t\t\tawait writePromise('ech\\\\');\n\t\t\tawait assertPromptInput(`ech\\\\|`);\n\t\t\tawait writePromise('\\no bye');\n\t\t\tawait assertPromptInput(`echo bye|`);\n\t\t});\n\t\ttest('newline with no continuation', async () => {\n\t\t\tpromptInputModel.setShellType(PosixShellType.Fish);\n\t\t\tawait writePromise('$ ');\n\t\t\tawait assertPromptInput('|');\n\t\t\tawait writePromise('[I] meganrogge@Megans-MacBook-Pro ~ (main|BISECTING)>');\n\t\t\tfireCommandStart();\n\t\t\tawait assertPromptInput('|');\n\n\t\t\tawait writePromise('echo \"hi');\n\t\t\tawait assertPromptInput(`echo \"hi|`);\n\t\t\tawait writePromise('\\nand bye\\nwhy\"');\n\t\t\tawait assertPromptInput(`echo \"hi\\nand bye\\nwhy\"|`);\n\t\t});\n\t});\n\n\t// To \"record a session\" for these tests:\n\t// - Enable debug logging\n\t// - Open and clear Terminal output channel\n\t// - Open terminal and perform the test\n\t// - Extract all \"parsing data\" lines from the terminal\n\tsuite('recorded sessions', () => {\n\t\tasync function replayEvents(events: string[]) {\n\t\t\tfor (const data of events) {\n\t\t\t\tawait writePromise(data);\n\t\t\t}\n\t\t}\n\n\t\tsuite('Windows 11 (10.0.22621.3447), pwsh 7.4.2, starship prompt 1.10.2', () => {\n\t\t\ttest('input with ignored ghost text', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:13:47 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$â‡¡ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93mf\u001b[97m\u001b[2m\u001b[3makecommand\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[93m\bfo\u001b[9X',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hfoo\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('foo|');\n\t\t\t\t});\n\t\t\t});\n\t\t\ttest('input with accepted and run ghost text', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:41:36 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tpromptInputModel.setContinuationPrompt('âˆ™ ');\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93me\u001b[97m\u001b[2m\u001b[3mcho \"hello world\"\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('e|[cho \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\bec\u001b[97m\u001b[2m\u001b[3mho \"hello world\"\u001b[3;5H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('ec|[ho \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hech\u001b[97m\u001b[2m\u001b[3mo \"hello world\"\u001b[3;6H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('ech|[o \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho\u001b[97m\u001b[2m\u001b[3m \"hello world\"\u001b[3;7H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo|[ \"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho \u001b[97m\u001b[2m\u001b[3m\"hello world\"\u001b[3;8H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo |[\"hello world\"]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3Hecho \u001b[36m\"hello world\"\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b]633;E;echo \"hello world\";ff464d39-bc80-4bae-9ead-b1cafc4adf6f\u0007\u001b]633;C\u0007',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandExecuted();\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\\r\\n',\n\t\t\t\t\t\t'hello world\\r\\n',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('echo \"hello world\"');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b]633;D;0\u0007\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m03:41:42 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/prompt_input_model \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$ \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\t\t\t\t});\n\t\t\t});\n\n\t\t\ttest('input, go to start (ctrl+home), delete word in front (ctrl+delete)', async () => {\n\t\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[2J\u001b[m\u001b[H\u001b]0;C:\\Program Files\\WindowsApps\\Microsoft.PowerShell_7.4.2.0_x64__8wekyb3d8bbwe\\pwsh.exe\u0007\u001b[?25h',\n\t\t\t\t\t\t'\u001b[?25l\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\\r\\n\u001b[K\u001b[H\u001b[?25h',\n\t\t\t\t\t\t'\u001b]633;P;IsWindows=True\u0007',\n\t\t\t\t\t\t'\u001b]633;P;ContinuationPrompt=\\x1b[38\\x3b5\\x3b8mâˆ™\\x1b[0m \u0007',\n\t\t\t\t\t\t'\u001b]633;A\u0007\u001b]633;P;Cwd=C:\\x5cGithub\\x5cmicrosoft\\x5cvscode\u0007\u001b]633;B\u0007',\n\t\t\t\t\t\t'\u001b[34m\\r\\nî‚¶\u001b[38;2;17;17;17m\u001b[44m16:07:06 \u001b[34m\u001b[41mî‚° \u001b[38;2;17;17;17mvscode \u001b[31m\u001b[43mî‚° \u001b[38;2;17;17;17mî‚  tyriar/210662 \u001b[33m\u001b[46mî‚° \u001b[38;2;17;17;17m$! \u001b[36m\u001b[49mî‚° \u001b[mvia \u001b[32m\u001b[1mîœ˜ v18.18.2 \\r\\nâ¯\u001b[m ',\n\t\t\t\t\t]);\n\t\t\t\t\tfireCommandStart();\n\t\t\t\t\tawait assertPromptInput('|');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[?25l\u001b[93mG\u001b[97m\u001b[2m\u001b[3mit push\u001b[3;4H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\bGe\u001b[97m\u001b[2m\u001b[3mt-ChildItem -Path a\u001b[3;5H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[93m\u001b[3;3HGet\u001b[97m\u001b[2m\u001b[3m-ChildItem -Path a\u001b[3;6H\u001b[?25h',\n\t\t\t\t\t]);\n\t\t\t\t\tawait assertPromptInput('Get|[-ChildItem -Path a]');\n\n\t\t\t\t\tawait replayEvents([\n\t\t\t\t\t\t'\u001b[m',\n\t\t\t\t\t\t'\u001b[?25l\u001b[3;3H\u001b[?25h',\n\t\t\t\t\t\t'\u001b[21X',\n\t\t\t\t\t]);\n\n\t\t\t\t\t// Don't force a sync, the prompt input model should update by itself\n\t\t\t\t\tawait timeout(0);\n\t\t\t\t\tconst actualValueWithCursor = promptInputModel.getCombinedString();\n\t\t\t\t\tstrictEqual(\n\t\t\t\t\t\tactualValueWithCursor,\n\t\t\t\t\t\t'|'.replaceAll('\\n', '\\u23CE')\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n});\n"]}