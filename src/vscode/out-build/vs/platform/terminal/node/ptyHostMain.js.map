{"version":3,"sources":["vs/platform/terminal/node/ptyHostMain.ts"],"names":[],"mappings":"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","file":"ptyHostMain.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DefaultURITransformer } from '../../../base/common/uriIpc.js';\nimport { ProxyChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { Server as ChildProcessServer } from '../../../base/parts/ipc/node/ipc.cp.js';\nimport { Server as UtilityProcessServer } from '../../../base/parts/ipc/node/ipc.mp.js';\nimport { localize } from '../../../nls.js';\nimport { OPTIONS, parseArgs } from '../../environment/node/argv.js';\nimport { NativeEnvironmentService } from '../../environment/node/environmentService.js';\nimport { getLogLevel } from '../../log/common/log.js';\nimport { LoggerChannel } from '../../log/common/logIpc.js';\nimport { LogService } from '../../log/common/logService.js';\nimport { LoggerService } from '../../log/node/loggerService.js';\nimport product from '../../product/common/product.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IReconnectConstants, TerminalIpcChannels } from '../common/terminal.js';\nimport { HeartbeatService } from './heartbeatService.js';\nimport { PtyService } from './ptyService.js';\nimport { isUtilityProcess } from '../../../base/parts/sandbox/node/electronTypes.js';\nimport { timeout } from '../../../base/common/async.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\n\nstartPtyHost();\n\nasync function startPtyHost() {\n\t// Parse environment variables\n\tconst startupDelay = parseInt(process.env.VSCODE_STARTUP_DELAY ?? '0');\n\tconst simulatedLatency = parseInt(process.env.VSCODE_LATENCY ?? '0');\n\tconst reconnectConstants: IReconnectConstants = {\n\t\tgraceTime: parseInt(process.env.VSCODE_RECONNECT_GRACE_TIME || '0'),\n\t\tshortGraceTime: parseInt(process.env.VSCODE_RECONNECT_SHORT_GRACE_TIME || '0'),\n\t\tscrollback: parseInt(process.env.VSCODE_RECONNECT_SCROLLBACK || '100')\n\t};\n\n\t// Sanitize environment\n\tdelete process.env.VSCODE_RECONNECT_GRACE_TIME;\n\tdelete process.env.VSCODE_RECONNECT_SHORT_GRACE_TIME;\n\tdelete process.env.VSCODE_RECONNECT_SCROLLBACK;\n\tdelete process.env.VSCODE_LATENCY;\n\tdelete process.env.VSCODE_STARTUP_DELAY;\n\n\t// Delay startup if needed, this must occur before RPC is setup to avoid the channel from timing\n\t// out.\n\tif (startupDelay) {\n\t\tawait timeout(startupDelay);\n\t}\n\n\t// Setup RPC\n\tconst _isUtilityProcess = isUtilityProcess(process);\n\tlet server: ChildProcessServer<string> | UtilityProcessServer;\n\tif (_isUtilityProcess) {\n\t\tserver = new UtilityProcessServer();\n\t} else {\n\t\tserver = new ChildProcessServer(TerminalIpcChannels.PtyHost);\n\t}\n\n\t// Services\n\tconst productService: IProductService = { _serviceBrand: undefined, ...product };\n\tconst environmentService = new NativeEnvironmentService(parseArgs(process.argv, OPTIONS), productService);\n\tconst loggerService = new LoggerService(getLogLevel(environmentService), environmentService.logsHome);\n\tserver.registerChannel(TerminalIpcChannels.Logger, new LoggerChannel(loggerService, () => DefaultURITransformer));\n\tconst logger = loggerService.createLogger('ptyhost', { name: localize('ptyHost', \"Pty Host\") });\n\tconst logService = new LogService(logger);\n\n\t// Log developer config\n\tif (startupDelay) {\n\t\tlogService.warn(`Pty Host startup is delayed ${startupDelay}ms`);\n\t}\n\tif (simulatedLatency) {\n\t\tlogService.warn(`Pty host is simulating ${simulatedLatency}ms latency`);\n\t}\n\n\tconst disposables = new DisposableStore();\n\n\t// Heartbeat responsiveness tracking\n\tconst heartbeatService = new HeartbeatService();\n\tserver.registerChannel(TerminalIpcChannels.Heartbeat, ProxyChannel.fromService(heartbeatService, disposables));\n\n\t// Init pty service\n\tconst ptyService = new PtyService(logService, productService, reconnectConstants, simulatedLatency);\n\tconst ptyServiceChannel = ProxyChannel.fromService(ptyService, disposables);\n\tserver.registerChannel(TerminalIpcChannels.PtyHost, ptyServiceChannel);\n\n\t// Register a channel for direct communication via Message Port\n\tif (_isUtilityProcess) {\n\t\tserver.registerChannel(TerminalIpcChannels.PtyHostWindow, ptyServiceChannel);\n\t}\n\n\t// Clean up\n\tprocess.once('exit', () => {\n\t\tlogService.trace('Pty host exiting');\n\t\tlogService.dispose();\n\t\theartbeatService.dispose();\n\t\tptyService.dispose();\n\t});\n}\n"]}