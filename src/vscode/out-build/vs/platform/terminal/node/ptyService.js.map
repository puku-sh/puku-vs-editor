{"version":3,"sources":["vs/platform/terminal/node/ptyService.ts"],"names":[],"mappings":"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","file":"ptyService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { execFile, exec } from 'child_process';\nimport { AutoOpenBarrier, ProcessTimeRunOnceScheduler, Promises, Queue, timeout } from '../../../base/common/async.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IProcessEnvironment, isWindows, OperatingSystem, OS } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { getSystemShell } from '../../../base/node/shell.js';\nimport { ILogService, LogLevel } from '../../log/common/log.js';\nimport { RequestStore } from '../common/requestStore.js';\nimport { IProcessDataEvent, IProcessReadyEvent, IPtyService, IRawTerminalInstanceLayoutInfo, IReconnectConstants, IShellLaunchConfig, ITerminalInstanceLayoutInfoById, ITerminalLaunchError, ITerminalsLayoutInfo, ITerminalTabLayoutInfoById, TerminalIcon, IProcessProperty, TitleEventSource, ProcessPropertyType, IProcessPropertyMap, IFixedTerminalDimensions, IPersistentTerminalProcessLaunchConfig, ICrossVersionSerializedTerminalState, ISerializedTerminalState, ITerminalProcessOptions, IPtyHostLatencyMeasurement, type IPtyServiceContribution, PosixShellType, ITerminalLaunchResult } from '../common/terminal.js';\nimport { TerminalDataBufferer } from '../common/terminalDataBuffering.js';\nimport { escapeNonWindowsPath } from '../common/terminalEnvironment.js';\nimport type { ISerializeOptions, SerializeAddon as XtermSerializeAddon } from '@xterm/addon-serialize';\nimport type { Unicode11Addon as XtermUnicode11Addon } from '@xterm/addon-unicode11';\nimport { IGetTerminalLayoutInfoArgs, IProcessDetails, ISetTerminalLayoutInfoArgs, ITerminalTabLayoutInfoDto } from '../common/terminalProcess.js';\nimport { getWindowsBuildNumber } from './terminalEnvironment.js';\nimport { TerminalProcess } from './terminalProcess.js';\nimport { localize } from '../../../nls.js';\nimport { ignoreProcessNames } from './childProcessMonitor.js';\nimport { ErrorNoTelemetry } from '../../../base/common/errors.js';\nimport { ShellIntegrationAddon } from '../common/xterm/shellIntegrationAddon.js';\nimport { formatMessageForTerminal } from '../common/terminalStrings.js';\nimport { IPtyHostProcessReplayEvent } from '../common/capabilities/capabilities.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { join } from '../../../base/common/path.js';\nimport { memoize } from '../../../base/common/decorators.js';\nimport * as performance from '../../../base/common/performance.js';\nimport pkg from '@xterm/headless';\nimport { AutoRepliesPtyServiceContribution } from './terminalContrib/autoReplies/autoRepliesContribController.js';\nimport { hasKey, isFunction, isNumber, isString } from '../../../base/common/types.js';\n\ntype XtermTerminal = pkg.Terminal;\nconst { Terminal: XtermTerminal } = pkg;\n\ninterface ITraceRpcArgs {\n\tlogService: ILogService;\n\tsimulatedLatency: number;\n}\n\nexport function traceRpc(_target: Object, key: string, descriptor: PropertyDescriptor) {\n\tif (!isFunction(descriptor.value)) {\n\t\tthrow new Error('not supported');\n\t}\n\tconst fnKey = 'value';\n\tconst fn = descriptor.value;\n\tdescriptor[fnKey] = async function <TThis extends { traceRpcArgs: ITraceRpcArgs }>(this: TThis, ...args: unknown[]) {\n\t\tif (this.traceRpcArgs.logService.getLevel() === LogLevel.Trace) {\n\t\t\tthis.traceRpcArgs.logService.trace(`[RPC Request] PtyService#${fn.name}(${args.map(e => JSON.stringify(e)).join(', ')})`);\n\t\t}\n\t\tif (this.traceRpcArgs.simulatedLatency) {\n\t\t\tawait timeout(this.traceRpcArgs.simulatedLatency);\n\t\t}\n\t\tlet result: unknown;\n\t\ttry {\n\t\t\tresult = await fn.apply(this, args);\n\t\t} catch (e) {\n\t\t\tthis.traceRpcArgs.logService.error(`[RPC Response] PtyService#${fn.name}`, e);\n\t\t\tthrow e;\n\t\t}\n\t\tif (this.traceRpcArgs.logService.getLevel() === LogLevel.Trace) {\n\t\t\tthis.traceRpcArgs.logService.trace(`[RPC Response] PtyService#${fn.name}`, result);\n\t\t}\n\t\treturn result;\n\t};\n}\n\ntype WorkspaceId = string;\n\nlet SerializeAddon: typeof XtermSerializeAddon;\nlet Unicode11Addon: typeof XtermUnicode11Addon;\n\nexport class PtyService extends Disposable implements IPtyService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _ptys: Map<number, PersistentTerminalProcess> = new Map();\n\tprivate readonly _workspaceLayoutInfos = new Map<WorkspaceId, ISetTerminalLayoutInfoArgs>();\n\tprivate readonly _detachInstanceRequestStore: RequestStore<IProcessDetails | undefined, { workspaceId: string; instanceId: number }>;\n\tprivate readonly _revivedPtyIdMap: Map<string, { newId: number; state: ISerializedTerminalState }> = new Map();\n\n\t// #region Pty service contribution RPC calls\n\n\tprivate readonly _autoRepliesContribution: AutoRepliesPtyServiceContribution;\n\t@traceRpc\n\tasync installAutoReply(match: string, reply: string) {\n\t\tawait this._autoRepliesContribution.installAutoReply(match, reply);\n\t}\n\t@traceRpc\n\tasync uninstallAllAutoReplies() {\n\t\tawait this._autoRepliesContribution.uninstallAllAutoReplies();\n\t}\n\n\t// #endregion\n\n\tprivate readonly _contributions: IPtyServiceContribution[];\n\n\tprivate _lastPtyId: number = 0;\n\n\tprivate readonly _onHeartbeat = this._register(new Emitter<void>());\n\treadonly onHeartbeat = this._traceEvent('_onHeartbeat', this._onHeartbeat.event);\n\n\tprivate readonly _onProcessData = this._register(new Emitter<{ id: number; event: IProcessDataEvent | string }>());\n\treadonly onProcessData = this._traceEvent('_onProcessData', this._onProcessData.event);\n\tprivate readonly _onProcessReplay = this._register(new Emitter<{ id: number; event: IPtyHostProcessReplayEvent }>());\n\treadonly onProcessReplay = this._traceEvent('_onProcessReplay', this._onProcessReplay.event);\n\tprivate readonly _onProcessReady = this._register(new Emitter<{ id: number; event: IProcessReadyEvent }>());\n\treadonly onProcessReady = this._traceEvent('_onProcessReady', this._onProcessReady.event);\n\tprivate readonly _onProcessExit = this._register(new Emitter<{ id: number; event: number | undefined }>());\n\treadonly onProcessExit = this._traceEvent('_onProcessExit', this._onProcessExit.event);\n\tprivate readonly _onProcessOrphanQuestion = this._register(new Emitter<{ id: number }>());\n\treadonly onProcessOrphanQuestion = this._traceEvent('_onProcessOrphanQuestion', this._onProcessOrphanQuestion.event);\n\tprivate readonly _onDidRequestDetach = this._register(new Emitter<{ requestId: number; workspaceId: string; instanceId: number }>());\n\treadonly onDidRequestDetach = this._traceEvent('_onDidRequestDetach', this._onDidRequestDetach.event);\n\tprivate readonly _onDidChangeProperty = this._register(new Emitter<{ id: number; property: IProcessProperty }>());\n\treadonly onDidChangeProperty = this._traceEvent('_onDidChangeProperty', this._onDidChangeProperty.event);\n\n\tprivate _traceEvent<T>(name: string, event: Event<T>): Event<T> {\n\t\tevent(e => {\n\t\t\tif (this._logService.getLevel() === LogLevel.Trace) {\n\t\t\t\tthis._logService.trace(`[RPC Event] PtyService#${name}.fire(${JSON.stringify(e)})`);\n\t\t\t}\n\t\t});\n\t\treturn event;\n\t}\n\n\t@memoize\n\tget traceRpcArgs(): ITraceRpcArgs {\n\t\treturn {\n\t\t\tlogService: this._logService,\n\t\t\tsimulatedLatency: this._simulatedLatency\n\t\t};\n\t}\n\n\tconstructor(\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _productService: IProductService,\n\t\tprivate readonly _reconnectConstants: IReconnectConstants,\n\t\tprivate readonly _simulatedLatency: number\n\t) {\n\t\tsuper();\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tfor (const pty of this._ptys.values()) {\n\t\t\t\tpty.shutdown(true);\n\t\t\t}\n\t\t\tthis._ptys.clear();\n\t\t}));\n\n\t\tthis._detachInstanceRequestStore = this._register(new RequestStore(undefined, this._logService));\n\t\tthis._detachInstanceRequestStore.onCreateRequest(this._onDidRequestDetach.fire, this._onDidRequestDetach);\n\n\t\tthis._autoRepliesContribution = new AutoRepliesPtyServiceContribution(this._logService);\n\n\t\tthis._contributions = [this._autoRepliesContribution];\n\n\t}\n\n\t@traceRpc\n\tasync refreshIgnoreProcessNames(names: string[]): Promise<void> {\n\t\tignoreProcessNames.length = 0;\n\t\tignoreProcessNames.push(...names);\n\t}\n\n\t@traceRpc\n\tasync requestDetachInstance(workspaceId: string, instanceId: number): Promise<IProcessDetails | undefined> {\n\t\treturn this._detachInstanceRequestStore.createRequest({ workspaceId, instanceId });\n\t}\n\n\t@traceRpc\n\tasync acceptDetachInstanceReply(requestId: number, persistentProcessId: number): Promise<void> {\n\t\tlet processDetails: IProcessDetails | undefined = undefined;\n\t\tconst pty = this._ptys.get(persistentProcessId);\n\t\tif (pty) {\n\t\t\tprocessDetails = await this._buildProcessDetails(persistentProcessId, pty);\n\t\t}\n\t\tthis._detachInstanceRequestStore.acceptReply(requestId, processDetails);\n\t}\n\n\t@traceRpc\n\tasync freePortKillProcess(port: string): Promise<{ port: string; processId: string }> {\n\t\tconst stdout = await new Promise<string>((resolve, reject) => {\n\t\t\texec(isWindows ? `netstat -ano | findstr \"${port}\"` : `lsof -nP -iTCP -sTCP:LISTEN | grep ${port}`, {}, (err, stdout) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn reject('Problem occurred when listing active processes');\n\t\t\t\t}\n\t\t\t\tresolve(stdout);\n\t\t\t});\n\t\t});\n\t\tconst processesForPort = stdout.split(/\\r?\\n/).filter(s => !!s.trim());\n\t\tif (processesForPort.length >= 1) {\n\t\t\tconst capturePid = /\\s+(\\d+)(?:\\s+|$)/;\n\t\t\tconst processId = processesForPort[0].match(capturePid)?.[1];\n\t\t\tif (processId) {\n\t\t\t\ttry {\n\t\t\t\t\tprocess.kill(Number.parseInt(processId));\n\t\t\t\t} catch { }\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Processes for port ${port} were not found`);\n\t\t\t}\n\t\t\treturn { port, processId };\n\t\t}\n\t\tthrow new Error(`Could not kill process with port ${port}`);\n\t}\n\n\t@traceRpc\n\tasync serializeTerminalState(ids: number[]): Promise<string> {\n\t\tconst promises: Promise<ISerializedTerminalState>[] = [];\n\t\tfor (const [persistentProcessId, persistentProcess] of this._ptys.entries()) {\n\t\t\t// Only serialize persistent processes that have had data written or performed a replay\n\t\t\tif (persistentProcess.hasWrittenData && ids.indexOf(persistentProcessId) !== -1) {\n\t\t\t\tpromises.push(Promises.withAsyncBody<ISerializedTerminalState>(async r => {\n\t\t\t\t\tr({\n\t\t\t\t\t\tid: persistentProcessId,\n\t\t\t\t\t\tshellLaunchConfig: persistentProcess.shellLaunchConfig,\n\t\t\t\t\t\tprocessDetails: await this._buildProcessDetails(persistentProcessId, persistentProcess),\n\t\t\t\t\t\tprocessLaunchConfig: persistentProcess.processLaunchOptions,\n\t\t\t\t\t\tunicodeVersion: persistentProcess.unicodeVersion,\n\t\t\t\t\t\treplayEvent: await persistentProcess.serializeNormalBuffer(),\n\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\tconst serialized: ICrossVersionSerializedTerminalState = {\n\t\t\tversion: 1,\n\t\t\tstate: await Promise.all(promises)\n\t\t};\n\t\treturn JSON.stringify(serialized);\n\t}\n\n\t@traceRpc\n\tasync reviveTerminalProcesses(workspaceId: string, state: ISerializedTerminalState[], dateTimeFormatLocale: string) {\n\t\tconst promises: Promise<void>[] = [];\n\t\tfor (const terminal of state) {\n\t\t\tpromises.push(this._reviveTerminalProcess(workspaceId, terminal));\n\t\t}\n\t\tawait Promise.all(promises);\n\t}\n\n\tprivate async _reviveTerminalProcess(workspaceId: string, terminal: ISerializedTerminalState): Promise<void> {\n\t\tconst restoreMessage = localize('terminal-history-restored', \"History restored\");\n\n\t\t// Conpty v1.22+ uses passthrough and doesn't reprint the buffer often, this means that when\n\t\t// the terminal is revived, the cursor would be at the bottom of the buffer then when\n\t\t// PSReadLine requests `GetConsoleCursorInfo` it will be handled by conpty itself by design.\n\t\t// This causes the cursor to move to the top into the replayed terminal contents. To avoid\n\t\t// this, the post restore message will print new lines to get a clear viewport and put the\n\t\t// cursor back at to top left.\n\t\tlet postRestoreMessage = '';\n\t\tif (isWindows) {\n\t\t\tconst lastReplayEvent = terminal.replayEvent.events.length > 0 ? terminal.replayEvent.events.at(-1) : undefined;\n\t\t\tif (lastReplayEvent) {\n\t\t\t\tpostRestoreMessage += '\\r\\n'.repeat(lastReplayEvent.rows - 1) + `\\x1b[H`;\n\t\t\t}\n\t\t}\n\n\t\t// TODO: We may at some point want to show date information in a hover via a custom sequence:\n\t\t//   new Date(terminal.timestamp).toLocaleDateString(dateTimeFormatLocale)\n\t\t//   new Date(terminal.timestamp).toLocaleTimeString(dateTimeFormatLocale)\n\t\tconst newId = await this.createProcess(\n\t\t\t{\n\t\t\t\t...terminal.shellLaunchConfig,\n\t\t\t\tcwd: terminal.processDetails.cwd,\n\t\t\t\tcolor: terminal.processDetails.color,\n\t\t\t\ticon: terminal.processDetails.icon,\n\t\t\t\tname: terminal.processDetails.titleSource === TitleEventSource.Api ? terminal.processDetails.title : undefined,\n\t\t\t\tinitialText: terminal.replayEvent.events[0].data + formatMessageForTerminal(restoreMessage, { loudFormatting: true }) + postRestoreMessage\n\t\t\t},\n\t\t\tterminal.processDetails.cwd,\n\t\t\tterminal.replayEvent.events[0].cols,\n\t\t\tterminal.replayEvent.events[0].rows,\n\t\t\tterminal.unicodeVersion,\n\t\t\tterminal.processLaunchConfig.env,\n\t\t\tterminal.processLaunchConfig.executableEnv,\n\t\t\tterminal.processLaunchConfig.options,\n\t\t\ttrue,\n\t\t\tterminal.processDetails.workspaceId,\n\t\t\tterminal.processDetails.workspaceName,\n\t\t\ttrue,\n\t\t\tterminal.replayEvent.events[0].data\n\t\t);\n\t\t// Don't start the process here as there's no terminal to answer CPR\n\t\tconst oldId = this._getRevivingProcessId(workspaceId, terminal.id);\n\t\tthis._revivedPtyIdMap.set(oldId, { newId, state: terminal });\n\t\tthis._logService.info(`Revived process, old id ${oldId} -> new id ${newId}`);\n\t}\n\n\t@traceRpc\n\tasync shutdownAll(): Promise<void> {\n\t\tthis.dispose();\n\t}\n\n\t@traceRpc\n\tasync createProcess(\n\t\tshellLaunchConfig: IShellLaunchConfig,\n\t\tcwd: string,\n\t\tcols: number,\n\t\trows: number,\n\t\tunicodeVersion: '6' | '11',\n\t\tenv: IProcessEnvironment,\n\t\texecutableEnv: IProcessEnvironment,\n\t\toptions: ITerminalProcessOptions,\n\t\tshouldPersist: boolean,\n\t\tworkspaceId: string,\n\t\tworkspaceName: string,\n\t\tisReviving?: boolean,\n\t\trawReviveBuffer?: string\n\t): Promise<number> {\n\t\tif (shellLaunchConfig.attachPersistentProcess) {\n\t\t\tthrow new Error('Attempt to create a process when attach object was provided');\n\t\t}\n\t\tconst id = ++this._lastPtyId;\n\t\tconst process = new TerminalProcess(shellLaunchConfig, cwd, cols, rows, env, executableEnv, options, this._logService, this._productService);\n\t\tconst processLaunchOptions: IPersistentTerminalProcessLaunchConfig = {\n\t\t\tenv,\n\t\t\texecutableEnv,\n\t\t\toptions\n\t\t};\n\t\tconst persistentProcess = new PersistentTerminalProcess(id, process, workspaceId, workspaceName, shouldPersist, cols, rows, processLaunchOptions, unicodeVersion, this._reconnectConstants, this._logService, isReviving && isString(shellLaunchConfig.initialText) ? shellLaunchConfig.initialText : undefined, rawReviveBuffer, shellLaunchConfig.icon, shellLaunchConfig.color, shellLaunchConfig.name, shellLaunchConfig.fixedDimensions);\n\t\tprocess.onProcessExit(event => {\n\t\t\tfor (const contrib of this._contributions) {\n\t\t\t\tcontrib.handleProcessDispose(id);\n\t\t\t}\n\t\t\tpersistentProcess.dispose();\n\t\t\tthis._ptys.delete(id);\n\t\t\tthis._onProcessExit.fire({ id, event });\n\t\t});\n\t\tpersistentProcess.onProcessData(event => this._onProcessData.fire({ id, event }));\n\t\tpersistentProcess.onProcessReplay(event => this._onProcessReplay.fire({ id, event }));\n\t\tpersistentProcess.onProcessReady(event => this._onProcessReady.fire({ id, event }));\n\t\tpersistentProcess.onProcessOrphanQuestion(() => this._onProcessOrphanQuestion.fire({ id }));\n\t\tpersistentProcess.onDidChangeProperty(property => this._onDidChangeProperty.fire({ id, property }));\n\t\tpersistentProcess.onPersistentProcessReady(() => {\n\t\t\tfor (const contrib of this._contributions) {\n\t\t\t\tcontrib.handleProcessReady(id, process);\n\t\t\t}\n\t\t});\n\t\tthis._ptys.set(id, persistentProcess);\n\t\treturn id;\n\t}\n\n\t@traceRpc\n\tasync attachToProcess(id: number): Promise<void> {\n\t\ttry {\n\t\t\tawait this._throwIfNoPty(id).attach();\n\t\t\tthis._logService.info(`Persistent process reconnection \"${id}\"`);\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Persistent process reconnection \"${id}\" failed`, e.message);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\t@traceRpc\n\tasync updateTitle(id: number, title: string, titleSource: TitleEventSource): Promise<void> {\n\t\tthis._throwIfNoPty(id).setTitle(title, titleSource);\n\t}\n\n\t@traceRpc\n\tasync updateIcon(id: number, userInitiated: boolean, icon: URI | { light: URI; dark: URI } | { id: string; color?: { id: string } }, color?: string): Promise<void> {\n\t\tthis._throwIfNoPty(id).setIcon(userInitiated, icon, color);\n\t}\n\n\t@traceRpc\n\tasync clearBuffer(id: number): Promise<void> {\n\t\tthis._throwIfNoPty(id).clearBuffer();\n\t}\n\n\t@traceRpc\n\tasync refreshProperty<T extends ProcessPropertyType>(id: number, type: T): Promise<IProcessPropertyMap[T]> {\n\t\treturn this._throwIfNoPty(id).refreshProperty(type);\n\t}\n\n\t@traceRpc\n\tasync updateProperty<T extends ProcessPropertyType>(id: number, type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._throwIfNoPty(id).updateProperty(type, value);\n\t}\n\n\t@traceRpc\n\tasync detachFromProcess(id: number, forcePersist?: boolean): Promise<void> {\n\t\treturn this._throwIfNoPty(id).detach(forcePersist);\n\t}\n\n\t@traceRpc\n\tasync reduceConnectionGraceTime(): Promise<void> {\n\t\tfor (const pty of this._ptys.values()) {\n\t\t\tpty.reduceGraceTime();\n\t\t}\n\t}\n\n\t@traceRpc\n\tasync listProcesses(): Promise<IProcessDetails[]> {\n\t\tconst persistentProcesses = Array.from(this._ptys.entries()).filter(([_, pty]) => pty.shouldPersistTerminal);\n\n\t\tthis._logService.info(`Listing ${persistentProcesses.length} persistent terminals, ${this._ptys.size} total terminals`);\n\t\tconst promises = persistentProcesses.map(async ([id, terminalProcessData]) => this._buildProcessDetails(id, terminalProcessData));\n\t\tconst allTerminals = await Promise.all(promises);\n\t\treturn allTerminals.filter(entry => entry.isOrphan);\n\t}\n\n\t@traceRpc\n\tasync getPerformanceMarks(): Promise<performance.PerformanceMark[]> {\n\t\treturn performance.getMarks();\n\t}\n\n\t@traceRpc\n\tasync start(id: number): Promise<ITerminalLaunchError | ITerminalLaunchResult | undefined> {\n\t\tconst pty = this._ptys.get(id);\n\t\treturn pty ? pty.start() : { message: `Could not find pty with id \"${id}\"` };\n\t}\n\n\t@traceRpc\n\tasync shutdown(id: number, immediate: boolean): Promise<void> {\n\t\t// Don't throw if the pty is already shutdown\n\t\treturn this._ptys.get(id)?.shutdown(immediate);\n\t}\n\t@traceRpc\n\tasync input(id: number, data: string): Promise<void> {\n\t\tconst pty = this._throwIfNoPty(id);\n\t\tif (pty) {\n\t\t\tfor (const contrib of this._contributions) {\n\t\t\t\tcontrib.handleProcessInput(id, data);\n\t\t\t}\n\t\t\tpty.input(data);\n\t\t}\n\t}\n\t@traceRpc\n\tasync sendSignal(id: number, signal: string): Promise<void> {\n\t\treturn this._throwIfNoPty(id).sendSignal(signal);\n\t}\n\t@traceRpc\n\tasync processBinary(id: number, data: string): Promise<void> {\n\t\treturn this._throwIfNoPty(id).writeBinary(data);\n\t}\n\t@traceRpc\n\tasync resize(id: number, cols: number, rows: number): Promise<void> {\n\t\tconst pty = this._throwIfNoPty(id);\n\t\tif (pty) {\n\t\t\tfor (const contrib of this._contributions) {\n\t\t\t\tcontrib.handleProcessResize(id, cols, rows);\n\t\t\t}\n\t\t\tpty.resize(cols, rows);\n\t\t}\n\t}\n\t@traceRpc\n\tasync getInitialCwd(id: number): Promise<string> {\n\t\treturn this._throwIfNoPty(id).getInitialCwd();\n\t}\n\t@traceRpc\n\tasync getCwd(id: number): Promise<string> {\n\t\treturn this._throwIfNoPty(id).getCwd();\n\t}\n\t@traceRpc\n\tasync acknowledgeDataEvent(id: number, charCount: number): Promise<void> {\n\t\treturn this._throwIfNoPty(id).acknowledgeDataEvent(charCount);\n\t}\n\t@traceRpc\n\tasync setUnicodeVersion(id: number, version: '6' | '11'): Promise<void> {\n\t\treturn this._throwIfNoPty(id).setUnicodeVersion(version);\n\t}\n\n\t@traceRpc\n\tasync setNextCommandId(id: number, commandLine: string, commandId: string): Promise<void> {\n\t\treturn this._throwIfNoPty(id).setNextCommandId(commandLine, commandId);\n\t}\n\t@traceRpc\n\tasync getLatency(): Promise<IPtyHostLatencyMeasurement[]> {\n\t\treturn [];\n\t}\n\t@traceRpc\n\tasync orphanQuestionReply(id: number): Promise<void> {\n\t\treturn this._throwIfNoPty(id).orphanQuestionReply();\n\t}\n\n\t@traceRpc\n\tasync getDefaultSystemShell(osOverride: OperatingSystem = OS): Promise<string> {\n\t\treturn getSystemShell(osOverride, process.env);\n\t}\n\n\t@traceRpc\n\tasync getEnvironment(): Promise<IProcessEnvironment> {\n\t\treturn { ...process.env };\n\t}\n\n\t@traceRpc\n\tasync getWslPath(original: string, direction: 'unix-to-win' | 'win-to-unix' | unknown): Promise<string> {\n\t\tif (direction === 'win-to-unix') {\n\t\t\tif (!isWindows) {\n\t\t\t\treturn original;\n\t\t\t}\n\t\t\tif (getWindowsBuildNumber() < 17063) {\n\t\t\t\treturn original.replace(/\\\\/g, '/');\n\t\t\t}\n\t\t\tconst wslExecutable = this._getWSLExecutablePath();\n\t\t\tif (!wslExecutable) {\n\t\t\t\treturn original;\n\t\t\t}\n\t\t\treturn new Promise<string>(c => {\n\t\t\t\tconst proc = execFile(wslExecutable, ['-e', 'wslpath', original], {}, (error, stdout, stderr) => {\n\t\t\t\t\tc(error ? original : escapeNonWindowsPath(stdout.trim(), PosixShellType.Bash));\n\t\t\t\t});\n\t\t\t\tproc.stdin!.end();\n\t\t\t});\n\t\t}\n\t\tif (direction === 'unix-to-win') {\n\t\t\t// The backend is Windows, for example a local Windows workspace with a wsl session in\n\t\t\t// the terminal.\n\t\t\tif (isWindows) {\n\t\t\t\tif (getWindowsBuildNumber() < 17063) {\n\t\t\t\t\treturn original;\n\t\t\t\t}\n\t\t\t\tconst wslExecutable = this._getWSLExecutablePath();\n\t\t\t\tif (!wslExecutable) {\n\t\t\t\t\treturn original;\n\t\t\t\t}\n\t\t\t\treturn new Promise<string>(c => {\n\t\t\t\t\tconst proc = execFile(wslExecutable, ['-e', 'wslpath', '-w', original], {}, (error, stdout, stderr) => {\n\t\t\t\t\t\tc(error ? original : stdout.trim());\n\t\t\t\t\t});\n\t\t\t\t\tproc.stdin!.end();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Fallback just in case\n\t\treturn original;\n\t}\n\n\tprivate _getWSLExecutablePath(): string | undefined {\n\t\tconst useWSLexe = getWindowsBuildNumber() >= 16299;\n\t\tconst is32ProcessOn64Windows = process.env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\t\tconst systemRoot = process.env['SystemRoot'];\n\t\tif (systemRoot) {\n\t\t\treturn join(systemRoot, is32ProcessOn64Windows ? 'Sysnative' : 'System32', useWSLexe ? 'wsl.exe' : 'bash.exe');\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t@traceRpc\n\tasync getRevivedPtyNewId(workspaceId: string, id: number): Promise<number | undefined> {\n\t\ttry {\n\t\t\treturn this._revivedPtyIdMap.get(this._getRevivingProcessId(workspaceId, id))?.newId;\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't find terminal ID ${workspaceId}-${id}`, e.message);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t@traceRpc\n\tasync setTerminalLayoutInfo(args: ISetTerminalLayoutInfoArgs): Promise<void> {\n\t\tthis._workspaceLayoutInfos.set(args.workspaceId, args);\n\t}\n\n\t@traceRpc\n\tasync getTerminalLayoutInfo(args: IGetTerminalLayoutInfoArgs): Promise<ITerminalsLayoutInfo | undefined> {\n\t\tperformance.mark('code/willGetTerminalLayoutInfo');\n\t\tconst layout = this._workspaceLayoutInfos.get(args.workspaceId);\n\t\tif (layout) {\n\t\t\tconst doneSet: Set<number> = new Set();\n\t\t\tconst expandedTabs = await Promise.all(layout.tabs.map(async tab => this._expandTerminalTab(args.workspaceId, tab, doneSet)));\n\t\t\tconst tabs = expandedTabs.filter(t => t.terminals.length > 0);\n\t\t\tconst expandedBackground = (await Promise.all(layout.background?.map(b => this._expandTerminalInstance(args.workspaceId, b, doneSet)) ?? [])).filter(b => b.terminal !== null).map(b => b.terminal);\n\t\t\tperformance.mark('code/didGetTerminalLayoutInfo');\n\t\t\treturn { tabs, background: expandedBackground };\n\t\t}\n\t\tperformance.mark('code/didGetTerminalLayoutInfo');\n\t\treturn undefined;\n\t}\n\n\tprivate async _expandTerminalTab(workspaceId: string, tab: ITerminalTabLayoutInfoById, doneSet: Set<number>): Promise<ITerminalTabLayoutInfoDto> {\n\t\tconst expandedTerminals = (await Promise.all(tab.terminals.map(t => this._expandTerminalInstance(workspaceId, t, doneSet))));\n\t\tconst filtered = expandedTerminals.filter(term => term.terminal !== null) as IRawTerminalInstanceLayoutInfo<IProcessDetails>[];\n\t\treturn {\n\t\t\tisActive: tab.isActive,\n\t\t\tactivePersistentProcessId: tab.activePersistentProcessId,\n\t\t\tterminals: filtered\n\t\t};\n\t}\n\n\tprivate async _expandTerminalInstance(workspaceId: string, t: ITerminalInstanceLayoutInfoById | number, doneSet: Set<number>): Promise<IRawTerminalInstanceLayoutInfo<IProcessDetails | null>> {\n\t\tconst hasLayout = !isNumber(t);\n\t\tconst ptyId = hasLayout ? t.terminal : t;\n\t\ttry {\n\t\t\tconst oldId = this._getRevivingProcessId(workspaceId, ptyId);\n\t\t\tconst revivedPtyId = this._revivedPtyIdMap.get(oldId)?.newId;\n\t\t\tthis._logService.info(`Expanding terminal instance, old id ${oldId} -> new id ${revivedPtyId}`);\n\t\t\tthis._revivedPtyIdMap.delete(oldId);\n\t\t\tconst persistentProcessId = revivedPtyId ?? ptyId;\n\t\t\tif (doneSet.has(persistentProcessId)) {\n\t\t\t\tthrow new Error(`Terminal ${persistentProcessId} has already been expanded`);\n\t\t\t}\n\t\t\tdoneSet.add(persistentProcessId);\n\t\t\tconst persistentProcess = this._throwIfNoPty(persistentProcessId);\n\t\t\tconst processDetails = persistentProcess && await this._buildProcessDetails(ptyId, persistentProcess, revivedPtyId !== undefined);\n\t\t\treturn {\n\t\t\t\tterminal: { ...processDetails, id: persistentProcessId },\n\t\t\t\trelativeSize: hasLayout ? t.relativeSize : 0\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't get layout info, a terminal was probably disconnected`, e.message);\n\t\t\tthis._logService.debug('Reattach to wrong terminal debug info - layout info by id', t);\n\t\t\tthis._logService.debug('Reattach to wrong terminal debug info - _revivePtyIdMap', Array.from(this._revivedPtyIdMap.values()));\n\t\t\tthis._logService.debug('Reattach to wrong terminal debug info - _ptys ids', Array.from(this._ptys.keys()));\n\t\t\t// this will be filtered out and not reconnected\n\t\t\treturn {\n\t\t\t\tterminal: null,\n\t\t\t\trelativeSize: hasLayout ? t.relativeSize : 0\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate _getRevivingProcessId(workspaceId: string, ptyId: number): string {\n\t\treturn `${workspaceId}-${ptyId}`;\n\t}\n\n\tprivate async _buildProcessDetails(id: number, persistentProcess: PersistentTerminalProcess, wasRevived: boolean = false): Promise<IProcessDetails> {\n\t\tperformance.mark(`code/willBuildProcessDetails/${id}`);\n\t\t// If the process was just revived, don't do the orphan check as it will\n\t\t// take some time\n\t\tconst [cwd, isOrphan] = await Promise.all([persistentProcess.getCwd(), wasRevived ? true : persistentProcess.isOrphaned()]);\n\t\tconst result = {\n\t\t\tid,\n\t\t\ttitle: persistentProcess.title,\n\t\t\ttitleSource: persistentProcess.titleSource,\n\t\t\tpid: persistentProcess.pid,\n\t\t\tworkspaceId: persistentProcess.workspaceId,\n\t\t\tworkspaceName: persistentProcess.workspaceName,\n\t\t\tcwd,\n\t\t\tisOrphan,\n\t\t\ticon: persistentProcess.icon,\n\t\t\tcolor: persistentProcess.color,\n\t\t\tfixedDimensions: persistentProcess.fixedDimensions,\n\t\t\tenvironmentVariableCollections: persistentProcess.processLaunchOptions.options.environmentVariableCollections,\n\t\t\treconnectionProperties: persistentProcess.shellLaunchConfig.reconnectionProperties,\n\t\t\twaitOnExit: persistentProcess.shellLaunchConfig.waitOnExit,\n\t\t\thideFromUser: persistentProcess.shellLaunchConfig.hideFromUser,\n\t\t\tisFeatureTerminal: persistentProcess.shellLaunchConfig.isFeatureTerminal,\n\t\t\ttype: persistentProcess.shellLaunchConfig.type,\n\t\t\thasChildProcesses: persistentProcess.hasChildProcesses,\n\t\t\tshellIntegrationNonce: persistentProcess.processLaunchOptions.options.shellIntegration.nonce,\n\t\t\ttabActions: persistentProcess.shellLaunchConfig.tabActions\n\t\t};\n\t\tperformance.mark(`code/didBuildProcessDetails/${id}`);\n\t\treturn result;\n\t}\n\n\tprivate _throwIfNoPty(id: number): PersistentTerminalProcess {\n\t\tconst pty = this._ptys.get(id);\n\t\tif (!pty) {\n\t\t\tthrow new ErrorNoTelemetry(`Could not find pty ${id} on pty host`);\n\t\t}\n\t\treturn pty;\n\t}\n}\n\nconst enum InteractionState {\n\t/** The terminal has not been interacted with. */\n\tNone = 'None',\n\t/** The terminal has only been interacted with by the replay mechanism. */\n\tReplayOnly = 'ReplayOnly',\n\t/** The terminal has been directly interacted with this session. */\n\tSession = 'Session'\n}\n\nclass PersistentTerminalProcess extends Disposable {\n\n\tprivate readonly _bufferer: TerminalDataBufferer;\n\n\tprivate readonly _pendingCommands = new Map<number, { resolve: (data: unknown) => void; reject: (err: unknown) => void }>();\n\n\tprivate _isStarted: boolean = false;\n\tprivate _interactionState: MutationLogger<InteractionState>;\n\n\tprivate _orphanQuestionBarrier: AutoOpenBarrier | null;\n\tprivate _orphanQuestionReplyTime: number;\n\tprivate _orphanRequestQueue = new Queue<boolean>();\n\tprivate _disconnectRunner1: ProcessTimeRunOnceScheduler;\n\tprivate _disconnectRunner2: ProcessTimeRunOnceScheduler;\n\n\tprivate readonly _onProcessReplay = this._register(new Emitter<IPtyHostProcessReplayEvent>());\n\treadonly onProcessReplay = this._onProcessReplay.event;\n\tprivate readonly _onProcessReady = this._register(new Emitter<IProcessReadyEvent>());\n\treadonly onProcessReady = this._onProcessReady.event;\n\tprivate readonly _onPersistentProcessReady = this._register(new Emitter<void>());\n\t/** Fired when the persistent process has a ready process and has finished its replay. */\n\treadonly onPersistentProcessReady = this._onPersistentProcessReady.event;\n\tprivate readonly _onProcessData = this._register(new Emitter<string>());\n\treadonly onProcessData = this._onProcessData.event;\n\tprivate readonly _onProcessOrphanQuestion = this._register(new Emitter<void>());\n\treadonly onProcessOrphanQuestion = this._onProcessOrphanQuestion.event;\n\tprivate readonly _onDidChangeProperty = this._register(new Emitter<IProcessProperty>());\n\treadonly onDidChangeProperty = this._onDidChangeProperty.event;\n\n\tprivate _inReplay = false;\n\n\tprivate _pid = -1;\n\tprivate _cwd = '';\n\tprivate _title: string | undefined;\n\tprivate _titleSource: TitleEventSource = TitleEventSource.Process;\n\tprivate _serializer: ITerminalSerializer;\n\tprivate _wasRevived: boolean;\n\tprivate _fixedDimensions: IFixedTerminalDimensions | undefined;\n\n\tget pid(): number { return this._pid; }\n\tget shellLaunchConfig(): IShellLaunchConfig { return this._terminalProcess.shellLaunchConfig; }\n\tget hasWrittenData(): boolean { return this._interactionState.value !== InteractionState.None; }\n\tget title(): string { return this._title || this._terminalProcess.currentTitle; }\n\tget titleSource(): TitleEventSource { return this._titleSource; }\n\tget icon(): TerminalIcon | undefined { return this._icon; }\n\tget color(): string | undefined { return this._color; }\n\tget fixedDimensions(): IFixedTerminalDimensions | undefined { return this._fixedDimensions; }\n\tget hasChildProcesses(): boolean { return this._terminalProcess.hasChildProcesses; }\n\n\tsetTitle(title: string, titleSource: TitleEventSource): void {\n\t\tif (titleSource === TitleEventSource.Api) {\n\t\t\tthis._interactionState.setValue(InteractionState.Session, 'setTitle');\n\t\t\tthis._serializer.freeRawReviveBuffer();\n\t\t}\n\t\tthis._title = title;\n\t\tthis._titleSource = titleSource;\n\t}\n\n\tsetIcon(userInitiated: boolean, icon: TerminalIcon, color?: string): void {\n\t\tif (!this._icon || hasKey(icon, { id: true }) && hasKey(this._icon, { id: true }) && icon.id !== this._icon.id ||\n\t\t\t!this.color || color !== this._color) {\n\n\t\t\tthis._serializer.freeRawReviveBuffer();\n\t\t\tif (userInitiated) {\n\t\t\t\tthis._interactionState.setValue(InteractionState.Session, 'setIcon');\n\t\t\t}\n\t\t}\n\t\tthis._icon = icon;\n\t\tthis._color = color;\n\t}\n\n\tprivate _setFixedDimensions(fixedDimensions?: IFixedTerminalDimensions): void {\n\t\tthis._fixedDimensions = fixedDimensions;\n\t}\n\n\tconstructor(\n\t\tprivate _persistentProcessId: number,\n\t\tprivate readonly _terminalProcess: TerminalProcess,\n\t\treadonly workspaceId: string,\n\t\treadonly workspaceName: string,\n\t\treadonly shouldPersistTerminal: boolean,\n\t\tcols: number,\n\t\trows: number,\n\t\treadonly processLaunchOptions: IPersistentTerminalProcessLaunchConfig,\n\t\tpublic unicodeVersion: '6' | '11',\n\t\treconnectConstants: IReconnectConstants,\n\t\tprivate readonly _logService: ILogService,\n\t\treviveBuffer: string | undefined,\n\t\trawReviveBuffer: string | undefined,\n\t\tprivate _icon?: TerminalIcon,\n\t\tprivate _color?: string,\n\t\tname?: string,\n\t\tfixedDimensions?: IFixedTerminalDimensions\n\t) {\n\t\tsuper();\n\t\tthis._interactionState = new MutationLogger(`Persistent process \"${this._persistentProcessId}\" interaction state`, InteractionState.None, this._logService);\n\t\tthis._wasRevived = reviveBuffer !== undefined;\n\t\tthis._serializer = new XtermSerializer(\n\t\t\tcols,\n\t\t\trows,\n\t\t\treconnectConstants.scrollback,\n\t\t\tunicodeVersion,\n\t\t\treviveBuffer,\n\t\t\tprocessLaunchOptions.options.shellIntegration.nonce,\n\t\t\tshouldPersistTerminal ? rawReviveBuffer : undefined,\n\t\t\tthis._logService\n\t\t);\n\t\tif (name) {\n\t\t\tthis.setTitle(name, TitleEventSource.Api);\n\t\t}\n\t\tthis._fixedDimensions = fixedDimensions;\n\t\tthis._orphanQuestionBarrier = null;\n\t\tthis._orphanQuestionReplyTime = 0;\n\t\tthis._disconnectRunner1 = this._register(new ProcessTimeRunOnceScheduler(() => {\n\t\t\tthis._logService.info(`Persistent process \"${this._persistentProcessId}\": The reconnection grace time of ${printTime(reconnectConstants.graceTime)} has expired, shutting down pid \"${this._pid}\"`);\n\t\t\tthis.shutdown(true);\n\t\t}, reconnectConstants.graceTime));\n\t\tthis._disconnectRunner2 = this._register(new ProcessTimeRunOnceScheduler(() => {\n\t\t\tthis._logService.info(`Persistent process \"${this._persistentProcessId}\": The short reconnection grace time of ${printTime(reconnectConstants.shortGraceTime)} has expired, shutting down pid ${this._pid}`);\n\t\t\tthis.shutdown(true);\n\t\t}, reconnectConstants.shortGraceTime));\n\t\tthis._register(this._terminalProcess.onProcessExit(() => this._bufferer.stopBuffering(this._persistentProcessId)));\n\t\tthis._register(this._terminalProcess.onProcessReady(e => {\n\t\t\tthis._pid = e.pid;\n\t\t\tthis._cwd = e.cwd;\n\t\t\tthis._onProcessReady.fire(e);\n\t\t}));\n\t\tthis._register(this._terminalProcess.onDidChangeProperty(e => {\n\t\t\tthis._onDidChangeProperty.fire(e);\n\t\t}));\n\n\t\t// Data buffering to reduce the amount of messages going to the renderer\n\t\tthis._bufferer = new TerminalDataBufferer((_, data) => this._onProcessData.fire(data));\n\t\tthis._register(this._bufferer.startBuffering(this._persistentProcessId, this._terminalProcess.onProcessData));\n\n\t\t// Data recording for reconnect\n\t\tthis._register(this.onProcessData(e => this._serializer.handleData(e)));\n\t}\n\n\tasync attach(): Promise<void> {\n\t\tif (!this._disconnectRunner1.isScheduled() && !this._disconnectRunner2.isScheduled()) {\n\t\t\tthis._logService.warn(`Persistent process \"${this._persistentProcessId}\": Process had no disconnect runners but was an orphan`);\n\t\t}\n\t\tthis._disconnectRunner1.cancel();\n\t\tthis._disconnectRunner2.cancel();\n\t}\n\n\tasync detach(forcePersist?: boolean): Promise<void> {\n\t\t// Keep the process around if it was indicated to persist and it has had some iteraction or\n\t\t// was replayed\n\t\tif (this.shouldPersistTerminal && (this._interactionState.value !== InteractionState.None || forcePersist)) {\n\t\t\tthis._disconnectRunner1.schedule();\n\t\t} else {\n\t\t\tthis.shutdown(true);\n\t\t}\n\t}\n\n\tserializeNormalBuffer(): Promise<IPtyHostProcessReplayEvent> {\n\t\treturn this._serializer.generateReplayEvent(true, this._interactionState.value !== InteractionState.Session);\n\t}\n\n\tasync refreshProperty<T extends ProcessPropertyType>(type: T): Promise<IProcessPropertyMap[T]> {\n\t\treturn this._terminalProcess.refreshProperty(type);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\tif (type === ProcessPropertyType.FixedDimensions) {\n\t\t\treturn this._setFixedDimensions(value as IProcessPropertyMap[ProcessPropertyType.FixedDimensions]);\n\t\t}\n\t}\n\n\tasync start(): Promise<ITerminalLaunchError | ITerminalLaunchResult | undefined> {\n\t\tif (!this._isStarted) {\n\t\t\tconst result = await this._terminalProcess.start();\n\t\t\tif (result && hasKey(result, { message: true })) {\n\t\t\t\t// it's a terminal launch error\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tthis._isStarted = true;\n\n\t\t\t// If the process was revived, trigger a replay on first start. An alternative approach\n\t\t\t// could be to start it on the pty host before attaching but this fails on Windows as\n\t\t\t// conpty's inherit cursor option which is required, ends up sending DSR CPR which\n\t\t\t// causes conhost to hang when no response is received from the terminal (which wouldn't\n\t\t\t// be attached yet). https://github.com/microsoft/terminal/issues/11213\n\t\t\tif (this._wasRevived) {\n\t\t\t\tthis.triggerReplay();\n\t\t\t} else {\n\t\t\t\tthis._onPersistentProcessReady.fire();\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tthis._onProcessReady.fire({ pid: this._pid, cwd: this._cwd, windowsPty: this._terminalProcess.getWindowsPty() });\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.Title, value: this._terminalProcess.currentTitle });\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellType, value: this._terminalProcess.shellType });\n\t\tthis.triggerReplay();\n\t\treturn undefined;\n\t}\n\tshutdown(immediate: boolean): void {\n\t\treturn this._terminalProcess.shutdown(immediate);\n\t}\n\tinput(data: string): void {\n\t\tthis._interactionState.setValue(InteractionState.Session, 'input');\n\t\tthis._serializer.freeRawReviveBuffer();\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._terminalProcess.input(data);\n\t}\n\tsendSignal(signal: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._terminalProcess.sendSignal(signal);\n\t}\n\twriteBinary(data: string): Promise<void> {\n\t\treturn this._terminalProcess.processBinary(data);\n\t}\n\tresize(cols: number, rows: number): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\t\tthis._serializer.handleResize(cols, rows);\n\n\t\t// Buffered events should flush when a resize occurs\n\t\tthis._bufferer.flushBuffer(this._persistentProcessId);\n\n\t\treturn this._terminalProcess.resize(cols, rows);\n\t}\n\tasync clearBuffer(): Promise<void> {\n\t\tthis._serializer.clearBuffer();\n\t\tthis._terminalProcess.clearBuffer();\n\t}\n\tsetUnicodeVersion(version: '6' | '11'): void {\n\t\tthis.unicodeVersion = version;\n\t\tthis._serializer.setUnicodeVersion?.(version);\n\t\t// TODO: Pass in unicode version in ctor\n\t}\n\n\tasync setNextCommandId(commandLine: string, commandId: string): Promise<void> {\n\t\tthis._serializer.setNextCommandId?.(commandLine, commandId);\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\t\treturn this._terminalProcess.acknowledgeDataEvent(charCount);\n\t}\n\tgetInitialCwd(): Promise<string> {\n\t\treturn this._terminalProcess.getInitialCwd();\n\t}\n\tgetCwd(): Promise<string> {\n\t\treturn this._terminalProcess.getCwd();\n\t}\n\n\tasync triggerReplay(): Promise<void> {\n\t\tif (this._interactionState.value === InteractionState.None) {\n\t\t\tthis._interactionState.setValue(InteractionState.ReplayOnly, 'triggerReplay');\n\t\t}\n\t\tconst ev = await this._serializer.generateReplayEvent();\n\t\tlet dataLength = 0;\n\t\tfor (const e of ev.events) {\n\t\t\tdataLength += e.data.length;\n\t\t}\n\t\tthis._logService.info(`Persistent process \"${this._persistentProcessId}\": Replaying ${dataLength} chars and ${ev.events.length} size events`);\n\t\tthis._onProcessReplay.fire(ev);\n\t\tthis._terminalProcess.clearUnacknowledgedChars();\n\t\tthis._onPersistentProcessReady.fire();\n\t}\n\n\tsendCommandResult(reqId: number, isError: boolean, serializedPayload: unknown): void {\n\t\tconst data = this._pendingCommands.get(reqId);\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingCommands.delete(reqId);\n\t}\n\n\torphanQuestionReply(): void {\n\t\tthis._orphanQuestionReplyTime = Date.now();\n\t\tif (this._orphanQuestionBarrier) {\n\t\t\tconst barrier = this._orphanQuestionBarrier;\n\t\t\tthis._orphanQuestionBarrier = null;\n\t\t\tbarrier.open();\n\t\t}\n\t}\n\n\treduceGraceTime(): void {\n\t\tif (this._disconnectRunner2.isScheduled()) {\n\t\t\t// we are disconnected and already running the short reconnection timer\n\t\t\treturn;\n\t\t}\n\t\tif (this._disconnectRunner1.isScheduled()) {\n\t\t\t// we are disconnected and running the long reconnection timer\n\t\t\tthis._disconnectRunner2.schedule();\n\t\t}\n\t}\n\n\tasync isOrphaned(): Promise<boolean> {\n\t\treturn await this._orphanRequestQueue.queue(async () => this._isOrphaned());\n\t}\n\n\tprivate async _isOrphaned(): Promise<boolean> {\n\t\t// The process is already known to be orphaned\n\t\tif (this._disconnectRunner1.isScheduled() || this._disconnectRunner2.isScheduled()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Ask whether the renderer(s) whether the process is orphaned and await the reply\n\t\tif (!this._orphanQuestionBarrier) {\n\t\t\t// the barrier opens after 4 seconds with or without a reply\n\t\t\tthis._orphanQuestionBarrier = new AutoOpenBarrier(4000);\n\t\t\tthis._orphanQuestionReplyTime = 0;\n\t\t\tthis._onProcessOrphanQuestion.fire();\n\t\t}\n\n\t\tawait this._orphanQuestionBarrier.wait();\n\t\treturn (Date.now() - this._orphanQuestionReplyTime > 500);\n\t}\n}\n\nclass MutationLogger<T> {\n\tget value(): T { return this._value; }\n\tsetValue(value: T, reason: string) {\n\t\tif (this._value !== value) {\n\t\t\tthis._value = value;\n\t\t\tthis._log(reason);\n\t\t}\n\t}\n\n\tconstructor(\n\t\tprivate readonly _name: string,\n\t\tprivate _value: T,\n\t\tprivate readonly _logService: ILogService\n\t) {\n\t\tthis._log('initialized');\n\t}\n\n\tprivate _log(reason: string): void {\n\t\tthis._logService.debug(`MutationLogger \"${this._name}\" set to \"${this._value}\", reason: ${reason}`);\n\t}\n}\n\nclass XtermSerializer implements ITerminalSerializer {\n\tprivate readonly _xterm: XtermTerminal;\n\tprivate readonly _shellIntegrationAddon: ShellIntegrationAddon;\n\tprivate _unicodeAddon?: XtermUnicode11Addon;\n\n\tconstructor(\n\t\tcols: number,\n\t\trows: number,\n\t\tscrollback: number,\n\t\tunicodeVersion: '6' | '11',\n\t\treviveBufferWithRestoreMessage: string | undefined,\n\t\tshellIntegrationNonce: string,\n\t\tprivate _rawReviveBuffer: string | undefined,\n\t\tlogService: ILogService\n\t) {\n\t\tthis._xterm = new XtermTerminal({\n\t\t\tcols,\n\t\t\trows,\n\t\t\tscrollback,\n\t\t\tallowProposedApi: true\n\t\t});\n\t\tif (reviveBufferWithRestoreMessage) {\n\t\t\tthis._xterm.writeln(reviveBufferWithRestoreMessage);\n\t\t}\n\t\tthis.setUnicodeVersion(unicodeVersion);\n\t\tthis._shellIntegrationAddon = new ShellIntegrationAddon(shellIntegrationNonce, true, undefined, undefined, logService);\n\t\tthis._xterm.loadAddon(this._shellIntegrationAddon);\n\t}\n\n\tfreeRawReviveBuffer(): void {\n\t\t// Free the memory of the terminal if it will need to be re-serialized\n\t\tthis._rawReviveBuffer = undefined;\n\t}\n\n\thandleData(data: string): void {\n\t\tthis._xterm.write(data);\n\t}\n\n\thandleResize(cols: number, rows: number): void {\n\t\tthis._xterm.resize(cols, rows);\n\t}\n\n\tclearBuffer(): void {\n\t\tthis._xterm.clear();\n\t}\n\n\tsetNextCommandId(commandLine: string, commandId: string): void {\n\t\tthis._shellIntegrationAddon.setNextCommandId(commandLine, commandId);\n\t}\n\n\tasync generateReplayEvent(normalBufferOnly?: boolean, restoreToLastReviveBuffer?: boolean): Promise<IPtyHostProcessReplayEvent> {\n\t\tconst serialize = new (await this._getSerializeConstructor());\n\t\tthis._xterm.loadAddon(serialize);\n\t\tconst options: ISerializeOptions = {\n\t\t\tscrollback: this._xterm.options.scrollback\n\t\t};\n\t\tif (normalBufferOnly) {\n\t\t\toptions.excludeAltBuffer = true;\n\t\t\toptions.excludeModes = true;\n\t\t}\n\t\tlet serialized: string;\n\t\tif (restoreToLastReviveBuffer && this._rawReviveBuffer) {\n\t\t\tserialized = this._rawReviveBuffer;\n\t\t} else {\n\t\t\tserialized = serialize.serialize(options);\n\t\t}\n\t\treturn {\n\t\t\tevents: [\n\t\t\t\t{\n\t\t\t\t\tcols: this._xterm.cols,\n\t\t\t\t\trows: this._xterm.rows,\n\t\t\t\t\tdata: serialized\n\t\t\t\t}\n\t\t\t],\n\t\t\tcommands: this._shellIntegrationAddon.serialize()\n\t\t};\n\t}\n\n\tasync setUnicodeVersion(version: '6' | '11'): Promise<void> {\n\t\tif (this._xterm.unicode.activeVersion === version) {\n\t\t\treturn;\n\t\t}\n\t\tif (version === '11') {\n\t\t\tthis._unicodeAddon = new (await this._getUnicode11Constructor());\n\t\t\tthis._xterm.loadAddon(this._unicodeAddon);\n\t\t} else {\n\t\t\tthis._unicodeAddon?.dispose();\n\t\t\tthis._unicodeAddon = undefined;\n\t\t}\n\t\tthis._xterm.unicode.activeVersion = version;\n\t}\n\n\tasync _getUnicode11Constructor(): Promise<typeof Unicode11Addon> {\n\t\tif (!Unicode11Addon) {\n\t\t\tUnicode11Addon = (await import('@xterm/addon-unicode11')).Unicode11Addon;\n\t\t}\n\t\treturn Unicode11Addon;\n\t}\n\n\tasync _getSerializeConstructor(): Promise<typeof SerializeAddon> {\n\t\tif (!SerializeAddon) {\n\t\t\tSerializeAddon = (await import('@xterm/addon-serialize')).SerializeAddon;\n\t\t}\n\t\treturn SerializeAddon;\n\t}\n}\n\nfunction printTime(ms: number): string {\n\tlet h = 0;\n\tlet m = 0;\n\tlet s = 0;\n\tif (ms >= 1000) {\n\t\ts = Math.floor(ms / 1000);\n\t\tms -= s * 1000;\n\t}\n\tif (s >= 60) {\n\t\tm = Math.floor(s / 60);\n\t\ts -= m * 60;\n\t}\n\tif (m >= 60) {\n\t\th = Math.floor(m / 60);\n\t\tm -= h * 60;\n\t}\n\tconst _h = h ? `${h}h` : ``;\n\tconst _m = m ? `${m}m` : ``;\n\tconst _s = s ? `${s}s` : ``;\n\tconst _ms = ms ? `${ms}ms` : ``;\n\treturn `${_h}${_m}${_s}${_ms}`;\n}\n\ninterface ITerminalSerializer {\n\thandleData(data: string): void;\n\tfreeRawReviveBuffer(): void;\n\thandleResize(cols: number, rows: number): void;\n\tclearBuffer(): void;\n\tgenerateReplayEvent(normalBufferOnly?: boolean, restoreToLastReviveBuffer?: boolean): Promise<IPtyHostProcessReplayEvent>;\n\tsetUnicodeVersion?(version: '6' | '11'): void;\n\tsetNextCommandId?(commandLine: string, commandId: string): void;\n}\n"]}