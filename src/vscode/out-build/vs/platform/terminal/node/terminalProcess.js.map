{"version":3,"sources":["vs/platform/terminal/node/terminalProcess.ts"],"names":[],"mappings":"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","file":"terminalProcess.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport { exec } from 'child_process';\nimport { timeout } from '../../../base/common/async.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as path from '../../../base/common/path.js';\nimport { IProcessEnvironment, isLinux, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { findExecutable } from '../../../base/node/processes.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { ILogService, LogLevel } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { FlowControlConstants, IShellLaunchConfig, ITerminalChildProcess, ITerminalLaunchError, IProcessProperty, IProcessPropertyMap as IProcessPropertyMap, ProcessPropertyType, TerminalShellType, IProcessReadyEvent, ITerminalProcessOptions, PosixShellType, IProcessReadyWindowsPty, GeneralShellType, ITerminalLaunchResult } from '../common/terminal.js';\nimport { ChildProcessMonitor } from './childProcessMonitor.js';\nimport { getShellIntegrationInjection, getWindowsBuildNumber, IShellIntegrationConfigInjection } from './terminalEnvironment.js';\nimport { WindowsShellHelper } from './windowsShellHelper.js';\nimport { IPty, IPtyForkOptions, IWindowsPtyForkOptions, spawn } from 'node-pty';\nimport { chunkInput } from '../common/terminalProcess.js';\nimport { isNumber } from '../../../base/common/types.js';\n\nconst enum ShutdownConstants {\n\t/**\n\t * The amount of ms that must pass between data events after exit is queued before the actual\n\t * kill call is triggered. This data flush mechanism works around an [issue in node-pty][1]\n\t * where not all data is flushed which causes problems for task problem matchers. Additionally\n\t * on Windows under conpty, killing a process while data is being output will cause the [conhost\n\t * flush to hang the pty host][2] because [conhost should be hosted on another thread][3].\n\t *\n\t * [1]: https://github.com/Tyriar/node-pty/issues/72\n\t * [2]: https://github.com/microsoft/vscode/issues/71966\n\t * [3]: https://github.com/microsoft/node-pty/pull/415\n\t */\n\tDataFlushTimeout = 250,\n\t/**\n\t * The maximum ms to allow after dispose is called because forcefully killing the process.\n\t */\n\tMaximumShutdownTime = 5000\n}\n\nconst enum Constants {\n\t/**\n\t * The minimum duration between kill and spawn calls on Windows/conpty as a mitigation for a\n\t * hang issue. See:\n\t * - https://github.com/microsoft/vscode/issues/71966\n\t * - https://github.com/microsoft/vscode/issues/117956\n\t * - https://github.com/microsoft/vscode/issues/121336\n\t */\n\tKillSpawnThrottleInterval = 250,\n\t/**\n\t * The amount of time to wait when a call is throttled beyond the exact amount, this is used to\n\t * try prevent early timeouts causing a kill/spawn call to happen at double the regular\n\t * interval.\n\t */\n\tKillSpawnSpacingDuration = 50,\n\t/**\n\t * How long to wait between chunk writes.\n\t */\n\tWriteInterval = 5,\n}\n\ninterface IWriteObject {\n\tdata: string;\n\tisBinary: boolean;\n}\n\nconst posixShellTypeMap = new Map<string, PosixShellType>([\n\t['bash', PosixShellType.Bash],\n\t['csh', PosixShellType.Csh],\n\t['fish', PosixShellType.Fish],\n\t['ksh', PosixShellType.Ksh],\n\t['sh', PosixShellType.Sh],\n\t['zsh', PosixShellType.Zsh]\n]);\n\nconst generalShellTypeMap = new Map<string, GeneralShellType>([\n\t['pwsh', GeneralShellType.PowerShell],\n\t['powershell', GeneralShellType.PowerShell],\n\t['python', GeneralShellType.Python],\n\t['julia', GeneralShellType.Julia],\n\t['nu', GeneralShellType.NuShell],\n\t['node', GeneralShellType.Node],\n\n]);\nexport class TerminalProcess extends Disposable implements ITerminalChildProcess {\n\treadonly id = 0;\n\treadonly shouldPersist = false;\n\n\tprivate _properties: IProcessPropertyMap = {\n\t\tcwd: '',\n\t\tinitialCwd: '',\n\t\tfixedDimensions: { cols: undefined, rows: undefined },\n\t\ttitle: '',\n\t\tshellType: undefined,\n\t\thasChildProcesses: true,\n\t\tresolvedShellLaunchConfig: {},\n\t\toverrideDimensions: undefined,\n\t\tfailedShellIntegrationActivation: false,\n\t\tusedShellIntegrationInjection: undefined,\n\t\tshellIntegrationInjectionFailureReason: undefined,\n\t};\n\tprivate static _lastKillOrStart = 0;\n\tprivate _exitCode: number | undefined;\n\tprivate _exitMessage: string | undefined;\n\tprivate _closeTimeout: Timeout | undefined;\n\tprivate _ptyProcess: IPty | undefined;\n\tprivate _currentTitle: string = '';\n\tprivate _processStartupComplete: Promise<void> | undefined;\n\tprivate _windowsShellHelper: WindowsShellHelper | undefined;\n\tprivate _childProcessMonitor: ChildProcessMonitor | undefined;\n\tprivate _titleInterval: Timeout | undefined;\n\tprivate _writeQueue: IWriteObject[] = [];\n\tprivate _writeTimeout: Timeout | undefined;\n\tprivate _delayedResizer: DelayedResizer | undefined;\n\tprivate readonly _initialCwd: string;\n\tprivate readonly _ptyOptions: IPtyForkOptions | IWindowsPtyForkOptions;\n\n\tprivate _isPtyPaused: boolean = false;\n\tprivate _unacknowledgedCharCount: number = 0;\n\tget exitMessage(): string | undefined { return this._exitMessage; }\n\n\tget currentTitle(): string { return this._windowsShellHelper?.shellTitle || this._currentTitle; }\n\tget shellType(): TerminalShellType | undefined { return isWindows ? this._windowsShellHelper?.shellType : posixShellTypeMap.get(this._currentTitle) || generalShellTypeMap.get(this._currentTitle); }\n\tget hasChildProcesses(): boolean { return this._childProcessMonitor?.hasChildProcesses || false; }\n\n\tprivate readonly _onProcessData = this._register(new Emitter<string>());\n\treadonly onProcessData = this._onProcessData.event;\n\tprivate readonly _onProcessReady = this._register(new Emitter<IProcessReadyEvent>());\n\treadonly onProcessReady = this._onProcessReady.event;\n\tprivate readonly _onDidChangeProperty = this._register(new Emitter<IProcessProperty>());\n\treadonly onDidChangeProperty = this._onDidChangeProperty.event;\n\tprivate readonly _onProcessExit = this._register(new Emitter<number>());\n\treadonly onProcessExit = this._onProcessExit.event;\n\n\tconstructor(\n\t\treadonly shellLaunchConfig: IShellLaunchConfig,\n\t\tcwd: string,\n\t\tcols: number,\n\t\trows: number,\n\t\tenv: IProcessEnvironment,\n\t\t/**\n\t\t * environment used for `findExecutable`\n\t\t */\n\t\tprivate readonly _executableEnv: IProcessEnvironment,\n\t\tprivate readonly _options: ITerminalProcessOptions,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IProductService private readonly _productService: IProductService\n\t) {\n\t\tsuper();\n\t\tlet name: string;\n\t\tif (isWindows) {\n\t\t\tname = path.basename(this.shellLaunchConfig.executable || '');\n\t\t} else {\n\t\t\t// Using 'xterm-256color' here helps ensure that the majority of Linux distributions will use a\n\t\t\t// color prompt as defined in the default ~/.bashrc file.\n\t\t\tname = 'xterm-256color';\n\t\t}\n\t\tthis._initialCwd = cwd;\n\t\tthis._properties[ProcessPropertyType.InitialCwd] = this._initialCwd;\n\t\tthis._properties[ProcessPropertyType.Cwd] = this._initialCwd;\n\t\tconst useConpty = this._options.windowsEnableConpty && process.platform === 'win32' && getWindowsBuildNumber() >= 18309;\n\t\tconst useConptyDll = useConpty && this._options.windowsUseConptyDll;\n\t\tthis._ptyOptions = {\n\t\t\tname,\n\t\t\tcwd,\n\t\t\t// TODO: When node-pty is updated this cast can be removed\n\t\t\tenv: env as { [key: string]: string },\n\t\t\tcols,\n\t\t\trows,\n\t\t\tuseConpty,\n\t\t\tuseConptyDll,\n\t\t\t// This option will force conpty to not redraw the whole viewport on launch\n\t\t\tconptyInheritCursor: useConpty && !!shellLaunchConfig.initialText\n\t\t};\n\t\t// Delay resizes to avoid conpty not respecting very early resize calls\n\t\tif (isWindows) {\n\t\t\tif (useConpty && cols === 0 && rows === 0 && this.shellLaunchConfig.executable?.endsWith('Git\\\\bin\\\\bash.exe')) {\n\t\t\t\tthis._delayedResizer = new DelayedResizer();\n\t\t\t\tthis._register(this._delayedResizer.onTrigger(dimensions => {\n\t\t\t\t\tthis._delayedResizer?.dispose();\n\t\t\t\t\tthis._delayedResizer = undefined;\n\t\t\t\t\tif (dimensions.cols && dimensions.rows) {\n\t\t\t\t\t\tthis.resize(dimensions.cols, dimensions.rows);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t\t// WindowsShellHelper is used to fetch the process title and shell type\n\t\t\tthis.onProcessReady(e => {\n\t\t\t\tthis._windowsShellHelper = this._register(new WindowsShellHelper(e.pid));\n\t\t\t\tthis._register(this._windowsShellHelper.onShellTypeChanged(e => this._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellType, value: e })));\n\t\t\t\tthis._register(this._windowsShellHelper.onShellNameChanged(e => this._onDidChangeProperty.fire({ type: ProcessPropertyType.Title, value: e })));\n\t\t\t});\n\t\t}\n\t\tthis._register(toDisposable(() => {\n\t\t\tif (this._titleInterval) {\n\t\t\t\tclearInterval(this._titleInterval);\n\t\t\t\tthis._titleInterval = undefined;\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync start(): Promise<ITerminalLaunchError | ITerminalLaunchResult | undefined> {\n\t\tconst results = await Promise.all([this._validateCwd(), this._validateExecutable()]);\n\t\tconst firstError = results.find(r => r !== undefined);\n\t\tif (firstError) {\n\t\t\treturn firstError;\n\t\t}\n\n\t\tconst injection = await getShellIntegrationInjection(this.shellLaunchConfig, this._options, this._ptyOptions.env, this._logService, this._productService);\n\t\tif (injection.type === 'injection') {\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.UsedShellIntegrationInjection, value: true });\n\t\t\tif (injection.envMixin) {\n\t\t\t\tfor (const [key, value] of Object.entries(injection.envMixin)) {\n\t\t\t\t\tthis._ptyOptions.env ||= {};\n\t\t\t\t\tthis._ptyOptions.env[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (injection.filesToCopy) {\n\t\t\t\tfor (const f of injection.filesToCopy) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait fs.promises.mkdir(path.dirname(f.dest), { recursive: true });\n\t\t\t\t\t\tawait fs.promises.copyFile(f.source, f.dest);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// Swallow error, this should only happen when multiple users are on the same\n\t\t\t\t\t\t// machine. Since the shell integration scripts rarely change, plus the other user\n\t\t\t\t\t\t// should be using the same version of the server in this case, assume the script is\n\t\t\t\t\t\t// fine if copy fails and swallow the error.\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.FailedShellIntegrationActivation, value: true });\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellIntegrationInjectionFailureReason, value: injection.reason });\n\t\t\t// Even if shell integration injection failed, still set the nonce if one was provided\n\t\t\t// This allows extensions to use shell integration with custom shells\n\t\t\tif (this._options.shellIntegration.nonce) {\n\t\t\t\tthis._ptyOptions.env ||= {};\n\t\t\t\tthis._ptyOptions.env['VSCODE_NONCE'] = this._options.shellIntegration.nonce;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tconst injectionConfig: IShellIntegrationConfigInjection | undefined = injection.type === 'injection' ? injection : undefined;\n\t\t\tawait this.setupPtyProcess(this.shellLaunchConfig, this._ptyOptions, injectionConfig);\n\t\t\tif (injectionConfig?.newArgs) {\n\t\t\t\treturn { injectedArgs: injectionConfig.newArgs };\n\t\t\t}\n\t\t\treturn undefined;\n\t\t} catch (err) {\n\t\t\tthis._logService.trace('node-pty.node-pty.IPty#spawn native exception', err);\n\t\t\treturn { message: `A native exception occurred during launch (${err.message})` };\n\t\t}\n\t}\n\n\tprivate async _validateCwd(): Promise<undefined | ITerminalLaunchError> {\n\t\ttry {\n\t\t\tconst result = await fs.promises.stat(this._initialCwd);\n\t\t\tif (!result.isDirectory()) {\n\t\t\t\treturn { message: localize('launchFail.cwdNotDirectory', \"Starting directory (cwd) \\\"{0}\\\" is not a directory\", this._initialCwd.toString()) };\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tif (err?.code === 'ENOENT') {\n\t\t\t\treturn { message: localize('launchFail.cwdDoesNotExist', \"Starting directory (cwd) \\\"{0}\\\" does not exist\", this._initialCwd.toString()) };\n\t\t\t}\n\t\t}\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.InitialCwd, value: this._initialCwd });\n\t\treturn undefined;\n\t}\n\n\tprivate async _validateExecutable(): Promise<undefined | ITerminalLaunchError> {\n\t\tconst slc = this.shellLaunchConfig;\n\t\tif (!slc.executable) {\n\t\t\tthrow new Error('IShellLaunchConfig.executable not set');\n\t\t}\n\n\t\tconst cwd = slc.cwd instanceof URI ? slc.cwd.path : slc.cwd;\n\t\tconst envPaths: string[] | undefined = (slc.env && slc.env.PATH) ? slc.env.PATH.split(path.delimiter) : undefined;\n\t\tconst executable = await findExecutable(slc.executable, cwd, envPaths, this._executableEnv);\n\t\tif (!executable) {\n\t\t\treturn { message: localize('launchFail.executableDoesNotExist', \"Path to shell executable \\\"{0}\\\" does not exist\", slc.executable) };\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await fs.promises.stat(executable);\n\t\t\tif (!result.isFile() && !result.isSymbolicLink()) {\n\t\t\t\treturn { message: localize('launchFail.executableIsNotFileOrSymlink', \"Path to shell executable \\\"{0}\\\" is not a file or a symlink\", slc.executable) };\n\t\t\t}\n\t\t\t// Set the executable explicitly here so that node-pty doesn't need to search the\n\t\t\t// $PATH too.\n\t\t\tslc.executable = executable;\n\t\t} catch (err) {\n\t\t\tif (err?.code === 'EACCES') {\n\t\t\t\t// Swallow\n\t\t\t} else {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async setupPtyProcess(\n\t\tshellLaunchConfig: IShellLaunchConfig,\n\t\toptions: IPtyForkOptions,\n\t\tshellIntegrationInjection: IShellIntegrationConfigInjection | undefined\n\t): Promise<void> {\n\t\tconst args = shellIntegrationInjection?.newArgs || shellLaunchConfig.args || [];\n\t\tawait this._throttleKillSpawn();\n\t\tthis._logService.trace('node-pty.IPty#spawn', shellLaunchConfig.executable, args, options);\n\t\tconst ptyProcess = spawn(shellLaunchConfig.executable!, args, options);\n\t\tthis._ptyProcess = ptyProcess;\n\t\tthis._childProcessMonitor = this._register(new ChildProcessMonitor(ptyProcess.pid, this._logService));\n\t\tthis._register(this._childProcessMonitor.onDidChangeHasChildProcesses(value => this._onDidChangeProperty.fire({ type: ProcessPropertyType.HasChildProcesses, value })));\n\t\tthis._processStartupComplete = new Promise<void>(c => {\n\t\t\tthis._register(this.onProcessReady(() => c()));\n\t\t});\n\t\tthis._register(ptyProcess.onData(data => {\n\t\t\t// Handle flow control\n\t\t\tthis._unacknowledgedCharCount += data.length;\n\t\t\tif (!this._isPtyPaused && this._unacknowledgedCharCount > FlowControlConstants.HighWatermarkChars) {\n\t\t\t\tthis._logService.trace(`Flow control: Pause (${this._unacknowledgedCharCount} > ${FlowControlConstants.HighWatermarkChars})`);\n\t\t\t\tthis._isPtyPaused = true;\n\t\t\t\tptyProcess.pause();\n\t\t\t}\n\n\t\t\t// Refire the data event\n\t\t\tthis._logService.trace('node-pty.IPty#onData', data);\n\t\t\tthis._onProcessData.fire(data);\n\t\t\tif (this._closeTimeout) {\n\t\t\t\tthis._queueProcessExit();\n\t\t\t}\n\t\t\tthis._windowsShellHelper?.checkShell();\n\t\t\tthis._childProcessMonitor?.handleOutput();\n\t\t}));\n\t\tthis._register(ptyProcess.onExit(e => {\n\t\t\tthis._exitCode = e.exitCode;\n\t\t\tthis._queueProcessExit();\n\t\t}));\n\t\tthis._sendProcessId(ptyProcess.pid);\n\t\tthis._setupTitlePolling(ptyProcess);\n\t}\n\n\tprivate _setupTitlePolling(ptyProcess: IPty) {\n\t\t// Send initial timeout async to give event listeners a chance to init\n\t\tsetTimeout(() => this._sendProcessTitle(ptyProcess));\n\t\t// Setup polling for non-Windows, for Windows `process` doesn't change\n\t\tif (!isWindows) {\n\t\t\tthis._titleInterval = setInterval(() => {\n\t\t\t\tif (this._currentTitle !== ptyProcess.process) {\n\t\t\t\t\tthis._sendProcessTitle(ptyProcess);\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\t// Allow any trailing data events to be sent before the exit event is sent.\n\t// See https://github.com/Tyriar/node-pty/issues/72\n\tprivate _queueProcessExit() {\n\t\tif (this._logService.getLevel() === LogLevel.Trace) {\n\t\t\tthis._logService.trace('TerminalProcess#_queueProcessExit', new Error().stack?.replace(/^Error/, ''));\n\t\t}\n\t\tif (this._closeTimeout) {\n\t\t\tclearTimeout(this._closeTimeout);\n\t\t}\n\t\tthis._closeTimeout = setTimeout(() => {\n\t\t\tthis._closeTimeout = undefined;\n\t\t\tthis._kill();\n\t\t}, ShutdownConstants.DataFlushTimeout);\n\t}\n\n\tprivate async _kill(): Promise<void> {\n\t\t// Wait to kill to process until the start up code has run. This prevents us from firing a process exit before a\n\t\t// process start.\n\t\tawait this._processStartupComplete;\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\t// Attempt to kill the pty, it may have already been killed at this\n\t\t// point but we want to make sure\n\t\ttry {\n\t\t\tif (this._ptyProcess) {\n\t\t\t\tawait this._throttleKillSpawn();\n\t\t\t\tthis._logService.trace('node-pty.IPty#kill');\n\t\t\t\tthis._ptyProcess.kill();\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\t// Swallow, the pty has already been killed\n\t\t}\n\t\tthis._onProcessExit.fire(this._exitCode || 0);\n\t\tthis.dispose();\n\t}\n\n\tprivate async _throttleKillSpawn(): Promise<void> {\n\t\t// Only throttle on Windows/conpty\n\t\tif (!isWindows || !hasConptyOption(this._ptyOptions) || !this._ptyOptions.useConpty) {\n\t\t\treturn;\n\t\t}\n\t\t// Don't throttle when using conpty.dll as it seems to have been fixed in later versions\n\t\tif (this._ptyOptions.useConptyDll) {\n\t\t\treturn;\n\t\t}\n\t\t// Use a loop to ensure multiple calls in a single interval space out\n\t\twhile (Date.now() - TerminalProcess._lastKillOrStart < Constants.KillSpawnThrottleInterval) {\n\t\t\tthis._logService.trace('Throttling kill/spawn call');\n\t\t\tawait timeout(Constants.KillSpawnThrottleInterval - (Date.now() - TerminalProcess._lastKillOrStart) + Constants.KillSpawnSpacingDuration);\n\t\t}\n\t\tTerminalProcess._lastKillOrStart = Date.now();\n\t}\n\n\tprivate _sendProcessId(pid: number) {\n\t\tthis._onProcessReady.fire({\n\t\t\tpid,\n\t\t\tcwd: this._initialCwd,\n\t\t\twindowsPty: this.getWindowsPty()\n\t\t});\n\t}\n\n\tprivate _sendProcessTitle(ptyProcess: IPty): void {\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\t// HACK: The node-pty API can return undefined somehow https://github.com/microsoft/vscode/issues/222323\n\t\tthis._currentTitle = (ptyProcess.process ?? '');\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.Title, value: this._currentTitle });\n\t\t// If fig is installed it may change the title of the process\n\t\tlet sanitizedTitle = this.currentTitle.replace(/ \\(figterm\\)$/g, '');\n\t\t// Ensure any prefixed path is removed so that the executable name since we use this to\n\t\t// detect the shell type\n\t\tif (!isWindows) {\n\t\t\tsanitizedTitle = path.basename(sanitizedTitle);\n\t\t}\n\n\t\tif (sanitizedTitle.toLowerCase().startsWith('python')) {\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellType, value: GeneralShellType.Python });\n\t\t} else if (sanitizedTitle.toLowerCase().startsWith('julia')) {\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellType, value: GeneralShellType.Julia });\n\t\t} else {\n\t\t\tconst shellTypeValue = posixShellTypeMap.get(sanitizedTitle) || generalShellTypeMap.get(sanitizedTitle);\n\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.ShellType, value: shellTypeValue });\n\t\t}\n\t}\n\n\tshutdown(immediate: boolean): void {\n\t\tif (this._logService.getLevel() === LogLevel.Trace) {\n\t\t\tthis._logService.trace('TerminalProcess#shutdown', new Error().stack?.replace(/^Error/, ''));\n\t\t}\n\t\t// don't force immediate disposal of the terminal processes on Windows as an additional\n\t\t// mitigation for https://github.com/microsoft/vscode/issues/71966 which causes the pty host\n\t\t// to become unresponsive, disconnecting all terminals across all windows.\n\t\tif (immediate && !isWindows) {\n\t\t\tthis._kill();\n\t\t} else {\n\t\t\tif (!this._closeTimeout && !this._store.isDisposed) {\n\t\t\t\tthis._queueProcessExit();\n\t\t\t\t// Allow a maximum amount of time for the process to exit, otherwise force kill it\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (this._closeTimeout && !this._store.isDisposed) {\n\t\t\t\t\t\tthis._closeTimeout = undefined;\n\t\t\t\t\t\tthis._kill();\n\t\t\t\t\t}\n\t\t\t\t}, ShutdownConstants.MaximumShutdownTime);\n\t\t\t}\n\t\t}\n\t}\n\n\tinput(data: string, isBinary: boolean = false): void {\n\t\tif (this._store.isDisposed || !this._ptyProcess) {\n\t\t\treturn;\n\t\t}\n\t\tthis._writeQueue.push(...chunkInput(data).map(e => {\n\t\t\treturn { isBinary, data: e };\n\t\t}));\n\t\tthis._startWrite();\n\t}\n\n\tsendSignal(signal: string): void {\n\t\tif (this._store.isDisposed || !this._ptyProcess) {\n\t\t\treturn;\n\t\t}\n\t\tthis._ptyProcess.kill(signal);\n\t}\n\n\tasync processBinary(data: string): Promise<void> {\n\t\tthis.input(data, true);\n\t}\n\n\tasync refreshProperty<T extends ProcessPropertyType>(type: T): Promise<IProcessPropertyMap[T]> {\n\t\tswitch (type) {\n\t\t\tcase ProcessPropertyType.Cwd: {\n\t\t\t\tconst newCwd = await this.getCwd();\n\t\t\t\tif (newCwd !== this._properties.cwd) {\n\t\t\t\t\tthis._properties.cwd = newCwd;\n\t\t\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.Cwd, value: this._properties.cwd });\n\t\t\t\t}\n\t\t\t\treturn newCwd as IProcessPropertyMap[T];\n\t\t\t}\n\t\t\tcase ProcessPropertyType.InitialCwd: {\n\t\t\t\tconst initialCwd = await this.getInitialCwd();\n\t\t\t\tif (initialCwd !== this._properties.initialCwd) {\n\t\t\t\t\tthis._properties.initialCwd = initialCwd;\n\t\t\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.InitialCwd, value: this._properties.initialCwd });\n\t\t\t\t}\n\t\t\t\treturn initialCwd as IProcessPropertyMap[T];\n\t\t\t}\n\t\t\tcase ProcessPropertyType.Title:\n\t\t\t\treturn this.currentTitle as IProcessPropertyMap[T];\n\t\t\tdefault:\n\t\t\t\treturn this.shellType as IProcessPropertyMap[T];\n\t\t}\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\tif (type === ProcessPropertyType.FixedDimensions) {\n\t\t\tthis._properties.fixedDimensions = value as IProcessPropertyMap[ProcessPropertyType.FixedDimensions];\n\t\t}\n\t}\n\n\tprivate _startWrite(): void {\n\t\t// Don't write if it's already queued of is there is nothing to write\n\t\tif (this._writeTimeout !== undefined || this._writeQueue.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._doWrite();\n\n\t\t// Don't queue more writes if the queue is empty\n\t\tif (this._writeQueue.length === 0) {\n\t\t\tthis._writeTimeout = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\t// Queue the next write\n\t\tthis._writeTimeout = setTimeout(() => {\n\t\t\tthis._writeTimeout = undefined;\n\t\t\tthis._startWrite();\n\t\t}, Constants.WriteInterval);\n\t}\n\n\tprivate _doWrite(): void {\n\t\tconst object = this._writeQueue.shift()!;\n\t\tthis._logService.trace('node-pty.IPty#write', object.data);\n\t\tif (object.isBinary) {\n\t\t\t// TODO: node-pty's write should accept a Buffer, needs https://github.com/microsoft/node-pty/pull/812\n\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\tthis._ptyProcess!.write(Buffer.from(object.data, 'binary') as any);\n\t\t} else {\n\t\t\tthis._ptyProcess!.write(object.data);\n\t\t}\n\t\tthis._childProcessMonitor?.handleInput();\n\t}\n\n\tresize(cols: number, rows: number): void {\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isNumber(cols) || !isNumber(rows)) {\n\t\t\treturn;\n\t\t}\n\t\t// Ensure that cols and rows are always >= 1, this prevents a native\n\t\t// exception in winpty.\n\t\tif (this._ptyProcess) {\n\t\t\tcols = Math.max(cols, 1);\n\t\t\trows = Math.max(rows, 1);\n\n\t\t\t// Delay resize if needed\n\t\t\tif (this._delayedResizer) {\n\t\t\t\tthis._delayedResizer.cols = cols;\n\t\t\t\tthis._delayedResizer.rows = rows;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._logService.trace('node-pty.IPty#resize', cols, rows);\n\t\t\ttry {\n\t\t\t\tthis._ptyProcess.resize(cols, rows);\n\t\t\t} catch (e) {\n\t\t\t\t// Swallow error if the pty has already exited\n\t\t\t\tthis._logService.trace('node-pty.IPty#resize exception ' + e.message);\n\t\t\t\tif (this._exitCode !== undefined &&\n\t\t\t\t\te.message !== 'ioctl(2) failed, EBADF' &&\n\t\t\t\t\te.message !== 'Cannot resize a pty that has already exited') {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclearBuffer(): void {\n\t\tthis._ptyProcess?.clear();\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\t// Prevent lower than 0 to heal from errors\n\t\tthis._unacknowledgedCharCount = Math.max(this._unacknowledgedCharCount - charCount, 0);\n\t\tthis._logService.trace(`Flow control: Ack ${charCount} chars (unacknowledged: ${this._unacknowledgedCharCount})`);\n\t\tif (this._isPtyPaused && this._unacknowledgedCharCount < FlowControlConstants.LowWatermarkChars) {\n\t\t\tthis._logService.trace(`Flow control: Resume (${this._unacknowledgedCharCount} < ${FlowControlConstants.LowWatermarkChars})`);\n\t\t\tthis._ptyProcess?.resume();\n\t\t\tthis._isPtyPaused = false;\n\t\t}\n\t}\n\n\tclearUnacknowledgedChars(): void {\n\t\tthis._unacknowledgedCharCount = 0;\n\t\tthis._logService.trace(`Flow control: Cleared all unacknowledged chars, forcing resume`);\n\t\tif (this._isPtyPaused) {\n\t\t\tthis._ptyProcess?.resume();\n\t\t\tthis._isPtyPaused = false;\n\t\t}\n\t}\n\n\tasync setUnicodeVersion(version: '6' | '11'): Promise<void> {\n\t\t// No-op\n\t}\n\n\tgetInitialCwd(): Promise<string> {\n\t\treturn Promise.resolve(this._initialCwd);\n\t}\n\n\tasync getCwd(): Promise<string> {\n\t\tif (isMacintosh) {\n\t\t\t// From Big Sur (darwin v20) there is a spawn blocking thread issue on Electron,\n\t\t\t// this is fixed in VS Code's internal Electron.\n\t\t\t// https://github.com/Microsoft/vscode/issues/105446\n\t\t\treturn new Promise<string>(resolve => {\n\t\t\t\tif (!this._ptyProcess) {\n\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._logService.trace('node-pty.IPty#pid');\n\t\t\t\texec('lsof -OPln -p ' + this._ptyProcess.pid + ' | grep cwd', { env: { ...process.env, LANG: 'en_US.UTF-8' } }, (error, stdout, stderr) => {\n\t\t\t\t\tif (!error && stdout !== '') {\n\t\t\t\t\t\tresolve(stdout.substring(stdout.indexOf('/'), stdout.length - 1));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._logService.error('lsof did not run successfully, it may not be on the $PATH?', error, stdout, stderr);\n\t\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (isLinux) {\n\t\t\tif (!this._ptyProcess) {\n\t\t\t\treturn this._initialCwd;\n\t\t\t}\n\t\t\tthis._logService.trace('node-pty.IPty#pid');\n\t\t\ttry {\n\t\t\t\treturn await fs.promises.readlink(`/proc/${this._ptyProcess.pid}/cwd`);\n\t\t\t} catch (error) {\n\t\t\t\treturn this._initialCwd;\n\t\t\t}\n\t\t}\n\n\t\treturn this._initialCwd;\n\t}\n\n\tgetWindowsPty(): IProcessReadyWindowsPty | undefined {\n\t\treturn isWindows ? {\n\t\t\tbackend: hasConptyOption(this._ptyOptions) && this._ptyOptions.useConpty ? 'conpty' : 'winpty',\n\t\t\tbuildNumber: getWindowsBuildNumber()\n\t\t} : undefined;\n\t}\n}\n\n/**\n * Tracks the latest resize event to be trigger at a later point.\n */\nclass DelayedResizer extends Disposable {\n\trows: number | undefined;\n\tcols: number | undefined;\n\tprivate _timeout: Timeout;\n\n\tprivate readonly _onTrigger = this._register(new Emitter<{ rows?: number; cols?: number }>());\n\tget onTrigger(): Event<{ rows?: number; cols?: number }> { return this._onTrigger.event; }\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._timeout = setTimeout(() => {\n\t\t\tthis._onTrigger.fire({ rows: this.rows, cols: this.cols });\n\t\t}, 1000);\n\t\tthis._register(toDisposable(() => clearTimeout(this._timeout)));\n\t}\n}\n\nfunction hasConptyOption(obj: IPtyForkOptions | IWindowsPtyForkOptions): obj is IWindowsPtyForkOptions {\n\treturn 'useConpty' in obj;\n}\n"]}