{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/terminal/node/terminalEnvironment.ts","vs/platform/terminal/node/terminalEnvironment.ts"],"names":[],"mappings":"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","file":"terminalEnvironment.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport { FileAccess } from '../../../base/common/network.js';\nimport * as path from '../../../base/common/path.js';\nimport { IProcessEnvironment, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport * as process from '../../../base/common/process.js';\nimport { format } from '../../../base/common/strings.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IShellLaunchConfig, ITerminalEnvironment, ITerminalProcessOptions, ShellIntegrationInjectionFailureReason } from '../common/terminal.js';\nimport { EnvironmentVariableMutatorType } from '../common/environmentVariable.js';\nimport { deserializeEnvironmentVariableCollections } from '../common/environmentVariableShared.js';\nimport { MergedEnvironmentVariableCollection } from '../common/environmentVariableCollection.js';\nimport { chmod, realpathSync, mkdirSync } from 'fs';\nimport { promisify } from 'util';\nimport { isString, SingleOrMany } from '../../../base/common/types.js';\n\nexport function getWindowsBuildNumber(): number {\n\tconst osVersion = (/(\\d+)\\.(\\d+)\\.(\\d+)/g).exec(os.release());\n\tlet buildNumber: number = 0;\n\tif (osVersion && osVersion.length === 4) {\n\t\tbuildNumber = parseInt(osVersion[3]);\n\t}\n\treturn buildNumber;\n}\n\nexport interface IShellIntegrationConfigInjection {\n\treadonly type: 'injection';\n\t/**\n\t * A new set of arguments to use.\n\t */\n\treadonly newArgs: string[] | undefined;\n\t/**\n\t * An optional environment to mixing to the real environment.\n\t */\n\treadonly envMixin?: IProcessEnvironment;\n\t/**\n\t * An optional array of files to copy from `source` to `dest`.\n\t */\n\treadonly filesToCopy?: {\n\t\tsource: string;\n\t\tdest: string;\n\t}[];\n}\n\nexport interface IShellIntegrationInjectionFailure {\n\treadonly type: 'failure';\n\treadonly reason: ShellIntegrationInjectionFailureReason;\n}\n\n/**\n * For a given shell launch config, returns arguments to replace and an optional environment to\n * mixin to the SLC's environment to enable shell integration. This must be run within the context\n * that creates the process to ensure accuracy. Returns undefined if shell integration cannot be\n * enabled.\n */\nexport async function getShellIntegrationInjection(\n\tshellLaunchConfig: IShellLaunchConfig,\n\toptions: ITerminalProcessOptions,\n\tenv: ITerminalEnvironment | undefined,\n\tlogService: ILogService,\n\tproductService: IProductService,\n\tskipStickyBit: boolean = false\n): Promise<IShellIntegrationConfigInjection | IShellIntegrationInjectionFailure> {\n\t// The global setting is disabled\n\tif (!options.shellIntegration.enabled) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.InjectionSettingDisabled };\n\t}\n\t// There is no executable (so there's no way to determine how to inject)\n\tif (!shellLaunchConfig.executable) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.NoExecutable };\n\t}\n\t// It's a feature terminal (tasks, debug), unless it's explicitly being forced\n\tif (shellLaunchConfig.isFeatureTerminal && !shellLaunchConfig.forceShellIntegration) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FeatureTerminal };\n\t}\n\t// The ignoreShellIntegration flag is passed (eg. relaunching without shell integration)\n\tif (shellLaunchConfig.ignoreShellIntegration) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.IgnoreShellIntegrationFlag };\n\t}\n\t// Shell integration doesn't work with winpty\n\tif (isWindows && (!options.windowsEnableConpty || getWindowsBuildNumber() < 18309)) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.Winpty };\n\t}\n\n\tconst originalArgs = shellLaunchConfig.args;\n\tconst shell = process.platform === 'win32' ? path.basename(shellLaunchConfig.executable).toLowerCase() : path.basename(shellLaunchConfig.executable);\n\tconst appRoot = path.dirname(FileAccess.asFileUri('').fsPath);\n\tconst type = 'injection';\n\tlet newArgs: string[] | undefined;\n\tconst envMixin: IProcessEnvironment = {\n\t\t'VSCODE_INJECTION': '1'\n\t};\n\n\tif (options.shellIntegration.nonce) {\n\t\tenvMixin['VSCODE_NONCE'] = options.shellIntegration.nonce;\n\t}\n\t// Temporarily pass list of hardcoded env vars for shell env api\n\tconst scopedDownShellEnvs = ['PATH', 'VIRTUAL_ENV', 'HOME', 'SHELL', 'PWD'];\n\tif (shellLaunchConfig.shellIntegrationEnvironmentReporting) {\n\t\tif (isWindows) {\n\t\t\tconst enableWindowsEnvReporting = options.windowsUseConptyDll || options.windowsEnableConpty && getWindowsBuildNumber() >= 22631 && shell !== 'bash.exe';\n\t\t\tif (enableWindowsEnvReporting) {\n\t\t\t\tenvMixin['VSCODE_SHELL_ENV_REPORTING'] = scopedDownShellEnvs.join(',');\n\t\t\t}\n\t\t} else {\n\t\t\tenvMixin['VSCODE_SHELL_ENV_REPORTING'] = scopedDownShellEnvs.join(',');\n\t\t}\n\t}\n\n\t// Windows\n\tif (isWindows) {\n\t\tif (shell === 'pwsh.exe' || shell === 'powershell.exe') {\n\t\t\tenvMixin['VSCODE_A11Y_MODE'] = options.isScreenReaderOptimized ? '1' : '0';\n\n\t\t\tif (!originalArgs || arePwshImpliedArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.WindowsPwsh);\n\t\t\t} else if (arePwshLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.WindowsPwshLogin);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot, '');\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t} else if (shell === 'bash.exe') {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tenvMixin['VSCODE_SHELL_LOGIN'] = '1';\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tlogService.warn(`Shell integration cannot be enabled for executable \"${shellLaunchConfig.executable}\" and args`, shellLaunchConfig.args);\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedShell };\n\t}\n\n\t// Linux & macOS\n\tswitch (shell) {\n\t\tcase 'bash': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tenvMixin['VSCODE_SHELL_LOGIN'] = '1';\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'fish': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Fish);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.FishLogin);\n\t\t\t} else if (originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.Fish) || originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.FishLogin)) {\n\t\t\t\tnewArgs = originalArgs;\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\n\t\t\t// On fish, '$fish_user_paths' is always prepended to the PATH, for both login and non-login shells, so we need\n\t\t\t// to apply the path prefix fix always, not only for login shells (see #232291)\n\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'pwsh': {\n\t\t\tif (!originalArgs || arePwshImpliedArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Pwsh);\n\t\t\t} else if (arePwshLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.PwshLogin);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot, '');\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'zsh': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Zsh);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.ZshLogin);\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t} else if (originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.Zsh) || originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.ZshLogin)) {\n\t\t\t\tnewArgs = originalArgs;\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\n\t\t\t// Move .zshrc into $ZDOTDIR as the way to activate the script\n\t\t\tlet username: string;\n\t\t\ttry {\n\t\t\t\tusername = os.userInfo().username;\n\t\t\t} catch {\n\t\t\t\tusername = 'unknown';\n\t\t\t}\n\n\t\t\t// Resolve the actual tmp directory so we can set the sticky bit\n\t\t\tconst realTmpDir = realpathSync(os.tmpdir());\n\t\t\tconst zdotdir = path.join(realTmpDir, `${username}-${productService.applicationName}-zsh`);\n\n\t\t\t// Set directory permissions using octal notation:\n\t\t\t// - 0o1700:\n\t\t\t// - Sticky bit is set, preventing non-owners from deleting or renaming files within this directory (1)\n\t\t\t// - Owner has full read (4), write (2), execute (1) permissions\n\t\t\t// - Group has no permissions (0)\n\t\t\t// - Others have no permissions (0)\n\t\t\tif (!skipStickyBit) {\n\t\t\t\t// skip for tests\n\t\t\t\ttry {\n\t\t\t\t\tconst chmodAsync = promisify(chmod);\n\t\t\t\t\tawait chmodAsync(zdotdir, 0o1700);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err.message.includes('ENOENT')) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tmkdirSync(zdotdir);\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tlogService.error(`Failed to create zdotdir at ${zdotdir}: ${err}`);\n\t\t\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToCreateTmpDir };\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst chmodAsync = promisify(chmod);\n\t\t\t\t\t\t\tawait chmodAsync(zdotdir, 0o1700);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tlogService.error(`Failed to set sticky bit on ${zdotdir}: ${err}`);\n\t\t\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToSetStickyBit };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlogService.error(`Failed to set sticky bit on ${zdotdir}: ${err}`);\n\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToSetStickyBit };\n\t\t\t\t}\n\t\t\t}\n\t\t\tenvMixin['ZDOTDIR'] = zdotdir;\n\t\t\tconst userZdotdir = env?.ZDOTDIR ?? os.homedir() ?? `~`;\n\t\t\tenvMixin['USER_ZDOTDIR'] = userZdotdir;\n\t\t\tconst filesToCopy: IShellIntegrationConfigInjection['filesToCopy'] = [];\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-rc.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zshrc')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-profile.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zprofile')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-env.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zshenv')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-login.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zlogin')\n\t\t\t});\n\t\t\treturn { type, newArgs, envMixin, filesToCopy };\n\t\t}\n\t}\n\tlogService.warn(`Shell integration cannot be enabled for executable \"${shellLaunchConfig.executable}\" and args`, shellLaunchConfig.args);\n\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedShell };\n}\n\n/**\n * There are a few situations where some directories are added to the beginning of the PATH.\n * 1. On macOS when the profile calls path_helper.\n * 2. For fish terminals, which always prepend \"$fish_user_paths\" to the PATH.\n *\n * This causes significant problems for the environment variable\n * collection API as the custom paths added to the end will now be somewhere in the middle of\n * the PATH. To combat this, VSCODE_PATH_PREFIX is used to re-apply any prefix after the profile\n * has run. This will cause duplication in the PATH but should fix the issue.\n *\n * See #99878 for more information.\n */\nfunction addEnvMixinPathPrefix(options: ITerminalProcessOptions, envMixin: IProcessEnvironment, shell: string): void {\n\tif ((isMacintosh || shell === 'fish') && options.environmentVariableCollections) {\n\t\t// Deserialize and merge\n\t\tconst deserialized = deserializeEnvironmentVariableCollections(options.environmentVariableCollections);\n\t\tconst merged = new MergedEnvironmentVariableCollection(deserialized);\n\n\t\t// Get all prepend PATH entries\n\t\tconst pathEntry = merged.getVariableMap({ workspaceFolder: options.workspaceFolder }).get('PATH');\n\t\tconst prependToPath: string[] = [];\n\t\tif (pathEntry) {\n\t\t\tfor (const mutator of pathEntry) {\n\t\t\t\tif (mutator.type === EnvironmentVariableMutatorType.Prepend) {\n\t\t\t\t\tprependToPath.push(mutator.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add to the environment mixin to be applied in the shell integration script\n\t\tif (prependToPath.length > 0) {\n\t\t\tenvMixin['VSCODE_PATH_PREFIX'] = prependToPath.join('');\n\t\t}\n\t}\n}\n\nenum ShellIntegrationExecutable {\n\tWindowsPwsh = 'windows-pwsh',\n\tWindowsPwshLogin = 'windows-pwsh-login',\n\tPwsh = 'pwsh',\n\tPwshLogin = 'pwsh-login',\n\tZsh = 'zsh',\n\tZshLogin = 'zsh-login',\n\tBash = 'bash',\n\tFish = 'fish',\n\tFishLogin = 'fish-login',\n}\n\nconst shellIntegrationArgs: Map<ShellIntegrationExecutable, string[]> = new Map();\n// The try catch swallows execution policy errors in the case of the archive distributable\nshellIntegrationArgs.set(ShellIntegrationExecutable.WindowsPwsh, ['-noexit', '-command', 'try { . \\\"{0}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\\\" } catch {}{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.WindowsPwshLogin, ['-l', '-noexit', '-command', 'try { . \\\"{0}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\\\" } catch {}{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Pwsh, ['-noexit', '-command', '. \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.PwshLogin, ['-l', '-noexit', '-command', '. \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Zsh, ['-i']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.ZshLogin, ['-il']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Bash, ['--init-file', '{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Fish, ['--init-command', 'source \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.fish\"']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.FishLogin, ['-l', '--init-command', 'source \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.fish\"']);\nconst pwshLoginArgs = ['-login', '-l'];\nconst shLoginArgs = ['--login', '-l'];\nconst shInteractiveArgs = ['-i', '--interactive'];\nconst pwshImpliedArgs = ['-nol', '-nologo'];\n\nfunction arePwshLoginArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (isString(originalArgs)) {\n\t\treturn pwshLoginArgs.includes(originalArgs.toLowerCase());\n\t} else {\n\t\treturn originalArgs.length === 1 && pwshLoginArgs.includes(originalArgs[0].toLowerCase()) ||\n\t\t\t(originalArgs.length === 2 &&\n\t\t\t\t(((pwshLoginArgs.includes(originalArgs[0].toLowerCase())) || pwshLoginArgs.includes(originalArgs[1].toLowerCase())))\n\t\t\t\t&& ((pwshImpliedArgs.includes(originalArgs[0].toLowerCase())) || pwshImpliedArgs.includes(originalArgs[1].toLowerCase())));\n\t}\n}\n\nfunction arePwshImpliedArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (isString(originalArgs)) {\n\t\treturn pwshImpliedArgs.includes(originalArgs.toLowerCase());\n\t} else {\n\t\treturn originalArgs.length === 0 || originalArgs?.length === 1 && pwshImpliedArgs.includes(originalArgs[0].toLowerCase());\n\t}\n}\n\nfunction areZshBashFishLoginArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (!isString(originalArgs)) {\n\t\toriginalArgs = originalArgs.filter(arg => !shInteractiveArgs.includes(arg.toLowerCase()));\n\t}\n\treturn isString(originalArgs) && shLoginArgs.includes(originalArgs.toLowerCase())\n\t\t|| !isString(originalArgs) && originalArgs.length === 1 && shLoginArgs.includes(originalArgs[0].toLowerCase());\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport { FileAccess } from '../../../base/common/network.js';\nimport * as path from '../../../base/common/path.js';\nimport { IProcessEnvironment, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport * as process from '../../../base/common/process.js';\nimport { format } from '../../../base/common/strings.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IShellLaunchConfig, ITerminalEnvironment, ITerminalProcessOptions, ShellIntegrationInjectionFailureReason } from '../common/terminal.js';\nimport { EnvironmentVariableMutatorType } from '../common/environmentVariable.js';\nimport { deserializeEnvironmentVariableCollections } from '../common/environmentVariableShared.js';\nimport { MergedEnvironmentVariableCollection } from '../common/environmentVariableCollection.js';\nimport { chmod, realpathSync, mkdirSync } from 'fs';\nimport { promisify } from 'util';\nimport { isString, SingleOrMany } from '../../../base/common/types.js';\n\nexport function getWindowsBuildNumber(): number {\n\tconst osVersion = (/(\\d+)\\.(\\d+)\\.(\\d+)/g).exec(os.release());\n\tlet buildNumber: number = 0;\n\tif (osVersion && osVersion.length === 4) {\n\t\tbuildNumber = parseInt(osVersion[3]);\n\t}\n\treturn buildNumber;\n}\n\nexport interface IShellIntegrationConfigInjection {\n\treadonly type: 'injection';\n\t/**\n\t * A new set of arguments to use.\n\t */\n\treadonly newArgs: string[] | undefined;\n\t/**\n\t * An optional environment to mixing to the real environment.\n\t */\n\treadonly envMixin?: IProcessEnvironment;\n\t/**\n\t * An optional array of files to copy from `source` to `dest`.\n\t */\n\treadonly filesToCopy?: {\n\t\tsource: string;\n\t\tdest: string;\n\t}[];\n}\n\nexport interface IShellIntegrationInjectionFailure {\n\treadonly type: 'failure';\n\treadonly reason: ShellIntegrationInjectionFailureReason;\n}\n\n/**\n * For a given shell launch config, returns arguments to replace and an optional environment to\n * mixin to the SLC's environment to enable shell integration. This must be run within the context\n * that creates the process to ensure accuracy. Returns undefined if shell integration cannot be\n * enabled.\n */\nexport async function getShellIntegrationInjection(\n\tshellLaunchConfig: IShellLaunchConfig,\n\toptions: ITerminalProcessOptions,\n\tenv: ITerminalEnvironment | undefined,\n\tlogService: ILogService,\n\tproductService: IProductService,\n\tskipStickyBit: boolean = false\n): Promise<IShellIntegrationConfigInjection | IShellIntegrationInjectionFailure> {\n\t// The global setting is disabled\n\tif (!options.shellIntegration.enabled) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.InjectionSettingDisabled };\n\t}\n\t// There is no executable (so there's no way to determine how to inject)\n\tif (!shellLaunchConfig.executable) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.NoExecutable };\n\t}\n\t// It's a feature terminal (tasks, debug), unless it's explicitly being forced\n\tif (shellLaunchConfig.isFeatureTerminal && !shellLaunchConfig.forceShellIntegration) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FeatureTerminal };\n\t}\n\t// The ignoreShellIntegration flag is passed (eg. relaunching without shell integration)\n\tif (shellLaunchConfig.ignoreShellIntegration) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.IgnoreShellIntegrationFlag };\n\t}\n\t// Shell integration doesn't work with winpty\n\tif (isWindows && (!options.windowsEnableConpty || getWindowsBuildNumber() < 18309)) {\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.Winpty };\n\t}\n\n\tconst originalArgs = shellLaunchConfig.args;\n\tconst shell = process.platform === 'win32' ? path.basename(shellLaunchConfig.executable).toLowerCase() : path.basename(shellLaunchConfig.executable);\n\tconst appRoot = path.dirname(FileAccess.asFileUri('').fsPath);\n\tconst type = 'injection';\n\tlet newArgs: string[] | undefined;\n\tconst envMixin: IProcessEnvironment = {\n\t\t'VSCODE_INJECTION': '1'\n\t};\n\n\tif (options.shellIntegration.nonce) {\n\t\tenvMixin['VSCODE_NONCE'] = options.shellIntegration.nonce;\n\t}\n\t// Temporarily pass list of hardcoded env vars for shell env api\n\tconst scopedDownShellEnvs = ['PATH', 'VIRTUAL_ENV', 'HOME', 'SHELL', 'PWD'];\n\tif (shellLaunchConfig.shellIntegrationEnvironmentReporting) {\n\t\tif (isWindows) {\n\t\t\tconst enableWindowsEnvReporting = options.windowsUseConptyDll || options.windowsEnableConpty && getWindowsBuildNumber() >= 22631 && shell !== 'bash.exe';\n\t\t\tif (enableWindowsEnvReporting) {\n\t\t\t\tenvMixin['VSCODE_SHELL_ENV_REPORTING'] = scopedDownShellEnvs.join(',');\n\t\t\t}\n\t\t} else {\n\t\t\tenvMixin['VSCODE_SHELL_ENV_REPORTING'] = scopedDownShellEnvs.join(',');\n\t\t}\n\t}\n\n\t// Windows\n\tif (isWindows) {\n\t\tif (shell === 'pwsh.exe' || shell === 'powershell.exe') {\n\t\t\tenvMixin['VSCODE_A11Y_MODE'] = options.isScreenReaderOptimized ? '1' : '0';\n\n\t\t\tif (!originalArgs || arePwshImpliedArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.WindowsPwsh);\n\t\t\t} else if (arePwshLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.WindowsPwshLogin);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot, '');\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t} else if (shell === 'bash.exe') {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tenvMixin['VSCODE_SHELL_LOGIN'] = '1';\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tlogService.warn(`Shell integration cannot be enabled for executable \"${shellLaunchConfig.executable}\" and args`, shellLaunchConfig.args);\n\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedShell };\n\t}\n\n\t// Linux & macOS\n\tswitch (shell) {\n\t\tcase 'bash': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tenvMixin['VSCODE_SHELL_LOGIN'] = '1';\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Bash);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'fish': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Fish);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.FishLogin);\n\t\t\t} else if (originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.Fish) || originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.FishLogin)) {\n\t\t\t\tnewArgs = originalArgs;\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\n\t\t\t// On fish, '$fish_user_paths' is always prepended to the PATH, for both login and non-login shells, so we need\n\t\t\t// to apply the path prefix fix always, not only for login shells (see #232291)\n\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'pwsh': {\n\t\t\tif (!originalArgs || arePwshImpliedArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Pwsh);\n\t\t\t} else if (arePwshLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.PwshLogin);\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot, '');\n\t\t\tenvMixin['VSCODE_STABLE'] = productService.quality === 'stable' ? '1' : '0';\n\t\t\treturn { type, newArgs, envMixin };\n\t\t}\n\t\tcase 'zsh': {\n\t\t\tif (!originalArgs || originalArgs.length === 0) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.Zsh);\n\t\t\t} else if (areZshBashFishLoginArgs(originalArgs)) {\n\t\t\t\tnewArgs = shellIntegrationArgs.get(ShellIntegrationExecutable.ZshLogin);\n\t\t\t\taddEnvMixinPathPrefix(options, envMixin, shell);\n\t\t\t} else if (originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.Zsh) || originalArgs === shellIntegrationArgs.get(ShellIntegrationExecutable.ZshLogin)) {\n\t\t\t\tnewArgs = originalArgs;\n\t\t\t}\n\t\t\tif (!newArgs) {\n\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedArgs };\n\t\t\t}\n\t\t\tnewArgs = [...newArgs]; // Shallow clone the array to avoid setting the default array\n\t\t\tnewArgs[newArgs.length - 1] = format(newArgs[newArgs.length - 1], appRoot);\n\n\t\t\t// Move .zshrc into $ZDOTDIR as the way to activate the script\n\t\t\tlet username: string;\n\t\t\ttry {\n\t\t\t\tusername = os.userInfo().username;\n\t\t\t} catch {\n\t\t\t\tusername = 'unknown';\n\t\t\t}\n\n\t\t\t// Resolve the actual tmp directory so we can set the sticky bit\n\t\t\tconst realTmpDir = realpathSync(os.tmpdir());\n\t\t\tconst zdotdir = path.join(realTmpDir, `${username}-${productService.applicationName}-zsh`);\n\n\t\t\t// Set directory permissions using octal notation:\n\t\t\t// - 0o1700:\n\t\t\t// - Sticky bit is set, preventing non-owners from deleting or renaming files within this directory (1)\n\t\t\t// - Owner has full read (4), write (2), execute (1) permissions\n\t\t\t// - Group has no permissions (0)\n\t\t\t// - Others have no permissions (0)\n\t\t\tif (!skipStickyBit) {\n\t\t\t\t// skip for tests\n\t\t\t\ttry {\n\t\t\t\t\tconst chmodAsync = promisify(chmod);\n\t\t\t\t\tawait chmodAsync(zdotdir, 0o1700);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err.message.includes('ENOENT')) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tmkdirSync(zdotdir);\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tlogService.error(`Failed to create zdotdir at ${zdotdir}: ${err}`);\n\t\t\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToCreateTmpDir };\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst chmodAsync = promisify(chmod);\n\t\t\t\t\t\t\tawait chmodAsync(zdotdir, 0o1700);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tlogService.error(`Failed to set sticky bit on ${zdotdir}: ${err}`);\n\t\t\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToSetStickyBit };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlogService.error(`Failed to set sticky bit on ${zdotdir}: ${err}`);\n\t\t\t\t\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.FailedToSetStickyBit };\n\t\t\t\t}\n\t\t\t}\n\t\t\tenvMixin['ZDOTDIR'] = zdotdir;\n\t\t\tconst userZdotdir = env?.ZDOTDIR ?? os.homedir() ?? `~`;\n\t\t\tenvMixin['USER_ZDOTDIR'] = userZdotdir;\n\t\t\tconst filesToCopy: IShellIntegrationConfigInjection['filesToCopy'] = [];\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-rc.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zshrc')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-profile.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zprofile')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-env.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zshenv')\n\t\t\t});\n\t\t\tfilesToCopy.push({\n\t\t\t\tsource: path.join(appRoot, 'out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-login.zsh'),\n\t\t\t\tdest: path.join(zdotdir, '.zlogin')\n\t\t\t});\n\t\t\treturn { type, newArgs, envMixin, filesToCopy };\n\t\t}\n\t}\n\tlogService.warn(`Shell integration cannot be enabled for executable \"${shellLaunchConfig.executable}\" and args`, shellLaunchConfig.args);\n\treturn { type: 'failure', reason: ShellIntegrationInjectionFailureReason.UnsupportedShell };\n}\n\n/**\n * There are a few situations where some directories are added to the beginning of the PATH.\n * 1. On macOS when the profile calls path_helper.\n * 2. For fish terminals, which always prepend \"$fish_user_paths\" to the PATH.\n *\n * This causes significant problems for the environment variable\n * collection API as the custom paths added to the end will now be somewhere in the middle of\n * the PATH. To combat this, VSCODE_PATH_PREFIX is used to re-apply any prefix after the profile\n * has run. This will cause duplication in the PATH but should fix the issue.\n *\n * See #99878 for more information.\n */\nfunction addEnvMixinPathPrefix(options: ITerminalProcessOptions, envMixin: IProcessEnvironment, shell: string): void {\n\tif ((isMacintosh || shell === 'fish') && options.environmentVariableCollections) {\n\t\t// Deserialize and merge\n\t\tconst deserialized = deserializeEnvironmentVariableCollections(options.environmentVariableCollections);\n\t\tconst merged = new MergedEnvironmentVariableCollection(deserialized);\n\n\t\t// Get all prepend PATH entries\n\t\tconst pathEntry = merged.getVariableMap({ workspaceFolder: options.workspaceFolder }).get('PATH');\n\t\tconst prependToPath: string[] = [];\n\t\tif (pathEntry) {\n\t\t\tfor (const mutator of pathEntry) {\n\t\t\t\tif (mutator.type === EnvironmentVariableMutatorType.Prepend) {\n\t\t\t\t\tprependToPath.push(mutator.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add to the environment mixin to be applied in the shell integration script\n\t\tif (prependToPath.length > 0) {\n\t\t\tenvMixin['VSCODE_PATH_PREFIX'] = prependToPath.join('');\n\t\t}\n\t}\n}\n\nenum ShellIntegrationExecutable {\n\tWindowsPwsh = 'windows-pwsh',\n\tWindowsPwshLogin = 'windows-pwsh-login',\n\tPwsh = 'pwsh',\n\tPwshLogin = 'pwsh-login',\n\tZsh = 'zsh',\n\tZshLogin = 'zsh-login',\n\tBash = 'bash',\n\tFish = 'fish',\n\tFishLogin = 'fish-login',\n}\n\nconst shellIntegrationArgs: Map<ShellIntegrationExecutable, string[]> = new Map();\n// The try catch swallows execution policy errors in the case of the archive distributable\nshellIntegrationArgs.set(ShellIntegrationExecutable.WindowsPwsh, ['-noexit', '-command', 'try { . \\\"{0}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\\\" } catch {}{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.WindowsPwshLogin, ['-l', '-noexit', '-command', 'try { . \\\"{0}\\\\out\\\\vs\\\\workbench\\\\contrib\\\\terminal\\\\common\\\\scripts\\\\shellIntegration.ps1\\\" } catch {}{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Pwsh, ['-noexit', '-command', '. \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"{1}']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.PwshLogin, ['-l', '-noexit', '-command', '. \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1\"']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Zsh, ['-i']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.ZshLogin, ['-il']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Bash, ['--init-file', '{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.Fish, ['--init-command', 'source \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.fish\"']);\nshellIntegrationArgs.set(ShellIntegrationExecutable.FishLogin, ['-l', '--init-command', 'source \"{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.fish\"']);\nconst pwshLoginArgs = ['-login', '-l'];\nconst shLoginArgs = ['--login', '-l'];\nconst shInteractiveArgs = ['-i', '--interactive'];\nconst pwshImpliedArgs = ['-nol', '-nologo'];\n\nfunction arePwshLoginArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (isString(originalArgs)) {\n\t\treturn pwshLoginArgs.includes(originalArgs.toLowerCase());\n\t} else {\n\t\treturn originalArgs.length === 1 && pwshLoginArgs.includes(originalArgs[0].toLowerCase()) ||\n\t\t\t(originalArgs.length === 2 &&\n\t\t\t\t(((pwshLoginArgs.includes(originalArgs[0].toLowerCase())) || pwshLoginArgs.includes(originalArgs[1].toLowerCase())))\n\t\t\t\t&& ((pwshImpliedArgs.includes(originalArgs[0].toLowerCase())) || pwshImpliedArgs.includes(originalArgs[1].toLowerCase())));\n\t}\n}\n\nfunction arePwshImpliedArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (isString(originalArgs)) {\n\t\treturn pwshImpliedArgs.includes(originalArgs.toLowerCase());\n\t} else {\n\t\treturn originalArgs.length === 0 || originalArgs?.length === 1 && pwshImpliedArgs.includes(originalArgs[0].toLowerCase());\n\t}\n}\n\nfunction areZshBashFishLoginArgs(originalArgs: SingleOrMany<string>): boolean {\n\tif (!isString(originalArgs)) {\n\t\toriginalArgs = originalArgs.filter(arg => !shInteractiveArgs.includes(arg.toLowerCase()));\n\t}\n\treturn isString(originalArgs) && shLoginArgs.includes(originalArgs.toLowerCase())\n\t\t|| !isString(originalArgs) && originalArgs.length === 1 && shLoginArgs.includes(originalArgs[0].toLowerCase());\n}\n"]}