{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/assignment/common/assignment.ts","vs/platform/assignment/common/assignment.ts"],"names":[],"mappings":"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","file":"assignment.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../base/common/event.js';\nimport * as platform from '../../../base/common/platform.js';\nimport type { IExperimentationFilterProvider } from 'tas-client';\n\nexport const ASSIGNMENT_STORAGE_KEY = 'VSCode.ABExp.FeatureData';\nexport const ASSIGNMENT_REFETCH_INTERVAL = 60 * 60 * 1000; // 1 hour\n\nexport interface IAssignmentService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidRefetchAssignments: Event<void>;\n\tgetTreatment<T extends string | number | boolean>(name: string): Promise<T | undefined>;\n}\n\nexport enum TargetPopulation {\n\tInsiders = 'insider',\n\tPublic = 'public',\n\tExploration = 'exploration'\n}\n\n/*\nBased upon the official VSCode currently existing filters in the\nExP backend for the VSCode cluster.\nhttps://experimentation.visualstudio.com/Analysis%20and%20Experimentation/_git/AnE.ExP.TAS.TachyonHost.Configuration?path=%2FConfigurations%2Fvscode%2Fvscode.json&version=GBmaster\n\"X-MSEdge-Market\": \"detection.market\",\n\"X-FD-Corpnet\": \"detection.corpnet\",\n\"X-VSCode-AppVersion\": \"appversion\",\n\"X-VSCode-Build\": \"build\",\n\"X-MSEdge-ClientId\": \"clientid\",\n\"X-VSCode-ExtensionName\": \"extensionname\",\n\"X-VSCode-ExtensionVersion\": \"extensionversion\",\n\"X-VSCode-TargetPopulation\": \"targetpopulation\",\n\"X-VSCode-Language\": \"language\",\n\"X-VSCode-Platform\": \"platform\",\n\"X-VSCode-ReleaseDate\": \"releasedate\"\n*/\nexport enum Filters {\n\t/**\n\t * The market in which the extension is distributed.\n\t */\n\tMarket = 'X-MSEdge-Market',\n\n\t/**\n\t * The corporation network.\n\t */\n\tCorpNet = 'X-FD-Corpnet',\n\n\t/**\n\t * Version of the application which uses experimentation service.\n\t */\n\tApplicationVersion = 'X-VSCode-AppVersion',\n\n\t/**\n\t * Insiders vs Stable.\n\t */\n\tBuild = 'X-VSCode-Build',\n\n\t/**\n\t * Client Id which is used as primary unit for the experimentation.\n\t */\n\tClientId = 'X-MSEdge-ClientId',\n\n\t/**\n\t * Developer Device Id which can be used as an alternate unit for experimentation.\n\t */\n\tDeveloperDeviceId = 'X-VSCode-DevDeviceId',\n\n\t/**\n\t * Extension header.\n\t */\n\tExtensionName = 'X-VSCode-ExtensionName',\n\n\t/**\n\t * The version of the extension.\n\t */\n\tExtensionVersion = 'X-VSCode-ExtensionVersion',\n\n\t/**\n\t * The language in use by VS Code\n\t */\n\tLanguage = 'X-VSCode-Language',\n\n\t/**\n\t * The target population.\n\t * This is used to separate internal, early preview, GA, etc.\n\t */\n\tTargetPopulation = 'X-VSCode-TargetPopulation',\n\n\t/**\n\t * The platform (OS) on which VS Code is running.\n\t */\n\tPlatform = 'X-VSCode-Platform',\n\n\t/**\n\t * The release/build date of VS Code (UTC) in the format yyyymmddHHMMSS.\n\t */\n\tReleaseDate = 'X-VSCode-ReleaseDate',\n}\n\nexport class AssignmentFilterProvider implements IExperimentationFilterProvider {\n\tconstructor(\n\t\tprivate version: string,\n\t\tprivate appName: string,\n\t\tprivate machineId: string,\n\t\tprivate devDeviceId: string,\n\t\tprivate targetPopulation: TargetPopulation,\n\t\tprivate releaseDate: string\n\t) { }\n\n\t/**\n\t * Returns a version string that can be parsed by the TAS client.\n\t * The tas client cannot handle suffixes lke \"-insider\"\n\t * Ref: https://github.com/microsoft/tas-client/blob/30340d5e1da37c2789049fcf45928b954680606f/vscode-tas-client/src/vscode-tas-client/VSCodeFilterProvider.ts#L35\n\t *\n\t * @param version Version string to be trimmed.\n\t*/\n\tprivate static trimVersionSuffix(version: string): string {\n\t\tconst regex = /\\-[a-zA-Z0-9]+$/;\n\t\tconst result = version.split(regex);\n\n\t\treturn result[0];\n\t}\n\n\tgetFilterValue(filter: string): string | null {\n\t\tswitch (filter) {\n\t\t\tcase Filters.ApplicationVersion:\n\t\t\t\treturn AssignmentFilterProvider.trimVersionSuffix(this.version); // productService.version\n\t\t\tcase Filters.Build:\n\t\t\t\treturn this.appName; // productService.nameLong\n\t\t\tcase Filters.ClientId:\n\t\t\t\treturn this.machineId;\n\t\t\tcase Filters.DeveloperDeviceId:\n\t\t\t\treturn this.devDeviceId;\n\t\t\tcase Filters.Language:\n\t\t\t\treturn platform.language;\n\t\t\tcase Filters.ExtensionName:\n\t\t\t\treturn 'vscode-core'; // always return vscode-core for exp service\n\t\t\tcase Filters.ExtensionVersion:\n\t\t\t\treturn '999999.0'; // always return a very large number for cross-extension experimentation\n\t\t\tcase Filters.TargetPopulation:\n\t\t\t\treturn this.targetPopulation;\n\t\t\tcase Filters.Platform:\n\t\t\t\treturn platform.PlatformToString(platform.platform);\n\t\t\tcase Filters.ReleaseDate:\n\t\t\t\treturn AssignmentFilterProvider.formatReleaseDate(this.releaseDate);\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\tprivate static formatReleaseDate(iso: string): string {\n\t\t// Expect ISO format, fall back to empty string if not provided\n\t\tif (!iso) {\n\t\t\treturn '';\n\t\t}\n\t\t// Remove separators and milliseconds: YYYY-MM-DDTHH:MM:SS.sssZ -> YYYYMMDDHHMMSS\n\t\tconst match = /^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})/.exec(iso);\n\t\tif (!match) {\n\t\t\treturn '';\n\t\t}\n\t\treturn match.slice(1, 7).join('');\n\t}\n\n\tgetFilters(): Map<string, unknown> {\n\t\tconst filters: Map<string, unknown> = new Map<string, unknown>();\n\t\tconst filterValues = Object.values(Filters);\n\t\tfor (const value of filterValues) {\n\t\t\tfilters.set(value, this.getFilterValue(value));\n\t\t}\n\n\t\treturn filters;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../base/common/event.js';\nimport * as platform from '../../../base/common/platform.js';\nimport type { IExperimentationFilterProvider } from 'tas-client';\n\nexport const ASSIGNMENT_STORAGE_KEY = 'VSCode.ABExp.FeatureData';\nexport const ASSIGNMENT_REFETCH_INTERVAL = 60 * 60 * 1000; // 1 hour\n\nexport interface IAssignmentService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidRefetchAssignments: Event<void>;\n\tgetTreatment<T extends string | number | boolean>(name: string): Promise<T | undefined>;\n}\n\nexport enum TargetPopulation {\n\tInsiders = 'insider',\n\tPublic = 'public',\n\tExploration = 'exploration'\n}\n\n/*\nBased upon the official VSCode currently existing filters in the\nExP backend for the VSCode cluster.\nhttps://experimentation.visualstudio.com/Analysis%20and%20Experimentation/_git/AnE.ExP.TAS.TachyonHost.Configuration?path=%2FConfigurations%2Fvscode%2Fvscode.json&version=GBmaster\n\"X-MSEdge-Market\": \"detection.market\",\n\"X-FD-Corpnet\": \"detection.corpnet\",\n\"X-VSCode-AppVersion\": \"appversion\",\n\"X-VSCode-Build\": \"build\",\n\"X-MSEdge-ClientId\": \"clientid\",\n\"X-VSCode-ExtensionName\": \"extensionname\",\n\"X-VSCode-ExtensionVersion\": \"extensionversion\",\n\"X-VSCode-TargetPopulation\": \"targetpopulation\",\n\"X-VSCode-Language\": \"language\",\n\"X-VSCode-Platform\": \"platform\",\n\"X-VSCode-ReleaseDate\": \"releasedate\"\n*/\nexport enum Filters {\n\t/**\n\t * The market in which the extension is distributed.\n\t */\n\tMarket = 'X-MSEdge-Market',\n\n\t/**\n\t * The corporation network.\n\t */\n\tCorpNet = 'X-FD-Corpnet',\n\n\t/**\n\t * Version of the application which uses experimentation service.\n\t */\n\tApplicationVersion = 'X-VSCode-AppVersion',\n\n\t/**\n\t * Insiders vs Stable.\n\t */\n\tBuild = 'X-VSCode-Build',\n\n\t/**\n\t * Client Id which is used as primary unit for the experimentation.\n\t */\n\tClientId = 'X-MSEdge-ClientId',\n\n\t/**\n\t * Developer Device Id which can be used as an alternate unit for experimentation.\n\t */\n\tDeveloperDeviceId = 'X-VSCode-DevDeviceId',\n\n\t/**\n\t * Extension header.\n\t */\n\tExtensionName = 'X-VSCode-ExtensionName',\n\n\t/**\n\t * The version of the extension.\n\t */\n\tExtensionVersion = 'X-VSCode-ExtensionVersion',\n\n\t/**\n\t * The language in use by VS Code\n\t */\n\tLanguage = 'X-VSCode-Language',\n\n\t/**\n\t * The target population.\n\t * This is used to separate internal, early preview, GA, etc.\n\t */\n\tTargetPopulation = 'X-VSCode-TargetPopulation',\n\n\t/**\n\t * The platform (OS) on which VS Code is running.\n\t */\n\tPlatform = 'X-VSCode-Platform',\n\n\t/**\n\t * The release/build date of VS Code (UTC) in the format yyyymmddHHMMSS.\n\t */\n\tReleaseDate = 'X-VSCode-ReleaseDate',\n}\n\nexport class AssignmentFilterProvider implements IExperimentationFilterProvider {\n\tconstructor(\n\t\tprivate version: string,\n\t\tprivate appName: string,\n\t\tprivate machineId: string,\n\t\tprivate devDeviceId: string,\n\t\tprivate targetPopulation: TargetPopulation,\n\t\tprivate releaseDate: string\n\t) { }\n\n\t/**\n\t * Returns a version string that can be parsed by the TAS client.\n\t * The tas client cannot handle suffixes lke \"-insider\"\n\t * Ref: https://github.com/microsoft/tas-client/blob/30340d5e1da37c2789049fcf45928b954680606f/vscode-tas-client/src/vscode-tas-client/VSCodeFilterProvider.ts#L35\n\t *\n\t * @param version Version string to be trimmed.\n\t*/\n\tprivate static trimVersionSuffix(version: string): string {\n\t\tconst regex = /\\-[a-zA-Z0-9]+$/;\n\t\tconst result = version.split(regex);\n\n\t\treturn result[0];\n\t}\n\n\tgetFilterValue(filter: string): string | null {\n\t\tswitch (filter) {\n\t\t\tcase Filters.ApplicationVersion:\n\t\t\t\treturn AssignmentFilterProvider.trimVersionSuffix(this.version); // productService.version\n\t\t\tcase Filters.Build:\n\t\t\t\treturn this.appName; // productService.nameLong\n\t\t\tcase Filters.ClientId:\n\t\t\t\treturn this.machineId;\n\t\t\tcase Filters.DeveloperDeviceId:\n\t\t\t\treturn this.devDeviceId;\n\t\t\tcase Filters.Language:\n\t\t\t\treturn platform.language;\n\t\t\tcase Filters.ExtensionName:\n\t\t\t\treturn 'vscode-core'; // always return vscode-core for exp service\n\t\t\tcase Filters.ExtensionVersion:\n\t\t\t\treturn '999999.0'; // always return a very large number for cross-extension experimentation\n\t\t\tcase Filters.TargetPopulation:\n\t\t\t\treturn this.targetPopulation;\n\t\t\tcase Filters.Platform:\n\t\t\t\treturn platform.PlatformToString(platform.platform);\n\t\t\tcase Filters.ReleaseDate:\n\t\t\t\treturn AssignmentFilterProvider.formatReleaseDate(this.releaseDate);\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\tprivate static formatReleaseDate(iso: string): string {\n\t\t// Expect ISO format, fall back to empty string if not provided\n\t\tif (!iso) {\n\t\t\treturn '';\n\t\t}\n\t\t// Remove separators and milliseconds: YYYY-MM-DDTHH:MM:SS.sssZ -> YYYYMMDDHHMMSS\n\t\tconst match = /^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})/.exec(iso);\n\t\tif (!match) {\n\t\t\treturn '';\n\t\t}\n\t\treturn match.slice(1, 7).join('');\n\t}\n\n\tgetFilters(): Map<string, unknown> {\n\t\tconst filters: Map<string, unknown> = new Map<string, unknown>();\n\t\tconst filterValues = Object.values(Filters);\n\t\tfor (const value of filterValues) {\n\t\t\tfilters.set(value, this.getFilterValue(value));\n\t\t}\n\n\t\treturn filters;\n\t}\n}\n"]}