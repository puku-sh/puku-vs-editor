{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/utilityProcess/electron-main/utilityProcess.ts","vs/platform/utilityProcess/electron-main/utilityProcess.ts"],"names":[],"mappings":"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","file":"utilityProcess.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserWindow, Details, MessageChannelMain, app, utilityProcess, UtilityProcess as ElectronUtilityProcess } from 'electron';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { StringDecoder } from 'string_decoder';\nimport { timeout } from '../../../base/common/async.js';\nimport { FileAccess } from '../../../base/common/network.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\nimport Severity from '../../../base/common/severity.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { ILifecycleMainService } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { removeDangerousEnvVariables } from '../../../base/common/processes.js';\nimport { deepClone } from '../../../base/common/objects.js';\nimport { isWindows } from '../../../base/common/platform.js';\nimport { isUNCAccessRestrictionsDisabled, getUNCHostAllowlist } from '../../../base/node/unc.js';\n\nexport interface IUtilityProcessConfiguration {\n\n\t/**\n\t * A way to group utility processes of same type together.\n\t */\n\treadonly type: string;\n\n\t/**\n\t * A human-readable name for the utility process.\n\t */\n\treadonly name: string;\n\n\t/**\n\t * The entry point to load in the utility process.\n\t */\n\treadonly entryPoint: string;\n\n\t/**\n\t * An optional serializable object to be sent into the utility process\n\t * as first message alongside the message port.\n\t */\n\treadonly payload?: unknown;\n\n\t/**\n\t * Environment key-value pairs. Default is `process.env`.\n\t */\n\treadonly env?: { [key: string]: string | undefined };\n\n\t/**\n\t * List of string arguments that will be available as `process.argv`\n\t * in the child process.\n\t */\n\treadonly args?: string[];\n\n\t/**\n\t * List of string arguments passed to the executable.\n\t */\n\treadonly execArgv?: string[];\n\n\t/**\n\t * Allow the utility process to load unsigned libraries.\n\t */\n\treadonly allowLoadingUnsignedLibraries?: boolean;\n\n\t/**\n\t * Used in log messages to correlate the process\n\t * with other components.\n\t */\n\treadonly correlationId?: string;\n\n\t/**\n\t * Optional pid of the parent process. If set, the\n\t * utility process will be terminated when the parent\n\t * process exits.\n\t */\n\treadonly parentLifecycleBound?: number;\n\n\t/**\n\t * HTTP 401 and 407 requests created via electron:net module\n\t * will be redirected to the main process and can be handled\n\t * via the app#login event.\n\t */\n\treadonly respondToAuthRequestsFromMainProcess?: boolean;\n}\n\nexport interface IWindowUtilityProcessConfiguration extends IUtilityProcessConfiguration {\n\n\t// --- message port response related\n\n\treadonly responseWindowId: number;\n\treadonly responseChannel: string;\n\treadonly responseNonce: string;\n\n\t// --- utility process options\n\n\t/**\n\t * If set to `true`, will terminate the utility process\n\t * when the associated browser window closes or reloads.\n\t */\n\treadonly windowLifecycleBound?: boolean;\n}\n\nfunction isWindowUtilityProcessConfiguration(config: IUtilityProcessConfiguration): config is IWindowUtilityProcessConfiguration {\n\tconst candidate = config as IWindowUtilityProcessConfiguration;\n\n\treturn typeof candidate.responseWindowId === 'number';\n}\n\ninterface IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The process id of the process that exited.\n\t */\n\treadonly pid: number;\n\n\t/**\n\t * The exit code of the process.\n\t */\n\treadonly code: number;\n}\n\nexport interface IUtilityProcessExitEvent extends IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The signal that caused the process to exit is unknown\n\t * for utility processes.\n\t */\n\treadonly signal: 'unknown';\n}\n\nexport interface IUtilityProcessCrashEvent extends IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The reason of the utility process crash.\n\t */\n\treadonly reason: 'clean-exit' | 'abnormal-exit' | 'killed' | 'crashed' | 'oom' | 'launch-failed' | 'integrity-failure' | 'memory-eviction';\n}\n\nexport interface IUtilityProcessInfo {\n\treadonly pid: number;\n\treadonly name: string;\n}\n\nexport class UtilityProcess extends Disposable {\n\n\tprivate static ID_COUNTER = 0;\n\n\tprivate static readonly all = new Map<number, IUtilityProcessInfo>();\n\tstatic getAll(): IUtilityProcessInfo[] {\n\t\treturn Array.from(UtilityProcess.all.values());\n\t}\n\n\tprivate readonly id = String(++UtilityProcess.ID_COUNTER);\n\n\tprivate readonly _onStdout = this._register(new Emitter<string>());\n\treadonly onStdout = this._onStdout.event;\n\n\tprivate readonly _onStderr = this._register(new Emitter<string>());\n\treadonly onStderr = this._onStderr.event;\n\n\tprivate readonly _onMessage = this._register(new Emitter<unknown>());\n\treadonly onMessage = this._onMessage.event;\n\n\tprivate readonly _onSpawn = this._register(new Emitter<number | undefined>());\n\treadonly onSpawn = this._onSpawn.event;\n\n\tprivate readonly _onExit = this._register(new Emitter<IUtilityProcessExitEvent>());\n\treadonly onExit = this._onExit.event;\n\n\tprivate readonly _onCrash = this._register(new Emitter<IUtilityProcessCrashEvent>());\n\treadonly onCrash = this._onCrash.event;\n\n\tprivate process: ElectronUtilityProcess | undefined = undefined;\n\tprivate processPid: number | undefined = undefined;\n\tprivate configuration: IUtilityProcessConfiguration | undefined = undefined;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILifecycleMainService protected readonly lifecycleMainService: ILifecycleMainService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected log(msg: string, severity: Severity): void {\n\t\tlet logMsg: string;\n\t\tif (this.configuration?.correlationId) {\n\t\t\tlogMsg = `[UtilityProcess id: ${this.configuration?.correlationId}, type: ${this.configuration?.type}, pid: ${this.processPid ?? '<none>'}]: ${msg}`;\n\t\t} else {\n\t\t\tlogMsg = `[UtilityProcess type: ${this.configuration?.type}, pid: ${this.processPid ?? '<none>'}]: ${msg}`;\n\t\t}\n\n\t\tswitch (severity) {\n\t\t\tcase Severity.Error:\n\t\t\t\tthis.logService.error(logMsg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Warning:\n\t\t\t\tthis.logService.warn(logMsg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Info:\n\t\t\t\tthis.logService.trace(logMsg);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate validateCanStart(): boolean {\n\t\tif (this.process) {\n\t\t\tthis.log('Cannot start utility process because it is already running...', Severity.Error);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstart(configuration: IUtilityProcessConfiguration): boolean {\n\t\tconst started = this.doStart(configuration);\n\n\t\tif (started && configuration.payload) {\n\t\t\tconst posted = this.postMessage(configuration.payload);\n\t\t\tif (posted) {\n\t\t\t\tthis.log('payload sent via postMessage()', Severity.Info);\n\t\t\t}\n\t\t}\n\n\t\treturn started;\n\t}\n\n\tprotected doStart(configuration: IUtilityProcessConfiguration): boolean {\n\t\tif (!this.validateCanStart()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.configuration = configuration;\n\n\t\tconst serviceName = `${this.configuration.type}-${this.id}`;\n\t\tconst modulePath = FileAccess.asFileUri('bootstrap-fork.js').fsPath;\n\t\tconst args = this.configuration.args ?? [];\n\t\tconst execArgv = this.configuration.execArgv ?? [];\n\t\tconst allowLoadingUnsignedLibraries = this.configuration.allowLoadingUnsignedLibraries;\n\t\tconst respondToAuthRequestsFromMainProcess = this.configuration.respondToAuthRequestsFromMainProcess;\n\t\tconst stdio = 'pipe';\n\t\tconst env = this.createEnv(configuration);\n\n\t\tthis.log('creating new...', Severity.Info);\n\n\t\t// Fork utility process\n\t\tthis.process = utilityProcess.fork(modulePath, args, {\n\t\t\tserviceName,\n\t\t\tenv,\n\t\t\texecArgv, // !!! Add `--trace-warnings` for node.js tracing !!!\n\t\t\tallowLoadingUnsignedLibraries,\n\t\t\trespondToAuthRequestsFromMainProcess,\n\t\t\tstdio\n\t\t});\n\n\t\t// Register to events\n\t\tthis.registerListeners(this.process, this.configuration, serviceName);\n\n\t\treturn true;\n\t}\n\n\tprivate createEnv(configuration: IUtilityProcessConfiguration): NodeJS.ProcessEnv {\n\t\tconst env: NodeJS.ProcessEnv = configuration.env ? { ...configuration.env } : { ...deepClone(process.env) };\n\n\t\t// Apply supported environment variables from config\n\t\tenv['VSCODE_ESM_ENTRYPOINT'] = configuration.entryPoint;\n\t\tif (typeof configuration.parentLifecycleBound === 'number') {\n\t\t\tenv['VSCODE_PARENT_PID'] = String(configuration.parentLifecycleBound);\n\t\t}\n\t\tenv['VSCODE_CRASH_REPORTER_PROCESS_TYPE'] = configuration.type;\n\t\tif (isWindows) {\n\t\t\tif (isUNCAccessRestrictionsDisabled()) {\n\t\t\t\tenv['NODE_DISABLE_UNC_ACCESS_CHECKS'] = '1';\n\t\t\t} else {\n\t\t\t\tenv['NODE_UNC_HOST_ALLOWLIST'] = getUNCHostAllowlist().join('\\\\');\n\t\t\t}\n\t\t}\n\n\t\t// Remove any environment variables that are not allowed\n\t\tremoveDangerousEnvVariables(env);\n\n\t\t// Ensure all values are strings, otherwise the process will not start\n\t\tfor (const key of Object.keys(env)) {\n\t\t\tenv[key] = String(env[key]);\n\t\t}\n\n\t\treturn env;\n\t}\n\n\tprivate registerListeners(process: ElectronUtilityProcess, configuration: IUtilityProcessConfiguration, serviceName: string): void {\n\n\t\t// Stdout\n\t\tif (process.stdout) {\n\t\t\tconst stdoutDecoder = new StringDecoder('utf-8');\n\t\t\tthis._register(Event.fromNodeEventEmitter<string | Buffer>(process.stdout, 'data')(chunk => this._onStdout.fire(typeof chunk === 'string' ? chunk : stdoutDecoder.write(chunk))));\n\t\t}\n\n\t\t// Stderr\n\t\tif (process.stderr) {\n\t\t\tconst stderrDecoder = new StringDecoder('utf-8');\n\t\t\tthis._register(Event.fromNodeEventEmitter<string | Buffer>(process.stderr, 'data')(chunk => this._onStderr.fire(typeof chunk === 'string' ? chunk : stderrDecoder.write(chunk))));\n\t\t}\n\n\t\t// Messages\n\t\tthis._register(Event.fromNodeEventEmitter(process, 'message')(msg => this._onMessage.fire(msg)));\n\n\t\t// Spawn\n\t\tthis._register(Event.fromNodeEventEmitter<void>(process, 'spawn')(() => {\n\t\t\tthis.processPid = process.pid;\n\n\t\t\tif (typeof process.pid === 'number') {\n\t\t\t\tUtilityProcess.all.set(process.pid, { pid: process.pid, name: isWindowUtilityProcessConfiguration(configuration) ? `${configuration.name} [${configuration.responseWindowId}]` : configuration.name });\n\t\t\t}\n\n\t\t\tthis.log('successfully created', Severity.Info);\n\t\t\tthis._onSpawn.fire(process.pid);\n\t\t}));\n\n\t\t// Exit\n\t\tthis._register(Event.fromNodeEventEmitter<number>(process, 'exit')(code => {\n\t\t\tthis.log(`received exit event with code ${code}`, Severity.Info);\n\n\t\t\t// Event\n\t\t\tthis._onExit.fire({ pid: this.processPid!, code, signal: 'unknown' });\n\n\t\t\t// Cleanup\n\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t}));\n\n\t\t// Child process gone\n\t\tthis._register(Event.fromNodeEventEmitter<{ details: Details }>(app, 'child-process-gone', (event, details) => ({ event, details }))(({ details }) => {\n\t\t\tif (details.type === 'Utility' && details.name === serviceName) {\n\t\t\t\tthis.log(`crashed with code ${details.exitCode} and reason '${details.reason}'`, Severity.Error);\n\n\t\t\t\t// Telemetry\n\t\t\t\ttype UtilityProcessCrashClassification = {\n\t\t\t\t\ttype: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The type of utility process to understand the origin of the crash better.' };\n\t\t\t\t\treason: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The reason of the utility process crash to understand the nature of the crash better.' };\n\t\t\t\t\tcode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The exit code of the utility process to understand the nature of the crash better' };\n\t\t\t\t\towner: 'bpasero';\n\t\t\t\t\tcomment: 'Provides insight into reasons the utility process crashed.';\n\t\t\t\t};\n\t\t\t\ttype UtilityProcessCrashEvent = {\n\t\t\t\t\ttype: string;\n\t\t\t\t\treason: string;\n\t\t\t\t\tcode: number;\n\t\t\t\t};\n\t\t\t\tthis.telemetryService.publicLog2<UtilityProcessCrashEvent, UtilityProcessCrashClassification>('utilityprocesscrash', {\n\t\t\t\t\ttype: configuration.type,\n\t\t\t\t\treason: details.reason,\n\t\t\t\t\tcode: details.exitCode\n\t\t\t\t});\n\n\t\t\t\t// Event\n\t\t\t\tthis._onCrash.fire({ pid: this.processPid!, code: details.exitCode, reason: details.reason });\n\n\t\t\t\t// Cleanup\n\t\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t\t}\n\t\t}));\n\t}\n\n\tonce(message: unknown, callback: () => void): void {\n\t\tconst disposable = this._register(this._onMessage.event(msg => {\n\t\t\tif (msg === message) {\n\t\t\t\tdisposable.dispose();\n\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpostMessage(message: unknown, transfer?: Electron.MessagePortMain[]): boolean {\n\t\tif (!this.process) {\n\t\t\treturn false; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.process.postMessage(message, transfer);\n\n\t\treturn true;\n\t}\n\n\tconnect(payload?: unknown): Electron.MessagePortMain {\n\t\tconst { port1: outPort, port2: utilityProcessPort } = new MessageChannelMain();\n\t\tthis.postMessage(payload, [utilityProcessPort]);\n\n\t\treturn outPort;\n\t}\n\n\tenableInspectPort(): boolean {\n\t\tif (!this.process || typeof this.processPid !== 'number') {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.log('enabling inspect port', Severity.Info);\n\n\t\tinterface ProcessExt {\n\t\t\t_debugProcess?(pid: number): unknown;\n\t\t}\n\n\t\t// use (undocumented) _debugProcess feature of node if available\n\t\tconst processExt = <ProcessExt>process;\n\t\tif (typeof processExt._debugProcess === 'function') {\n\t\t\tprocessExt._debugProcess(this.processPid);\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// not supported...\n\t\treturn false;\n\t}\n\n\tkill(): void {\n\t\tif (!this.process) {\n\t\t\treturn; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.log('attempting to kill the process...', Severity.Info);\n\t\tconst killed = this.process.kill();\n\t\tif (killed) {\n\t\t\tthis.log('successfully killed the process', Severity.Info);\n\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t} else {\n\t\t\tthis.log('unable to kill the process', Severity.Warning);\n\t\t}\n\t}\n\n\tprivate onDidExitOrCrashOrKill(): void {\n\t\tif (typeof this.processPid === 'number') {\n\t\t\tUtilityProcess.all.delete(this.processPid);\n\t\t}\n\n\t\tthis.process = undefined;\n\t}\n\n\tasync waitForExit(maxWaitTimeMs: number): Promise<void> {\n\t\tif (!this.process) {\n\t\t\treturn; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.log('waiting to exit...', Severity.Info);\n\t\tawait Promise.race([Event.toPromise(this.onExit), timeout(maxWaitTimeMs)]);\n\n\t\tif (this.process) {\n\t\t\tthis.log(`did not exit within ${maxWaitTimeMs}ms, will kill it now...`, Severity.Info);\n\t\t\tthis.kill();\n\t\t}\n\t}\n}\n\nexport class WindowUtilityProcess extends UtilityProcess {\n\n\tconstructor(\n\t\t@ILogService logService: ILogService,\n\t\t@IWindowsMainService private readonly windowsMainService: IWindowsMainService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILifecycleMainService lifecycleMainService: ILifecycleMainService\n\t) {\n\t\tsuper(logService, telemetryService, lifecycleMainService);\n\t}\n\n\toverride start(configuration: IWindowUtilityProcessConfiguration): boolean {\n\t\tconst responseWindow = this.windowsMainService.getWindowById(configuration.responseWindowId);\n\t\tif (!responseWindow?.win || responseWindow.win.isDestroyed() || responseWindow.win.webContents.isDestroyed()) {\n\t\t\tthis.log('Refusing to start utility process because requesting window cannot be found or is destroyed...', Severity.Error);\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// Start utility process\n\t\tconst started = super.doStart(configuration);\n\t\tif (!started) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Register to window events\n\t\tthis.registerWindowListeners(responseWindow.win, configuration);\n\n\t\t// Establish & exchange message ports\n\t\tconst windowPort = this.connect(configuration.payload);\n\t\tresponseWindow.win.webContents.postMessage(configuration.responseChannel, configuration.responseNonce, [windowPort]);\n\n\t\treturn true;\n\t}\n\n\tprivate registerWindowListeners(window: BrowserWindow, configuration: IWindowUtilityProcessConfiguration): void {\n\n\t\t// If the lifecycle of the utility process is bound to the window,\n\t\t// we kill the process if the window closes or changes\n\n\t\tif (configuration.windowLifecycleBound) {\n\t\t\tthis._register(Event.filter(this.lifecycleMainService.onWillLoadWindow, e => e.window.win === window)(() => this.kill()));\n\t\t\tthis._register(Event.fromNodeEventEmitter(window, 'closed')(() => this.kill()));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserWindow, Details, MessageChannelMain, app, utilityProcess, UtilityProcess as ElectronUtilityProcess } from 'electron';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { StringDecoder } from 'string_decoder';\nimport { timeout } from '../../../base/common/async.js';\nimport { FileAccess } from '../../../base/common/network.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\nimport Severity from '../../../base/common/severity.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { ILifecycleMainService } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { removeDangerousEnvVariables } from '../../../base/common/processes.js';\nimport { deepClone } from '../../../base/common/objects.js';\nimport { isWindows } from '../../../base/common/platform.js';\nimport { isUNCAccessRestrictionsDisabled, getUNCHostAllowlist } from '../../../base/node/unc.js';\n\nexport interface IUtilityProcessConfiguration {\n\n\t/**\n\t * A way to group utility processes of same type together.\n\t */\n\treadonly type: string;\n\n\t/**\n\t * A human-readable name for the utility process.\n\t */\n\treadonly name: string;\n\n\t/**\n\t * The entry point to load in the utility process.\n\t */\n\treadonly entryPoint: string;\n\n\t/**\n\t * An optional serializable object to be sent into the utility process\n\t * as first message alongside the message port.\n\t */\n\treadonly payload?: unknown;\n\n\t/**\n\t * Environment key-value pairs. Default is `process.env`.\n\t */\n\treadonly env?: { [key: string]: string | undefined };\n\n\t/**\n\t * List of string arguments that will be available as `process.argv`\n\t * in the child process.\n\t */\n\treadonly args?: string[];\n\n\t/**\n\t * List of string arguments passed to the executable.\n\t */\n\treadonly execArgv?: string[];\n\n\t/**\n\t * Allow the utility process to load unsigned libraries.\n\t */\n\treadonly allowLoadingUnsignedLibraries?: boolean;\n\n\t/**\n\t * Used in log messages to correlate the process\n\t * with other components.\n\t */\n\treadonly correlationId?: string;\n\n\t/**\n\t * Optional pid of the parent process. If set, the\n\t * utility process will be terminated when the parent\n\t * process exits.\n\t */\n\treadonly parentLifecycleBound?: number;\n\n\t/**\n\t * HTTP 401 and 407 requests created via electron:net module\n\t * will be redirected to the main process and can be handled\n\t * via the app#login event.\n\t */\n\treadonly respondToAuthRequestsFromMainProcess?: boolean;\n}\n\nexport interface IWindowUtilityProcessConfiguration extends IUtilityProcessConfiguration {\n\n\t// --- message port response related\n\n\treadonly responseWindowId: number;\n\treadonly responseChannel: string;\n\treadonly responseNonce: string;\n\n\t// --- utility process options\n\n\t/**\n\t * If set to `true`, will terminate the utility process\n\t * when the associated browser window closes or reloads.\n\t */\n\treadonly windowLifecycleBound?: boolean;\n}\n\nfunction isWindowUtilityProcessConfiguration(config: IUtilityProcessConfiguration): config is IWindowUtilityProcessConfiguration {\n\tconst candidate = config as IWindowUtilityProcessConfiguration;\n\n\treturn typeof candidate.responseWindowId === 'number';\n}\n\ninterface IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The process id of the process that exited.\n\t */\n\treadonly pid: number;\n\n\t/**\n\t * The exit code of the process.\n\t */\n\treadonly code: number;\n}\n\nexport interface IUtilityProcessExitEvent extends IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The signal that caused the process to exit is unknown\n\t * for utility processes.\n\t */\n\treadonly signal: 'unknown';\n}\n\nexport interface IUtilityProcessCrashEvent extends IUtilityProcessExitBaseEvent {\n\n\t/**\n\t * The reason of the utility process crash.\n\t */\n\treadonly reason: 'clean-exit' | 'abnormal-exit' | 'killed' | 'crashed' | 'oom' | 'launch-failed' | 'integrity-failure' | 'memory-eviction';\n}\n\nexport interface IUtilityProcessInfo {\n\treadonly pid: number;\n\treadonly name: string;\n}\n\nexport class UtilityProcess extends Disposable {\n\n\tprivate static ID_COUNTER = 0;\n\n\tprivate static readonly all = new Map<number, IUtilityProcessInfo>();\n\tstatic getAll(): IUtilityProcessInfo[] {\n\t\treturn Array.from(UtilityProcess.all.values());\n\t}\n\n\tprivate readonly id = String(++UtilityProcess.ID_COUNTER);\n\n\tprivate readonly _onStdout = this._register(new Emitter<string>());\n\treadonly onStdout = this._onStdout.event;\n\n\tprivate readonly _onStderr = this._register(new Emitter<string>());\n\treadonly onStderr = this._onStderr.event;\n\n\tprivate readonly _onMessage = this._register(new Emitter<unknown>());\n\treadonly onMessage = this._onMessage.event;\n\n\tprivate readonly _onSpawn = this._register(new Emitter<number | undefined>());\n\treadonly onSpawn = this._onSpawn.event;\n\n\tprivate readonly _onExit = this._register(new Emitter<IUtilityProcessExitEvent>());\n\treadonly onExit = this._onExit.event;\n\n\tprivate readonly _onCrash = this._register(new Emitter<IUtilityProcessCrashEvent>());\n\treadonly onCrash = this._onCrash.event;\n\n\tprivate process: ElectronUtilityProcess | undefined = undefined;\n\tprivate processPid: number | undefined = undefined;\n\tprivate configuration: IUtilityProcessConfiguration | undefined = undefined;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILifecycleMainService protected readonly lifecycleMainService: ILifecycleMainService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected log(msg: string, severity: Severity): void {\n\t\tlet logMsg: string;\n\t\tif (this.configuration?.correlationId) {\n\t\t\tlogMsg = `[UtilityProcess id: ${this.configuration?.correlationId}, type: ${this.configuration?.type}, pid: ${this.processPid ?? '<none>'}]: ${msg}`;\n\t\t} else {\n\t\t\tlogMsg = `[UtilityProcess type: ${this.configuration?.type}, pid: ${this.processPid ?? '<none>'}]: ${msg}`;\n\t\t}\n\n\t\tswitch (severity) {\n\t\t\tcase Severity.Error:\n\t\t\t\tthis.logService.error(logMsg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Warning:\n\t\t\t\tthis.logService.warn(logMsg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Info:\n\t\t\t\tthis.logService.trace(logMsg);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate validateCanStart(): boolean {\n\t\tif (this.process) {\n\t\t\tthis.log('Cannot start utility process because it is already running...', Severity.Error);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstart(configuration: IUtilityProcessConfiguration): boolean {\n\t\tconst started = this.doStart(configuration);\n\n\t\tif (started && configuration.payload) {\n\t\t\tconst posted = this.postMessage(configuration.payload);\n\t\t\tif (posted) {\n\t\t\t\tthis.log('payload sent via postMessage()', Severity.Info);\n\t\t\t}\n\t\t}\n\n\t\treturn started;\n\t}\n\n\tprotected doStart(configuration: IUtilityProcessConfiguration): boolean {\n\t\tif (!this.validateCanStart()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.configuration = configuration;\n\n\t\tconst serviceName = `${this.configuration.type}-${this.id}`;\n\t\tconst modulePath = FileAccess.asFileUri('bootstrap-fork.js').fsPath;\n\t\tconst args = this.configuration.args ?? [];\n\t\tconst execArgv = this.configuration.execArgv ?? [];\n\t\tconst allowLoadingUnsignedLibraries = this.configuration.allowLoadingUnsignedLibraries;\n\t\tconst respondToAuthRequestsFromMainProcess = this.configuration.respondToAuthRequestsFromMainProcess;\n\t\tconst stdio = 'pipe';\n\t\tconst env = this.createEnv(configuration);\n\n\t\tthis.log('creating new...', Severity.Info);\n\n\t\t// Fork utility process\n\t\tthis.process = utilityProcess.fork(modulePath, args, {\n\t\t\tserviceName,\n\t\t\tenv,\n\t\t\texecArgv, // !!! Add `--trace-warnings` for node.js tracing !!!\n\t\t\tallowLoadingUnsignedLibraries,\n\t\t\trespondToAuthRequestsFromMainProcess,\n\t\t\tstdio\n\t\t});\n\n\t\t// Register to events\n\t\tthis.registerListeners(this.process, this.configuration, serviceName);\n\n\t\treturn true;\n\t}\n\n\tprivate createEnv(configuration: IUtilityProcessConfiguration): NodeJS.ProcessEnv {\n\t\tconst env: NodeJS.ProcessEnv = configuration.env ? { ...configuration.env } : { ...deepClone(process.env) };\n\n\t\t// Apply supported environment variables from config\n\t\tenv['VSCODE_ESM_ENTRYPOINT'] = configuration.entryPoint;\n\t\tif (typeof configuration.parentLifecycleBound === 'number') {\n\t\t\tenv['VSCODE_PARENT_PID'] = String(configuration.parentLifecycleBound);\n\t\t}\n\t\tenv['VSCODE_CRASH_REPORTER_PROCESS_TYPE'] = configuration.type;\n\t\tif (isWindows) {\n\t\t\tif (isUNCAccessRestrictionsDisabled()) {\n\t\t\t\tenv['NODE_DISABLE_UNC_ACCESS_CHECKS'] = '1';\n\t\t\t} else {\n\t\t\t\tenv['NODE_UNC_HOST_ALLOWLIST'] = getUNCHostAllowlist().join('\\\\');\n\t\t\t}\n\t\t}\n\n\t\t// Remove any environment variables that are not allowed\n\t\tremoveDangerousEnvVariables(env);\n\n\t\t// Ensure all values are strings, otherwise the process will not start\n\t\tfor (const key of Object.keys(env)) {\n\t\t\tenv[key] = String(env[key]);\n\t\t}\n\n\t\treturn env;\n\t}\n\n\tprivate registerListeners(process: ElectronUtilityProcess, configuration: IUtilityProcessConfiguration, serviceName: string): void {\n\n\t\t// Stdout\n\t\tif (process.stdout) {\n\t\t\tconst stdoutDecoder = new StringDecoder('utf-8');\n\t\t\tthis._register(Event.fromNodeEventEmitter<string | Buffer>(process.stdout, 'data')(chunk => this._onStdout.fire(typeof chunk === 'string' ? chunk : stdoutDecoder.write(chunk))));\n\t\t}\n\n\t\t// Stderr\n\t\tif (process.stderr) {\n\t\t\tconst stderrDecoder = new StringDecoder('utf-8');\n\t\t\tthis._register(Event.fromNodeEventEmitter<string | Buffer>(process.stderr, 'data')(chunk => this._onStderr.fire(typeof chunk === 'string' ? chunk : stderrDecoder.write(chunk))));\n\t\t}\n\n\t\t// Messages\n\t\tthis._register(Event.fromNodeEventEmitter(process, 'message')(msg => this._onMessage.fire(msg)));\n\n\t\t// Spawn\n\t\tthis._register(Event.fromNodeEventEmitter<void>(process, 'spawn')(() => {\n\t\t\tthis.processPid = process.pid;\n\n\t\t\tif (typeof process.pid === 'number') {\n\t\t\t\tUtilityProcess.all.set(process.pid, { pid: process.pid, name: isWindowUtilityProcessConfiguration(configuration) ? `${configuration.name} [${configuration.responseWindowId}]` : configuration.name });\n\t\t\t}\n\n\t\t\tthis.log('successfully created', Severity.Info);\n\t\t\tthis._onSpawn.fire(process.pid);\n\t\t}));\n\n\t\t// Exit\n\t\tthis._register(Event.fromNodeEventEmitter<number>(process, 'exit')(code => {\n\t\t\tthis.log(`received exit event with code ${code}`, Severity.Info);\n\n\t\t\t// Event\n\t\t\tthis._onExit.fire({ pid: this.processPid!, code, signal: 'unknown' });\n\n\t\t\t// Cleanup\n\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t}));\n\n\t\t// Child process gone\n\t\tthis._register(Event.fromNodeEventEmitter<{ details: Details }>(app, 'child-process-gone', (event, details) => ({ event, details }))(({ details }) => {\n\t\t\tif (details.type === 'Utility' && details.name === serviceName) {\n\t\t\t\tthis.log(`crashed with code ${details.exitCode} and reason '${details.reason}'`, Severity.Error);\n\n\t\t\t\t// Telemetry\n\t\t\t\ttype UtilityProcessCrashClassification = {\n\t\t\t\t\ttype: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The type of utility process to understand the origin of the crash better.' };\n\t\t\t\t\treason: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The reason of the utility process crash to understand the nature of the crash better.' };\n\t\t\t\t\tcode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The exit code of the utility process to understand the nature of the crash better' };\n\t\t\t\t\towner: 'bpasero';\n\t\t\t\t\tcomment: 'Provides insight into reasons the utility process crashed.';\n\t\t\t\t};\n\t\t\t\ttype UtilityProcessCrashEvent = {\n\t\t\t\t\ttype: string;\n\t\t\t\t\treason: string;\n\t\t\t\t\tcode: number;\n\t\t\t\t};\n\t\t\t\tthis.telemetryService.publicLog2<UtilityProcessCrashEvent, UtilityProcessCrashClassification>('utilityprocesscrash', {\n\t\t\t\t\ttype: configuration.type,\n\t\t\t\t\treason: details.reason,\n\t\t\t\t\tcode: details.exitCode\n\t\t\t\t});\n\n\t\t\t\t// Event\n\t\t\t\tthis._onCrash.fire({ pid: this.processPid!, code: details.exitCode, reason: details.reason });\n\n\t\t\t\t// Cleanup\n\t\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t\t}\n\t\t}));\n\t}\n\n\tonce(message: unknown, callback: () => void): void {\n\t\tconst disposable = this._register(this._onMessage.event(msg => {\n\t\t\tif (msg === message) {\n\t\t\t\tdisposable.dispose();\n\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpostMessage(message: unknown, transfer?: Electron.MessagePortMain[]): boolean {\n\t\tif (!this.process) {\n\t\t\treturn false; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.process.postMessage(message, transfer);\n\n\t\treturn true;\n\t}\n\n\tconnect(payload?: unknown): Electron.MessagePortMain {\n\t\tconst { port1: outPort, port2: utilityProcessPort } = new MessageChannelMain();\n\t\tthis.postMessage(payload, [utilityProcessPort]);\n\n\t\treturn outPort;\n\t}\n\n\tenableInspectPort(): boolean {\n\t\tif (!this.process || typeof this.processPid !== 'number') {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.log('enabling inspect port', Severity.Info);\n\n\t\tinterface ProcessExt {\n\t\t\t_debugProcess?(pid: number): unknown;\n\t\t}\n\n\t\t// use (undocumented) _debugProcess feature of node if available\n\t\tconst processExt = <ProcessExt>process;\n\t\tif (typeof processExt._debugProcess === 'function') {\n\t\t\tprocessExt._debugProcess(this.processPid);\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// not supported...\n\t\treturn false;\n\t}\n\n\tkill(): void {\n\t\tif (!this.process) {\n\t\t\treturn; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.log('attempting to kill the process...', Severity.Info);\n\t\tconst killed = this.process.kill();\n\t\tif (killed) {\n\t\t\tthis.log('successfully killed the process', Severity.Info);\n\t\t\tthis.onDidExitOrCrashOrKill();\n\t\t} else {\n\t\t\tthis.log('unable to kill the process', Severity.Warning);\n\t\t}\n\t}\n\n\tprivate onDidExitOrCrashOrKill(): void {\n\t\tif (typeof this.processPid === 'number') {\n\t\t\tUtilityProcess.all.delete(this.processPid);\n\t\t}\n\n\t\tthis.process = undefined;\n\t}\n\n\tasync waitForExit(maxWaitTimeMs: number): Promise<void> {\n\t\tif (!this.process) {\n\t\t\treturn; // already killed, crashed or never started\n\t\t}\n\n\t\tthis.log('waiting to exit...', Severity.Info);\n\t\tawait Promise.race([Event.toPromise(this.onExit), timeout(maxWaitTimeMs)]);\n\n\t\tif (this.process) {\n\t\t\tthis.log(`did not exit within ${maxWaitTimeMs}ms, will kill it now...`, Severity.Info);\n\t\t\tthis.kill();\n\t\t}\n\t}\n}\n\nexport class WindowUtilityProcess extends UtilityProcess {\n\n\tconstructor(\n\t\t@ILogService logService: ILogService,\n\t\t@IWindowsMainService private readonly windowsMainService: IWindowsMainService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILifecycleMainService lifecycleMainService: ILifecycleMainService\n\t) {\n\t\tsuper(logService, telemetryService, lifecycleMainService);\n\t}\n\n\toverride start(configuration: IWindowUtilityProcessConfiguration): boolean {\n\t\tconst responseWindow = this.windowsMainService.getWindowById(configuration.responseWindowId);\n\t\tif (!responseWindow?.win || responseWindow.win.isDestroyed() || responseWindow.win.webContents.isDestroyed()) {\n\t\t\tthis.log('Refusing to start utility process because requesting window cannot be found or is destroyed...', Severity.Error);\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// Start utility process\n\t\tconst started = super.doStart(configuration);\n\t\tif (!started) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Register to window events\n\t\tthis.registerWindowListeners(responseWindow.win, configuration);\n\n\t\t// Establish & exchange message ports\n\t\tconst windowPort = this.connect(configuration.payload);\n\t\tresponseWindow.win.webContents.postMessage(configuration.responseChannel, configuration.responseNonce, [windowPort]);\n\n\t\treturn true;\n\t}\n\n\tprivate registerWindowListeners(window: BrowserWindow, configuration: IWindowUtilityProcessConfiguration): void {\n\n\t\t// If the lifecycle of the utility process is bound to the window,\n\t\t// we kill the process if the window closes or changes\n\n\t\tif (configuration.windowLifecycleBound) {\n\t\t\tthis._register(Event.filter(this.lifecycleMainService.onWillLoadWindow, e => e.window.win === window)(() => this.kill()));\n\t\t\tthis._register(Event.fromNodeEventEmitter(window, 'closed')(() => this.kill()));\n\t\t}\n\t}\n}\n"]}