{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/files/test/browser/fileService.test.ts","vs/platform/files/test/browser/fileService.test.ts"],"names":[],"mappings":"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","file":"fileService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise, timeout } from '../../../../base/common/async.js';\nimport { bufferToReadable, bufferToStream, VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { consumeStream, newWriteableStream, ReadableStreamEvents } from '../../../../base/common/stream.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IFileOpenOptions, IFileReadStreamOptions, FileSystemProviderCapabilities, FileType, IFileSystemProviderCapabilitiesChangeEvent, IFileSystemProviderRegistrationEvent, IStat, IFileAtomicReadOptions, IFileAtomicWriteOptions, IFileAtomicDeleteOptions, IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicDeleteCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileAtomicOptions, IFileChange, isFileSystemWatcher, FileChangesEvent, FileChangeType } from '../../common/files.js';\nimport { FileService } from '../../common/fileService.js';\nimport { NullFileSystemProvider } from '../common/nullFileSystemProvider.js';\nimport { NullLogService } from '../../../log/common/log.js';\n\nsuite('File Service', () => {\n\n\tconst disposables = new DisposableStore();\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\ttest('provider registration', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\t\tconst resource = URI.parse('test://foo/bar');\n\t\tconst provider = new NullFileSystemProvider();\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), false);\n\t\tassert.strictEqual(service.hasProvider(resource), false);\n\t\tassert.strictEqual(service.getProvider(resource.scheme), undefined);\n\n\t\tconst registrations: IFileSystemProviderRegistrationEvent[] = [];\n\t\tdisposables.add(service.onDidChangeFileSystemProviderRegistrations(e => {\n\t\t\tregistrations.push(e);\n\t\t}));\n\n\t\tconst capabilityChanges: IFileSystemProviderCapabilitiesChangeEvent[] = [];\n\t\tdisposables.add(service.onDidChangeFileSystemProviderCapabilities(e => {\n\t\t\tcapabilityChanges.push(e);\n\t\t}));\n\n\t\tlet registrationDisposable: IDisposable | undefined;\n\t\tlet callCount = 0;\n\t\tdisposables.add(service.onWillActivateFileSystemProvider(e => {\n\t\t\tcallCount++;\n\n\t\t\tif (e.scheme === 'test' && callCount === 1) {\n\t\t\t\te.join(new Promise(resolve => {\n\t\t\t\t\tregistrationDisposable = service.registerProvider('test', provider);\n\n\t\t\t\t\tresolve();\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), true);\n\t\tassert.strictEqual(service.hasProvider(resource), true);\n\t\tassert.strictEqual(service.getProvider(resource.scheme), provider);\n\n\t\tassert.strictEqual(registrations.length, 1);\n\t\tassert.strictEqual(registrations[0].scheme, 'test');\n\t\tassert.strictEqual(registrations[0].added, true);\n\t\tassert.ok(registrationDisposable);\n\n\t\tassert.strictEqual(capabilityChanges.length, 0);\n\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.FileFolderCopy);\n\t\tassert.strictEqual(capabilityChanges.length, 1);\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.Readonly);\n\t\tassert.strictEqual(capabilityChanges.length, 2);\n\n\t\tawait service.activateProvider('test');\n\t\tassert.strictEqual(callCount, 2); // activation is called again\n\n\t\tassert.strictEqual(service.hasCapability(resource, FileSystemProviderCapabilities.Readonly), true);\n\t\tassert.strictEqual(service.hasCapability(resource, FileSystemProviderCapabilities.FileOpenReadWriteClose), false);\n\n\t\tregistrationDisposable.dispose();\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), false);\n\t\tassert.strictEqual(service.hasProvider(resource), false);\n\n\t\tassert.strictEqual(registrations.length, 2);\n\t\tassert.strictEqual(registrations[1].scheme, 'test');\n\t\tassert.strictEqual(registrations[1].added, false);\n\t});\n\n\ttest('watch', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tlet disposeCounter = 0;\n\t\tdisposables.add(service.registerProvider('test', new NullFileSystemProvider(() => {\n\t\t\treturn toDisposable(() => {\n\t\t\t\tdisposeCounter++;\n\t\t\t});\n\t\t})));\n\t\tawait service.activateProvider('test');\n\n\t\tconst resource1 = URI.parse('test://foo/bar1');\n\t\tconst watcher1Disposable = service.watch(resource1);\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher1Disposable.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\n\t\tdisposeCounter = 0;\n\t\tconst resource2 = URI.parse('test://foo/bar2');\n\t\tconst watcher2Disposable1 = service.watch(resource2);\n\t\tconst watcher2Disposable2 = service.watch(resource2);\n\t\tconst watcher2Disposable3 = service.watch(resource2);\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable1.dispose();\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable2.dispose();\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable3.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\n\t\tdisposeCounter = 0;\n\t\tconst resource3 = URI.parse('test://foo/bar3');\n\t\tconst watcher3Disposable1 = service.watch(resource3);\n\t\tconst watcher3Disposable2 = service.watch(resource3, { recursive: true, excludes: [] });\n\t\tconst watcher3Disposable3 = service.watch(resource3, { recursive: false, excludes: [], includes: [] });\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher3Disposable1.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\t\twatcher3Disposable2.dispose();\n\t\tassert.strictEqual(disposeCounter, 2);\n\t\twatcher3Disposable3.dispose();\n\t\tassert.strictEqual(disposeCounter, 3);\n\n\t\tservice.dispose();\n\t});\n\n\ttest('watch - with corelation', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\t\t\tprivate readonly _testOnDidChangeFile = new Emitter<readonly IFileChange[]>();\n\t\t\toverride readonly onDidChangeFile: Event<readonly IFileChange[]> = this._testOnDidChangeFile.event;\n\n\t\t\tfireFileChange(changes: readonly IFileChange[]) {\n\t\t\t\tthis._testOnDidChangeFile.fire(changes);\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\t\tawait service.activateProvider('test');\n\n\t\tconst globalEvents: FileChangesEvent[] = [];\n\t\tdisposables.add(service.onDidFilesChange(e => {\n\t\t\tglobalEvents.push(e);\n\t\t}));\n\n\t\tconst watcher0 = disposables.add(service.watch(URI.parse('test://watch/folder1'), { recursive: true, excludes: [], includes: [] }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher0), false);\n\t\tconst watcher1 = disposables.add(service.watch(URI.parse('test://watch/folder2'), { recursive: true, excludes: [], includes: [], correlationId: 100 }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher1), true);\n\t\tconst watcher2 = disposables.add(service.watch(URI.parse('test://watch/folder3'), { recursive: true, excludes: [], includes: [], correlationId: 200 }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher2), true);\n\n\t\tconst watcher1Events: FileChangesEvent[] = [];\n\t\tdisposables.add(watcher1.onDidChange(e => {\n\t\t\twatcher1Events.push(e);\n\t\t}));\n\n\t\tconst watcher2Events: FileChangesEvent[] = [];\n\t\tdisposables.add(watcher2.onDidChange(e => {\n\t\t\twatcher2Events.push(e);\n\t\t}));\n\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder1'), type: FileChangeType.ADDED }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder2'), type: FileChangeType.ADDED, cId: 100 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder2'), type: FileChangeType.ADDED, cId: 100 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder3/file'), type: FileChangeType.UPDATED, cId: 200 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder3'), type: FileChangeType.UPDATED, cId: 200 }]);\n\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 50 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 60 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 70 }]);\n\n\t\tassert.strictEqual(globalEvents.length, 1);\n\t\tassert.strictEqual(watcher1Events.length, 2);\n\t\tassert.strictEqual(watcher2Events.length, 2);\n\t});\n\n\ttest('error from readFile bubbles through (https://github.com/microsoft/vscode/issues/118060) - async', async () => {\n\t\ttestReadErrorBubbles(true);\n\t});\n\n\ttest('error from readFile bubbles through (https://github.com/microsoft/vscode/issues/118060)', async () => {\n\t\ttestReadErrorBubbles(false);\n\t});\n\n\tasync function testReadErrorBubbles(async: boolean) {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tsize: 100,\n\t\t\t\t\ttype: FileType.File\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride readFile(resource: URI): Promise<Uint8Array> {\n\t\t\t\tif (async) {\n\t\t\t\t\treturn timeout(5, CancellationToken.None).then(() => { throw new Error('failed'); });\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\n\t\t\toverride open(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\t\t\tif (async) {\n\t\t\t\t\treturn timeout(5, CancellationToken.None).then(() => { throw new Error('failed'); });\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\tif (async) {\n\t\t\t\t\tconst stream = newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t\t\ttimeout(5, CancellationToken.None).then(() => stream.error(new Error('failed')));\n\n\t\t\t\t\treturn stream;\n\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tfor (const capabilities of [FileSystemProviderCapabilities.FileReadWrite, FileSystemProviderCapabilities.FileReadStream, FileSystemProviderCapabilities.FileOpenReadWriteClose]) {\n\t\t\tprovider.setCapabilities(capabilities);\n\n\t\t\tlet e1;\n\t\t\ttry {\n\t\t\t\tawait service.readFile(URI.parse('test://foo/bar'));\n\t\t\t} catch (error) {\n\t\t\t\te1 = error;\n\t\t\t}\n\n\t\t\tassert.ok(e1);\n\n\t\t\tlet e2;\n\t\t\ttry {\n\t\t\t\tconst stream = await service.readFileStream(URI.parse('test://foo/bar'));\n\t\t\t\tawait consumeStream(stream.value, chunk => chunk[0]);\n\t\t\t} catch (error) {\n\t\t\t\te2 = error;\n\t\t\t}\n\n\t\t\tassert.ok(e2);\n\t\t}\n\t}\n\n\ttest('readFile/readFileStream supports cancellation (https://github.com/microsoft/vscode/issues/138805)', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tlet readFileStreamReady: DeferredPromise<void> | undefined = undefined;\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tsize: 100,\n\t\t\t\t\ttype: FileType.File\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\tconst stream = newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t\tdisposables.add(token.onCancellationRequested(() => {\n\t\t\t\t\tstream.error(new Error('Expected cancellation'));\n\t\t\t\t\tstream.end();\n\t\t\t\t}));\n\n\t\t\t\treadFileStreamReady!.complete();\n\n\t\t\t\treturn stream;\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.FileReadStream);\n\n\t\tlet e1;\n\t\ttry {\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\treadFileStreamReady = new DeferredPromise();\n\t\t\tconst promise = service.readFile(URI.parse('test://foo/bar'), undefined, cts.token);\n\t\t\tawait Promise.all([readFileStreamReady.p.then(() => cts.cancel()), promise]);\n\t\t} catch (error) {\n\t\t\te1 = error;\n\t\t}\n\n\t\tassert.ok(e1);\n\n\t\tlet e2;\n\t\ttry {\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\treadFileStreamReady = new DeferredPromise();\n\t\t\tconst stream = await service.readFileStream(URI.parse('test://foo/bar'), undefined, cts.token);\n\t\t\tawait Promise.all([readFileStreamReady.p.then(() => cts.cancel()), consumeStream(stream.value, chunk => chunk[0])]);\n\t\t} catch (error) {\n\t\t\te2 = error;\n\t\t}\n\n\t\tassert.ok(e2);\n\t});\n\n\ttest('enforced atomic read/write/delete', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst atomicResource = URI.parse('test://foo/bar/atomic');\n\t\tconst nonAtomicResource = URI.parse('test://foo/nonatomic');\n\n\t\tlet atomicReadCounter = 0;\n\t\tlet atomicWriteCounter = 0;\n\t\tlet atomicDeleteCounter = 0;\n\n\t\tconst provider = new class extends NullFileSystemProvider implements IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileSystemProviderWithFileAtomicDeleteCapability {\n\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\ttype: FileType.File,\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tsize: 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride async readFile(resource: URI, opts?: IFileAtomicReadOptions): Promise<Uint8Array> {\n\t\t\t\tif (opts?.atomic) {\n\t\t\t\t\tatomicReadCounter++;\n\t\t\t\t}\n\t\t\t\treturn new Uint8Array();\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\treturn newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t}\n\n\t\t\tenforceAtomicReadFile(resource: URI): boolean {\n\t\t\t\treturn isEqual(resource, atomicResource);\n\t\t\t}\n\n\t\t\toverride async writeFile(resource: URI, content: Uint8Array, opts: IFileAtomicWriteOptions): Promise<void> {\n\t\t\t\tif (opts.atomic) {\n\t\t\t\t\tatomicWriteCounter++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tenforceAtomicWriteFile(resource: URI): IFileAtomicOptions | false {\n\t\t\t\treturn isEqual(resource, atomicResource) ? { postfix: '.tmp' } : false;\n\t\t\t}\n\n\t\t\toverride async delete(resource: URI, opts: IFileAtomicDeleteOptions): Promise<void> {\n\t\t\t\tif (opts.atomic) {\n\t\t\t\t\tatomicDeleteCounter++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tenforceAtomicDelete(resource: URI): IFileAtomicOptions | false {\n\t\t\t\treturn isEqual(resource, atomicResource) ? { postfix: '.tmp' } : false;\n\t\t\t}\n\t\t};\n\n\t\tprovider.setCapabilities(\n\t\t\tFileSystemProviderCapabilities.FileReadWrite |\n\t\t\tFileSystemProviderCapabilities.FileOpenReadWriteClose |\n\t\t\tFileSystemProviderCapabilities.FileReadStream |\n\t\t\tFileSystemProviderCapabilities.FileAtomicRead |\n\t\t\tFileSystemProviderCapabilities.FileAtomicWrite |\n\t\t\tFileSystemProviderCapabilities.FileAtomicDelete\n\t\t);\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tawait service.readFile(atomicResource);\n\t\tawait service.readFile(nonAtomicResource);\n\t\tawait service.readFileStream(atomicResource);\n\t\tawait service.readFileStream(nonAtomicResource);\n\n\t\tawait service.writeFile(atomicResource, VSBuffer.fromString(''));\n\t\tawait service.writeFile(nonAtomicResource, VSBuffer.fromString(''));\n\n\t\tawait service.writeFile(atomicResource, bufferToStream(VSBuffer.fromString('')));\n\t\tawait service.writeFile(nonAtomicResource, bufferToStream(VSBuffer.fromString('')));\n\n\t\tawait service.writeFile(atomicResource, bufferToReadable(VSBuffer.fromString('')));\n\t\tawait service.writeFile(nonAtomicResource, bufferToReadable(VSBuffer.fromString('')));\n\n\t\tawait service.del(atomicResource);\n\t\tawait service.del(nonAtomicResource);\n\n\t\tassert.strictEqual(atomicReadCounter, 2);\n\t\tassert.strictEqual(atomicWriteCounter, 3);\n\t\tassert.strictEqual(atomicDeleteCounter, 1);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise, timeout } from '../../../../base/common/async.js';\nimport { bufferToReadable, bufferToStream, VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { consumeStream, newWriteableStream, ReadableStreamEvents } from '../../../../base/common/stream.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IFileOpenOptions, IFileReadStreamOptions, FileSystemProviderCapabilities, FileType, IFileSystemProviderCapabilitiesChangeEvent, IFileSystemProviderRegistrationEvent, IStat, IFileAtomicReadOptions, IFileAtomicWriteOptions, IFileAtomicDeleteOptions, IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicDeleteCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileAtomicOptions, IFileChange, isFileSystemWatcher, FileChangesEvent, FileChangeType } from '../../common/files.js';\nimport { FileService } from '../../common/fileService.js';\nimport { NullFileSystemProvider } from '../common/nullFileSystemProvider.js';\nimport { NullLogService } from '../../../log/common/log.js';\n\nsuite('File Service', () => {\n\n\tconst disposables = new DisposableStore();\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\ttest('provider registration', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\t\tconst resource = URI.parse('test://foo/bar');\n\t\tconst provider = new NullFileSystemProvider();\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), false);\n\t\tassert.strictEqual(service.hasProvider(resource), false);\n\t\tassert.strictEqual(service.getProvider(resource.scheme), undefined);\n\n\t\tconst registrations: IFileSystemProviderRegistrationEvent[] = [];\n\t\tdisposables.add(service.onDidChangeFileSystemProviderRegistrations(e => {\n\t\t\tregistrations.push(e);\n\t\t}));\n\n\t\tconst capabilityChanges: IFileSystemProviderCapabilitiesChangeEvent[] = [];\n\t\tdisposables.add(service.onDidChangeFileSystemProviderCapabilities(e => {\n\t\t\tcapabilityChanges.push(e);\n\t\t}));\n\n\t\tlet registrationDisposable: IDisposable | undefined;\n\t\tlet callCount = 0;\n\t\tdisposables.add(service.onWillActivateFileSystemProvider(e => {\n\t\t\tcallCount++;\n\n\t\t\tif (e.scheme === 'test' && callCount === 1) {\n\t\t\t\te.join(new Promise(resolve => {\n\t\t\t\t\tregistrationDisposable = service.registerProvider('test', provider);\n\n\t\t\t\t\tresolve();\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), true);\n\t\tassert.strictEqual(service.hasProvider(resource), true);\n\t\tassert.strictEqual(service.getProvider(resource.scheme), provider);\n\n\t\tassert.strictEqual(registrations.length, 1);\n\t\tassert.strictEqual(registrations[0].scheme, 'test');\n\t\tassert.strictEqual(registrations[0].added, true);\n\t\tassert.ok(registrationDisposable);\n\n\t\tassert.strictEqual(capabilityChanges.length, 0);\n\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.FileFolderCopy);\n\t\tassert.strictEqual(capabilityChanges.length, 1);\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.Readonly);\n\t\tassert.strictEqual(capabilityChanges.length, 2);\n\n\t\tawait service.activateProvider('test');\n\t\tassert.strictEqual(callCount, 2); // activation is called again\n\n\t\tassert.strictEqual(service.hasCapability(resource, FileSystemProviderCapabilities.Readonly), true);\n\t\tassert.strictEqual(service.hasCapability(resource, FileSystemProviderCapabilities.FileOpenReadWriteClose), false);\n\n\t\tregistrationDisposable.dispose();\n\n\t\tassert.strictEqual(await service.canHandleResource(resource), false);\n\t\tassert.strictEqual(service.hasProvider(resource), false);\n\n\t\tassert.strictEqual(registrations.length, 2);\n\t\tassert.strictEqual(registrations[1].scheme, 'test');\n\t\tassert.strictEqual(registrations[1].added, false);\n\t});\n\n\ttest('watch', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tlet disposeCounter = 0;\n\t\tdisposables.add(service.registerProvider('test', new NullFileSystemProvider(() => {\n\t\t\treturn toDisposable(() => {\n\t\t\t\tdisposeCounter++;\n\t\t\t});\n\t\t})));\n\t\tawait service.activateProvider('test');\n\n\t\tconst resource1 = URI.parse('test://foo/bar1');\n\t\tconst watcher1Disposable = service.watch(resource1);\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher1Disposable.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\n\t\tdisposeCounter = 0;\n\t\tconst resource2 = URI.parse('test://foo/bar2');\n\t\tconst watcher2Disposable1 = service.watch(resource2);\n\t\tconst watcher2Disposable2 = service.watch(resource2);\n\t\tconst watcher2Disposable3 = service.watch(resource2);\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable1.dispose();\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable2.dispose();\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher2Disposable3.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\n\t\tdisposeCounter = 0;\n\t\tconst resource3 = URI.parse('test://foo/bar3');\n\t\tconst watcher3Disposable1 = service.watch(resource3);\n\t\tconst watcher3Disposable2 = service.watch(resource3, { recursive: true, excludes: [] });\n\t\tconst watcher3Disposable3 = service.watch(resource3, { recursive: false, excludes: [], includes: [] });\n\n\t\tawait timeout(0); // service.watch() is async\n\t\tassert.strictEqual(disposeCounter, 0);\n\t\twatcher3Disposable1.dispose();\n\t\tassert.strictEqual(disposeCounter, 1);\n\t\twatcher3Disposable2.dispose();\n\t\tassert.strictEqual(disposeCounter, 2);\n\t\twatcher3Disposable3.dispose();\n\t\tassert.strictEqual(disposeCounter, 3);\n\n\t\tservice.dispose();\n\t});\n\n\ttest('watch - with corelation', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\t\t\tprivate readonly _testOnDidChangeFile = new Emitter<readonly IFileChange[]>();\n\t\t\toverride readonly onDidChangeFile: Event<readonly IFileChange[]> = this._testOnDidChangeFile.event;\n\n\t\t\tfireFileChange(changes: readonly IFileChange[]) {\n\t\t\t\tthis._testOnDidChangeFile.fire(changes);\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\t\tawait service.activateProvider('test');\n\n\t\tconst globalEvents: FileChangesEvent[] = [];\n\t\tdisposables.add(service.onDidFilesChange(e => {\n\t\t\tglobalEvents.push(e);\n\t\t}));\n\n\t\tconst watcher0 = disposables.add(service.watch(URI.parse('test://watch/folder1'), { recursive: true, excludes: [], includes: [] }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher0), false);\n\t\tconst watcher1 = disposables.add(service.watch(URI.parse('test://watch/folder2'), { recursive: true, excludes: [], includes: [], correlationId: 100 }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher1), true);\n\t\tconst watcher2 = disposables.add(service.watch(URI.parse('test://watch/folder3'), { recursive: true, excludes: [], includes: [], correlationId: 200 }));\n\t\tassert.strictEqual(isFileSystemWatcher(watcher2), true);\n\n\t\tconst watcher1Events: FileChangesEvent[] = [];\n\t\tdisposables.add(watcher1.onDidChange(e => {\n\t\t\twatcher1Events.push(e);\n\t\t}));\n\n\t\tconst watcher2Events: FileChangesEvent[] = [];\n\t\tdisposables.add(watcher2.onDidChange(e => {\n\t\t\twatcher2Events.push(e);\n\t\t}));\n\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder1'), type: FileChangeType.ADDED }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder2'), type: FileChangeType.ADDED, cId: 100 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder2'), type: FileChangeType.ADDED, cId: 100 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder3/file'), type: FileChangeType.UPDATED, cId: 200 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder3'), type: FileChangeType.UPDATED, cId: 200 }]);\n\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 50 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 60 }]);\n\t\tprovider.fireFileChange([{ resource: URI.parse('test://watch/folder4'), type: FileChangeType.ADDED, cId: 70 }]);\n\n\t\tassert.strictEqual(globalEvents.length, 1);\n\t\tassert.strictEqual(watcher1Events.length, 2);\n\t\tassert.strictEqual(watcher2Events.length, 2);\n\t});\n\n\ttest('error from readFile bubbles through (https://github.com/microsoft/vscode/issues/118060) - async', async () => {\n\t\ttestReadErrorBubbles(true);\n\t});\n\n\ttest('error from readFile bubbles through (https://github.com/microsoft/vscode/issues/118060)', async () => {\n\t\ttestReadErrorBubbles(false);\n\t});\n\n\tasync function testReadErrorBubbles(async: boolean) {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tsize: 100,\n\t\t\t\t\ttype: FileType.File\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride readFile(resource: URI): Promise<Uint8Array> {\n\t\t\t\tif (async) {\n\t\t\t\t\treturn timeout(5, CancellationToken.None).then(() => { throw new Error('failed'); });\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\n\t\t\toverride open(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\t\t\tif (async) {\n\t\t\t\t\treturn timeout(5, CancellationToken.None).then(() => { throw new Error('failed'); });\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\tif (async) {\n\t\t\t\t\tconst stream = newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t\t\ttimeout(5, CancellationToken.None).then(() => stream.error(new Error('failed')));\n\n\t\t\t\t\treturn stream;\n\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('failed');\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tfor (const capabilities of [FileSystemProviderCapabilities.FileReadWrite, FileSystemProviderCapabilities.FileReadStream, FileSystemProviderCapabilities.FileOpenReadWriteClose]) {\n\t\t\tprovider.setCapabilities(capabilities);\n\n\t\t\tlet e1;\n\t\t\ttry {\n\t\t\t\tawait service.readFile(URI.parse('test://foo/bar'));\n\t\t\t} catch (error) {\n\t\t\t\te1 = error;\n\t\t\t}\n\n\t\t\tassert.ok(e1);\n\n\t\t\tlet e2;\n\t\t\ttry {\n\t\t\t\tconst stream = await service.readFileStream(URI.parse('test://foo/bar'));\n\t\t\t\tawait consumeStream(stream.value, chunk => chunk[0]);\n\t\t\t} catch (error) {\n\t\t\t\te2 = error;\n\t\t\t}\n\n\t\t\tassert.ok(e2);\n\t\t}\n\t}\n\n\ttest('readFile/readFileStream supports cancellation (https://github.com/microsoft/vscode/issues/138805)', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tlet readFileStreamReady: DeferredPromise<void> | undefined = undefined;\n\n\t\tconst provider = new class extends NullFileSystemProvider {\n\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tsize: 100,\n\t\t\t\t\ttype: FileType.File\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\tconst stream = newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t\tdisposables.add(token.onCancellationRequested(() => {\n\t\t\t\t\tstream.error(new Error('Expected cancellation'));\n\t\t\t\t\tstream.end();\n\t\t\t\t}));\n\n\t\t\t\treadFileStreamReady!.complete();\n\n\t\t\t\treturn stream;\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tprovider.setCapabilities(FileSystemProviderCapabilities.FileReadStream);\n\n\t\tlet e1;\n\t\ttry {\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\treadFileStreamReady = new DeferredPromise();\n\t\t\tconst promise = service.readFile(URI.parse('test://foo/bar'), undefined, cts.token);\n\t\t\tawait Promise.all([readFileStreamReady.p.then(() => cts.cancel()), promise]);\n\t\t} catch (error) {\n\t\t\te1 = error;\n\t\t}\n\n\t\tassert.ok(e1);\n\n\t\tlet e2;\n\t\ttry {\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\treadFileStreamReady = new DeferredPromise();\n\t\t\tconst stream = await service.readFileStream(URI.parse('test://foo/bar'), undefined, cts.token);\n\t\t\tawait Promise.all([readFileStreamReady.p.then(() => cts.cancel()), consumeStream(stream.value, chunk => chunk[0])]);\n\t\t} catch (error) {\n\t\t\te2 = error;\n\t\t}\n\n\t\tassert.ok(e2);\n\t});\n\n\ttest('enforced atomic read/write/delete', async () => {\n\t\tconst service = disposables.add(new FileService(new NullLogService()));\n\n\t\tconst atomicResource = URI.parse('test://foo/bar/atomic');\n\t\tconst nonAtomicResource = URI.parse('test://foo/nonatomic');\n\n\t\tlet atomicReadCounter = 0;\n\t\tlet atomicWriteCounter = 0;\n\t\tlet atomicDeleteCounter = 0;\n\n\t\tconst provider = new class extends NullFileSystemProvider implements IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileSystemProviderWithFileAtomicDeleteCapability {\n\n\t\t\toverride async stat(resource: URI): Promise<IStat> {\n\t\t\t\treturn {\n\t\t\t\t\ttype: FileType.File,\n\t\t\t\t\tctime: Date.now(),\n\t\t\t\t\tmtime: Date.now(),\n\t\t\t\t\tsize: 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\toverride async readFile(resource: URI, opts?: IFileAtomicReadOptions): Promise<Uint8Array> {\n\t\t\t\tif (opts?.atomic) {\n\t\t\t\t\tatomicReadCounter++;\n\t\t\t\t}\n\t\t\t\treturn new Uint8Array();\n\t\t\t}\n\n\t\t\toverride readFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\t\t\treturn newWriteableStream<Uint8Array>(chunk => chunk[0]);\n\t\t\t}\n\n\t\t\tenforceAtomicReadFile(resource: URI): boolean {\n\t\t\t\treturn isEqual(resource, atomicResource);\n\t\t\t}\n\n\t\t\toverride async writeFile(resource: URI, content: Uint8Array, opts: IFileAtomicWriteOptions): Promise<void> {\n\t\t\t\tif (opts.atomic) {\n\t\t\t\t\tatomicWriteCounter++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tenforceAtomicWriteFile(resource: URI): IFileAtomicOptions | false {\n\t\t\t\treturn isEqual(resource, atomicResource) ? { postfix: '.tmp' } : false;\n\t\t\t}\n\n\t\t\toverride async delete(resource: URI, opts: IFileAtomicDeleteOptions): Promise<void> {\n\t\t\t\tif (opts.atomic) {\n\t\t\t\t\tatomicDeleteCounter++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tenforceAtomicDelete(resource: URI): IFileAtomicOptions | false {\n\t\t\t\treturn isEqual(resource, atomicResource) ? { postfix: '.tmp' } : false;\n\t\t\t}\n\t\t};\n\n\t\tprovider.setCapabilities(\n\t\t\tFileSystemProviderCapabilities.FileReadWrite |\n\t\t\tFileSystemProviderCapabilities.FileOpenReadWriteClose |\n\t\t\tFileSystemProviderCapabilities.FileReadStream |\n\t\t\tFileSystemProviderCapabilities.FileAtomicRead |\n\t\t\tFileSystemProviderCapabilities.FileAtomicWrite |\n\t\t\tFileSystemProviderCapabilities.FileAtomicDelete\n\t\t);\n\n\t\tdisposables.add(service.registerProvider('test', provider));\n\n\t\tawait service.readFile(atomicResource);\n\t\tawait service.readFile(nonAtomicResource);\n\t\tawait service.readFileStream(atomicResource);\n\t\tawait service.readFileStream(nonAtomicResource);\n\n\t\tawait service.writeFile(atomicResource, VSBuffer.fromString(''));\n\t\tawait service.writeFile(nonAtomicResource, VSBuffer.fromString(''));\n\n\t\tawait service.writeFile(atomicResource, bufferToStream(VSBuffer.fromString('')));\n\t\tawait service.writeFile(nonAtomicResource, bufferToStream(VSBuffer.fromString('')));\n\n\t\tawait service.writeFile(atomicResource, bufferToReadable(VSBuffer.fromString('')));\n\t\tawait service.writeFile(nonAtomicResource, bufferToReadable(VSBuffer.fromString('')));\n\n\t\tawait service.del(atomicResource);\n\t\tawait service.del(nonAtomicResource);\n\n\t\tassert.strictEqual(atomicReadCounter, 2);\n\t\tassert.strictEqual(atomicWriteCounter, 3);\n\t\tassert.strictEqual(atomicDeleteCounter, 1);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}