{"version":3,"sources":["vs/platform/files/browser/indexedDBFileSystemProvider.ts"],"names":[],"mappings":"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","file":"indexedDBFileSystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Throttler } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtUri } from '../../../base/common/resources.js';\nimport { isString } from '../../../base/common/types.js';\nimport { URI, UriDto } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { createFileSystemProviderError, FileChangeType, IFileDeleteOptions, IFileOverwriteOptions, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileWriteOptions, IFileChange, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../common/files.js';\nimport { IndexedDB } from '../../../base/browser/indexedDB.js';\nimport { BroadcastDataChannel } from '../../../base/browser/broadcast.js';\n\n// Standard FS Errors (expected to be thrown in production when invalid FS operations are requested)\nconst ERR_FILE_NOT_FOUND = createFileSystemProviderError(localize('fileNotExists', \"File does not exist\"), FileSystemProviderErrorCode.FileNotFound);\nconst ERR_FILE_IS_DIR = createFileSystemProviderError(localize('fileIsDirectory', \"File is Directory\"), FileSystemProviderErrorCode.FileIsADirectory);\nconst ERR_FILE_NOT_DIR = createFileSystemProviderError(localize('fileNotDirectory', \"File is not a directory\"), FileSystemProviderErrorCode.FileNotADirectory);\nconst ERR_DIR_NOT_EMPTY = createFileSystemProviderError(localize('dirIsNotEmpty', \"Directory is not empty\"), FileSystemProviderErrorCode.Unknown);\nconst ERR_FILE_EXCEEDS_STORAGE_QUOTA = createFileSystemProviderError(localize('fileExceedsStorageQuota', \"File exceeds available storage quota\"), FileSystemProviderErrorCode.FileExceedsStorageQuota);\n\n// Arbitrary Internal Errors\nconst ERR_UNKNOWN_INTERNAL = (message: string) => createFileSystemProviderError(localize('internal', \"Internal error occurred in IndexedDB File System Provider. ({0})\", message), FileSystemProviderErrorCode.Unknown);\n\ntype DirEntry = [string, FileType];\n\ntype IndexedDBFileSystemEntry =\n\t| {\n\t\tpath: string;\n\t\ttype: FileType.Directory;\n\t\tchildren: Map<string, IndexedDBFileSystemNode>;\n\t}\n\t| {\n\t\tpath: string;\n\t\ttype: FileType.File;\n\t\tsize: number | undefined;\n\t};\n\nclass IndexedDBFileSystemNode {\n\tpublic type: FileType;\n\n\tconstructor(private entry: IndexedDBFileSystemEntry) {\n\t\tthis.type = entry.type;\n\t}\n\n\tread(path: string): IndexedDBFileSystemEntry | undefined {\n\t\treturn this.doRead(path.split('/').filter(p => p.length));\n\t}\n\n\tprivate doRead(pathParts: string[]): IndexedDBFileSystemEntry | undefined {\n\t\tif (pathParts.length === 0) { return this.entry; }\n\t\tif (this.entry.type !== FileType.Directory) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL('Internal error reading from IndexedDBFSNode -- expected directory at ' + this.entry.path);\n\t\t}\n\t\tconst next = this.entry.children.get(pathParts[0]);\n\n\t\tif (!next) { return undefined; }\n\t\treturn next.doRead(pathParts.slice(1));\n\t}\n\n\tdelete(path: string): void {\n\t\tconst toDelete = path.split('/').filter(p => p.length);\n\t\tif (toDelete.length === 0) {\n\t\t\tif (this.entry.type !== FileType.Directory) {\n\t\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error deleting from IndexedDBFSNode. Expected root entry to be directory`);\n\t\t\t}\n\t\t\tthis.entry.children.clear();\n\t\t} else {\n\t\t\treturn this.doDelete(toDelete, path);\n\t\t}\n\t}\n\n\tprivate doDelete(pathParts: string[], originalPath: string): void {\n\t\tif (pathParts.length === 0) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error deleting from IndexedDBFSNode -- got no deletion path parts (encountered while deleting ${originalPath})`);\n\t\t}\n\t\telse if (this.entry.type !== FileType.Directory) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL('Internal error deleting from IndexedDBFSNode -- expected directory at ' + this.entry.path);\n\t\t}\n\t\telse if (pathParts.length === 1) {\n\t\t\tthis.entry.children.delete(pathParts[0]);\n\t\t}\n\t\telse {\n\t\t\tconst next = this.entry.children.get(pathParts[0]);\n\t\t\tif (!next) {\n\t\t\t\tthrow ERR_UNKNOWN_INTERNAL('Internal error deleting from IndexedDBFSNode -- expected entry at ' + this.entry.path + '/' + next);\n\t\t\t}\n\t\t\tnext.doDelete(pathParts.slice(1), originalPath);\n\t\t}\n\t}\n\n\tadd(path: string, entry: { type: 'file'; size?: number } | { type: 'dir' }) {\n\t\tthis.doAdd(path.split('/').filter(p => p.length), entry, path);\n\t}\n\n\tprivate doAdd(pathParts: string[], entry: { type: 'file'; size?: number } | { type: 'dir' }, originalPath: string) {\n\t\tif (pathParts.length === 0) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error creating IndexedDBFSNode -- adding empty path (encountered while adding ${originalPath})`);\n\t\t}\n\t\telse if (this.entry.type !== FileType.Directory) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error creating IndexedDBFSNode -- parent is not a directory (encountered while adding ${originalPath})`);\n\t\t}\n\t\telse if (pathParts.length === 1) {\n\t\t\tconst next = pathParts[0];\n\t\t\tconst existing = this.entry.children.get(next);\n\t\t\tif (entry.type === 'dir') {\n\t\t\t\tif (existing?.entry.type === FileType.File) {\n\t\t\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error creating IndexedDBFSNode -- overwriting file with directory: ${this.entry.path}/${next} (encountered while adding ${originalPath})`);\n\t\t\t\t}\n\t\t\t\tthis.entry.children.set(next, existing ?? new IndexedDBFileSystemNode({\n\t\t\t\t\ttype: FileType.Directory,\n\t\t\t\t\tpath: this.entry.path + '/' + next,\n\t\t\t\t\tchildren: new Map(),\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tif (existing?.entry.type === FileType.Directory) {\n\t\t\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error creating IndexedDBFSNode -- overwriting directory with file: ${this.entry.path}/${next} (encountered while adding ${originalPath})`);\n\t\t\t\t}\n\t\t\t\tthis.entry.children.set(next, new IndexedDBFileSystemNode({\n\t\t\t\t\ttype: FileType.File,\n\t\t\t\t\tpath: this.entry.path + '/' + next,\n\t\t\t\t\tsize: entry.size,\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\telse if (pathParts.length > 1) {\n\t\t\tconst next = pathParts[0];\n\t\t\tlet childNode = this.entry.children.get(next);\n\t\t\tif (!childNode) {\n\t\t\t\tchildNode = new IndexedDBFileSystemNode({\n\t\t\t\t\tchildren: new Map(),\n\t\t\t\t\tpath: this.entry.path + '/' + next,\n\t\t\t\t\ttype: FileType.Directory\n\t\t\t\t});\n\t\t\t\tthis.entry.children.set(next, childNode);\n\t\t\t}\n\t\t\telse if (childNode.type === FileType.File) {\n\t\t\t\tthrow ERR_UNKNOWN_INTERNAL(`Internal error creating IndexedDBFSNode -- overwriting file entry with directory: ${this.entry.path}/${next} (encountered while adding ${originalPath})`);\n\t\t\t}\n\t\t\tchildNode.doAdd(pathParts.slice(1), entry, originalPath);\n\t\t}\n\t}\n\n\tprint(indentation = '') {\n\t\tconsole.log(indentation + this.entry.path);\n\t\tif (this.entry.type === FileType.Directory) {\n\t\t\tthis.entry.children.forEach(child => child.print(indentation + ' '));\n\t\t}\n\t}\n}\n\nexport class IndexedDBFileSystemProvider extends Disposable implements IFileSystemProviderWithFileReadWriteCapability {\n\n\treadonly capabilities: FileSystemProviderCapabilities =\n\t\tFileSystemProviderCapabilities.FileReadWrite\n\t\t| FileSystemProviderCapabilities.PathCaseSensitive;\n\treadonly onDidChangeCapabilities: Event<void> = Event.None;\n\n\tprivate readonly extUri = new ExtUri(() => false) /* Case Sensitive */;\n\n\tprivate readonly changesBroadcastChannel: BroadcastDataChannel<UriDto<IFileChange>[]> | undefined;\n\tprivate readonly _onDidChangeFile = this._register(new Emitter<readonly IFileChange[]>());\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = this._onDidChangeFile.event;\n\n\tprivate readonly mtimes = new Map<string, number>();\n\n\tprivate cachedFiletree: Promise<IndexedDBFileSystemNode> | undefined;\n\tprivate writeManyThrottler: Throttler;\n\n\tconstructor(readonly scheme: string, private indexedDB: IndexedDB, private readonly store: string, watchCrossWindowChanges: boolean) {\n\t\tsuper();\n\t\tthis.writeManyThrottler = new Throttler();\n\n\t\tif (watchCrossWindowChanges) {\n\t\t\tthis.changesBroadcastChannel = this._register(new BroadcastDataChannel<UriDto<IFileChange>[]>(`vscode.indexedDB.${scheme}.changes`));\n\t\t\tthis._register(this.changesBroadcastChannel.onDidReceiveData(changes => {\n\t\t\t\tthis._onDidChangeFile.fire(changes.map(c => ({ type: c.type, resource: URI.revive(c.resource) })));\n\t\t\t}));\n\t\t}\n\t}\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable {\n\t\treturn Disposable.None;\n\t}\n\n\tasync mkdir(resource: URI): Promise<void> {\n\t\ttry {\n\t\t\tconst resourceStat = await this.stat(resource);\n\t\t\tif (resourceStat.type === FileType.File) {\n\t\t\t\tthrow ERR_FILE_NOT_DIR;\n\t\t\t}\n\t\t} catch (error) { /* Ignore */ }\n\t\t(await this.getFiletree()).add(resource.path, { type: 'dir' });\n\t}\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\tconst entry = (await this.getFiletree()).read(resource.path);\n\n\t\tif (entry?.type === FileType.File) {\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tctime: 0,\n\t\t\t\tmtime: this.mtimes.get(resource.toString()) || 0,\n\t\t\t\tsize: entry.size ?? (await this.readFile(resource)).byteLength\n\t\t\t};\n\t\t}\n\n\t\tif (entry?.type === FileType.Directory) {\n\t\t\treturn {\n\t\t\t\ttype: FileType.Directory,\n\t\t\t\tctime: 0,\n\t\t\t\tmtime: 0,\n\t\t\t\tsize: 0\n\t\t\t};\n\t\t}\n\n\t\tthrow ERR_FILE_NOT_FOUND;\n\t}\n\n\tasync readdir(resource: URI): Promise<DirEntry[]> {\n\t\tconst entry = (await this.getFiletree()).read(resource.path);\n\t\tif (!entry) {\n\t\t\t// Dirs aren't saved to disk, so empty dirs will be lost on reload.\n\t\t\t// Thus we have two options for what happens when you try to read a dir and nothing is found:\n\t\t\t// - Throw FileSystemProviderErrorCode.FileNotFound\n\t\t\t// - Return []\n\t\t\t// We choose to return [] as creating a dir then reading it (even after reload) should not throw an error.\n\t\t\treturn [];\n\t\t}\n\t\tif (entry.type !== FileType.Directory) {\n\t\t\tthrow ERR_FILE_NOT_DIR;\n\t\t}\n\t\telse {\n\t\t\treturn [...entry.children.entries()].map(([name, node]) => [name, node.type]);\n\t\t}\n\t}\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst result = await this.indexedDB.runInTransaction(this.store, 'readonly', objectStore => objectStore.get(resource.path));\n\t\tif (result === undefined) {\n\t\t\tthrow ERR_FILE_NOT_FOUND;\n\t\t}\n\t\tconst buffer = result instanceof Uint8Array ? result : isString(result) ? VSBuffer.fromString(result).buffer : undefined;\n\t\tif (buffer === undefined) {\n\t\t\tthrow ERR_UNKNOWN_INTERNAL(`IndexedDB entry at \"${resource.path}\" in unexpected format`);\n\t\t}\n\n\t\t// update cache\n\t\tconst fileTree = await this.getFiletree();\n\t\tfileTree.add(resource.path, { type: 'file', size: buffer.byteLength });\n\n\t\treturn buffer;\n\t}\n\n\tasync writeFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\tconst existing = await this.stat(resource).catch(() => undefined);\n\t\tif (existing?.type === FileType.Directory) {\n\t\t\tthrow ERR_FILE_IS_DIR;\n\t\t}\n\t\tawait this.bulkWrite([[resource, content]]);\n\t}\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\tconst fileTree = await this.getFiletree();\n\t\tconst fromEntry = fileTree.read(from.path);\n\t\tif (!fromEntry) {\n\t\t\tthrow ERR_FILE_NOT_FOUND;\n\t\t}\n\n\t\tconst toEntry = fileTree.read(to.path);\n\t\tif (toEntry) {\n\t\t\tif (!opts.overwrite) {\n\t\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t\t}\n\t\t\tif (toEntry.type !== fromEntry.type) {\n\t\t\t\tthrow createFileSystemProviderError('Cannot rename files with different types', FileSystemProviderErrorCode.Unknown);\n\t\t\t}\n\t\t\t// delete the target file if exists\n\t\t\tawait this.delete(to, { recursive: true, useTrash: false, atomic: false });\n\t\t}\n\n\t\tconst toTargetResource = (path: string): URI => this.extUri.joinPath(to, this.extUri.relativePath(from, from.with({ path })) || '');\n\n\t\tconst sourceEntries = await this.tree(from);\n\t\tconst sourceFiles: DirEntry[] = [];\n\t\tfor (const sourceEntry of sourceEntries) {\n\t\t\tif (sourceEntry[1] === FileType.File) {\n\t\t\t\tsourceFiles.push(sourceEntry);\n\t\t\t} else if (sourceEntry[1] === FileType.Directory) {\n\t\t\t\t// add directories to the tree\n\t\t\t\tfileTree.add(toTargetResource(sourceEntry[0]).path, { type: 'dir' });\n\t\t\t}\n\t\t}\n\n\t\tif (sourceFiles.length) {\n\t\t\tconst targetFiles: [URI, Uint8Array][] = [];\n\t\t\tconst sourceFilesContents = await this.indexedDB.runInTransaction(this.store, 'readonly', objectStore => sourceFiles.map(([path]) => objectStore.get(path)));\n\t\t\tfor (let index = 0; index < sourceFiles.length; index++) {\n\t\t\t\tconst content = sourceFilesContents[index] instanceof Uint8Array ? sourceFilesContents[index] : isString(sourceFilesContents[index]) ? VSBuffer.fromString(sourceFilesContents[index]).buffer : undefined;\n\t\t\t\tif (content) {\n\t\t\t\t\ttargetFiles.push([toTargetResource(sourceFiles[index][0]), content]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this.bulkWrite(targetFiles);\n\t\t}\n\n\t\tawait this.delete(from, { recursive: true, useTrash: false, atomic: false });\n\t}\n\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\tlet stat: IStat;\n\t\ttry {\n\t\t\tstat = await this.stat(resource);\n\t\t} catch (e) {\n\t\t\tif (e.code === FileSystemProviderErrorCode.FileNotFound) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\n\t\tlet toDelete: string[];\n\t\tif (opts.recursive) {\n\t\t\tconst tree = await this.tree(resource);\n\t\t\ttoDelete = tree.map(([path]) => path);\n\t\t} else {\n\t\t\tif (stat.type === FileType.Directory && (await this.readdir(resource)).length) {\n\t\t\t\tthrow ERR_DIR_NOT_EMPTY;\n\t\t\t}\n\t\t\ttoDelete = [resource.path];\n\t\t}\n\t\tawait this.deleteKeys(toDelete);\n\t\t(await this.getFiletree()).delete(resource.path);\n\t\ttoDelete.forEach(key => this.mtimes.delete(key));\n\t\tthis.triggerChanges(toDelete.map(path => ({ resource: resource.with({ path }), type: FileChangeType.DELETED })));\n\t}\n\n\tprivate async tree(resource: URI): Promise<DirEntry[]> {\n\t\tconst stat = await this.stat(resource);\n\t\tconst allEntries: DirEntry[] = [[resource.path, stat.type]];\n\t\tif (stat.type === FileType.Directory) {\n\t\t\tconst dirEntries = await this.readdir(resource);\n\t\t\tfor (const [key, type] of dirEntries) {\n\t\t\t\tconst childResource = this.extUri.joinPath(resource, key);\n\t\t\t\tallEntries.push([childResource.path, type]);\n\t\t\t\tif (type === FileType.Directory) {\n\t\t\t\t\tconst childEntries = await this.tree(childResource);\n\t\t\t\t\tallEntries.push(...childEntries);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn allEntries;\n\t}\n\n\tprivate triggerChanges(changes: IFileChange[]): void {\n\t\tif (changes.length) {\n\t\t\tthis._onDidChangeFile.fire(changes);\n\n\t\t\tthis.changesBroadcastChannel?.postData(changes);\n\t\t}\n\t}\n\n\tprivate getFiletree(): Promise<IndexedDBFileSystemNode> {\n\t\tif (!this.cachedFiletree) {\n\t\t\tthis.cachedFiletree = (async () => {\n\t\t\t\tconst rootNode = new IndexedDBFileSystemNode({\n\t\t\t\t\tchildren: new Map(),\n\t\t\t\t\tpath: '',\n\t\t\t\t\ttype: FileType.Directory\n\t\t\t\t});\n\t\t\t\tconst result = await this.indexedDB.runInTransaction(this.store, 'readonly', objectStore => objectStore.getAllKeys());\n\t\t\t\tconst keys = result.map(key => key.toString());\n\t\t\t\tkeys.forEach(key => rootNode.add(key, { type: 'file' }));\n\t\t\t\treturn rootNode;\n\t\t\t})();\n\t\t}\n\t\treturn this.cachedFiletree;\n\t}\n\n\tprivate async bulkWrite(files: [URI, Uint8Array][]): Promise<void> {\n\t\tfiles.forEach(([resource, content]) => this.fileWriteBatch.push({ content, resource }));\n\t\tawait this.writeManyThrottler.queue(() => this.writeMany());\n\n\t\tconst fileTree = await this.getFiletree();\n\t\tfor (const [resource, content] of files) {\n\t\t\tfileTree.add(resource.path, { type: 'file', size: content.byteLength });\n\t\t\tthis.mtimes.set(resource.toString(), Date.now());\n\t\t}\n\n\t\tthis.triggerChanges(files.map(([resource]) => ({ resource, type: FileChangeType.UPDATED })));\n\t}\n\n\tprivate fileWriteBatch: { resource: URI; content: Uint8Array }[] = [];\n\tprivate async writeMany() {\n\t\tif (this.fileWriteBatch.length) {\n\t\t\tconst fileBatch = this.fileWriteBatch.splice(0, this.fileWriteBatch.length);\n\t\t\ttry {\n\t\t\t\tawait this.indexedDB.runInTransaction(this.store, 'readwrite', objectStore => fileBatch.map(entry => {\n\t\t\t\t\treturn objectStore.put(entry.content, entry.resource.path);\n\t\t\t\t}));\n\t\t\t} catch (ex) {\n\t\t\t\tif (ex instanceof DOMException && ex.name === 'QuotaExceededError') {\n\t\t\t\t\tthrow ERR_FILE_EXCEEDS_STORAGE_QUOTA;\n\t\t\t\t}\n\n\t\t\t\tthrow ex;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async deleteKeys(keys: string[]): Promise<void> {\n\t\tif (keys.length) {\n\t\t\tawait this.indexedDB.runInTransaction(this.store, 'readwrite', objectStore => keys.map(key => objectStore.delete(key)));\n\t\t}\n\t}\n\n\tasync reset(): Promise<void> {\n\t\tawait this.indexedDB.runInTransaction(this.store, 'readwrite', objectStore => objectStore.clear());\n\t}\n\n}\n"]}