{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/files/common/inMemoryFilesystemProvider.ts","vs/platform/files/common/inMemoryFilesystemProvider.ts"],"names":[],"mappings":"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","file":"inMemoryFilesystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport * as resources from '../../../base/common/resources.js';\nimport { ReadableStreamEvents, newWriteableStream } from '../../../base/common/stream.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { FileChangeType, IFileDeleteOptions, IFileOverwriteOptions, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileWriteOptions, IFileChange, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions, createFileSystemProviderError, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileOpenOptions, IFileSystemProviderWithFileAtomicDeleteCapability, IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileSystemProviderWithFileReadStreamCapability } from './files.js';\n\nclass File implements IStat {\n\n\treadonly type: FileType.File;\n\treadonly ctime: number;\n\tmtime: number;\n\tsize: number;\n\n\tname: string;\n\tdata?: Uint8Array;\n\n\tconstructor(name: string) {\n\t\tthis.type = FileType.File;\n\t\tthis.ctime = Date.now();\n\t\tthis.mtime = Date.now();\n\t\tthis.size = 0;\n\t\tthis.name = name;\n\t}\n}\n\nclass Directory implements IStat {\n\n\treadonly type: FileType.Directory;\n\treadonly ctime: number;\n\tmtime: number;\n\tsize: number;\n\n\tname: string;\n\treadonly entries: Map<string, File | Directory>;\n\n\tconstructor(name: string) {\n\t\tthis.type = FileType.Directory;\n\t\tthis.ctime = Date.now();\n\t\tthis.mtime = Date.now();\n\t\tthis.size = 0;\n\t\tthis.name = name;\n\t\tthis.entries = new Map();\n\t}\n}\n\ntype Entry = File | Directory;\n\nexport class InMemoryFileSystemProvider extends Disposable implements\n\tIFileSystemProviderWithFileReadWriteCapability,\n\tIFileSystemProviderWithOpenReadWriteCloseCapability,\n\tIFileSystemProviderWithFileReadStreamCapability,\n\tIFileSystemProviderWithFileAtomicReadCapability,\n\tIFileSystemProviderWithFileAtomicWriteCapability,\n\tIFileSystemProviderWithFileAtomicDeleteCapability {\n\n\tprivate memoryFdCounter = 0;\n\tprivate readonly fdMemory = new Map<number, Uint8Array>();\n\tprivate _onDidChangeCapabilities = this._register(new Emitter<void>());\n\treadonly onDidChangeCapabilities = this._onDidChangeCapabilities.event;\n\n\tprivate _capabilities = FileSystemProviderCapabilities.FileReadWrite | FileSystemProviderCapabilities.PathCaseSensitive;\n\tget capabilities(): FileSystemProviderCapabilities { return this._capabilities; }\n\n\tsetReadOnly(readonly: boolean) {\n\t\tconst isReadonly = !!(this._capabilities & FileSystemProviderCapabilities.Readonly);\n\t\tif (readonly !== isReadonly) {\n\t\t\tthis._capabilities = readonly ? FileSystemProviderCapabilities.Readonly | FileSystemProviderCapabilities.PathCaseSensitive | FileSystemProviderCapabilities.FileReadWrite\n\t\t\t\t: FileSystemProviderCapabilities.FileReadWrite | FileSystemProviderCapabilities.PathCaseSensitive;\n\t\t\tthis._onDidChangeCapabilities.fire();\n\t\t}\n\t}\n\n\troot = new Directory('');\n\n\t// --- manage file metadata\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\treturn this._lookup(resource, false);\n\t}\n\n\tasync readdir(resource: URI): Promise<[string, FileType][]> {\n\t\tconst entry = this._lookupAsDirectory(resource, false);\n\t\tconst result: [string, FileType][] = [];\n\t\tentry.entries.forEach((child, name) => result.push([name, child.type]));\n\t\treturn result;\n\t}\n\n\t// --- manage file contents\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\t\tif (data) {\n\t\t\treturn data;\n\t\t}\n\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t}\n\n\treadFileStream(resource: URI): ReadableStreamEvents<Uint8Array> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\n\t\tconst stream = newWriteableStream<Uint8Array>(data => VSBuffer.concat(data.map(data => VSBuffer.wrap(data))).buffer);\n\t\tstream.end(data);\n\n\t\treturn stream;\n\t}\n\n\tasync writeFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\tconst basename = resources.basename(resource);\n\t\tconst parent = this._lookupParentDirectory(resource);\n\t\tlet entry = parent.entries.get(basename);\n\t\tif (entry instanceof Directory) {\n\t\t\tthrow createFileSystemProviderError('file is directory', FileSystemProviderErrorCode.FileIsADirectory);\n\t\t}\n\t\tif (!entry && !opts.create) {\n\t\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t\t}\n\t\tif (entry && opts.create && !opts.overwrite) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\t\tif (!entry) {\n\t\t\tentry = new File(basename);\n\t\t\tparent.entries.set(basename, entry);\n\t\t\tthis._fireSoon({ type: FileChangeType.ADDED, resource });\n\t\t}\n\t\tentry.mtime = Date.now();\n\t\tentry.size = content.byteLength;\n\t\tentry.data = content;\n\n\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource });\n\t}\n\n\t// file open/read/write/close\n\topen(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\t\tif (data) {\n\t\t\tconst fd = this.memoryFdCounter++;\n\t\t\tthis.fdMemory.set(fd, data);\n\t\t\treturn Promise.resolve(fd);\n\t\t}\n\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t}\n\n\tclose(fd: number): Promise<void> {\n\t\tthis.fdMemory.delete(fd);\n\t\treturn Promise.resolve();\n\t}\n\n\tread(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst memory = this.fdMemory.get(fd);\n\t\tif (!memory) {\n\t\t\tthrow createFileSystemProviderError(`No file with that descriptor open`, FileSystemProviderErrorCode.Unavailable);\n\t\t}\n\n\t\tconst toWrite = VSBuffer.wrap(memory).slice(pos, pos + length);\n\t\tdata.set(toWrite.buffer, offset);\n\t\treturn Promise.resolve(toWrite.byteLength);\n\t}\n\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst memory = this.fdMemory.get(fd);\n\t\tif (!memory) {\n\t\t\tthrow createFileSystemProviderError(`No file with that descriptor open`, FileSystemProviderErrorCode.Unavailable);\n\t\t}\n\n\t\tconst toWrite = VSBuffer.wrap(data).slice(offset, offset + length);\n\t\tmemory.set(toWrite.buffer, pos);\n\t\treturn Promise.resolve(toWrite.byteLength);\n\t}\n\n\t// --- manage files/folders\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\tif (!opts.overwrite && this._lookup(to, true)) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\n\t\tconst entry = this._lookup(from, false);\n\t\tconst oldParent = this._lookupParentDirectory(from);\n\n\t\tconst newParent = this._lookupParentDirectory(to);\n\t\tconst newName = resources.basename(to);\n\n\t\toldParent.entries.delete(entry.name);\n\t\tentry.name = newName;\n\t\tnewParent.entries.set(newName, entry);\n\n\t\tthis._fireSoon(\n\t\t\t{ type: FileChangeType.DELETED, resource: from },\n\t\t\t{ type: FileChangeType.ADDED, resource: to }\n\t\t);\n\t}\n\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\tconst dirname = resources.dirname(resource);\n\t\tconst basename = resources.basename(resource);\n\t\tconst parent = this._lookupAsDirectory(dirname, false);\n\t\tif (parent.entries.has(basename)) {\n\t\t\tparent.entries.delete(basename);\n\t\t\tparent.mtime = Date.now();\n\t\t\tparent.size -= 1;\n\t\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource: dirname }, { resource, type: FileChangeType.DELETED });\n\t\t}\n\t}\n\n\tasync mkdir(resource: URI): Promise<void> {\n\t\tif (this._lookup(resource, true)) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\n\t\tconst basename = resources.basename(resource);\n\t\tconst dirname = resources.dirname(resource);\n\t\tconst parent = this._lookupAsDirectory(dirname, false);\n\n\t\tconst entry = new Directory(basename);\n\t\tparent.entries.set(entry.name, entry);\n\t\tparent.mtime = Date.now();\n\t\tparent.size += 1;\n\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource: dirname }, { type: FileChangeType.ADDED, resource });\n\t}\n\n\t// --- lookup\n\n\tprivate _lookup(uri: URI, silent: false): Entry;\n\tprivate _lookup(uri: URI, silent: boolean): Entry | undefined;\n\tprivate _lookup(uri: URI, silent: boolean): Entry | undefined {\n\t\tconst parts = uri.path.split('/');\n\t\tlet entry: Entry = this.root;\n\t\tfor (const part of parts) {\n\t\t\tif (!part) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet child: Entry | undefined;\n\t\t\tif (entry instanceof Directory) {\n\t\t\t\tchild = entry.entries.get(part);\n\t\t\t}\n\t\t\tif (!child) {\n\t\t\t\tif (!silent) {\n\t\t\t\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t\tentry = child;\n\t\t}\n\t\treturn entry;\n\t}\n\n\tprivate _lookupAsDirectory(uri: URI, silent: boolean): Directory {\n\t\tconst entry = this._lookup(uri, silent);\n\t\tif (entry instanceof Directory) {\n\t\t\treturn entry;\n\t\t}\n\t\tthrow createFileSystemProviderError('file not a directory', FileSystemProviderErrorCode.FileNotADirectory);\n\t}\n\n\tprivate _lookupAsFile(uri: URI, silent: boolean): File {\n\t\tconst entry = this._lookup(uri, silent);\n\t\tif (entry instanceof File) {\n\t\t\treturn entry;\n\t\t}\n\t\tthrow createFileSystemProviderError('file is a directory', FileSystemProviderErrorCode.FileIsADirectory);\n\t}\n\n\tprivate _lookupParentDirectory(uri: URI): Directory {\n\t\tconst dirname = resources.dirname(uri);\n\t\treturn this._lookupAsDirectory(dirname, false);\n\t}\n\n\t// --- manage file events\n\n\tprivate readonly _onDidChangeFile = this._register(new Emitter<readonly IFileChange[]>());\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = this._onDidChangeFile.event;\n\n\tprivate _bufferedChanges: IFileChange[] = [];\n\tprivate _fireSoonHandle?: Timeout;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable {\n\t\t// ignore, fires for all changes...\n\t\treturn Disposable.None;\n\t}\n\n\tprivate _fireSoon(...changes: IFileChange[]): void {\n\t\tthis._bufferedChanges.push(...changes);\n\n\t\tif (this._fireSoonHandle) {\n\t\t\tclearTimeout(this._fireSoonHandle);\n\t\t}\n\n\t\tthis._fireSoonHandle = setTimeout(() => {\n\t\t\tthis._onDidChangeFile.fire(this._bufferedChanges);\n\t\t\tthis._bufferedChanges.length = 0;\n\t\t}, 5);\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis.fdMemory.clear();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport * as resources from '../../../base/common/resources.js';\nimport { ReadableStreamEvents, newWriteableStream } from '../../../base/common/stream.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { FileChangeType, IFileDeleteOptions, IFileOverwriteOptions, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileWriteOptions, IFileChange, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions, createFileSystemProviderError, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileOpenOptions, IFileSystemProviderWithFileAtomicDeleteCapability, IFileSystemProviderWithFileAtomicReadCapability, IFileSystemProviderWithFileAtomicWriteCapability, IFileSystemProviderWithFileReadStreamCapability } from './files.js';\n\nclass File implements IStat {\n\n\treadonly type: FileType.File;\n\treadonly ctime: number;\n\tmtime: number;\n\tsize: number;\n\n\tname: string;\n\tdata?: Uint8Array;\n\n\tconstructor(name: string) {\n\t\tthis.type = FileType.File;\n\t\tthis.ctime = Date.now();\n\t\tthis.mtime = Date.now();\n\t\tthis.size = 0;\n\t\tthis.name = name;\n\t}\n}\n\nclass Directory implements IStat {\n\n\treadonly type: FileType.Directory;\n\treadonly ctime: number;\n\tmtime: number;\n\tsize: number;\n\n\tname: string;\n\treadonly entries: Map<string, File | Directory>;\n\n\tconstructor(name: string) {\n\t\tthis.type = FileType.Directory;\n\t\tthis.ctime = Date.now();\n\t\tthis.mtime = Date.now();\n\t\tthis.size = 0;\n\t\tthis.name = name;\n\t\tthis.entries = new Map();\n\t}\n}\n\ntype Entry = File | Directory;\n\nexport class InMemoryFileSystemProvider extends Disposable implements\n\tIFileSystemProviderWithFileReadWriteCapability,\n\tIFileSystemProviderWithOpenReadWriteCloseCapability,\n\tIFileSystemProviderWithFileReadStreamCapability,\n\tIFileSystemProviderWithFileAtomicReadCapability,\n\tIFileSystemProviderWithFileAtomicWriteCapability,\n\tIFileSystemProviderWithFileAtomicDeleteCapability {\n\n\tprivate memoryFdCounter = 0;\n\tprivate readonly fdMemory = new Map<number, Uint8Array>();\n\tprivate _onDidChangeCapabilities = this._register(new Emitter<void>());\n\treadonly onDidChangeCapabilities = this._onDidChangeCapabilities.event;\n\n\tprivate _capabilities = FileSystemProviderCapabilities.FileReadWrite | FileSystemProviderCapabilities.PathCaseSensitive;\n\tget capabilities(): FileSystemProviderCapabilities { return this._capabilities; }\n\n\tsetReadOnly(readonly: boolean) {\n\t\tconst isReadonly = !!(this._capabilities & FileSystemProviderCapabilities.Readonly);\n\t\tif (readonly !== isReadonly) {\n\t\t\tthis._capabilities = readonly ? FileSystemProviderCapabilities.Readonly | FileSystemProviderCapabilities.PathCaseSensitive | FileSystemProviderCapabilities.FileReadWrite\n\t\t\t\t: FileSystemProviderCapabilities.FileReadWrite | FileSystemProviderCapabilities.PathCaseSensitive;\n\t\t\tthis._onDidChangeCapabilities.fire();\n\t\t}\n\t}\n\n\troot = new Directory('');\n\n\t// --- manage file metadata\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\treturn this._lookup(resource, false);\n\t}\n\n\tasync readdir(resource: URI): Promise<[string, FileType][]> {\n\t\tconst entry = this._lookupAsDirectory(resource, false);\n\t\tconst result: [string, FileType][] = [];\n\t\tentry.entries.forEach((child, name) => result.push([name, child.type]));\n\t\treturn result;\n\t}\n\n\t// --- manage file contents\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\t\tif (data) {\n\t\t\treturn data;\n\t\t}\n\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t}\n\n\treadFileStream(resource: URI): ReadableStreamEvents<Uint8Array> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\n\t\tconst stream = newWriteableStream<Uint8Array>(data => VSBuffer.concat(data.map(data => VSBuffer.wrap(data))).buffer);\n\t\tstream.end(data);\n\n\t\treturn stream;\n\t}\n\n\tasync writeFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\tconst basename = resources.basename(resource);\n\t\tconst parent = this._lookupParentDirectory(resource);\n\t\tlet entry = parent.entries.get(basename);\n\t\tif (entry instanceof Directory) {\n\t\t\tthrow createFileSystemProviderError('file is directory', FileSystemProviderErrorCode.FileIsADirectory);\n\t\t}\n\t\tif (!entry && !opts.create) {\n\t\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t\t}\n\t\tif (entry && opts.create && !opts.overwrite) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\t\tif (!entry) {\n\t\t\tentry = new File(basename);\n\t\t\tparent.entries.set(basename, entry);\n\t\t\tthis._fireSoon({ type: FileChangeType.ADDED, resource });\n\t\t}\n\t\tentry.mtime = Date.now();\n\t\tentry.size = content.byteLength;\n\t\tentry.data = content;\n\n\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource });\n\t}\n\n\t// file open/read/write/close\n\topen(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\tconst data = this._lookupAsFile(resource, false).data;\n\t\tif (data) {\n\t\t\tconst fd = this.memoryFdCounter++;\n\t\t\tthis.fdMemory.set(fd, data);\n\t\t\treturn Promise.resolve(fd);\n\t\t}\n\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t}\n\n\tclose(fd: number): Promise<void> {\n\t\tthis.fdMemory.delete(fd);\n\t\treturn Promise.resolve();\n\t}\n\n\tread(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst memory = this.fdMemory.get(fd);\n\t\tif (!memory) {\n\t\t\tthrow createFileSystemProviderError(`No file with that descriptor open`, FileSystemProviderErrorCode.Unavailable);\n\t\t}\n\n\t\tconst toWrite = VSBuffer.wrap(memory).slice(pos, pos + length);\n\t\tdata.set(toWrite.buffer, offset);\n\t\treturn Promise.resolve(toWrite.byteLength);\n\t}\n\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst memory = this.fdMemory.get(fd);\n\t\tif (!memory) {\n\t\t\tthrow createFileSystemProviderError(`No file with that descriptor open`, FileSystemProviderErrorCode.Unavailable);\n\t\t}\n\n\t\tconst toWrite = VSBuffer.wrap(data).slice(offset, offset + length);\n\t\tmemory.set(toWrite.buffer, pos);\n\t\treturn Promise.resolve(toWrite.byteLength);\n\t}\n\n\t// --- manage files/folders\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\tif (!opts.overwrite && this._lookup(to, true)) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\n\t\tconst entry = this._lookup(from, false);\n\t\tconst oldParent = this._lookupParentDirectory(from);\n\n\t\tconst newParent = this._lookupParentDirectory(to);\n\t\tconst newName = resources.basename(to);\n\n\t\toldParent.entries.delete(entry.name);\n\t\tentry.name = newName;\n\t\tnewParent.entries.set(newName, entry);\n\n\t\tthis._fireSoon(\n\t\t\t{ type: FileChangeType.DELETED, resource: from },\n\t\t\t{ type: FileChangeType.ADDED, resource: to }\n\t\t);\n\t}\n\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\tconst dirname = resources.dirname(resource);\n\t\tconst basename = resources.basename(resource);\n\t\tconst parent = this._lookupAsDirectory(dirname, false);\n\t\tif (parent.entries.has(basename)) {\n\t\t\tparent.entries.delete(basename);\n\t\t\tparent.mtime = Date.now();\n\t\t\tparent.size -= 1;\n\t\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource: dirname }, { resource, type: FileChangeType.DELETED });\n\t\t}\n\t}\n\n\tasync mkdir(resource: URI): Promise<void> {\n\t\tif (this._lookup(resource, true)) {\n\t\t\tthrow createFileSystemProviderError('file exists already', FileSystemProviderErrorCode.FileExists);\n\t\t}\n\n\t\tconst basename = resources.basename(resource);\n\t\tconst dirname = resources.dirname(resource);\n\t\tconst parent = this._lookupAsDirectory(dirname, false);\n\n\t\tconst entry = new Directory(basename);\n\t\tparent.entries.set(entry.name, entry);\n\t\tparent.mtime = Date.now();\n\t\tparent.size += 1;\n\t\tthis._fireSoon({ type: FileChangeType.UPDATED, resource: dirname }, { type: FileChangeType.ADDED, resource });\n\t}\n\n\t// --- lookup\n\n\tprivate _lookup(uri: URI, silent: false): Entry;\n\tprivate _lookup(uri: URI, silent: boolean): Entry | undefined;\n\tprivate _lookup(uri: URI, silent: boolean): Entry | undefined {\n\t\tconst parts = uri.path.split('/');\n\t\tlet entry: Entry = this.root;\n\t\tfor (const part of parts) {\n\t\t\tif (!part) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet child: Entry | undefined;\n\t\t\tif (entry instanceof Directory) {\n\t\t\t\tchild = entry.entries.get(part);\n\t\t\t}\n\t\t\tif (!child) {\n\t\t\t\tif (!silent) {\n\t\t\t\t\tthrow createFileSystemProviderError('file not found', FileSystemProviderErrorCode.FileNotFound);\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t\tentry = child;\n\t\t}\n\t\treturn entry;\n\t}\n\n\tprivate _lookupAsDirectory(uri: URI, silent: boolean): Directory {\n\t\tconst entry = this._lookup(uri, silent);\n\t\tif (entry instanceof Directory) {\n\t\t\treturn entry;\n\t\t}\n\t\tthrow createFileSystemProviderError('file not a directory', FileSystemProviderErrorCode.FileNotADirectory);\n\t}\n\n\tprivate _lookupAsFile(uri: URI, silent: boolean): File {\n\t\tconst entry = this._lookup(uri, silent);\n\t\tif (entry instanceof File) {\n\t\t\treturn entry;\n\t\t}\n\t\tthrow createFileSystemProviderError('file is a directory', FileSystemProviderErrorCode.FileIsADirectory);\n\t}\n\n\tprivate _lookupParentDirectory(uri: URI): Directory {\n\t\tconst dirname = resources.dirname(uri);\n\t\treturn this._lookupAsDirectory(dirname, false);\n\t}\n\n\t// --- manage file events\n\n\tprivate readonly _onDidChangeFile = this._register(new Emitter<readonly IFileChange[]>());\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = this._onDidChangeFile.event;\n\n\tprivate _bufferedChanges: IFileChange[] = [];\n\tprivate _fireSoonHandle?: Timeout;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable {\n\t\t// ignore, fires for all changes...\n\t\treturn Disposable.None;\n\t}\n\n\tprivate _fireSoon(...changes: IFileChange[]): void {\n\t\tthis._bufferedChanges.push(...changes);\n\n\t\tif (this._fireSoonHandle) {\n\t\t\tclearTimeout(this._fireSoonHandle);\n\t\t}\n\n\t\tthis._fireSoonHandle = setTimeout(() => {\n\t\t\tthis._onDidChangeFile.fire(this._bufferedChanges);\n\t\t\tthis._bufferedChanges.length = 0;\n\t\t}, 5);\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis.fdMemory.clear();\n\t}\n}\n"]}