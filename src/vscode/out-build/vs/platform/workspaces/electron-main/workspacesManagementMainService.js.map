{"version":3,"sources":["vs/platform/workspaces/electron-main/workspacesManagementMainService.ts"],"names":[],"mappings":"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","file":"workspacesManagementMainService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport electron from 'electron';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { parse } from '../../../base/common/json.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { dirname, join } from '../../../base/common/path.js';\nimport { basename, extUriBiasedIgnorePathCase, joinPath, originalFSPath } from '../../../base/common/resources.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Promises } from '../../../base/node/pfs.js';\nimport { localize } from '../../../nls.js';\nimport { IBackupMainService } from '../../backup/electron-main/backup.js';\nimport { IDialogMainService } from '../../dialogs/electron-main/dialogMainService.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUserDataProfilesMainService } from '../../userDataProfile/electron-main/userDataProfile.js';\nimport { ICodeWindow } from '../../window/electron-main/window.js';\nimport { findWindowOnWorkspaceOrFolder } from '../../windows/electron-main/windowsFinder.js';\nimport { isWorkspaceIdentifier, IWorkspaceIdentifier, IResolvedWorkspace, hasWorkspaceFileExtension, UNTITLED_WORKSPACE_NAME, isUntitledWorkspace } from '../../workspace/common/workspace.js';\nimport { getStoredWorkspaceFolder, IEnterWorkspaceResult, isStoredWorkspaceFolder, IStoredWorkspace, IStoredWorkspaceFolder, IUntitledWorkspaceInfo, IWorkspaceFolderCreationData, toWorkspaceFolders } from '../common/workspaces.js';\nimport { getWorkspaceIdentifier } from '../node/workspaces.js';\n\nexport const IWorkspacesManagementMainService = createDecorator<IWorkspacesManagementMainService>('workspacesManagementMainService');\n\nexport interface IWorkspaceEnteredEvent {\n\treadonly window: ICodeWindow;\n\treadonly workspace: IWorkspaceIdentifier;\n}\n\nexport interface IWorkspacesManagementMainService {\n\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidDeleteUntitledWorkspace: Event<IWorkspaceIdentifier>;\n\treadonly onDidEnterWorkspace: Event<IWorkspaceEnteredEvent>;\n\n\tenterWorkspace(intoWindow: ICodeWindow, openedWindows: ICodeWindow[], path: URI): Promise<IEnterWorkspaceResult | undefined>;\n\n\tcreateUntitledWorkspace(folders?: IWorkspaceFolderCreationData[], remoteAuthority?: string): Promise<IWorkspaceIdentifier>;\n\n\tdeleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void>;\n\n\tgetUntitledWorkspaces(): IUntitledWorkspaceInfo[];\n\tisUntitledWorkspace(workspace: IWorkspaceIdentifier): boolean;\n\n\tresolveLocalWorkspace(path: URI): Promise<IResolvedWorkspace | undefined>;\n\n\tgetWorkspaceIdentifier(workspacePath: URI): Promise<IWorkspaceIdentifier>;\n}\n\nexport class WorkspacesManagementMainService extends Disposable implements IWorkspacesManagementMainService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidDeleteUntitledWorkspace = this._register(new Emitter<IWorkspaceIdentifier>());\n\treadonly onDidDeleteUntitledWorkspace: Event<IWorkspaceIdentifier> = this._onDidDeleteUntitledWorkspace.event;\n\n\tprivate readonly _onDidEnterWorkspace = this._register(new Emitter<IWorkspaceEnteredEvent>());\n\treadonly onDidEnterWorkspace: Event<IWorkspaceEnteredEvent> = this._onDidEnterWorkspace.event;\n\n\tprivate readonly untitledWorkspacesHome: URI; // local URI that contains all untitled workspaces\n\n\tprivate untitledWorkspaces: IUntitledWorkspaceInfo[] = [];\n\n\tconstructor(\n\t\t@IEnvironmentMainService private readonly environmentMainService: IEnvironmentMainService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesMainService: IUserDataProfilesMainService,\n\t\t@IBackupMainService private readonly backupMainService: IBackupMainService,\n\t\t@IDialogMainService private readonly dialogMainService: IDialogMainService\n\t) {\n\t\tsuper();\n\n\t\tthis.untitledWorkspacesHome = this.environmentMainService.untitledWorkspacesHome;\n\t}\n\n\tasync initialize(): Promise<void> {\n\n\t\t// Reset\n\t\tthis.untitledWorkspaces = [];\n\n\t\t// Resolve untitled workspaces\n\t\ttry {\n\t\t\tconst untitledWorkspacePaths = (await Promises.readdir(this.untitledWorkspacesHome.with({ scheme: Schemas.file }).fsPath)).map(folder => joinPath(this.untitledWorkspacesHome, folder, UNTITLED_WORKSPACE_NAME));\n\t\t\tfor (const untitledWorkspacePath of untitledWorkspacePaths) {\n\t\t\t\tconst workspace = getWorkspaceIdentifier(untitledWorkspacePath);\n\t\t\t\tconst resolvedWorkspace = await this.resolveLocalWorkspace(untitledWorkspacePath);\n\t\t\t\tif (!resolvedWorkspace) {\n\t\t\t\t\tawait this.deleteUntitledWorkspace(workspace);\n\t\t\t\t} else {\n\t\t\t\t\tthis.untitledWorkspaces.push({ workspace, remoteAuthority: resolvedWorkspace.remoteAuthority });\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (error.code !== 'ENOENT') {\n\t\t\t\tthis.logService.warn(`Unable to read folders in ${this.untitledWorkspacesHome} (${error}).`);\n\t\t\t}\n\t\t}\n\t}\n\n\tresolveLocalWorkspace(uri: URI): Promise<IResolvedWorkspace | undefined> {\n\t\treturn this.doResolveLocalWorkspace(uri, path => fs.promises.readFile(path, 'utf8'));\n\t}\n\n\tprivate doResolveLocalWorkspace(uri: URI, contentsFn: (path: string) => string): IResolvedWorkspace | undefined;\n\tprivate doResolveLocalWorkspace(uri: URI, contentsFn: (path: string) => Promise<string>): Promise<IResolvedWorkspace | undefined>;\n\tprivate doResolveLocalWorkspace(uri: URI, contentsFn: (path: string) => string | Promise<string>): IResolvedWorkspace | undefined | Promise<IResolvedWorkspace | undefined> {\n\t\tif (!this.isWorkspacePath(uri)) {\n\t\t\treturn undefined; // does not look like a valid workspace config file\n\t\t}\n\n\t\tif (uri.scheme !== Schemas.file) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\tconst contents = contentsFn(uri.fsPath);\n\t\t\tif (contents instanceof Promise) {\n\t\t\t\treturn contents.then(value => this.doResolveWorkspace(uri, value), error => undefined /* invalid workspace */);\n\t\t\t} else {\n\t\t\t\treturn this.doResolveWorkspace(uri, contents);\n\t\t\t}\n\t\t} catch {\n\t\t\treturn undefined; // invalid workspace\n\t\t}\n\t}\n\n\tprivate isWorkspacePath(uri: URI): boolean {\n\t\treturn isUntitledWorkspace(uri, this.environmentMainService) || hasWorkspaceFileExtension(uri);\n\t}\n\n\tprivate doResolveWorkspace(path: URI, contents: string): IResolvedWorkspace | undefined {\n\t\ttry {\n\t\t\tconst workspace = this.doParseStoredWorkspace(path, contents);\n\t\t\tconst workspaceIdentifier = getWorkspaceIdentifier(path);\n\t\t\treturn {\n\t\t\t\tid: workspaceIdentifier.id,\n\t\t\t\tconfigPath: workspaceIdentifier.configPath,\n\t\t\t\tfolders: toWorkspaceFolders(workspace.folders, workspaceIdentifier.configPath, extUriBiasedIgnorePathCase),\n\t\t\t\tremoteAuthority: workspace.remoteAuthority,\n\t\t\t\ttransient: workspace.transient\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tthis.logService.warn(error.toString());\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate doParseStoredWorkspace(path: URI, contents: string): IStoredWorkspace {\n\n\t\t// Parse workspace file\n\t\tconst storedWorkspace: IStoredWorkspace = parse(contents); // use fault tolerant parser\n\n\t\t// Filter out folders which do not have a path or uri set\n\t\tif (storedWorkspace && Array.isArray(storedWorkspace.folders)) {\n\t\t\tstoredWorkspace.folders = storedWorkspace.folders.filter(folder => isStoredWorkspaceFolder(folder));\n\t\t} else {\n\t\t\tthrow new Error(`${path.toString(true)} looks like an invalid workspace file.`);\n\t\t}\n\n\t\treturn storedWorkspace;\n\t}\n\n\tasync createUntitledWorkspace(folders?: IWorkspaceFolderCreationData[], remoteAuthority?: string): Promise<IWorkspaceIdentifier> {\n\t\tconst { workspace, storedWorkspace } = this.newUntitledWorkspace(folders, remoteAuthority);\n\t\tconst configPath = workspace.configPath.fsPath;\n\n\t\tawait fs.promises.mkdir(dirname(configPath), { recursive: true });\n\t\tawait Promises.writeFile(configPath, JSON.stringify(storedWorkspace, null, '\\t'));\n\n\t\tthis.untitledWorkspaces.push({ workspace, remoteAuthority });\n\n\t\treturn workspace;\n\t}\n\n\tprivate newUntitledWorkspace(folders: IWorkspaceFolderCreationData[] = [], remoteAuthority?: string): { workspace: IWorkspaceIdentifier; storedWorkspace: IStoredWorkspace } {\n\t\tconst randomId = (Date.now() + Math.round(Math.random() * 1000)).toString();\n\t\tconst untitledWorkspaceConfigFolder = joinPath(this.untitledWorkspacesHome, randomId);\n\t\tconst untitledWorkspaceConfigPath = joinPath(untitledWorkspaceConfigFolder, UNTITLED_WORKSPACE_NAME);\n\n\t\tconst storedWorkspaceFolder: IStoredWorkspaceFolder[] = [];\n\n\t\tfor (const folder of folders) {\n\t\t\tstoredWorkspaceFolder.push(getStoredWorkspaceFolder(folder.uri, true, folder.name, untitledWorkspaceConfigFolder, extUriBiasedIgnorePathCase));\n\t\t}\n\n\t\treturn {\n\t\t\tworkspace: getWorkspaceIdentifier(untitledWorkspaceConfigPath),\n\t\t\tstoredWorkspace: { folders: storedWorkspaceFolder, remoteAuthority }\n\t\t};\n\t}\n\n\tasync getWorkspaceIdentifier(configPath: URI): Promise<IWorkspaceIdentifier> {\n\t\treturn getWorkspaceIdentifier(configPath);\n\t}\n\n\tisUntitledWorkspace(workspace: IWorkspaceIdentifier): boolean {\n\t\treturn isUntitledWorkspace(workspace.configPath, this.environmentMainService);\n\t}\n\n\tasync deleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void> {\n\t\tif (!this.isUntitledWorkspace(workspace)) {\n\t\t\treturn; // only supported for untitled workspaces\n\t\t}\n\n\t\t// Delete from disk\n\t\tawait this.doDeleteUntitledWorkspace(workspace);\n\n\t\t// unset workspace from profiles\n\t\tthis.userDataProfilesMainService.unsetWorkspace(workspace);\n\n\t\t// Event\n\t\tthis._onDidDeleteUntitledWorkspace.fire(workspace);\n\t}\n\n\tprivate async doDeleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void> {\n\t\tconst configPath = originalFSPath(workspace.configPath);\n\t\ttry {\n\n\t\t\t// Delete Workspace\n\t\t\tawait Promises.rm(dirname(configPath));\n\n\t\t\t// Mark Workspace Storage to be deleted\n\t\t\tconst workspaceStoragePath = join(this.environmentMainService.workspaceStorageHome.with({ scheme: Schemas.file }).fsPath, workspace.id);\n\t\t\tif (await Promises.exists(workspaceStoragePath)) {\n\t\t\t\tawait Promises.writeFile(join(workspaceStoragePath, 'obsolete'), '');\n\t\t\t}\n\n\t\t\t// Remove from list\n\t\t\tthis.untitledWorkspaces = this.untitledWorkspaces.filter(untitledWorkspace => untitledWorkspace.workspace.id !== workspace.id);\n\t\t} catch (error) {\n\t\t\tthis.logService.warn(`Unable to delete untitled workspace ${configPath} (${error}).`);\n\t\t}\n\t}\n\n\tgetUntitledWorkspaces(): IUntitledWorkspaceInfo[] {\n\t\treturn this.untitledWorkspaces;\n\t}\n\n\tasync enterWorkspace(window: ICodeWindow, windows: ICodeWindow[], path: URI): Promise<IEnterWorkspaceResult | undefined> {\n\t\tif (!window?.win || !window.isReady) {\n\t\t\treturn undefined; // return early if the window is not ready or disposed\n\t\t}\n\n\t\tconst isValid = await this.isValidTargetWorkspacePath(window, windows, path);\n\t\tif (!isValid) {\n\t\t\treturn undefined; // return early if the workspace is not valid\n\t\t}\n\n\t\tconst result = await this.doEnterWorkspace(window, getWorkspaceIdentifier(path));\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Emit as event\n\t\tthis._onDidEnterWorkspace.fire({ window, workspace: result.workspace });\n\n\t\treturn result;\n\t}\n\n\tprivate async isValidTargetWorkspacePath(window: ICodeWindow, windows: ICodeWindow[], workspacePath?: URI): Promise<boolean> {\n\t\tif (!workspacePath) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (isWorkspaceIdentifier(window.openedWorkspace) && extUriBiasedIgnorePathCase.isEqual(window.openedWorkspace.configPath, workspacePath)) {\n\t\t\treturn false; // window is already opened on a workspace with that path\n\t\t}\n\n\t\t// Prevent overwriting a workspace that is currently opened in another window\n\t\tif (findWindowOnWorkspaceOrFolder(windows, workspacePath)) {\n\t\t\tawait this.dialogMainService.showMessageBox({\n\t\t\t\ttype: 'info',\n\t\t\t\tbuttons: [localize({ key: 'ok', comment: ['&& denotes a mnemonic'] }, \"&&OK\")],\n\t\t\t\tmessage: localize('workspaceOpenedMessage', \"Unable to save workspace '{0}'\", basename(workspacePath)),\n\t\t\t\tdetail: localize('workspaceOpenedDetail', \"The workspace is already opened in another window. Please close that window first and then try again.\")\n\t\t\t}, electron.BrowserWindow.getFocusedWindow() ?? undefined);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true; // OK\n\t}\n\n\tprivate async doEnterWorkspace(window: ICodeWindow, workspace: IWorkspaceIdentifier): Promise<IEnterWorkspaceResult | undefined> {\n\t\tif (!window.config) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\twindow.focus();\n\n\t\t// Register window for backups and migrate current backups over\n\t\tlet backupPath: string | undefined;\n\t\tif (!window.config.extensionDevelopmentPath) {\n\t\t\tif (window.config.backupPath) {\n\t\t\t\tbackupPath = await this.backupMainService.registerWorkspaceBackup({ workspace, remoteAuthority: window.remoteAuthority }, window.config.backupPath);\n\t\t\t} else {\n\t\t\t\tbackupPath = this.backupMainService.registerWorkspaceBackup({ workspace, remoteAuthority: window.remoteAuthority });\n\t\t\t}\n\t\t}\n\n\t\t// if the window was opened on an untitled workspace, delete it.\n\t\tif (isWorkspaceIdentifier(window.openedWorkspace) && this.isUntitledWorkspace(window.openedWorkspace)) {\n\t\t\tawait this.deleteUntitledWorkspace(window.openedWorkspace);\n\t\t}\n\n\t\t// Update window configuration properly based on transition to workspace\n\t\twindow.config.workspace = workspace;\n\t\twindow.config.backupPath = backupPath;\n\n\t\treturn { workspace, backupPath };\n\t}\n}\n"]}