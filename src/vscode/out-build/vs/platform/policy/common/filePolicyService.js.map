{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/policy/common/filePolicyService.ts","vs/platform/policy/common/filePolicyService.ts"],"names":[],"mappings":"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","file":"filePolicyService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ThrottledDelayer } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Iterable } from '../../../base/common/iterator.js';\nimport { PolicyName } from '../../../base/common/policy.js';\nimport { isObject } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { AbstractPolicyService, IPolicyService, PolicyValue } from './policy.js';\n\nfunction keysDiff<T>(a: Map<string, T>, b: Map<string, T>): string[] {\n\tconst result: string[] = [];\n\n\tfor (const key of new Set(Iterable.concat(a.keys(), b.keys()))) {\n\t\tif (a.get(key) !== b.get(key)) {\n\t\t\tresult.push(key);\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport class FilePolicyService extends AbstractPolicyService implements IPolicyService {\n\n\tprivate readonly throttledDelayer = this._register(new ThrottledDelayer(500));\n\n\tconstructor(\n\t\tprivate readonly file: URI,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\tconst onDidChangePolicyFile = Event.filter(fileService.onDidFilesChange, e => e.affects(file));\n\t\tthis._register(fileService.watch(file));\n\t\tthis._register(onDidChangePolicyFile(() => this.throttledDelayer.trigger(() => this.refresh())));\n\t}\n\n\tprotected async _updatePolicyDefinitions(): Promise<void> {\n\t\tawait this.refresh();\n\t}\n\n\tprivate async read(): Promise<Map<PolicyName, PolicyValue>> {\n\t\tconst policies = new Map<PolicyName, PolicyValue>();\n\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.file);\n\t\t\tconst raw = JSON.parse(content.value.toString());\n\n\t\t\tif (!isObject(raw)) {\n\t\t\t\tthrow new Error('Policy file isn\\'t a JSON object');\n\t\t\t}\n\n\t\t\tfor (const key of Object.keys(raw)) {\n\t\t\t\tif (this.policyDefinitions[key]) {\n\t\t\t\t\tpolicies.set(key, raw[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(`[FilePolicyService] Failed to read policies`, error);\n\t\t\t}\n\t\t}\n\n\t\treturn policies;\n\t}\n\n\tprivate async refresh(): Promise<void> {\n\t\tconst policies = await this.read();\n\t\tconst diff = keysDiff(this.policies, policies);\n\t\tthis.policies = policies;\n\n\t\tif (diff.length > 0) {\n\t\t\tthis._onDidChange.fire(diff);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ThrottledDelayer } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Iterable } from '../../../base/common/iterator.js';\nimport { PolicyName } from '../../../base/common/policy.js';\nimport { isObject } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { AbstractPolicyService, IPolicyService, PolicyValue } from './policy.js';\n\nfunction keysDiff<T>(a: Map<string, T>, b: Map<string, T>): string[] {\n\tconst result: string[] = [];\n\n\tfor (const key of new Set(Iterable.concat(a.keys(), b.keys()))) {\n\t\tif (a.get(key) !== b.get(key)) {\n\t\t\tresult.push(key);\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport class FilePolicyService extends AbstractPolicyService implements IPolicyService {\n\n\tprivate readonly throttledDelayer = this._register(new ThrottledDelayer(500));\n\n\tconstructor(\n\t\tprivate readonly file: URI,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\tconst onDidChangePolicyFile = Event.filter(fileService.onDidFilesChange, e => e.affects(file));\n\t\tthis._register(fileService.watch(file));\n\t\tthis._register(onDidChangePolicyFile(() => this.throttledDelayer.trigger(() => this.refresh())));\n\t}\n\n\tprotected async _updatePolicyDefinitions(): Promise<void> {\n\t\tawait this.refresh();\n\t}\n\n\tprivate async read(): Promise<Map<PolicyName, PolicyValue>> {\n\t\tconst policies = new Map<PolicyName, PolicyValue>();\n\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.file);\n\t\t\tconst raw = JSON.parse(content.value.toString());\n\n\t\t\tif (!isObject(raw)) {\n\t\t\t\tthrow new Error('Policy file isn\\'t a JSON object');\n\t\t\t}\n\n\t\t\tfor (const key of Object.keys(raw)) {\n\t\t\t\tif (this.policyDefinitions[key]) {\n\t\t\t\t\tpolicies.set(key, raw[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(`[FilePolicyService] Failed to read policies`, error);\n\t\t\t}\n\t\t}\n\n\t\treturn policies;\n\t}\n\n\tprivate async refresh(): Promise<void> {\n\t\tconst policies = await this.read();\n\t\tconst diff = keysDiff(this.policies, policies);\n\t\tthis.policies = policies;\n\n\t\tif (diff.length > 0) {\n\t\t\tthis._onDidChange.fire(diff);\n\t\t}\n\t}\n}\n"]}