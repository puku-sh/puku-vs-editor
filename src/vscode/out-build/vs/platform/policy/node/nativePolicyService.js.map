{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/policy/node/nativePolicyService.ts","vs/platform/policy/node/nativePolicyService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,qBAAqB,EAAiD,MAAM,qBAAqB,CAAC;AAE3G,OAAO,EAAE,SAAS,EAAE,MAAM,+BAA+B,CAAC;AAE1D,OAAO,EAAE,iBAAiB,EAAE,MAAM,mCAAmC,CAAC;AACtE,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAC;AAE/C,IAAM,mBAAmB,GAAzB,MAAM,mBAAoB,SAAQ,qBAAqB;IAK7D,YACc,UAAwC,EACpC,WAAmB;QAEpC,KAAK,EAAE,CAAC;QAHsB,eAAU,GAAV,UAAU,CAAa;QACpC,gBAAW,GAAX,WAAW,CAAQ;QAL7B,cAAS,GAAG,IAAI,SAAS,EAAE,CAAC;QACnB,YAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,iBAAiB,EAAW,CAAC,CAAC;IAO5E,CAAC;IAES,KAAK,CAAC,wBAAwB,CAAC,iBAAsD;QAC9F,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,wDAAwD,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,MAAM,qBAAqB,CAAC,CAAC;QAE1I,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,MAAM,CAAC,wBAAwB,CAAC,CAAC;QAEjE,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,OAAO,CAAO,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;YAC3D,IAAI,CAAC;gBACJ,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,aAAa,CAAC,IAAI,CAAC,WAAW,EAAE,iBAAiB,EAAE,MAAM,CAAC,EAAE;oBAChF,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;oBAChC,CAAC,EAAE,CAAC;gBACL,CAAC,CAAC,CAAC;YACJ,CAAC;YAAC,OAAO,GAAG,EAAE,CAAC;gBACd,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,wEAAwE,EAAE,GAAG,CAAC,CAAC;gBACrG,CAAC,CAAC,GAAG,CAAC,CAAC;YACR,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,kBAAkB,CAAC,MAAyD;QACnF,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,mEAAmE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAEnH,KAAK,MAAM,GAAG,IAAI,MAAiD,EAAE,CAAC;YACrE,MAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;YAE1B,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;gBACzB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YAC3B,CAAC;iBAAM,CAAC;gBACP,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YAC/B,CAAC;QACF,CAAC;QAED,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IAC7C,CAAC;CACD,CAAA;AA7CY,mBAAmB;IAM7B,WAAA,WAAW,CAAA;GAND,mBAAmB,CA6C/B","file":"nativePolicyService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AbstractPolicyService, IPolicyService, PolicyDefinition, PolicyValue } from '../common/policy.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { Throttler } from '../../../base/common/async.js';\nimport type { PolicyUpdate, Watcher } from '@vscode/policy-watcher';\nimport { MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { ILogService } from '../../log/common/log.js';\n\nexport class NativePolicyService extends AbstractPolicyService implements IPolicyService {\n\n\tprivate throttler = new Throttler();\n\tprivate readonly watcher = this._register(new MutableDisposable<Watcher>());\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\tprivate readonly productName: string\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected async _updatePolicyDefinitions(policyDefinitions: IStringDictionary<PolicyDefinition>): Promise<void> {\n\t\tthis.logService.trace(`NativePolicyService#_updatePolicyDefinitions - Found ${Object.keys(policyDefinitions).length} policy definitions`);\n\n\t\tconst { createWatcher } = await import('@vscode/policy-watcher');\n\n\t\tawait this.throttler.queue(() => new Promise<void>((c, e) => {\n\t\t\ttry {\n\t\t\t\tthis.watcher.value = createWatcher(this.productName, policyDefinitions, update => {\n\t\t\t\t\tthis._onDidPolicyChange(update);\n\t\t\t\t\tc();\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tthis.logService.error(`NativePolicyService#_updatePolicyDefinitions - Error creating watcher:`, err);\n\t\t\t\te(err);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onDidPolicyChange(update: PolicyUpdate<IStringDictionary<PolicyDefinition>>): void {\n\t\tthis.logService.trace(`NativePolicyService#_onDidPolicyChange - Updated policy values: ${JSON.stringify(update)}`);\n\n\t\tfor (const key in update as Record<string, PolicyValue | undefined>) {\n\t\t\tconst value = update[key];\n\n\t\t\tif (value === undefined) {\n\t\t\t\tthis.policies.delete(key);\n\t\t\t} else {\n\t\t\t\tthis.policies.set(key, value);\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChange.fire(Object.keys(update));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AbstractPolicyService, IPolicyService, PolicyDefinition, PolicyValue } from '../common/policy.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { Throttler } from '../../../base/common/async.js';\nimport type { PolicyUpdate, Watcher } from '@vscode/policy-watcher';\nimport { MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { ILogService } from '../../log/common/log.js';\n\nexport class NativePolicyService extends AbstractPolicyService implements IPolicyService {\n\n\tprivate throttler = new Throttler();\n\tprivate readonly watcher = this._register(new MutableDisposable<Watcher>());\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\tprivate readonly productName: string\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected async _updatePolicyDefinitions(policyDefinitions: IStringDictionary<PolicyDefinition>): Promise<void> {\n\t\tthis.logService.trace(`NativePolicyService#_updatePolicyDefinitions - Found ${Object.keys(policyDefinitions).length} policy definitions`);\n\n\t\tconst { createWatcher } = await import('@vscode/policy-watcher');\n\n\t\tawait this.throttler.queue(() => new Promise<void>((c, e) => {\n\t\t\ttry {\n\t\t\t\tthis.watcher.value = createWatcher(this.productName, policyDefinitions, update => {\n\t\t\t\t\tthis._onDidPolicyChange(update);\n\t\t\t\t\tc();\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tthis.logService.error(`NativePolicyService#_updatePolicyDefinitions - Error creating watcher:`, err);\n\t\t\t\te(err);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onDidPolicyChange(update: PolicyUpdate<IStringDictionary<PolicyDefinition>>): void {\n\t\tthis.logService.trace(`NativePolicyService#_onDidPolicyChange - Updated policy values: ${JSON.stringify(update)}`);\n\n\t\tfor (const key in update as Record<string, PolicyValue | undefined>) {\n\t\t\tconst value = update[key];\n\n\t\t\tif (value === undefined) {\n\t\t\t\tthis.policies.delete(key);\n\t\t\t} else {\n\t\t\t\tthis.policies.set(key, value);\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChange.fire(Object.keys(update));\n\t}\n}\n"]}