{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/mcp/common/mcpManagementIpc.ts","vs/platform/mcp/common/mcpManagementIpc.ts"],"names":[],"mappings":"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","file":"mcpManagementIpc.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { cloneAndChange } from '../../../base/common/objects.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { DefaultURITransformer, IURITransformer, transformAndReviveIncomingURIs } from '../../../base/common/uriIpc.js';\nimport { IChannel, IServerChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { RemoteAgentConnectionContext } from '../../remote/common/remoteAgentEnvironment.js';\nimport { DidUninstallMcpServerEvent, IGalleryMcpServer, ILocalMcpServer, IMcpManagementService, IInstallableMcpServer, InstallMcpServerEvent, InstallMcpServerResult, InstallOptions, UninstallMcpServerEvent, UninstallOptions, IAllowedMcpServersService } from './mcpManagement.js';\nimport { AbstractMcpManagementService } from './mcpManagementService.js';\n\nfunction transformIncomingURI(uri: UriComponents, transformer: IURITransformer | null): URI;\nfunction transformIncomingURI(uri: UriComponents | undefined, transformer: IURITransformer | null): URI | undefined;\nfunction transformIncomingURI(uri: UriComponents | undefined, transformer: IURITransformer | null): URI | undefined {\n\treturn uri ? URI.revive(transformer ? transformer.transformIncoming(uri) : uri) : undefined;\n}\n\nfunction transformIncomingServer(mcpServer: ILocalMcpServer, transformer: IURITransformer | null): ILocalMcpServer {\n\ttransformer = transformer ? transformer : DefaultURITransformer;\n\tconst manifest = mcpServer.manifest;\n\tconst transformed = transformAndReviveIncomingURIs({ ...mcpServer, ...{ manifest: undefined } }, transformer);\n\treturn { ...transformed, ...{ manifest } };\n}\n\nfunction transformIncomingOptions<O extends { mcpResource?: UriComponents }>(options: O | undefined, transformer: IURITransformer | null): O | undefined {\n\treturn options?.mcpResource ? transformAndReviveIncomingURIs(options, transformer ?? DefaultURITransformer) : options;\n}\n\nfunction transformOutgoingExtension(extension: ILocalMcpServer, transformer: IURITransformer | null): ILocalMcpServer {\n\treturn transformer ? cloneAndChange(extension, value => value instanceof URI ? transformer.transformOutgoingURI(value) : undefined) : extension;\n}\n\nfunction transformOutgoingURI(uri: URI, transformer: IURITransformer | null): URI {\n\treturn transformer ? transformer.transformOutgoingURI(uri) : uri;\n}\n\nexport class McpManagementChannel<TContext = RemoteAgentConnectionContext | string> implements IServerChannel<TContext> {\n\treadonly onInstallMcpServer: Event<InstallMcpServerEvent>;\n\treadonly onDidInstallMcpServers: Event<readonly InstallMcpServerResult[]>;\n\treadonly onDidUpdateMcpServers: Event<readonly InstallMcpServerResult[]>;\n\treadonly onUninstallMcpServer: Event<UninstallMcpServerEvent>;\n\treadonly onDidUninstallMcpServer: Event<DidUninstallMcpServerEvent>;\n\n\tconstructor(private service: IMcpManagementService, private getUriTransformer: (requestContext: TContext) => IURITransformer | null) {\n\t\tthis.onInstallMcpServer = Event.buffer(service.onInstallMcpServer, true);\n\t\tthis.onDidInstallMcpServers = Event.buffer(service.onDidInstallMcpServers, true);\n\t\tthis.onDidUpdateMcpServers = Event.buffer(service.onDidUpdateMcpServers, true);\n\t\tthis.onUninstallMcpServer = Event.buffer(service.onUninstallMcpServer, true);\n\t\tthis.onDidUninstallMcpServer = Event.buffer(service.onDidUninstallMcpServer, true);\n\t}\n\n\tlisten<T>(context: TContext, event: string): Event<T> {\n\t\tconst uriTransformer = this.getUriTransformer(context);\n\t\tswitch (event) {\n\t\t\tcase 'onInstallMcpServer': {\n\t\t\t\treturn Event.map<InstallMcpServerEvent, InstallMcpServerEvent>(this.onInstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidInstallMcpServers': {\n\t\t\t\treturn Event.map<readonly InstallMcpServerResult[], readonly InstallMcpServerResult[]>(this.onDidInstallMcpServers, results =>\n\t\t\t\t\tresults.map(i => ({\n\t\t\t\t\t\t...i,\n\t\t\t\t\t\tlocal: i.local ? transformOutgoingExtension(i.local, uriTransformer) : i.local,\n\t\t\t\t\t\tmcpResource: transformOutgoingURI(i.mcpResource, uriTransformer)\n\t\t\t\t\t}))) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidUpdateMcpServers': {\n\t\t\t\treturn Event.map<readonly InstallMcpServerResult[], readonly InstallMcpServerResult[]>(this.onDidUpdateMcpServers, results =>\n\t\t\t\t\tresults.map(i => ({\n\t\t\t\t\t\t...i,\n\t\t\t\t\t\tlocal: i.local ? transformOutgoingExtension(i.local, uriTransformer) : i.local,\n\t\t\t\t\t\tmcpResource: transformOutgoingURI(i.mcpResource, uriTransformer)\n\t\t\t\t\t}))) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onUninstallMcpServer': {\n\t\t\t\treturn Event.map<UninstallMcpServerEvent, UninstallMcpServerEvent>(this.onUninstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidUninstallMcpServer': {\n\t\t\t\treturn Event.map<DidUninstallMcpServerEvent, DidUninstallMcpServerEvent>(this.onDidUninstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Invalid listen');\n\t}\n\n\tasync call<T>(context: TContext, command: string, args?: unknown): Promise<T> {\n\t\tconst uriTransformer: IURITransformer | null = this.getUriTransformer(context);\n\t\tconst argsArray = Array.isArray(args) ? args : [];\n\t\tswitch (command) {\n\t\t\tcase 'getInstalled': {\n\t\t\t\tconst mcpServers = await this.service.getInstalled(transformIncomingURI(argsArray[0], uriTransformer));\n\t\t\t\treturn mcpServers.map(e => transformOutgoingExtension(e, uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'install': {\n\t\t\t\treturn this.service.install(argsArray[0], transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'installFromGallery': {\n\t\t\t\treturn this.service.installFromGallery(argsArray[0], transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'uninstall': {\n\t\t\t\treturn this.service.uninstall(transformIncomingServer(argsArray[0], uriTransformer), transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'updateMetadata': {\n\t\t\t\treturn this.service.updateMetadata(transformIncomingServer(argsArray[0], uriTransformer), argsArray[1], transformIncomingURI(argsArray[2], uriTransformer)) as T;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Invalid call');\n\t}\n}\n\nexport class McpManagementChannelClient extends AbstractMcpManagementService implements IMcpManagementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\tget onInstallMcpServer() { return this._onInstallMcpServer.event; }\n\n\tprivate readonly _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\tget onDidInstallMcpServers() { return this._onDidInstallMcpServers.event; }\n\n\tprivate readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\tget onUninstallMcpServer() { return this._onUninstallMcpServer.event; }\n\n\tprivate readonly _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\tget onDidUninstallMcpServer() { return this._onDidUninstallMcpServer.event; }\n\n\tprivate readonly _onDidUpdateMcpServers = this._register(new Emitter<InstallMcpServerResult[]>());\n\tget onDidUpdateMcpServers() { return this._onDidUpdateMcpServers.event; }\n\n\tconstructor(\n\t\tprivate readonly channel: IChannel,\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\t\tthis._register(this.channel.listen<InstallMcpServerEvent>('onInstallMcpServer')(e => this._onInstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t\tthis._register(this.channel.listen<readonly InstallMcpServerResult[]>('onDidInstallMcpServers')(results => this._onDidInstallMcpServers.fire(results.map(e => ({ ...e, local: e.local ? transformIncomingServer(e.local, null) : e.local, mcpResource: transformIncomingURI(e.mcpResource, null) })))));\n\t\tthis._register(this.channel.listen<readonly InstallMcpServerResult[]>('onDidUpdateMcpServers')(results => this._onDidUpdateMcpServers.fire(results.map(e => ({ ...e, local: e.local ? transformIncomingServer(e.local, null) : e.local, mcpResource: transformIncomingURI(e.mcpResource, null) })))));\n\t\tthis._register(this.channel.listen<UninstallMcpServerEvent>('onUninstallMcpServer')(e => this._onUninstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t\tthis._register(this.channel.listen<DidUninstallMcpServerEvent>('onDidUninstallMcpServer')(e => this._onDidUninstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t}\n\n\tinstall(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('install', [server, options])).then(local => transformIncomingServer(local, null));\n\t}\n\n\tinstallFromGallery(extension: IGalleryMcpServer, installOptions?: InstallOptions): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('installFromGallery', [extension, installOptions])).then(local => transformIncomingServer(local, null));\n\t}\n\n\tuninstall(extension: ILocalMcpServer, options?: UninstallOptions): Promise<void> {\n\t\treturn Promise.resolve(this.channel.call<void>('uninstall', [extension, options]));\n\t}\n\n\tgetInstalled(mcpResource?: URI): Promise<ILocalMcpServer[]> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer[]>('getInstalled', [mcpResource]))\n\t\t\t.then(servers => servers.map(server => transformIncomingServer(server, null)));\n\t}\n\n\tupdateMetadata(local: ILocalMcpServer, gallery: IGalleryMcpServer, mcpResource?: URI): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('updateMetadata', [local, gallery, mcpResource])).then(local => transformIncomingServer(local, null));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { cloneAndChange } from '../../../base/common/objects.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { DefaultURITransformer, IURITransformer, transformAndReviveIncomingURIs } from '../../../base/common/uriIpc.js';\nimport { IChannel, IServerChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { RemoteAgentConnectionContext } from '../../remote/common/remoteAgentEnvironment.js';\nimport { DidUninstallMcpServerEvent, IGalleryMcpServer, ILocalMcpServer, IMcpManagementService, IInstallableMcpServer, InstallMcpServerEvent, InstallMcpServerResult, InstallOptions, UninstallMcpServerEvent, UninstallOptions, IAllowedMcpServersService } from './mcpManagement.js';\nimport { AbstractMcpManagementService } from './mcpManagementService.js';\n\nfunction transformIncomingURI(uri: UriComponents, transformer: IURITransformer | null): URI;\nfunction transformIncomingURI(uri: UriComponents | undefined, transformer: IURITransformer | null): URI | undefined;\nfunction transformIncomingURI(uri: UriComponents | undefined, transformer: IURITransformer | null): URI | undefined {\n\treturn uri ? URI.revive(transformer ? transformer.transformIncoming(uri) : uri) : undefined;\n}\n\nfunction transformIncomingServer(mcpServer: ILocalMcpServer, transformer: IURITransformer | null): ILocalMcpServer {\n\ttransformer = transformer ? transformer : DefaultURITransformer;\n\tconst manifest = mcpServer.manifest;\n\tconst transformed = transformAndReviveIncomingURIs({ ...mcpServer, ...{ manifest: undefined } }, transformer);\n\treturn { ...transformed, ...{ manifest } };\n}\n\nfunction transformIncomingOptions<O extends { mcpResource?: UriComponents }>(options: O | undefined, transformer: IURITransformer | null): O | undefined {\n\treturn options?.mcpResource ? transformAndReviveIncomingURIs(options, transformer ?? DefaultURITransformer) : options;\n}\n\nfunction transformOutgoingExtension(extension: ILocalMcpServer, transformer: IURITransformer | null): ILocalMcpServer {\n\treturn transformer ? cloneAndChange(extension, value => value instanceof URI ? transformer.transformOutgoingURI(value) : undefined) : extension;\n}\n\nfunction transformOutgoingURI(uri: URI, transformer: IURITransformer | null): URI {\n\treturn transformer ? transformer.transformOutgoingURI(uri) : uri;\n}\n\nexport class McpManagementChannel<TContext = RemoteAgentConnectionContext | string> implements IServerChannel<TContext> {\n\treadonly onInstallMcpServer: Event<InstallMcpServerEvent>;\n\treadonly onDidInstallMcpServers: Event<readonly InstallMcpServerResult[]>;\n\treadonly onDidUpdateMcpServers: Event<readonly InstallMcpServerResult[]>;\n\treadonly onUninstallMcpServer: Event<UninstallMcpServerEvent>;\n\treadonly onDidUninstallMcpServer: Event<DidUninstallMcpServerEvent>;\n\n\tconstructor(private service: IMcpManagementService, private getUriTransformer: (requestContext: TContext) => IURITransformer | null) {\n\t\tthis.onInstallMcpServer = Event.buffer(service.onInstallMcpServer, true);\n\t\tthis.onDidInstallMcpServers = Event.buffer(service.onDidInstallMcpServers, true);\n\t\tthis.onDidUpdateMcpServers = Event.buffer(service.onDidUpdateMcpServers, true);\n\t\tthis.onUninstallMcpServer = Event.buffer(service.onUninstallMcpServer, true);\n\t\tthis.onDidUninstallMcpServer = Event.buffer(service.onDidUninstallMcpServer, true);\n\t}\n\n\tlisten<T>(context: TContext, event: string): Event<T> {\n\t\tconst uriTransformer = this.getUriTransformer(context);\n\t\tswitch (event) {\n\t\t\tcase 'onInstallMcpServer': {\n\t\t\t\treturn Event.map<InstallMcpServerEvent, InstallMcpServerEvent>(this.onInstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidInstallMcpServers': {\n\t\t\t\treturn Event.map<readonly InstallMcpServerResult[], readonly InstallMcpServerResult[]>(this.onDidInstallMcpServers, results =>\n\t\t\t\t\tresults.map(i => ({\n\t\t\t\t\t\t...i,\n\t\t\t\t\t\tlocal: i.local ? transformOutgoingExtension(i.local, uriTransformer) : i.local,\n\t\t\t\t\t\tmcpResource: transformOutgoingURI(i.mcpResource, uriTransformer)\n\t\t\t\t\t}))) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidUpdateMcpServers': {\n\t\t\t\treturn Event.map<readonly InstallMcpServerResult[], readonly InstallMcpServerResult[]>(this.onDidUpdateMcpServers, results =>\n\t\t\t\t\tresults.map(i => ({\n\t\t\t\t\t\t...i,\n\t\t\t\t\t\tlocal: i.local ? transformOutgoingExtension(i.local, uriTransformer) : i.local,\n\t\t\t\t\t\tmcpResource: transformOutgoingURI(i.mcpResource, uriTransformer)\n\t\t\t\t\t}))) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onUninstallMcpServer': {\n\t\t\t\treturn Event.map<UninstallMcpServerEvent, UninstallMcpServerEvent>(this.onUninstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t\tcase 'onDidUninstallMcpServer': {\n\t\t\t\treturn Event.map<DidUninstallMcpServerEvent, DidUninstallMcpServerEvent>(this.onDidUninstallMcpServer, event => {\n\t\t\t\t\treturn { ...event, mcpResource: transformOutgoingURI(event.mcpResource, uriTransformer) };\n\t\t\t\t}) as Event<T>;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Invalid listen');\n\t}\n\n\tasync call<T>(context: TContext, command: string, args?: unknown): Promise<T> {\n\t\tconst uriTransformer: IURITransformer | null = this.getUriTransformer(context);\n\t\tconst argsArray = Array.isArray(args) ? args : [];\n\t\tswitch (command) {\n\t\t\tcase 'getInstalled': {\n\t\t\t\tconst mcpServers = await this.service.getInstalled(transformIncomingURI(argsArray[0], uriTransformer));\n\t\t\t\treturn mcpServers.map(e => transformOutgoingExtension(e, uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'install': {\n\t\t\t\treturn this.service.install(argsArray[0], transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'installFromGallery': {\n\t\t\t\treturn this.service.installFromGallery(argsArray[0], transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'uninstall': {\n\t\t\t\treturn this.service.uninstall(transformIncomingServer(argsArray[0], uriTransformer), transformIncomingOptions(argsArray[1], uriTransformer)) as T;\n\t\t\t}\n\t\t\tcase 'updateMetadata': {\n\t\t\t\treturn this.service.updateMetadata(transformIncomingServer(argsArray[0], uriTransformer), argsArray[1], transformIncomingURI(argsArray[2], uriTransformer)) as T;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Invalid call');\n\t}\n}\n\nexport class McpManagementChannelClient extends AbstractMcpManagementService implements IMcpManagementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\tget onInstallMcpServer() { return this._onInstallMcpServer.event; }\n\n\tprivate readonly _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\tget onDidInstallMcpServers() { return this._onDidInstallMcpServers.event; }\n\n\tprivate readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\tget onUninstallMcpServer() { return this._onUninstallMcpServer.event; }\n\n\tprivate readonly _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\tget onDidUninstallMcpServer() { return this._onDidUninstallMcpServer.event; }\n\n\tprivate readonly _onDidUpdateMcpServers = this._register(new Emitter<InstallMcpServerResult[]>());\n\tget onDidUpdateMcpServers() { return this._onDidUpdateMcpServers.event; }\n\n\tconstructor(\n\t\tprivate readonly channel: IChannel,\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\t\tthis._register(this.channel.listen<InstallMcpServerEvent>('onInstallMcpServer')(e => this._onInstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t\tthis._register(this.channel.listen<readonly InstallMcpServerResult[]>('onDidInstallMcpServers')(results => this._onDidInstallMcpServers.fire(results.map(e => ({ ...e, local: e.local ? transformIncomingServer(e.local, null) : e.local, mcpResource: transformIncomingURI(e.mcpResource, null) })))));\n\t\tthis._register(this.channel.listen<readonly InstallMcpServerResult[]>('onDidUpdateMcpServers')(results => this._onDidUpdateMcpServers.fire(results.map(e => ({ ...e, local: e.local ? transformIncomingServer(e.local, null) : e.local, mcpResource: transformIncomingURI(e.mcpResource, null) })))));\n\t\tthis._register(this.channel.listen<UninstallMcpServerEvent>('onUninstallMcpServer')(e => this._onUninstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t\tthis._register(this.channel.listen<DidUninstallMcpServerEvent>('onDidUninstallMcpServer')(e => this._onDidUninstallMcpServer.fire(({ ...e, mcpResource: transformIncomingURI(e.mcpResource, null) }))));\n\t}\n\n\tinstall(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('install', [server, options])).then(local => transformIncomingServer(local, null));\n\t}\n\n\tinstallFromGallery(extension: IGalleryMcpServer, installOptions?: InstallOptions): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('installFromGallery', [extension, installOptions])).then(local => transformIncomingServer(local, null));\n\t}\n\n\tuninstall(extension: ILocalMcpServer, options?: UninstallOptions): Promise<void> {\n\t\treturn Promise.resolve(this.channel.call<void>('uninstall', [extension, options]));\n\t}\n\n\tgetInstalled(mcpResource?: URI): Promise<ILocalMcpServer[]> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer[]>('getInstalled', [mcpResource]))\n\t\t\t.then(servers => servers.map(server => transformIncomingServer(server, null)));\n\t}\n\n\tupdateMetadata(local: ILocalMcpServer, gallery: IGalleryMcpServer, mcpResource?: URI): Promise<ILocalMcpServer> {\n\t\treturn Promise.resolve(this.channel.call<ILocalMcpServer>('updateMetadata', [local, gallery, mcpResource])).then(local => transformIncomingServer(local, null));\n\t}\n}\n"]}