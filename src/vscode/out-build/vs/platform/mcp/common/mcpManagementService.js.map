{"version":3,"sources":["vs/platform/mcp/common/mcpManagementService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,gBAAgB,EAAE,MAAM,+BAA+B,CAAC;AACjE,OAAO,EAAE,QAAQ,EAAE,MAAM,gCAAgC,CAAC;AAC1D,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AACzE,OAAO,EAAE,OAAO,EAAS,MAAM,+BAA+B,CAAC;AAC/D,OAAO,EAAmB,cAAc,EAAE,MAAM,qCAAqC,CAAC;AACtF,OAAO,EAAE,UAAU,EAAE,eAAe,EAAe,MAAM,mCAAmC,CAAC;AAC7F,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,MAAM,EAAE,MAAM,iCAAiC,CAAC;AACzD,OAAO,EAAE,QAAQ,EAAE,MAAM,+BAA+B,CAAC;AACzD,OAAO,EAAE,GAAG,EAAE,MAAM,6BAA6B,CAAC;AAClD,OAAO,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAE3C,OAAO,EAAE,mBAAmB,EAAE,MAAM,yCAAyC,CAAC;AAC9E,OAAO,EAAE,YAAY,EAAE,MAAM,6BAA6B,CAAC;AAC3D,OAAO,EAAE,qBAAqB,EAAE,MAAM,6CAA6C,CAAC;AACpF,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAC;AACtD,OAAO,EAAE,mBAAmB,EAAE,MAAM,yCAAyC,CAAC;AAC9E,OAAO,EAAE,wBAAwB,EAAE,MAAM,iDAAiD,CAAC;AAC3F,OAAO,EAAkE,kBAAkB,EAAyN,yBAAyB,EAAkF,MAAM,oBAAoB,CAAC;AAE1b,OAAO,EAAE,0BAA0B,EAAqB,MAAM,gCAAgC,CAAC;AAuBxF,IAAe,kCAAkC,GAAjD,MAAe,kCAAmC,SAAQ,UAAU;IAiB1E,YACiC,UAAuB;QAEvD,KAAK,EAAE,CAAC;QAFwB,eAAU,GAAV,UAAU,CAAa;IAGxD,CAAC;IAED,qCAAqC,CAAC,QAAwC,EAAE,WAAyB;QAExG,SAAS;QACT,IAAI,WAAW,uCAAwB,IAAI,QAAQ,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC;YACrE,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,EAAE,CAAC,CAAC;YAC5F,OAAO;gBACN,sBAAsB,EAAE;oBACvB,MAAM,EAAE;wBACP,IAAI,mCAAsB;wBAC1B,GAAG,EAAE,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG;wBAC5B,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS;qBACxD;oBACD,MAAM,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS;iBAChD;gBACD,OAAO,EAAE,EAAE;aACX,CAAC;QACH,CAAC;QAED,QAAQ;QACR,MAAM,aAAa,GAAG,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,KAAK,WAAW,CAAC,IAAI,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC;QAC7G,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;QAC5C,CAAC;QAED,MAAM,IAAI,GAAa,EAAE,CAAC;QAC1B,MAAM,MAAM,GAAyB,EAAE,CAAC;QACxC,MAAM,GAAG,GAA2B,EAAE,CAAC;QACvC,MAAM,OAAO,GAAa,EAAE,CAAC;QAE7B,IAAI,aAAa,CAAC,YAAY,oCAAwB,EAAE,CAAC;YACxD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACjB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAChB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACnB,CAAC;QAED,IAAI,aAAa,CAAC,gBAAgB,EAAE,MAAM,EAAE,CAAC;YAC5C,MAAM,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,gBAAgB,IAAI,EAAE,CAAC,CAAC;YAC3E,IAAI,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;YACjC,OAAO,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QAED,IAAI,aAAa,CAAC,oBAAoB,EAAE,MAAM,EAAE,CAAC;YAChD,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAAC,oBAAoB,IAAI,EAAE,CAAC,CAAC;YACjJ,MAAM,CAAC,IAAI,CAAC,GAAG,YAAY,CAAC,CAAC;YAC7B,OAAO,CAAC,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC;YAC5B,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC;gBACvD,GAAG,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;gBAClB,IAAI,aAAa,CAAC,YAAY,oCAAwB,EAAE,CAAC;oBACxD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAChB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACjB,CAAC;YACF,CAAC;QACF,CAAC;QAED,QAAQ,aAAa,CAAC,YAAY,EAAE,CAAC;YACpC;gBACC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC,UAAU,IAAI,aAAa,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBACrH,MAAM;YACP;gBACC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC,UAAU,KAAK,aAAa,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBACtH,MAAM;YACP;gBACC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC,UAAU,IAAI,aAAa,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBACrH,MAAM;YACP;gBACC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC,UAAU,IAAI,aAAa,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBACrH,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,oEAAoE;gBACxF,IAAI,aAAa,CAAC,gBAAgB,EAAE,MAAM,EAAE,CAAC;oBAC5C,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACjB,CAAC;gBACD,MAAM;QACR,CAAC;QAED,IAAI,aAAa,CAAC,gBAAgB,EAAE,MAAM,EAAE,CAAC;YAC5C,MAAM,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;YACrE,IAAI,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;YACjC,OAAO,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QAED,OAAO;YACN,OAAO;YACP,sBAAsB,EAAE;gBACvB,MAAM,EAAE;oBACP,IAAI,mCAAqB;oBACzB,OAAO,EAAE,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,YAAY,CAAC;oBACxD,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS;oBACpC,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS;iBAC9C;gBACD,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS;aAC1C;SACD,CAAC;IACH,CAAC;IAES,cAAc,CAAC,WAAyB;QACjD,QAAQ,WAAW,EAAE,CAAC;YACrB,kCAAsB,CAAC,CAAC,OAAO,KAAK,CAAC;YACrC,oCAAwB,CAAC,CAAC,OAAO,QAAQ,CAAC;YAC1C,qCAAwB,CAAC,CAAC,OAAO,KAAK,CAAC;YACvC,qCAAuB,CAAC,CAAC,OAAO,KAAK,CAAC;QACvC,CAAC;QACD,OAAO,WAAW,CAAC;IACpB,CAAC;IAES,YAAY,CAAC,cAA+C;QACrE,MAAM,SAAS,GAAyB,EAAE,CAAC;QAC3C,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE,CAAC;YAC3D,SAAS,CAAC,IAAI,CAAC;gBACd,EAAE,EAAE,GAAG;gBACP,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,+CAA4B,CAAC,kDAA6B;gBAC/E,WAAW,EAAE,KAAK,CAAC,WAAW,IAAI,EAAE;gBACpC,QAAQ,EAAE,CAAC,CAAC,KAAK,CAAC,QAAQ;gBAC1B,OAAO,EAAE,KAAK,CAAC,OAAO;gBACtB,OAAO,EAAE,KAAK,CAAC,OAAO;aACtB,CAAC,CAAC;QACJ,CAAC;QACD,OAAO,SAAS,CAAC;IAClB,CAAC;IAEO,qBAAqB,CAAC,cAAsD;QACnF,MAAM,OAAO,GAAa,EAAE,CAAC;QAC7B,MAAM,MAAM,GAA2B,EAAE,CAAC;QAC1C,MAAM,SAAS,GAAyB,EAAE,CAAC;QAE3C,KAAK,MAAM,KAAK,IAAI,cAAc,EAAE,CAAC;YACpC,MAAM,cAAc,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACjF,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,EAAE,CAAC;YAE9B,4DAA4D;YAC5D,IAAI,cAAc,CAAC,MAAM,EAAE,CAAC;gBAC3B,KAAK,MAAM,QAAQ,IAAI,cAAc,EAAE,CAAC;oBACvC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,EAAE,GAAG,EAAE,YAAY,QAAQ,CAAC,EAAE,GAAG,CAAC,CAAC;gBACvE,CAAC;gBACD,SAAS,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,CAAC;YACnC,CAAC;iBAAM,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,WAAW,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,KAAK,SAAS,CAAC,EAAE,CAAC;gBAC1F,kFAAkF;gBAClF,SAAS,CAAC,IAAI,CAAC;oBACd,EAAE,EAAE,KAAK,CAAC,IAAI;oBACd,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,+CAA4B,CAAC,kDAA6B;oBAC/E,WAAW,EAAE,KAAK,CAAC,WAAW,IAAI,EAAE;oBACpC,QAAQ,EAAE,CAAC,CAAC,KAAK,CAAC,QAAQ;oBAC1B,OAAO,EAAE,KAAK,CAAC,OAAO;oBACtB,OAAO,EAAE,KAAK,CAAC,OAAO;iBACtB,CAAC,CAAC;gBACH,KAAK,GAAG,YAAY,KAAK,CAAC,IAAI,GAAG,CAAC;YACnC,CAAC;YAED,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;QAC5B,CAAC;QAED,OAAO,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC;IACvC,CAAC;IAEO,gBAAgB,CAAC,aAA4C;QACpE,MAAM,IAAI,GAAa,EAAE,CAAC;QAC1B,MAAM,SAAS,GAAyB,EAAE,CAAC;QAC3C,MAAM,OAAO,GAAa,EAAE,CAAC;QAC7B,KAAK,MAAM,GAAG,IAAI,aAAa,EAAE,CAAC;YACjC,MAAM,YAAY,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAE3E,IAAI,GAAG,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;gBAC/B,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;gBACtB,IAAI,KAAK,EAAE,CAAC;oBACX,KAAK,MAAM,QAAQ,IAAI,YAAY,EAAE,CAAC;wBACrC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,EAAE,GAAG,EAAE,YAAY,QAAQ,CAAC,EAAE,GAAG,CAAC,CAAC;oBACvE,CAAC;oBACD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBACjB,IAAI,YAAY,CAAC,MAAM,EAAE,CAAC;wBACzB,SAAS,CAAC,IAAI,CAAC,GAAG,YAAY,CAAC,CAAC;oBACjC,CAAC;gBACF,CAAC;qBAAM,IAAI,GAAG,CAAC,SAAS,IAAI,CAAC,GAAG,CAAC,WAAW,IAAI,GAAG,CAAC,OAAO,KAAK,SAAS,CAAC,EAAE,CAAC;oBAC5E,8DAA8D;oBAC9D,SAAS,CAAC,IAAI,CAAC;wBACd,EAAE,EAAE,GAAG,CAAC,SAAS;wBACjB,IAAI,mDAA8B;wBAClC,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,EAAE;wBAClC,QAAQ,EAAE,KAAK;wBACf,OAAO,EAAE,GAAG,CAAC,OAAO;qBACpB,CAAC,CAAC;oBACH,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;gBACzC,CAAC;qBAAM,CAAC;oBACP,oCAAoC;oBACpC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,IAAI,EAAE,CAAC,CAAC;gBAChC,CAAC;YACF,CAAC;iBAAM,IAAI,GAAG,CAAC,IAAI,KAAK,OAAO,EAAE,CAAC;gBACjC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;oBACf,OAAO,CAAC,IAAI,CAAC,qCAAqC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;oBACzE,SAAS;gBACV,CAAC;gBACD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBACpB,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;oBACf,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;oBACtB,KAAK,MAAM,QAAQ,IAAI,YAAY,EAAE,CAAC;wBACrC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,QAAQ,CAAC,EAAE,GAAG,EAAE,YAAY,QAAQ,CAAC,EAAE,GAAG,CAAC,CAAC;oBACvE,CAAC;oBACD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBACjB,IAAI,YAAY,CAAC,MAAM,EAAE,CAAC;wBACzB,SAAS,CAAC,IAAI,CAAC,GAAG,YAAY,CAAC,CAAC;oBACjC,CAAC;gBACF,CAAC;qBAAM,IAAI,GAAG,CAAC,WAAW,IAAI,GAAG,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;oBACzD,yDAAyD;oBACzD,MAAM,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;oBAChD,SAAS,CAAC,IAAI,CAAC;wBACd,EAAE,EAAE,UAAU;wBACd,IAAI,mDAA8B;wBAClC,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,EAAE;wBAClC,QAAQ,EAAE,KAAK;wBACf,OAAO,EAAE,GAAG,CAAC,OAAO;qBACpB,CAAC,CAAC;oBACH,IAAI,CAAC,IAAI,CAAC,YAAY,UAAU,GAAG,CAAC,CAAC;gBACtC,CAAC;YACF,CAAC;QACF,CAAC;QACD,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC;IACrC,CAAC;CAED,CAAA;AAhPqB,kCAAkC;IAkBrD,WAAA,WAAW,CAAA;GAlBQ,kCAAkC,CAgPvD;;AAEM,IAAe,oCAAoC,GAAnD,MAAe,oCAAqC,SAAQ,kCAAkC;IAUpG,IAAI,sBAAsB,KAAK,OAAO,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC,CAAC;IAG3E,IAAI,qBAAqB,KAAK,OAAO,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC,CAAC;IAGzE,IAAI,oBAAoB,KAAK,OAAO,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC;IAGvE,IAAI,uBAAuB,KAAK,OAAO,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC,CAAC;IAE7E,YACoB,WAAgB,EAChB,MAAyB,EACxB,iBAAwD,EAC9D,WAA4C,EACrC,kBAA0D,EAClE,UAAuB,EACR,yBAAwE;QAEpG,KAAK,CAAC,UAAU,CAAC,CAAC;QARC,gBAAW,GAAX,WAAW,CAAK;QAChB,WAAM,GAAN,MAAM,CAAmB;QACL,sBAAiB,GAAjB,iBAAiB,CAAoB;QAC3C,gBAAW,GAAX,WAAW,CAAc;QAClB,uBAAkB,GAAlB,kBAAkB,CAAqB;QAEhC,8BAAyB,GAAzB,yBAAyB,CAA4B;QAxB7F,UAAK,GAAG,IAAI,GAAG,EAA2B,CAAC;QAEhC,wBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAyB,CAAC,CAAC;QACrF,uBAAkB,GAAG,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;QAE1C,4BAAuB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA4B,CAAC,CAAC;QAGlF,2BAAsB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA4B,CAAC,CAAC;QAGjF,0BAAqB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA2B,CAAC,CAAC;QAGxF,6BAAwB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA8B,CAAC,CAAC;QAa9F,IAAI,CAAC,4BAA4B,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;IACxG,CAAC;IAEO,UAAU;QACjB,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAC7B,IAAI,CAAC,iBAAiB,GAAG,CAAC,KAAK,IAAI,EAAE;gBACpC,IAAI,CAAC;oBACJ,IAAI,CAAC,KAAK,GAAG,MAAM,IAAI,CAAC,oBAAoB,EAAE,CAAC;gBAChD,CAAC;wBAAS,CAAC;oBACV,IAAI,CAAC,aAAa,EAAE,CAAC;gBACtB,CAAC;YACF,CAAC,CAAC,EAAE,CAAC;QACN,CAAC;QACD,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAC/B,CAAC;IAEO,KAAK,CAAC,oBAAoB;QACjC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,2DAA2D,EAAE,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC,CAAC;QAChH,MAAM,KAAK,GAAG,IAAI,GAAG,EAA2B,CAAC;QACjD,IAAI,CAAC;YACJ,MAAM,iBAAiB,GAAG,MAAM,IAAI,CAAC,yBAAyB,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC7G,IAAI,iBAAiB,CAAC,OAAO,EAAE,CAAC;gBAC/B,MAAM,OAAO,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,aAAa,CAAC,EAAE,EAAE;oBACtG,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;oBAC/D,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBACzB,CAAC,CAAC,CAAC,CAAC;YACL,CAAC;QACF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;YACjE,MAAM,KAAK,CAAC;QACb,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAEO,aAAa;QACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;QACzD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;YACpD,IAAI,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;gBACjC,IAAI,CAAC,4BAA4B,CAAC,QAAQ,EAAE,CAAC;YAC9C,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAES,KAAK,CAAC,WAAW;QAC1B,IAAI,CAAC;YACJ,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAElD,MAAM,KAAK,GAAsB,EAAE,CAAC;YACpC,MAAM,OAAO,GAAsB,EAAE,CAAC;YACtC,MAAM,OAAO,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;YAE1E,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;gBAC9B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAC3B,CAAC;YAED,KAAK,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,OAAO,EAAE,CAAC;gBACtC,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBACtC,IAAI,QAAQ,EAAE,CAAC;oBACd,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,CAAC;wBAC/B,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACrB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;oBAC9B,CAAC;gBACF,CAAC;qBAAM,CAAC;oBACP,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBACnB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC9B,CAAC;YACF,CAAC;YAED,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;gBAC9B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC1B,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;YACrF,CAAC;YAED,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;gBACpB,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;YAChI,CAAC;YAED,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC;gBAClB,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;YAC/H,CAAC;QAEF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,uCAAuC,EAAE,KAAK,CAAC,CAAC;QACvE,CAAC;IACF,CAAC;IAED,KAAK,CAAC,YAAY;QACjB,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;QACxB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;IACxC,CAAC;IAES,KAAK,CAAC,eAAe,CAAC,IAAY,EAAE,MAA+B;QAC5E,IAAI,aAAa,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAChE,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,aAAa,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,CAAC,OAAO,EAAE,UAAU,EAAE,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;QACtH,CAAC;QAED,OAAO;YACN,IAAI;YACJ,MAAM;YACN,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,OAAO,EAAE,aAAa,CAAC,OAAO;YAC9B,QAAQ,EAAE,aAAa,CAAC,QAAQ;YAChC,WAAW,EAAE,aAAa,CAAC,WAAW;YACtC,WAAW,EAAE,aAAa,CAAC,WAAW;YACtC,SAAS,EAAE,aAAa,CAAC,SAAS;YAClC,oBAAoB,EAAE,aAAa,CAAC,oBAAoB;YACxD,UAAU,EAAE,aAAa,CAAC,UAAU;YACpC,SAAS,EAAE,aAAa,CAAC,SAAS;YAClC,aAAa,EAAE,aAAa,CAAC,aAAa;YAC1C,SAAS,EAAE,aAAa,CAAC,SAAS;YAClC,IAAI,EAAE,aAAa,CAAC,IAAI;YACxB,OAAO,EAAE,aAAa,CAAC,OAAO;YAC9B,QAAQ,EAAE,aAAa,CAAC,QAAQ;YAChC,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO;SAC5C,CAAC;IACH,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,MAA6B,EAAE,OAA6C;QACzF,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,iCAAiC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;QAEtE,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QACpF,IAAI,CAAC;YACJ,MAAM,IAAI,CAAC,yBAAyB,CAAC,aAAa,CAAC,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC5F,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;YACzB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;gBACZ,MAAM,IAAI,KAAK,CAAC,iCAAiC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC;YACjE,CAAC;YACD,OAAO,KAAK,CAAC;QACd,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YACpG,MAAM,CAAC,CAAC;QACT,CAAC;IACF,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,MAAuB,EAAE,OAA+C;QACvF,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,mCAAmC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;QACxE,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QAEtF,IAAI,CAAC;YACJ,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,yBAAyB,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC1G,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;gBAC7B,OAAO;YACR,CAAC;YACD,MAAM,IAAI,CAAC,yBAAyB,CAAC,gBAAgB,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YACpG,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACrB,MAAM,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAC9E,CAAC;YACD,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;QAC1B,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;YACnG,MAAM,CAAC,CAAC;QACT,CAAC;IACF,CAAC;CAID,CAAA;AA7LqB,oCAAoC;IAwBvD,WAAA,kBAAkB,CAAA;IAClB,WAAA,YAAY,CAAA;IACZ,WAAA,mBAAmB,CAAA;IACnB,WAAA,WAAW,CAAA;IACX,WAAA,0BAA0B,CAAA;GA5BP,oCAAoC,CA6LzD;;AAEM,IAAM,gCAAgC,GAAtC,MAAM,gCAAiC,SAAQ,oCAAoC;IAIzF,YACC,WAAgB,EACI,iBAAqC,EAC3C,WAAyB,EAClB,kBAAuC,EAC/C,UAAuB,EACR,yBAAqD,EAC5D,kBAAuC;QAE5D,KAAK,CAAC,WAAW,oCAA4B,iBAAiB,EAAE,WAAW,EAAE,kBAAkB,EAAE,UAAU,EAAE,yBAAyB,CAAC,CAAC;QACxI,IAAI,CAAC,WAAW,GAAG,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,kBAAkB,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;IACtG,CAAC;IAED,KAAK,CAAC,kBAAkB,CAAC,MAAyB,EAAE,OAAwB;QAC3E,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;IAClC,CAAC;IAED,KAAK,CAAC,cAAc,CAAC,KAAsB,EAAE,OAA0B;QACtE,MAAM,IAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC,CAAC;QAC9C,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;QACzB,MAAM,YAAY,GAAG,CAAC,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC;QAClF,IAAI,CAAC,YAAY,EAAE,CAAC;YACnB,MAAM,IAAI,KAAK,CAAC,8BAA8B,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;QAC7D,CAAC;QACD,OAAO,YAAY,CAAC;IACrB,CAAC;IAES,KAAK,CAAC,yBAAyB,CAAC,OAA0B;QACnE,MAAM,QAAQ,GAAG,OAAO,CAAC,aAAa,CAAC;QACvC,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;QACjE,MAAM,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;QACxF,MAAM,KAAK,GAAwB;YAClC,UAAU,EAAE,OAAO,CAAC,UAAU;YAC9B,SAAS,EAAE,OAAO,CAAC,EAAE;YACrB,IAAI,EAAE,OAAO,CAAC,IAAI;YAClB,WAAW,EAAE,OAAO,CAAC,WAAW;YAChC,WAAW,EAAE,OAAO,CAAC,WAAW;YAChC,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,SAAS,EAAE,OAAO,CAAC,SAAS;YAC5B,oBAAoB,EAAE,OAAO,CAAC,oBAAoB;YAClD,aAAa,EAAE,OAAO,CAAC,aAAa;YACpC,UAAU,EAAE,OAAO,CAAC,OAAO;YAC3B,IAAI,EAAE,OAAO,CAAC,IAAI;YAClB,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,QAAQ;SACR,CAAC;QACF,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,YAAY,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAE3F,IAAI,OAAO,CAAC,SAAS,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;YACzC,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,OAAO,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;YACzH,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;QAC/H,CAAC;QAED,OAAO,QAAQ,CAAC;IACjB,CAAC;IAES,KAAK,CAAC,kBAAkB,CAAC,IAAY,EAAE,eAAwC;QACxF,IAAI,mBAAoD,CAAC;QACzD,IAAI,QAAyB,CAAC;QAC9B,IAAI,SAA0B,CAAC;QAC/B,IAAI,eAAe,CAAC,OAAO,EAAE,CAAC;YAC7B,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,eAAe,CAAC,OAAO,CAAC,CAAC;YAC3D,MAAM,gBAAgB,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;YAC5F,IAAI,CAAC;gBACJ,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;gBAClE,mBAAmB,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAwB,CAAC;gBAElF,UAAU;gBACV,IAAI,mBAAmB,CAAC,UAAU,EAAE,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;oBACtD,mBAAmB,CAAC,UAAU,GAAG,mBAAmB,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,EAAE,mBAAmB,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC7H,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,gBAAgB,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;gBAC9G,CAAC;gBAED,mBAAmB,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBACxC,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;gBAC3E,IAAI,CAAC,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC;oBAC/C,SAAS,GAAG,SAAS,CAAC;gBACvB,CAAC;gBACD,mBAAmB,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3C,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,iDAAiD,EAAE,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC;YAClG,CAAC;QACF,CAAC;QACD,OAAO,mBAAmB,CAAC;IAC5B,CAAC;IAES,WAAW,CAAC,IAAY,EAAE,OAAgB;QACnD,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC9B,OAAO,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,IAAI,OAAO,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;IACzG,CAAC;IAEkB,cAAc,CAAC,GAAQ,EAAE,OAA6C;QACxF,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;IAC1C,CAAC;IAEQ,UAAU;QAClB,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;IAClC,CAAC;CAED,CAAA;AAvGY,gCAAgC;IAM1C,WAAA,kBAAkB,CAAA;IAClB,WAAA,YAAY,CAAA;IACZ,WAAA,mBAAmB,CAAA;IACnB,WAAA,WAAW,CAAA;IACX,WAAA,0BAA0B,CAAA;IAC1B,WAAA,mBAAmB,CAAA;GAXT,gCAAgC,CAuG5C;;AAEM,IAAe,4BAA4B,GAA3C,MAAe,4BAA6B,SAAQ,kCAAkC;IAE5F,YAC+C,wBAAmD,EACpF,UAAuB;QAEpC,KAAK,CAAC,UAAU,CAAC,CAAC;QAH4B,6BAAwB,GAAxB,wBAAwB,CAA2B;IAIlG,CAAC;IAED,UAAU,CAAC,MAAiD;QAC3D,MAAM,gBAAgB,GAAG,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QACzE,IAAI,gBAAgB,KAAK,IAAI,EAAE,CAAC;YAC/B,OAAO,IAAI,cAAc,CAAC,QAAQ,CAAC,IAAwB,EAAE,IAAiD,EAAE,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC;QAC1I,CAAC;QACD,OAAO,IAAI,CAAC;IACb,CAAC;CACD,CAAA;AAhBqB,4BAA4B;IAG/C,WAAA,yBAAyB,CAAA;IACzB,WAAA,WAAW,CAAA;GAJQ,4BAA4B,CAgBjD;;AAEM,IAAM,oBAAoB,GAA1B,MAAM,oBAAqB,SAAQ,4BAA4B;IAmBrE,YAC4B,wBAAmD,EACjE,UAAuB,EACV,uBAAkE,EACrE,oBAA8D;QAErF,KAAK,CAAC,wBAAwB,EAAE,UAAU,CAAC,CAAC;QAHD,4BAAuB,GAAvB,uBAAuB,CAA0B;QAClD,yBAAoB,GAApB,oBAAoB,CAAuB;QArBrE,wBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAyB,CAAC,CAAC;QACnF,uBAAkB,GAAG,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;QAE5C,4BAAuB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAqC,CAAC,CAAC;QACnG,2BAAsB,GAAG,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC;QAEpD,2BAAsB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAqC,CAAC,CAAC;QAClG,0BAAqB,GAAG,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC;QAElD,0BAAqB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA2B,CAAC,CAAC;QACvF,yBAAoB,GAAG,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC;QAEhD,6BAAwB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA8B,CAAC,CAAC;QAC7F,4BAAuB,GAAG,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC;QAEtD,kCAA6B,GAAG,IAAI,WAAW,EAA+D,CAAC;IAShI,CAAC;IAEO,+BAA+B,CAAC,WAAgB;QACvD,IAAI,4BAA4B,GAAG,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QACvF,IAAI,CAAC,4BAA4B,EAAE,CAAC;YACnC,MAAM,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;YAC1C,MAAM,OAAO,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,kCAAkC,CAAC,WAAW,CAAC,CAAC,CAAC;YACtF,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACnF,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC3F,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACzF,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACvF,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7F,IAAI,CAAC,6BAA6B,CAAC,GAAG,CAAC,WAAW,EAAE,4BAA4B,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,WAAW,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QACvI,CAAC;QACD,OAAO,4BAA4B,CAAC,OAAO,CAAC;IAC7C,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,WAAiB;QACnC,MAAM,cAAc,GAAG,WAAW,IAAI,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC;QAC9F,OAAO,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC,YAAY,EAAE,CAAC;IAC5E,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,MAA6B,EAAE,OAAwB;QACpE,MAAM,cAAc,GAAG,OAAO,EAAE,WAAW,IAAI,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC;QACvG,OAAO,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IACtF,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,MAAuB,EAAE,OAA0B;QAClE,MAAM,cAAc,GAAG,OAAO,EAAE,WAAW,IAAI,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC;QACvG,OAAO,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IACxF,CAAC;IAED,KAAK,CAAC,kBAAkB,CAAC,MAAyB,EAAE,OAAwB;QAC3E,MAAM,cAAc,GAAG,OAAO,EAAE,WAAW,IAAI,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC;QACvG,OAAO,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IACjG,CAAC;IAED,KAAK,CAAC,cAAc,CAAC,KAAsB,EAAE,OAA0B,EAAE,WAAiB;QACzF,OAAO,IAAI,CAAC,+BAA+B,CAAC,WAAW,IAAI,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,cAAc,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;IACpJ,CAAC;IAEQ,OAAO;QACf,IAAI,CAAC,6BAA6B,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;QACzE,IAAI,CAAC,6BAA6B,CAAC,KAAK,EAAE,CAAC;QAC3C,KAAK,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC;IAES,kCAAkC,CAAC,WAAgB;QAC5D,OAAO,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,gCAAgC,EAAE,WAAW,CAAC,CAAC;IAChG,CAAC;CAED,CAAA;AA7EY,oBAAoB;IAoB9B,WAAA,yBAAyB,CAAA;IACzB,WAAA,WAAW,CAAA;IACX,WAAA,wBAAwB,CAAA;IACxB,WAAA,qBAAqB,CAAA;GAvBX,oBAAoB,CA6EhC","file":"mcpManagementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IMarkdownString, MarkdownString } from '../../../base/common/htmlContent.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { equals } from '../../../base/common/objects.js';\nimport { isString } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { ConfigurationTarget } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { DidUninstallMcpServerEvent, IGalleryMcpServer, ILocalMcpServer, IMcpGalleryService, IMcpManagementService, IMcpServerInput, IGalleryMcpServerConfiguration, InstallMcpServerEvent, InstallMcpServerResult, RegistryType, UninstallMcpServerEvent, InstallOptions, UninstallOptions, IInstallableMcpServer, IAllowedMcpServersService, IMcpServerArgument, IMcpServerKeyValueInput, McpServerConfigurationParseResult } from './mcpManagement.js';\nimport { IMcpServerVariable, McpServerVariableType, IMcpServerConfiguration, McpServerType } from './mcpPlatformTypes.js';\nimport { IMcpResourceScannerService, McpResourceTarget } from './mcpResourceScannerService.js';\n\nexport interface ILocalMcpServerInfo {\n\tname: string;\n\tversion?: string;\n\tdisplayName?: string;\n\tgalleryId?: string;\n\tgalleryUrl?: string;\n\tdescription?: string;\n\trepositoryUrl?: string;\n\tpublisher?: string;\n\tpublisherDisplayName?: string;\n\ticon?: {\n\t\tdark: string;\n\t\tlight: string;\n\t};\n\tcodicon?: string;\n\tmanifest?: IGalleryMcpServerConfiguration;\n\treadmeUrl?: URI;\n\tlocation?: URI;\n\tlicenseUrl?: string;\n}\n\nexport abstract class AbstractCommonMcpManagementService extends Disposable implements IMcpManagementService {\n\n\t_serviceBrand: undefined;\n\n\tabstract onInstallMcpServer: Event<InstallMcpServerEvent>;\n\tabstract onDidInstallMcpServers: Event<readonly InstallMcpServerResult[]>;\n\tabstract onDidUpdateMcpServers: Event<readonly InstallMcpServerResult[]>;\n\tabstract onUninstallMcpServer: Event<UninstallMcpServerEvent>;\n\tabstract onDidUninstallMcpServer: Event<DidUninstallMcpServerEvent>;\n\n\tabstract getInstalled(mcpResource?: URI): Promise<ILocalMcpServer[]>;\n\tabstract install(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer>;\n\tabstract installFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer>;\n\tabstract updateMetadata(local: ILocalMcpServer, server: IGalleryMcpServer, profileLocation?: URI): Promise<ILocalMcpServer>;\n\tabstract uninstall(server: ILocalMcpServer, options?: UninstallOptions): Promise<void>;\n\tabstract canInstall(server: IGalleryMcpServer | IInstallableMcpServer): true | IMarkdownString;\n\n\tconstructor(\n\t\t@ILogService protected readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t}\n\n\tgetMcpServerConfigurationFromManifest(manifest: IGalleryMcpServerConfiguration, packageType: RegistryType): McpServerConfigurationParseResult {\n\n\t\t// remote\n\t\tif (packageType === RegistryType.REMOTE && manifest.remotes?.length) {\n\t\t\tconst { inputs, variables } = this.processKeyValueInputs(manifest.remotes[0].headers ?? []);\n\t\t\treturn {\n\t\t\t\tmcpServerConfiguration: {\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\ttype: McpServerType.REMOTE,\n\t\t\t\t\t\turl: manifest.remotes[0].url,\n\t\t\t\t\t\theaders: Object.keys(inputs).length ? inputs : undefined,\n\t\t\t\t\t},\n\t\t\t\t\tinputs: variables.length ? variables : undefined,\n\t\t\t\t},\n\t\t\t\tnotices: [],\n\t\t\t};\n\t\t}\n\n\t\t// local\n\t\tconst serverPackage = manifest.packages?.find(p => p.registryType === packageType) ?? manifest.packages?.[0];\n\t\tif (!serverPackage) {\n\t\t\tthrow new Error(`No server package found`);\n\t\t}\n\n\t\tconst args: string[] = [];\n\t\tconst inputs: IMcpServerVariable[] = [];\n\t\tconst env: Record<string, string> = {};\n\t\tconst notices: string[] = [];\n\n\t\tif (serverPackage.registryType === RegistryType.DOCKER) {\n\t\t\targs.push('run');\n\t\t\targs.push('-i');\n\t\t\targs.push('--rm');\n\t\t}\n\n\t\tif (serverPackage.runtimeArguments?.length) {\n\t\t\tconst result = this.processArguments(serverPackage.runtimeArguments ?? []);\n\t\t\targs.push(...result.args);\n\t\t\tinputs.push(...result.variables);\n\t\t\tnotices.push(...result.notices);\n\t\t}\n\n\t\tif (serverPackage.environmentVariables?.length) {\n\t\t\tconst { inputs: envInputs, variables: envVariables, notices: envNotices } = this.processKeyValueInputs(serverPackage.environmentVariables ?? []);\n\t\t\tinputs.push(...envVariables);\n\t\t\tnotices.push(...envNotices);\n\t\t\tfor (const [name, value] of Object.entries(envInputs)) {\n\t\t\t\tenv[name] = value;\n\t\t\t\tif (serverPackage.registryType === RegistryType.DOCKER) {\n\t\t\t\t\targs.push('-e');\n\t\t\t\t\targs.push(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tswitch (serverPackage.registryType) {\n\t\t\tcase RegistryType.NODE:\n\t\t\t\targs.push(serverPackage.version ? `${serverPackage.identifier}@${serverPackage.version}` : serverPackage.identifier);\n\t\t\t\tbreak;\n\t\t\tcase RegistryType.PYTHON:\n\t\t\t\targs.push(serverPackage.version ? `${serverPackage.identifier}==${serverPackage.version}` : serverPackage.identifier);\n\t\t\t\tbreak;\n\t\t\tcase RegistryType.DOCKER:\n\t\t\t\targs.push(serverPackage.version ? `${serverPackage.identifier}:${serverPackage.version}` : serverPackage.identifier);\n\t\t\t\tbreak;\n\t\t\tcase RegistryType.NUGET:\n\t\t\t\targs.push(serverPackage.version ? `${serverPackage.identifier}@${serverPackage.version}` : serverPackage.identifier);\n\t\t\t\targs.push('--yes'); // installation is confirmed by the UI, so --yes is appropriate here\n\t\t\t\tif (serverPackage.packageArguments?.length) {\n\t\t\t\t\targs.push('--');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (serverPackage.packageArguments?.length) {\n\t\t\tconst result = this.processArguments(serverPackage.packageArguments);\n\t\t\targs.push(...result.args);\n\t\t\tinputs.push(...result.variables);\n\t\t\tnotices.push(...result.notices);\n\t\t}\n\n\t\treturn {\n\t\t\tnotices,\n\t\t\tmcpServerConfiguration: {\n\t\t\t\tconfig: {\n\t\t\t\t\ttype: McpServerType.LOCAL,\n\t\t\t\t\tcommand: this.getCommandName(serverPackage.registryType),\n\t\t\t\t\targs: args.length ? args : undefined,\n\t\t\t\t\tenv: Object.keys(env).length ? env : undefined,\n\t\t\t\t},\n\t\t\t\tinputs: inputs.length ? inputs : undefined,\n\t\t\t}\n\t\t};\n\t}\n\n\tprotected getCommandName(packageType: RegistryType): string {\n\t\tswitch (packageType) {\n\t\t\tcase RegistryType.NODE: return 'npx';\n\t\t\tcase RegistryType.DOCKER: return 'docker';\n\t\t\tcase RegistryType.PYTHON: return 'uvx';\n\t\t\tcase RegistryType.NUGET: return 'dnx';\n\t\t}\n\t\treturn packageType;\n\t}\n\n\tprotected getVariables(variableInputs: Record<string, IMcpServerInput>): IMcpServerVariable[] {\n\t\tconst variables: IMcpServerVariable[] = [];\n\t\tfor (const [key, value] of Object.entries(variableInputs)) {\n\t\t\tvariables.push({\n\t\t\t\tid: key,\n\t\t\t\ttype: value.choices ? McpServerVariableType.PICK : McpServerVariableType.PROMPT,\n\t\t\t\tdescription: value.description ?? '',\n\t\t\t\tpassword: !!value.isSecret,\n\t\t\t\tdefault: value.default,\n\t\t\t\toptions: value.choices,\n\t\t\t});\n\t\t}\n\t\treturn variables;\n\t}\n\n\tprivate processKeyValueInputs(keyValueInputs: ReadonlyArray<IMcpServerKeyValueInput>): { inputs: Record<string, string>; variables: IMcpServerVariable[]; notices: string[] } {\n\t\tconst notices: string[] = [];\n\t\tconst inputs: Record<string, string> = {};\n\t\tconst variables: IMcpServerVariable[] = [];\n\n\t\tfor (const input of keyValueInputs) {\n\t\t\tconst inputVariables = input.variables ? this.getVariables(input.variables) : [];\n\t\t\tlet value = input.value || '';\n\n\t\t\t// If explicit variables exist, use them regardless of value\n\t\t\tif (inputVariables.length) {\n\t\t\t\tfor (const variable of inputVariables) {\n\t\t\t\t\tvalue = value.replace(`{${variable.id}}`, `\\${input:${variable.id}}`);\n\t\t\t\t}\n\t\t\t\tvariables.push(...inputVariables);\n\t\t\t} else if (!value && (input.description || input.choices || input.default !== undefined)) {\n\t\t\t\t// Only create auto-generated input variable if no explicit variables and no value\n\t\t\t\tvariables.push({\n\t\t\t\t\tid: input.name,\n\t\t\t\t\ttype: input.choices ? McpServerVariableType.PICK : McpServerVariableType.PROMPT,\n\t\t\t\t\tdescription: input.description ?? '',\n\t\t\t\t\tpassword: !!input.isSecret,\n\t\t\t\t\tdefault: input.default,\n\t\t\t\t\toptions: input.choices,\n\t\t\t\t});\n\t\t\t\tvalue = `\\${input:${input.name}}`;\n\t\t\t}\n\n\t\t\tinputs[input.name] = value;\n\t\t}\n\n\t\treturn { inputs, variables, notices };\n\t}\n\n\tprivate processArguments(argumentsList: readonly IMcpServerArgument[]): { args: string[]; variables: IMcpServerVariable[]; notices: string[] } {\n\t\tconst args: string[] = [];\n\t\tconst variables: IMcpServerVariable[] = [];\n\t\tconst notices: string[] = [];\n\t\tfor (const arg of argumentsList) {\n\t\t\tconst argVariables = arg.variables ? this.getVariables(arg.variables) : [];\n\n\t\t\tif (arg.type === 'positional') {\n\t\t\t\tlet value = arg.value;\n\t\t\t\tif (value) {\n\t\t\t\t\tfor (const variable of argVariables) {\n\t\t\t\t\t\tvalue = value.replace(`{${variable.id}}`, `\\${input:${variable.id}}`);\n\t\t\t\t\t}\n\t\t\t\t\targs.push(value);\n\t\t\t\t\tif (argVariables.length) {\n\t\t\t\t\t\tvariables.push(...argVariables);\n\t\t\t\t\t}\n\t\t\t\t} else if (arg.valueHint && (arg.description || arg.default !== undefined)) {\n\t\t\t\t\t// Create input variable for positional argument without value\n\t\t\t\t\tvariables.push({\n\t\t\t\t\t\tid: arg.valueHint,\n\t\t\t\t\t\ttype: McpServerVariableType.PROMPT,\n\t\t\t\t\t\tdescription: arg.description ?? '',\n\t\t\t\t\t\tpassword: false,\n\t\t\t\t\t\tdefault: arg.default,\n\t\t\t\t\t});\n\t\t\t\t\targs.push(`\\${input:${arg.valueHint}}`);\n\t\t\t\t} else {\n\t\t\t\t\t// Fallback to value_hint as literal\n\t\t\t\t\targs.push(arg.valueHint ?? '');\n\t\t\t\t}\n\t\t\t} else if (arg.type === 'named') {\n\t\t\t\tif (!arg.name) {\n\t\t\t\t\tnotices.push(`Named argument is missing a name. ${JSON.stringify(arg)}`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\targs.push(arg.name);\n\t\t\t\tif (arg.value) {\n\t\t\t\t\tlet value = arg.value;\n\t\t\t\t\tfor (const variable of argVariables) {\n\t\t\t\t\t\tvalue = value.replace(`{${variable.id}}`, `\\${input:${variable.id}}`);\n\t\t\t\t\t}\n\t\t\t\t\targs.push(value);\n\t\t\t\t\tif (argVariables.length) {\n\t\t\t\t\t\tvariables.push(...argVariables);\n\t\t\t\t\t}\n\t\t\t\t} else if (arg.description || arg.default !== undefined) {\n\t\t\t\t\t// Create input variable for named argument without value\n\t\t\t\t\tconst variableId = arg.name.replace(/^--?/, '');\n\t\t\t\t\tvariables.push({\n\t\t\t\t\t\tid: variableId,\n\t\t\t\t\t\ttype: McpServerVariableType.PROMPT,\n\t\t\t\t\t\tdescription: arg.description ?? '',\n\t\t\t\t\t\tpassword: false,\n\t\t\t\t\t\tdefault: arg.default,\n\t\t\t\t\t});\n\t\t\t\t\targs.push(`\\${input:${variableId}}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { args, variables, notices };\n\t}\n\n}\n\nexport abstract class AbstractMcpResourceManagementService extends AbstractCommonMcpManagementService {\n\n\tprivate initializePromise: Promise<void> | undefined;\n\tprivate readonly reloadConfigurationScheduler: RunOnceScheduler;\n\tprivate local = new Map<string, ILocalMcpServer>();\n\n\tprotected readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprotected readonly _onDidInstallMcpServers = this._register(new Emitter<InstallMcpServerResult[]>());\n\tget onDidInstallMcpServers() { return this._onDidInstallMcpServers.event; }\n\n\tprotected readonly _onDidUpdateMcpServers = this._register(new Emitter<InstallMcpServerResult[]>());\n\tget onDidUpdateMcpServers() { return this._onDidUpdateMcpServers.event; }\n\n\tprotected readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\tget onUninstallMcpServer() { return this._onUninstallMcpServer.event; }\n\n\tprotected _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\tget onDidUninstallMcpServer() { return this._onDidUninstallMcpServer.event; }\n\n\tconstructor(\n\t\tprotected readonly mcpResource: URI,\n\t\tprotected readonly target: McpResourceTarget,\n\t\t@IMcpGalleryService protected readonly mcpGalleryService: IMcpGalleryService,\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@IUriIdentityService protected readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IMcpResourceScannerService protected readonly mcpResourceScannerService: IMcpResourceScannerService,\n\t) {\n\t\tsuper(logService);\n\t\tthis.reloadConfigurationScheduler = this._register(new RunOnceScheduler(() => this.updateLocal(), 50));\n\t}\n\n\tprivate initialize(): Promise<void> {\n\t\tif (!this.initializePromise) {\n\t\t\tthis.initializePromise = (async () => {\n\t\t\t\ttry {\n\t\t\t\t\tthis.local = await this.populateLocalServers();\n\t\t\t\t} finally {\n\t\t\t\t\tthis.startWatching();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializePromise;\n\t}\n\n\tprivate async populateLocalServers(): Promise<Map<string, ILocalMcpServer>> {\n\t\tthis.logService.trace('AbstractMcpResourceManagementService#populateLocalServers', this.mcpResource.toString());\n\t\tconst local = new Map<string, ILocalMcpServer>();\n\t\ttry {\n\t\t\tconst scannedMcpServers = await this.mcpResourceScannerService.scanMcpServers(this.mcpResource, this.target);\n\t\t\tif (scannedMcpServers.servers) {\n\t\t\t\tawait Promise.allSettled(Object.entries(scannedMcpServers.servers).map(async ([name, scannedServer]) => {\n\t\t\t\t\tconst server = await this.scanLocalServer(name, scannedServer);\n\t\t\t\t\tlocal.set(name, server);\n\t\t\t\t}));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.debug('Could not read user MCP servers:', error);\n\t\t\tthrow error;\n\t\t}\n\t\treturn local;\n\t}\n\n\tprivate startWatching(): void {\n\t\tthis._register(this.fileService.watch(this.mcpResource));\n\t\tthis._register(this.fileService.onDidFilesChange(e => {\n\t\t\tif (e.affects(this.mcpResource)) {\n\t\t\t\tthis.reloadConfigurationScheduler.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected async updateLocal(): Promise<void> {\n\t\ttry {\n\t\t\tconst current = await this.populateLocalServers();\n\n\t\t\tconst added: ILocalMcpServer[] = [];\n\t\t\tconst updated: ILocalMcpServer[] = [];\n\t\t\tconst removed = [...this.local.keys()].filter(name => !current.has(name));\n\n\t\t\tfor (const server of removed) {\n\t\t\t\tthis.local.delete(server);\n\t\t\t}\n\n\t\t\tfor (const [name, server] of current) {\n\t\t\t\tconst previous = this.local.get(name);\n\t\t\t\tif (previous) {\n\t\t\t\t\tif (!equals(previous, server)) {\n\t\t\t\t\t\tupdated.push(server);\n\t\t\t\t\t\tthis.local.set(name, server);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tadded.push(server);\n\t\t\t\t\tthis.local.set(name, server);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const server of removed) {\n\t\t\t\tthis.local.delete(server);\n\t\t\t\tthis._onDidUninstallMcpServer.fire({ name: server, mcpResource: this.mcpResource });\n\t\t\t}\n\n\t\t\tif (updated.length) {\n\t\t\t\tthis._onDidUpdateMcpServers.fire(updated.map(server => ({ name: server.name, local: server, mcpResource: this.mcpResource })));\n\t\t\t}\n\n\t\t\tif (added.length) {\n\t\t\t\tthis._onDidInstallMcpServers.fire(added.map(server => ({ name: server.name, local: server, mcpResource: this.mcpResource })));\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tthis.logService.error('Failed to load installed MCP servers:', error);\n\t\t}\n\t}\n\n\tasync getInstalled(): Promise<ILocalMcpServer[]> {\n\t\tawait this.initialize();\n\t\treturn Array.from(this.local.values());\n\t}\n\n\tprotected async scanLocalServer(name: string, config: IMcpServerConfiguration): Promise<ILocalMcpServer> {\n\t\tlet mcpServerInfo = await this.getLocalServerInfo(name, config);\n\t\tif (!mcpServerInfo) {\n\t\t\tmcpServerInfo = { name, version: config.version, galleryUrl: isString(config.gallery) ? config.gallery : undefined };\n\t\t}\n\n\t\treturn {\n\t\t\tname,\n\t\t\tconfig,\n\t\t\tmcpResource: this.mcpResource,\n\t\t\tversion: mcpServerInfo.version,\n\t\t\tlocation: mcpServerInfo.location,\n\t\t\tdisplayName: mcpServerInfo.displayName,\n\t\t\tdescription: mcpServerInfo.description,\n\t\t\tpublisher: mcpServerInfo.publisher,\n\t\t\tpublisherDisplayName: mcpServerInfo.publisherDisplayName,\n\t\t\tgalleryUrl: mcpServerInfo.galleryUrl,\n\t\t\tgalleryId: mcpServerInfo.galleryId,\n\t\t\trepositoryUrl: mcpServerInfo.repositoryUrl,\n\t\t\treadmeUrl: mcpServerInfo.readmeUrl,\n\t\t\ticon: mcpServerInfo.icon,\n\t\t\tcodicon: mcpServerInfo.codicon,\n\t\t\tmanifest: mcpServerInfo.manifest,\n\t\t\tsource: config.gallery ? 'gallery' : 'local'\n\t\t};\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: Omit<InstallOptions, 'mcpResource'>): Promise<ILocalMcpServer> {\n\t\tthis.logService.trace('MCP Management Service: install', server.name);\n\n\t\tthis._onInstallMcpServer.fire({ name: server.name, mcpResource: this.mcpResource });\n\t\ttry {\n\t\t\tawait this.mcpResourceScannerService.addMcpServers([server], this.mcpResource, this.target);\n\t\t\tawait this.updateLocal();\n\t\t\tconst local = this.local.get(server.name);\n\t\t\tif (!local) {\n\t\t\t\tthrow new Error(`Failed to install MCP server: ${server.name}`);\n\t\t\t}\n\t\t\treturn local;\n\t\t} catch (e) {\n\t\t\tthis._onDidInstallMcpServers.fire([{ name: server.name, error: e, mcpResource: this.mcpResource }]);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync uninstall(server: ILocalMcpServer, options?: Omit<UninstallOptions, 'mcpResource'>): Promise<void> {\n\t\tthis.logService.trace('MCP Management Service: uninstall', server.name);\n\t\tthis._onUninstallMcpServer.fire({ name: server.name, mcpResource: this.mcpResource });\n\n\t\ttry {\n\t\t\tconst currentServers = await this.mcpResourceScannerService.scanMcpServers(this.mcpResource, this.target);\n\t\t\tif (!currentServers.servers) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.mcpResourceScannerService.removeMcpServers([server.name], this.mcpResource, this.target);\n\t\t\tif (server.location) {\n\t\t\t\tawait this.fileService.del(URI.revive(server.location), { recursive: true });\n\t\t\t}\n\t\t\tawait this.updateLocal();\n\t\t} catch (e) {\n\t\t\tthis._onDidUninstallMcpServer.fire({ name: server.name, error: e, mcpResource: this.mcpResource });\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tprotected abstract getLocalServerInfo(name: string, mcpServerConfig: IMcpServerConfiguration): Promise<ILocalMcpServerInfo | undefined>;\n\tprotected abstract installFromUri(uri: URI, options?: Omit<InstallOptions, 'mcpResource'>): Promise<ILocalMcpServer>;\n}\n\nexport class McpUserResourceManagementService extends AbstractMcpResourceManagementService {\n\n\tprotected readonly mcpLocation: URI;\n\n\tconstructor(\n\t\tmcpResource: URI,\n\t\t@IMcpGalleryService mcpGalleryService: IMcpGalleryService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IMcpResourceScannerService mcpResourceScannerService: IMcpResourceScannerService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService\n\t) {\n\t\tsuper(mcpResource, ConfigurationTarget.USER, mcpGalleryService, fileService, uriIdentityService, logService, mcpResourceScannerService);\n\t\tthis.mcpLocation = uriIdentityService.extUri.joinPath(environmentService.userRoamingDataHome, 'mcp');\n\t}\n\n\tasync installFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tasync updateMetadata(local: ILocalMcpServer, gallery: IGalleryMcpServer): Promise<ILocalMcpServer> {\n\t\tawait this.updateMetadataFromGallery(gallery);\n\t\tawait this.updateLocal();\n\t\tconst updatedLocal = (await this.getInstalled()).find(s => s.name === local.name);\n\t\tif (!updatedLocal) {\n\t\t\tthrow new Error(`Failed to find MCP server: ${local.name}`);\n\t\t}\n\t\treturn updatedLocal;\n\t}\n\n\tprotected async updateMetadataFromGallery(gallery: IGalleryMcpServer): Promise<IGalleryMcpServerConfiguration> {\n\t\tconst manifest = gallery.configuration;\n\t\tconst location = this.getLocation(gallery.name, gallery.version);\n\t\tconst manifestPath = this.uriIdentityService.extUri.joinPath(location, 'manifest.json');\n\t\tconst local: ILocalMcpServerInfo = {\n\t\t\tgalleryUrl: gallery.galleryUrl,\n\t\t\tgalleryId: gallery.id,\n\t\t\tname: gallery.name,\n\t\t\tdisplayName: gallery.displayName,\n\t\t\tdescription: gallery.description,\n\t\t\tversion: gallery.version,\n\t\t\tpublisher: gallery.publisher,\n\t\t\tpublisherDisplayName: gallery.publisherDisplayName,\n\t\t\trepositoryUrl: gallery.repositoryUrl,\n\t\t\tlicenseUrl: gallery.license,\n\t\t\ticon: gallery.icon,\n\t\t\tcodicon: gallery.codicon,\n\t\t\tmanifest,\n\t\t};\n\t\tawait this.fileService.writeFile(manifestPath, VSBuffer.fromString(JSON.stringify(local)));\n\n\t\tif (gallery.readmeUrl || gallery.readme) {\n\t\t\tconst readme = gallery.readme ? gallery.readme : await this.mcpGalleryService.getReadme(gallery, CancellationToken.None);\n\t\t\tawait this.fileService.writeFile(this.uriIdentityService.extUri.joinPath(location, 'README.md'), VSBuffer.fromString(readme));\n\t\t}\n\n\t\treturn manifest;\n\t}\n\n\tprotected async getLocalServerInfo(name: string, mcpServerConfig: IMcpServerConfiguration): Promise<ILocalMcpServerInfo | undefined> {\n\t\tlet storedMcpServerInfo: ILocalMcpServerInfo | undefined;\n\t\tlet location: URI | undefined;\n\t\tlet readmeUrl: URI | undefined;\n\t\tif (mcpServerConfig.gallery) {\n\t\t\tlocation = this.getLocation(name, mcpServerConfig.version);\n\t\t\tconst manifestLocation = this.uriIdentityService.extUri.joinPath(location, 'manifest.json');\n\t\t\ttry {\n\t\t\t\tconst content = await this.fileService.readFile(manifestLocation);\n\t\t\t\tstoredMcpServerInfo = JSON.parse(content.value.toString()) as ILocalMcpServerInfo;\n\n\t\t\t\t// migrate\n\t\t\t\tif (storedMcpServerInfo.galleryUrl?.includes('/v0/')) {\n\t\t\t\t\tstoredMcpServerInfo.galleryUrl = storedMcpServerInfo.galleryUrl.substring(0, storedMcpServerInfo.galleryUrl.indexOf('/v0/'));\n\t\t\t\t\tawait this.fileService.writeFile(manifestLocation, VSBuffer.fromString(JSON.stringify(storedMcpServerInfo)));\n\t\t\t\t}\n\n\t\t\t\tstoredMcpServerInfo.location = location;\n\t\t\t\treadmeUrl = this.uriIdentityService.extUri.joinPath(location, 'README.md');\n\t\t\t\tif (!await this.fileService.exists(readmeUrl)) {\n\t\t\t\t\treadmeUrl = undefined;\n\t\t\t\t}\n\t\t\t\tstoredMcpServerInfo.readmeUrl = readmeUrl;\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.error('MCP Management Service: failed to read manifest', location.toString(), e);\n\t\t\t}\n\t\t}\n\t\treturn storedMcpServerInfo;\n\t}\n\n\tprotected getLocation(name: string, version?: string): URI {\n\t\tname = name.replace('/', '.');\n\t\treturn this.uriIdentityService.extUri.joinPath(this.mcpLocation, version ? `${name}-${version}` : name);\n\t}\n\n\tprotected override installFromUri(uri: URI, options?: Omit<InstallOptions, 'mcpResource'>): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Method not supported.');\n\t}\n\n\toverride canInstall(): true | IMarkdownString {\n\t\tthrow new Error('Not supported');\n\t}\n\n}\n\nexport abstract class AbstractMcpManagementService extends AbstractCommonMcpManagementService implements IMcpManagementService {\n\n\tconstructor(\n\t\t@IAllowedMcpServersService protected readonly allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tsuper(logService);\n\t}\n\n\tcanInstall(server: IGalleryMcpServer | IInstallableMcpServer): true | IMarkdownString {\n\t\tconst allowedToInstall = this.allowedMcpServersService.isAllowed(server);\n\t\tif (allowedToInstall !== true) {\n\t\t\treturn new MarkdownString(localize('not allowed to install', \"This mcp server cannot be installed because {0}\", allowedToInstall.value));\n\t\t}\n\t\treturn true;\n\t}\n}\n\nexport class McpManagementService extends AbstractMcpManagementService implements IMcpManagementService {\n\n\tprivate readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprivate readonly _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidInstallMcpServers = this._onDidInstallMcpServers.event;\n\n\tprivate readonly _onDidUpdateMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidUpdateMcpServers = this._onDidUpdateMcpServers.event;\n\n\tprivate readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\treadonly onUninstallMcpServer = this._onUninstallMcpServer.event;\n\n\tprivate readonly _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\treadonly onDidUninstallMcpServer = this._onDidUninstallMcpServer.event;\n\n\tprivate readonly mcpResourceManagementServices = new ResourceMap<{ service: McpUserResourceManagementService } & IDisposable>();\n\n\tconstructor(\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\t}\n\n\tprivate getMcpResourceManagementService(mcpResource: URI): McpUserResourceManagementService {\n\t\tlet mcpResourceManagementService = this.mcpResourceManagementServices.get(mcpResource);\n\t\tif (!mcpResourceManagementService) {\n\t\t\tconst disposables = new DisposableStore();\n\t\t\tconst service = disposables.add(this.createMcpResourceManagementService(mcpResource));\n\t\t\tdisposables.add(service.onInstallMcpServer(e => this._onInstallMcpServer.fire(e)));\n\t\t\tdisposables.add(service.onDidInstallMcpServers(e => this._onDidInstallMcpServers.fire(e)));\n\t\t\tdisposables.add(service.onDidUpdateMcpServers(e => this._onDidUpdateMcpServers.fire(e)));\n\t\t\tdisposables.add(service.onUninstallMcpServer(e => this._onUninstallMcpServer.fire(e)));\n\t\t\tdisposables.add(service.onDidUninstallMcpServer(e => this._onDidUninstallMcpServer.fire(e)));\n\t\t\tthis.mcpResourceManagementServices.set(mcpResource, mcpResourceManagementService = { service, dispose: () => disposables.dispose() });\n\t\t}\n\t\treturn mcpResourceManagementService.service;\n\t}\n\n\tasync getInstalled(mcpResource?: URI): Promise<ILocalMcpServer[]> {\n\t\tconst mcpResourceUri = mcpResource || this.userDataProfilesService.defaultProfile.mcpResource;\n\t\treturn this.getMcpResourceManagementService(mcpResourceUri).getInstalled();\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tconst mcpResourceUri = options?.mcpResource || this.userDataProfilesService.defaultProfile.mcpResource;\n\t\treturn this.getMcpResourceManagementService(mcpResourceUri).install(server, options);\n\t}\n\n\tasync uninstall(server: ILocalMcpServer, options?: UninstallOptions): Promise<void> {\n\t\tconst mcpResourceUri = options?.mcpResource || this.userDataProfilesService.defaultProfile.mcpResource;\n\t\treturn this.getMcpResourceManagementService(mcpResourceUri).uninstall(server, options);\n\t}\n\n\tasync installFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tconst mcpResourceUri = options?.mcpResource || this.userDataProfilesService.defaultProfile.mcpResource;\n\t\treturn this.getMcpResourceManagementService(mcpResourceUri).installFromGallery(server, options);\n\t}\n\n\tasync updateMetadata(local: ILocalMcpServer, gallery: IGalleryMcpServer, mcpResource?: URI): Promise<ILocalMcpServer> {\n\t\treturn this.getMcpResourceManagementService(mcpResource || this.userDataProfilesService.defaultProfile.mcpResource).updateMetadata(local, gallery);\n\t}\n\n\toverride dispose(): void {\n\t\tthis.mcpResourceManagementServices.forEach(service => service.dispose());\n\t\tthis.mcpResourceManagementServices.clear();\n\t\tsuper.dispose();\n\t}\n\n\tprotected createMcpResourceManagementService(mcpResource: URI): McpUserResourceManagementService {\n\t\treturn this.instantiationService.createInstance(McpUserResourceManagementService, mcpResource);\n\t}\n\n}\n"]}