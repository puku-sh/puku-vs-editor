{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/mcp/common/mcpGalleryManifestService.ts","vs/platform/mcp/common/mcpGalleryManifestService.ts"],"names":[],"mappings":"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","file":"mcpGalleryManifestService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IRequestService, isSuccess } from '../../request/common/request.js';\nimport { McpGalleryResourceType, IMcpGalleryManifest, IMcpGalleryManifestService, McpGalleryManifestStatus } from './mcpGalleryManifest.js';\n\nconst SUPPORTED_VERSIONS = [\n\t'v0.1',\n\t'v0',\n];\n\nexport class McpGalleryManifestService extends Disposable implements IMcpGalleryManifestService {\n\n\treadonly _serviceBrand: undefined;\n\treadonly onDidChangeMcpGalleryManifest = Event.None;\n\treadonly onDidChangeMcpGalleryManifestStatus = Event.None;\n\n\tprivate readonly versionByUrl = new Map<string, Promise<string>>();\n\n\tget mcpGalleryManifestStatus(): McpGalleryManifestStatus {\n\t\treturn !!this.productService.mcpGallery?.serviceUrl ? McpGalleryManifestStatus.Available : McpGalleryManifestStatus.Unavailable;\n\t}\n\n\tconstructor(\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getMcpGalleryManifest(): Promise<IMcpGalleryManifest | null> {\n\t\tif (!this.productService.mcpGallery) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.createMcpGalleryManifest(this.productService.mcpGallery.serviceUrl, SUPPORTED_VERSIONS[0]);\n\t}\n\n\tprotected async createMcpGalleryManifest(url: string, version?: string): Promise<IMcpGalleryManifest> {\n\t\turl = url.endsWith('/') ? url.slice(0, -1) : url;\n\n\t\tif (!version) {\n\t\t\tlet versionPromise = this.versionByUrl.get(url);\n\t\t\tif (!versionPromise) {\n\t\t\t\tthis.versionByUrl.set(url, versionPromise = this.getVersion(url));\n\t\t\t}\n\t\t\tversion = await versionPromise;\n\t\t}\n\n\t\tconst isProductGalleryUrl = this.productService.mcpGallery?.serviceUrl === url;\n\t\tconst serversUrl = `${url}/${version}/servers`;\n\t\tconst resources = [\n\t\t\t{\n\t\t\t\tid: serversUrl,\n\t\t\t\ttype: McpGalleryResourceType.McpServersQueryService\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: `${serversUrl}/{name}/versions/{version}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerVersionUri\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: `${serversUrl}/{name}/versions/latest`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerLatestVersionUri\n\t\t\t}\n\t\t];\n\n\t\tif (isProductGalleryUrl) {\n\t\t\tresources.push({\n\t\t\t\tid: `${serversUrl}/by-name/{name}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerNamedResourceUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.itemWebUrl,\n\t\t\t\ttype: McpGalleryResourceType.McpServerWebUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.publisherUrl,\n\t\t\t\ttype: McpGalleryResourceType.PublisherUriTemplate\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.supportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ContactSupportUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.supportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ContactSupportUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.privacyPolicyUrl,\n\t\t\t\ttype: McpGalleryResourceType.PrivacyPolicyUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.termsOfServiceUrl,\n\t\t\t\ttype: McpGalleryResourceType.TermsOfServiceUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.reportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ReportUri\n\t\t\t});\n\t\t}\n\n\t\tif (version === 'v0') {\n\t\t\tresources.push({\n\t\t\t\tid: `${serversUrl}/{id}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerIdUri\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tversion,\n\t\t\turl,\n\t\t\tresources\n\t\t};\n\t}\n\n\tprivate async getVersion(url: string): Promise<string> {\n\t\tfor (const version of SUPPORTED_VERSIONS) {\n\t\t\tif (await this.checkVersion(url, version)) {\n\t\t\t\treturn version;\n\t\t\t}\n\t\t}\n\t\treturn SUPPORTED_VERSIONS[0];\n\t}\n\n\tprivate async checkVersion(url: string, version: string): Promise<boolean> {\n\t\ttry {\n\t\t\tconst context = await this.requestService.request({\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: `${url}/${version}/servers?limit=1`,\n\t\t\t}, CancellationToken.None);\n\t\t\tif (isSuccess(context)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.logService.info(`The service at ${url} does not support version ${version}. Service returned status ${context.res.statusCode}.`);\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\treturn false;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IRequestService, isSuccess } from '../../request/common/request.js';\nimport { McpGalleryResourceType, IMcpGalleryManifest, IMcpGalleryManifestService, McpGalleryManifestStatus } from './mcpGalleryManifest.js';\n\nconst SUPPORTED_VERSIONS = [\n\t'v0.1',\n\t'v0',\n];\n\nexport class McpGalleryManifestService extends Disposable implements IMcpGalleryManifestService {\n\n\treadonly _serviceBrand: undefined;\n\treadonly onDidChangeMcpGalleryManifest = Event.None;\n\treadonly onDidChangeMcpGalleryManifestStatus = Event.None;\n\n\tprivate readonly versionByUrl = new Map<string, Promise<string>>();\n\n\tget mcpGalleryManifestStatus(): McpGalleryManifestStatus {\n\t\treturn !!this.productService.mcpGallery?.serviceUrl ? McpGalleryManifestStatus.Available : McpGalleryManifestStatus.Unavailable;\n\t}\n\n\tconstructor(\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getMcpGalleryManifest(): Promise<IMcpGalleryManifest | null> {\n\t\tif (!this.productService.mcpGallery) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.createMcpGalleryManifest(this.productService.mcpGallery.serviceUrl, SUPPORTED_VERSIONS[0]);\n\t}\n\n\tprotected async createMcpGalleryManifest(url: string, version?: string): Promise<IMcpGalleryManifest> {\n\t\turl = url.endsWith('/') ? url.slice(0, -1) : url;\n\n\t\tif (!version) {\n\t\t\tlet versionPromise = this.versionByUrl.get(url);\n\t\t\tif (!versionPromise) {\n\t\t\t\tthis.versionByUrl.set(url, versionPromise = this.getVersion(url));\n\t\t\t}\n\t\t\tversion = await versionPromise;\n\t\t}\n\n\t\tconst isProductGalleryUrl = this.productService.mcpGallery?.serviceUrl === url;\n\t\tconst serversUrl = `${url}/${version}/servers`;\n\t\tconst resources = [\n\t\t\t{\n\t\t\t\tid: serversUrl,\n\t\t\t\ttype: McpGalleryResourceType.McpServersQueryService\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: `${serversUrl}/{name}/versions/{version}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerVersionUri\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: `${serversUrl}/{name}/versions/latest`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerLatestVersionUri\n\t\t\t}\n\t\t];\n\n\t\tif (isProductGalleryUrl) {\n\t\t\tresources.push({\n\t\t\t\tid: `${serversUrl}/by-name/{name}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerNamedResourceUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.itemWebUrl,\n\t\t\t\ttype: McpGalleryResourceType.McpServerWebUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.publisherUrl,\n\t\t\t\ttype: McpGalleryResourceType.PublisherUriTemplate\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.supportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ContactSupportUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.supportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ContactSupportUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.privacyPolicyUrl,\n\t\t\t\ttype: McpGalleryResourceType.PrivacyPolicyUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.termsOfServiceUrl,\n\t\t\t\ttype: McpGalleryResourceType.TermsOfServiceUri\n\t\t\t});\n\t\t\tresources.push({\n\t\t\t\tid: this.productService.mcpGallery.reportUrl,\n\t\t\t\ttype: McpGalleryResourceType.ReportUri\n\t\t\t});\n\t\t}\n\n\t\tif (version === 'v0') {\n\t\t\tresources.push({\n\t\t\t\tid: `${serversUrl}/{id}`,\n\t\t\t\ttype: McpGalleryResourceType.McpServerIdUri\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tversion,\n\t\t\turl,\n\t\t\tresources\n\t\t};\n\t}\n\n\tprivate async getVersion(url: string): Promise<string> {\n\t\tfor (const version of SUPPORTED_VERSIONS) {\n\t\t\tif (await this.checkVersion(url, version)) {\n\t\t\t\treturn version;\n\t\t\t}\n\t\t}\n\t\treturn SUPPORTED_VERSIONS[0];\n\t}\n\n\tprivate async checkVersion(url: string, version: string): Promise<boolean> {\n\t\ttry {\n\t\t\tconst context = await this.requestService.request({\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: `${url}/${version}/servers?limit=1`,\n\t\t\t}, CancellationToken.None);\n\t\t\tif (isSuccess(context)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.logService.info(`The service at ${url} does not support version ${version}. Service returned status ${context.res.statusCode}.`);\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\treturn false;\n\t}\n}\n"]}