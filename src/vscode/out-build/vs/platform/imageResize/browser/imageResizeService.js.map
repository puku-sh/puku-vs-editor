{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/imageResize/browser/imageResizeService.ts","vs/platform/imageResize/browser/imageResizeService.ts"],"names":[],"mappings":"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","file":"imageResizeService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { decodeBase64, VSBuffer } from '../../../base/common/buffer.js';\nimport { joinPath } from '../../../base/common/resources.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IImageResizeService } from '../common/imageResizeService.js';\n\n\nexport class ImageResizeService implements IImageResizeService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\t/**\n\t * Resizes an image provided as a UInt8Array string. Resizing is based on Open AI's algorithm for tokenzing images.\n\t * https://platform.openai.com/docs/guides/vision#calculating-costs\n\t * @param data - The UInt8Array string of the image to resize.\n\t * @returns A promise that resolves to the UInt8Array string of the resized image.\n\t */\n\n\tasync resizeImage(data: Uint8Array | string, mimeType?: string): Promise<Uint8Array> {\n\t\tconst isGif = mimeType === 'image/gif';\n\n\t\tif (typeof data === 'string') {\n\t\t\tdata = this.convertStringToUInt8Array(data);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst blob = new Blob([data as Uint8Array<ArrayBuffer>], { type: mimeType });\n\t\t\tconst img = new Image();\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\timg.src = url;\n\n\t\t\timg.onload = () => {\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\tlet { width, height } = img;\n\n\t\t\t\tif ((width <= 768 || height <= 768) && !isGif) {\n\t\t\t\t\tresolve(data);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Calculate the new dimensions while maintaining the aspect ratio\n\t\t\t\tif (width > 2048 || height > 2048) {\n\t\t\t\t\tconst scaleFactor = 2048 / Math.max(width, height);\n\t\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\t\theight = Math.round(height * scaleFactor);\n\t\t\t\t}\n\n\t\t\t\tconst scaleFactor = 768 / Math.min(width, height);\n\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\theight = Math.round(height * scaleFactor);\n\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\t\tif (ctx) {\n\t\t\t\t\tctx.drawImage(img, 0, 0, width, height);\n\n\t\t\t\t\tconst jpegTypes = ['image/jpeg', 'image/jpg'];\n\t\t\t\t\tconst outputMimeType = mimeType && jpegTypes.includes(mimeType) ? 'image/jpeg' : 'image/png';\n\n\t\t\t\t\tcanvas.toBlob(blob => {\n\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.onerror = (error) => reject(error);\n\t\t\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(new Error('Failed to create blob from canvas'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, outputMimeType);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('Failed to get canvas context'));\n\t\t\t\t}\n\t\t\t};\n\t\t\timg.onerror = (error) => {\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\treject(error);\n\t\t\t};\n\t\t});\n\t}\n\n\tconvertStringToUInt8Array(data: string): Uint8Array {\n\t\tconst base64Data = data.includes(',') ? data.split(',')[1] : data;\n\t\tif (this.isValidBase64(base64Data)) {\n\t\t\treturn decodeBase64(base64Data).buffer;\n\t\t}\n\t\treturn new TextEncoder().encode(data);\n\t}\n\n\t// Only used for URLs\n\tconvertUint8ArrayToString(data: Uint8Array): string {\n\t\ttry {\n\t\t\tconst decoder = new TextDecoder();\n\t\t\tconst decodedString = decoder.decode(data);\n\t\t\treturn decodedString;\n\t\t} catch {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tisValidBase64(str: string): boolean {\n\t\ttry {\n\t\t\tdecodeBase64(str);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync createFileForMedia(fileService: IFileService, imagesFolder: URI, dataTransfer: Uint8Array, mimeType: string): Promise<URI | undefined> {\n\t\tconst exists = await fileService.exists(imagesFolder);\n\t\tif (!exists) {\n\t\t\tawait fileService.createFolder(imagesFolder);\n\t\t}\n\n\t\tconst ext = mimeType.split('/')[1] || 'png';\n\t\tconst filename = `image-${Date.now()}.${ext}`;\n\t\tconst fileUri = joinPath(imagesFolder, filename);\n\n\t\tconst buffer = VSBuffer.wrap(dataTransfer);\n\t\tawait fileService.writeFile(fileUri, buffer);\n\n\t\treturn fileUri;\n\t}\n\n\tasync cleanupOldImages(fileService: IFileService, logService: ILogService, imagesFolder: URI): Promise<void> {\n\t\tconst exists = await fileService.exists(imagesFolder);\n\t\tif (!exists) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst duration = 7 * 24 * 60 * 60 * 1000; // 7 days\n\t\tconst files = await fileService.resolve(imagesFolder);\n\t\tif (!files.children) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.all(files.children.map(async (file) => {\n\t\t\ttry {\n\t\t\t\tconst timestamp = this.getTimestampFromFilename(file.name);\n\t\t\t\tif (timestamp && (Date.now() - timestamp > duration)) {\n\t\t\t\t\tawait fileService.del(file.resource);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tlogService.error('Failed to clean up old images', err);\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetTimestampFromFilename(filename: string): number | undefined {\n\t\tconst match = filename.match(/image-(\\d+)\\./);\n\t\tif (match) {\n\t\t\treturn parseInt(match[1], 10);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\n}\n\nregisterSingleton(IImageResizeService, ImageResizeService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { decodeBase64, VSBuffer } from '../../../base/common/buffer.js';\nimport { joinPath } from '../../../base/common/resources.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IImageResizeService } from '../common/imageResizeService.js';\n\n\nexport class ImageResizeService implements IImageResizeService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\t/**\n\t * Resizes an image provided as a UInt8Array string. Resizing is based on Open AI's algorithm for tokenzing images.\n\t * https://platform.openai.com/docs/guides/vision#calculating-costs\n\t * @param data - The UInt8Array string of the image to resize.\n\t * @returns A promise that resolves to the UInt8Array string of the resized image.\n\t */\n\n\tasync resizeImage(data: Uint8Array | string, mimeType?: string): Promise<Uint8Array> {\n\t\tconst isGif = mimeType === 'image/gif';\n\n\t\tif (typeof data === 'string') {\n\t\t\tdata = this.convertStringToUInt8Array(data);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst blob = new Blob([data as Uint8Array<ArrayBuffer>], { type: mimeType });\n\t\t\tconst img = new Image();\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\timg.src = url;\n\n\t\t\timg.onload = () => {\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\tlet { width, height } = img;\n\n\t\t\t\tif ((width <= 768 || height <= 768) && !isGif) {\n\t\t\t\t\tresolve(data);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Calculate the new dimensions while maintaining the aspect ratio\n\t\t\t\tif (width > 2048 || height > 2048) {\n\t\t\t\t\tconst scaleFactor = 2048 / Math.max(width, height);\n\t\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\t\theight = Math.round(height * scaleFactor);\n\t\t\t\t}\n\n\t\t\t\tconst scaleFactor = 768 / Math.min(width, height);\n\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\theight = Math.round(height * scaleFactor);\n\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\t\tif (ctx) {\n\t\t\t\t\tctx.drawImage(img, 0, 0, width, height);\n\n\t\t\t\t\tconst jpegTypes = ['image/jpeg', 'image/jpg'];\n\t\t\t\t\tconst outputMimeType = mimeType && jpegTypes.includes(mimeType) ? 'image/jpeg' : 'image/png';\n\n\t\t\t\t\tcanvas.toBlob(blob => {\n\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.onerror = (error) => reject(error);\n\t\t\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(new Error('Failed to create blob from canvas'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, outputMimeType);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('Failed to get canvas context'));\n\t\t\t\t}\n\t\t\t};\n\t\t\timg.onerror = (error) => {\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\treject(error);\n\t\t\t};\n\t\t});\n\t}\n\n\tconvertStringToUInt8Array(data: string): Uint8Array {\n\t\tconst base64Data = data.includes(',') ? data.split(',')[1] : data;\n\t\tif (this.isValidBase64(base64Data)) {\n\t\t\treturn decodeBase64(base64Data).buffer;\n\t\t}\n\t\treturn new TextEncoder().encode(data);\n\t}\n\n\t// Only used for URLs\n\tconvertUint8ArrayToString(data: Uint8Array): string {\n\t\ttry {\n\t\t\tconst decoder = new TextDecoder();\n\t\t\tconst decodedString = decoder.decode(data);\n\t\t\treturn decodedString;\n\t\t} catch {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tisValidBase64(str: string): boolean {\n\t\ttry {\n\t\t\tdecodeBase64(str);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync createFileForMedia(fileService: IFileService, imagesFolder: URI, dataTransfer: Uint8Array, mimeType: string): Promise<URI | undefined> {\n\t\tconst exists = await fileService.exists(imagesFolder);\n\t\tif (!exists) {\n\t\t\tawait fileService.createFolder(imagesFolder);\n\t\t}\n\n\t\tconst ext = mimeType.split('/')[1] || 'png';\n\t\tconst filename = `image-${Date.now()}.${ext}`;\n\t\tconst fileUri = joinPath(imagesFolder, filename);\n\n\t\tconst buffer = VSBuffer.wrap(dataTransfer);\n\t\tawait fileService.writeFile(fileUri, buffer);\n\n\t\treturn fileUri;\n\t}\n\n\tasync cleanupOldImages(fileService: IFileService, logService: ILogService, imagesFolder: URI): Promise<void> {\n\t\tconst exists = await fileService.exists(imagesFolder);\n\t\tif (!exists) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst duration = 7 * 24 * 60 * 60 * 1000; // 7 days\n\t\tconst files = await fileService.resolve(imagesFolder);\n\t\tif (!files.children) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.all(files.children.map(async (file) => {\n\t\t\ttry {\n\t\t\t\tconst timestamp = this.getTimestampFromFilename(file.name);\n\t\t\t\tif (timestamp && (Date.now() - timestamp > duration)) {\n\t\t\t\t\tawait fileService.del(file.resource);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tlogService.error('Failed to clean up old images', err);\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetTimestampFromFilename(filename: string): number | undefined {\n\t\tconst match = filename.match(/image-(\\d+)\\./);\n\t\tif (match) {\n\t\t\treturn parseInt(match[1], 10);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\n}\n\nregisterSingleton(IImageResizeService, ImageResizeService, InstantiationType.Delayed);\n"]}