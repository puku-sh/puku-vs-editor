{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/debug/electron-main/extensionHostDebugIpc.ts","vs/platform/debug/electron-main/extensionHostDebugIpc.ts"],"names":[],"mappings":"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","file":"extensionHostDebugIpc.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserWindow } from 'electron';\nimport { Socket } from 'net';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { ISocket } from '../../../base/parts/ipc/common/ipc.net.js';\nimport { upgradeToISocket } from '../../../base/parts/ipc/node/ipc.net.js';\nimport { OPTIONS, parseArgs } from '../../environment/node/argv.js';\nimport { IWindowsMainService, OpenContext } from '../../windows/electron-main/windows.js';\nimport { IOpenExtensionWindowResult } from '../common/extensionHostDebug.js';\nimport { ExtensionHostDebugBroadcastChannel } from '../common/extensionHostDebugIpc.js';\n\nexport class ElectronExtensionHostDebugBroadcastChannel<TContext> extends ExtensionHostDebugBroadcastChannel<TContext> {\n\n\tconstructor(\n\t\tprivate windowsMainService: IWindowsMainService\n\t) {\n\t\tsuper();\n\t}\n\n\toverride call(ctx: TContext, command: string, arg?: any): Promise<any> {\n\t\tif (command === 'openExtensionDevelopmentHostWindow') {\n\t\t\treturn this.openExtensionDevelopmentHostWindow(arg[0], arg[1]);\n\t\t} else if (command === 'attachToCurrentWindowRenderer') {\n\t\t\treturn this.attachToCurrentWindowRenderer(arg[0]);\n\t\t} else {\n\t\t\treturn super.call(ctx, command, arg);\n\t\t}\n\t}\n\n\tprivate async attachToCurrentWindowRenderer(windowId: number): Promise<IOpenExtensionWindowResult> {\n\t\tconst codeWindow = this.windowsMainService.getWindowById(windowId);\n\t\tif (!codeWindow?.win) {\n\t\t\treturn { success: false };\n\t\t}\n\n\t\treturn this.openCdp(codeWindow.win);\n\t}\n\n\tprivate async openExtensionDevelopmentHostWindow(args: string[], debugRenderer: boolean): Promise<IOpenExtensionWindowResult> {\n\t\tconst pargs = parseArgs(args, OPTIONS);\n\t\tpargs.debugRenderer = debugRenderer;\n\n\t\tconst extDevPaths = pargs.extensionDevelopmentPath;\n\t\tif (!extDevPaths) {\n\t\t\treturn { success: false };\n\t\t}\n\n\t\tconst [codeWindow] = await this.windowsMainService.openExtensionDevelopmentHostWindow(extDevPaths, {\n\t\t\tcontext: OpenContext.API,\n\t\t\tcli: pargs,\n\t\t\tforceProfile: pargs.profile,\n\t\t\tforceTempProfile: pargs['profile-temp']\n\t\t});\n\n\t\tif (!debugRenderer) {\n\t\t\treturn { success: true };\n\t\t}\n\n\t\tconst win = codeWindow.win;\n\t\tif (!win) {\n\t\t\treturn { success: true };\n\t\t}\n\n\t\treturn this.openCdp(win);\n\t}\n\n\tprivate async openCdpServer(ident: string, onSocket: (socket: ISocket) => void) {\n\t\tconst { createServer } = await import('http'); // Lazy due to https://github.com/nodejs/node/issues/59686\n\t\tconst server = createServer((req, res) => {\n\t\t\tres.statusCode = 404;\n\t\t\tres.end();\n\t\t});\n\n\t\tserver.on('upgrade', (req, socket) => {\n\t\t\tif (!req.url?.includes(ident)) {\n\t\t\t\tsocket.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst upgraded = upgradeToISocket(req, socket as Socket, {\n\t\t\t\tdebugLabel: 'extension-host-cdp-' + generateUuid(),\n\t\t\t});\n\n\t\t\tif (upgraded) {\n\t\t\t\tonSocket(upgraded);\n\t\t\t}\n\t\t});\n\n\t\treturn server;\n\t}\n\n\tprivate async openCdp(win: BrowserWindow): Promise<IOpenExtensionWindowResult> {\n\t\tconst debug = win.webContents.debugger;\n\n\t\tlet listeners = debug.isAttached() ? Infinity : 0;\n\t\tconst ident = generateUuid();\n\t\tconst server = await this.openCdpServer(ident, listener => {\n\t\t\tif (listeners++ === 0) {\n\t\t\t\tdebug.attach();\n\t\t\t}\n\n\t\t\tconst store = new DisposableStore();\n\t\t\tstore.add(listener);\n\n\t\t\tconst writeMessage = (message: object) => {\n\t\t\t\tif (!store.isDisposed) { // in case sendCommand promises settle after closed\n\t\t\t\t\tlistener.write(VSBuffer.fromString(JSON.stringify(message))); // null-delimited, CDP-compatible\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst onMessage = (_event: Electron.Event, method: string, params: unknown, sessionId?: string) =>\n\t\t\t\twriteMessage({ method, params, sessionId });\n\n\t\t\tconst onWindowClose = () => {\n\t\t\t\tlistener.end();\n\t\t\t\tstore.dispose();\n\t\t\t};\n\n\t\t\twin.addListener('close', onWindowClose);\n\t\t\tstore.add(toDisposable(() => win.removeListener('close', onWindowClose)));\n\n\t\t\tdebug.addListener('message', onMessage);\n\t\t\tstore.add(toDisposable(() => debug.removeListener('message', onMessage)));\n\n\t\t\tstore.add(listener.onData(rawData => {\n\t\t\t\tlet data: { id: number; sessionId: string; method: string; params: {} };\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(rawData.toString());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('error reading cdp line', e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdebug.sendCommand(data.method, data.params, data.sessionId)\n\t\t\t\t\t.then((result: object) => writeMessage({ id: data.id, sessionId: data.sessionId, result }))\n\t\t\t\t\t.catch((error: Error) => writeMessage({ id: data.id, sessionId: data.sessionId, error: { code: 0, message: error.message } }));\n\t\t\t}));\n\n\t\t\tstore.add(listener.onClose(() => {\n\t\t\t\tif (--listeners === 0) {\n\t\t\t\t\tdebug.detach();\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\tawait new Promise<void>(r => server.listen(0, '127.0.0.1', r));\n\t\twin.on('close', () => server.close());\n\n\t\tconst serverAddr = server.address();\n\t\tconst serverAddrBase = typeof serverAddr === 'string' ? serverAddr : `ws://127.0.0.1:${serverAddr?.port}`;\n\t\treturn { rendererDebugAddr: `${serverAddrBase}/${ident}`, success: true };\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserWindow } from 'electron';\nimport { Socket } from 'net';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { ISocket } from '../../../base/parts/ipc/common/ipc.net.js';\nimport { upgradeToISocket } from '../../../base/parts/ipc/node/ipc.net.js';\nimport { OPTIONS, parseArgs } from '../../environment/node/argv.js';\nimport { IWindowsMainService, OpenContext } from '../../windows/electron-main/windows.js';\nimport { IOpenExtensionWindowResult } from '../common/extensionHostDebug.js';\nimport { ExtensionHostDebugBroadcastChannel } from '../common/extensionHostDebugIpc.js';\n\nexport class ElectronExtensionHostDebugBroadcastChannel<TContext> extends ExtensionHostDebugBroadcastChannel<TContext> {\n\n\tconstructor(\n\t\tprivate windowsMainService: IWindowsMainService\n\t) {\n\t\tsuper();\n\t}\n\n\toverride call(ctx: TContext, command: string, arg?: any): Promise<any> {\n\t\tif (command === 'openExtensionDevelopmentHostWindow') {\n\t\t\treturn this.openExtensionDevelopmentHostWindow(arg[0], arg[1]);\n\t\t} else if (command === 'attachToCurrentWindowRenderer') {\n\t\t\treturn this.attachToCurrentWindowRenderer(arg[0]);\n\t\t} else {\n\t\t\treturn super.call(ctx, command, arg);\n\t\t}\n\t}\n\n\tprivate async attachToCurrentWindowRenderer(windowId: number): Promise<IOpenExtensionWindowResult> {\n\t\tconst codeWindow = this.windowsMainService.getWindowById(windowId);\n\t\tif (!codeWindow?.win) {\n\t\t\treturn { success: false };\n\t\t}\n\n\t\treturn this.openCdp(codeWindow.win);\n\t}\n\n\tprivate async openExtensionDevelopmentHostWindow(args: string[], debugRenderer: boolean): Promise<IOpenExtensionWindowResult> {\n\t\tconst pargs = parseArgs(args, OPTIONS);\n\t\tpargs.debugRenderer = debugRenderer;\n\n\t\tconst extDevPaths = pargs.extensionDevelopmentPath;\n\t\tif (!extDevPaths) {\n\t\t\treturn { success: false };\n\t\t}\n\n\t\tconst [codeWindow] = await this.windowsMainService.openExtensionDevelopmentHostWindow(extDevPaths, {\n\t\t\tcontext: OpenContext.API,\n\t\t\tcli: pargs,\n\t\t\tforceProfile: pargs.profile,\n\t\t\tforceTempProfile: pargs['profile-temp']\n\t\t});\n\n\t\tif (!debugRenderer) {\n\t\t\treturn { success: true };\n\t\t}\n\n\t\tconst win = codeWindow.win;\n\t\tif (!win) {\n\t\t\treturn { success: true };\n\t\t}\n\n\t\treturn this.openCdp(win);\n\t}\n\n\tprivate async openCdpServer(ident: string, onSocket: (socket: ISocket) => void) {\n\t\tconst { createServer } = await import('http'); // Lazy due to https://github.com/nodejs/node/issues/59686\n\t\tconst server = createServer((req, res) => {\n\t\t\tres.statusCode = 404;\n\t\t\tres.end();\n\t\t});\n\n\t\tserver.on('upgrade', (req, socket) => {\n\t\t\tif (!req.url?.includes(ident)) {\n\t\t\t\tsocket.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst upgraded = upgradeToISocket(req, socket as Socket, {\n\t\t\t\tdebugLabel: 'extension-host-cdp-' + generateUuid(),\n\t\t\t});\n\n\t\t\tif (upgraded) {\n\t\t\t\tonSocket(upgraded);\n\t\t\t}\n\t\t});\n\n\t\treturn server;\n\t}\n\n\tprivate async openCdp(win: BrowserWindow): Promise<IOpenExtensionWindowResult> {\n\t\tconst debug = win.webContents.debugger;\n\n\t\tlet listeners = debug.isAttached() ? Infinity : 0;\n\t\tconst ident = generateUuid();\n\t\tconst server = await this.openCdpServer(ident, listener => {\n\t\t\tif (listeners++ === 0) {\n\t\t\t\tdebug.attach();\n\t\t\t}\n\n\t\t\tconst store = new DisposableStore();\n\t\t\tstore.add(listener);\n\n\t\t\tconst writeMessage = (message: object) => {\n\t\t\t\tif (!store.isDisposed) { // in case sendCommand promises settle after closed\n\t\t\t\t\tlistener.write(VSBuffer.fromString(JSON.stringify(message))); // null-delimited, CDP-compatible\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst onMessage = (_event: Electron.Event, method: string, params: unknown, sessionId?: string) =>\n\t\t\t\twriteMessage({ method, params, sessionId });\n\n\t\t\tconst onWindowClose = () => {\n\t\t\t\tlistener.end();\n\t\t\t\tstore.dispose();\n\t\t\t};\n\n\t\t\twin.addListener('close', onWindowClose);\n\t\t\tstore.add(toDisposable(() => win.removeListener('close', onWindowClose)));\n\n\t\t\tdebug.addListener('message', onMessage);\n\t\t\tstore.add(toDisposable(() => debug.removeListener('message', onMessage)));\n\n\t\t\tstore.add(listener.onData(rawData => {\n\t\t\t\tlet data: { id: number; sessionId: string; method: string; params: {} };\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(rawData.toString());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('error reading cdp line', e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdebug.sendCommand(data.method, data.params, data.sessionId)\n\t\t\t\t\t.then((result: object) => writeMessage({ id: data.id, sessionId: data.sessionId, result }))\n\t\t\t\t\t.catch((error: Error) => writeMessage({ id: data.id, sessionId: data.sessionId, error: { code: 0, message: error.message } }));\n\t\t\t}));\n\n\t\t\tstore.add(listener.onClose(() => {\n\t\t\t\tif (--listeners === 0) {\n\t\t\t\t\tdebug.detach();\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\tawait new Promise<void>(r => server.listen(0, '127.0.0.1', r));\n\t\twin.on('close', () => server.close());\n\n\t\tconst serverAddr = server.address();\n\t\tconst serverAddrBase = typeof serverAddr === 'string' ? serverAddr : `ws://127.0.0.1:${serverAddr?.port}`;\n\t\treturn { rendererDebugAddr: `${serverAddrBase}/${ident}`, success: true };\n\t}\n}\n"]}