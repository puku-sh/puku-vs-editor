{"version":3,"sources":["vs/platform/shell/node/shellEnv.ts"],"names":[],"mappings":"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","file":"shellEnv.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { spawn } from 'child_process';\nimport { basename } from '../../../base/common/path.js';\nimport { localize } from '../../../nls.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { CancellationError, isCancellationError } from '../../../base/common/errors.js';\nimport { IProcessEnvironment, isWindows, OS } from '../../../base/common/platform.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { getSystemShell } from '../../../base/node/shell.js';\nimport { NativeParsedArgs } from '../../environment/common/argv.js';\nimport { isLaunchedFromCli } from '../../environment/node/argvHelper.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { Promises } from '../../../base/common/async.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { clamp } from '../../../base/common/numbers.js';\n\nlet unixShellEnvPromise: Promise<typeof process.env> | undefined = undefined;\n\n/**\n * Resolves the shell environment by spawning a shell. This call will cache\n * the shell spawning so that subsequent invocations use that cached result.\n *\n * Will throw an error if:\n * - we hit a timeout of `MAX_SHELL_RESOLVE_TIME`\n * - any other error from spawning a shell to figure out the environment\n */\nexport async function getResolvedShellEnv(configurationService: IConfigurationService, logService: ILogService, args: NativeParsedArgs, env: IProcessEnvironment): Promise<typeof process.env> {\n\n\t// Skip if --force-disable-user-env\n\tif (args['force-disable-user-env']) {\n\t\tlogService.trace('resolveShellEnv(): skipped (--force-disable-user-env)');\n\n\t\treturn {};\n\t}\n\n\t// Skip on windows\n\telse if (isWindows) {\n\t\tlogService.trace('resolveShellEnv(): skipped (Windows)');\n\n\t\treturn {};\n\t}\n\n\t// Skip if running from CLI already\n\telse if (isLaunchedFromCli(env) && !args['force-user-env']) {\n\t\tlogService.trace('resolveShellEnv(): skipped (VSCODE_CLI is set)');\n\n\t\treturn {};\n\t}\n\n\t// Otherwise resolve (macOS, Linux)\n\telse {\n\t\tif (isLaunchedFromCli(env)) {\n\t\t\tlogService.trace('resolveShellEnv(): running (--force-user-env)');\n\t\t} else {\n\t\t\tlogService.trace('resolveShellEnv(): running (macOS/Linux)');\n\t\t}\n\n\t\t// Call this only once and cache the promise for\n\t\t// subsequent calls since this operation can be\n\t\t// expensive (spawns a process).\n\t\tif (!unixShellEnvPromise) {\n\t\t\tunixShellEnvPromise = Promises.withAsyncBody<NodeJS.ProcessEnv>(async (resolve, reject) => {\n\t\t\t\tconst cts = new CancellationTokenSource();\n\n\t\t\t\tlet timeoutValue = 10000; // default to 10 seconds\n\t\t\t\tconst configuredTimeoutValue = configurationService.getValue<unknown>('application.shellEnvironmentResolutionTimeout');\n\t\t\t\tif (typeof configuredTimeoutValue === 'number') {\n\t\t\t\t\ttimeoutValue = clamp(configuredTimeoutValue, 1, 120) * 1000 /* convert from seconds */;\n\t\t\t\t}\n\n\t\t\t\t// Give up resolving shell env after some time\n\t\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\t\tcts.dispose(true);\n\t\t\t\t\treject(new Error(localize('resolveShellEnvTimeout', \"Unable to resolve your shell environment in a reasonable time. Please review your shell configuration and restart.\")));\n\t\t\t\t}, timeoutValue);\n\n\t\t\t\t// Resolve shell env and handle errors\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await doResolveUnixShellEnv(logService, cts.token));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (!isCancellationError(error) && !cts.token.isCancellationRequested) {\n\t\t\t\t\t\treject(new Error(localize('resolveShellEnvError', \"Unable to resolve your shell environment: {0}\", toErrorMessage(error))));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve({});\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\tcts.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn unixShellEnvPromise;\n\t}\n}\n\nasync function doResolveUnixShellEnv(logService: ILogService, token: CancellationToken): Promise<typeof process.env> {\n\tconst runAsNode = process.env['ELECTRON_RUN_AS_NODE'];\n\tlogService.trace('getUnixShellEnvironment#runAsNode', runAsNode);\n\n\tconst noAttach = process.env['ELECTRON_NO_ATTACH_CONSOLE'];\n\tlogService.trace('getUnixShellEnvironment#noAttach', noAttach);\n\n\tconst mark = generateUuid().replace(/-/g, '').substr(0, 12);\n\tconst regex = new RegExp(mark + '({.*})' + mark);\n\n\tconst env = {\n\t\t...process.env,\n\t\tELECTRON_RUN_AS_NODE: '1',\n\t\tELECTRON_NO_ATTACH_CONSOLE: '1',\n\t\tVSCODE_RESOLVING_ENVIRONMENT: '1'\n\t};\n\n\tlogService.trace('getUnixShellEnvironment#env', env);\n\tconst systemShellUnix = await getSystemShell(OS, env);\n\tlogService.trace('getUnixShellEnvironment#shell', systemShellUnix);\n\n\treturn new Promise<typeof process.env>((resolve, reject) => {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn reject(new CancellationError());\n\t\t}\n\n\t\t// handle popular non-POSIX shells\n\t\tconst name = basename(systemShellUnix);\n\t\tlet command: string, shellArgs: Array<string>;\n\t\tconst extraArgs = '';\n\t\tif (/^(?:pwsh|powershell)(?:-preview)?$/.test(name)) {\n\t\t\t// Older versions of PowerShell removes double quotes sometimes so we use \"double single quotes\" which is how\n\t\t\t// you escape single quotes inside of a single quoted string.\n\t\t\tcommand = `& '${process.execPath}' ${extraArgs} -p '''${mark}'' + JSON.stringify(process.env) + ''${mark}'''`;\n\t\t\tshellArgs = ['-Login', '-Command'];\n\t\t} else if (name === 'nu') { // nushell requires ^ before quoted path to treat it as a command\n\t\t\tcommand = `^'${process.execPath}' ${extraArgs} -p '\"${mark}\" + JSON.stringify(process.env) + \"${mark}\"'`;\n\t\t\tshellArgs = ['-i', '-l', '-c'];\n\t\t} else if (name === 'xonsh') { // #200374: native implementation is shorter\n\t\t\tcommand = `import os, json; print(\"${mark}\", json.dumps(dict(os.environ)), \"${mark}\")`;\n\t\t\tshellArgs = ['-i', '-l', '-c'];\n\t\t} else {\n\t\t\tcommand = `'${process.execPath}' ${extraArgs} -p '\"${mark}\" + JSON.stringify(process.env) + \"${mark}\"'`;\n\n\t\t\tif (name === 'tcsh' || name === 'csh') {\n\t\t\t\tshellArgs = ['-ic'];\n\t\t\t} else {\n\t\t\t\tshellArgs = ['-i', '-l', '-c'];\n\t\t\t}\n\t\t}\n\n\t\tlogService.trace('getUnixShellEnvironment#spawn', JSON.stringify(shellArgs), command);\n\n\t\tconst child = spawn(systemShellUnix, [...shellArgs, command], {\n\t\t\tdetached: true,\n\t\t\tstdio: ['ignore', 'pipe', 'pipe'],\n\t\t\tenv\n\t\t});\n\n\t\ttoken.onCancellationRequested(() => {\n\t\t\tchild.kill();\n\n\t\t\treturn reject(new CancellationError());\n\t\t});\n\n\t\tchild.on('error', err => {\n\t\t\tlogService.error('getUnixShellEnvironment#errorChildProcess', toErrorMessage(err));\n\t\t\treject(err);\n\t\t});\n\n\t\tconst buffers: Buffer[] = [];\n\t\tchild.stdout.on('data', b => buffers.push(b));\n\n\t\tconst stderr: Buffer[] = [];\n\t\tchild.stderr.on('data', b => stderr.push(b));\n\n\t\tchild.on('close', (code, signal) => {\n\t\t\tconst raw = Buffer.concat(buffers).toString('utf8');\n\t\t\tlogService.trace('getUnixShellEnvironment#raw', raw);\n\n\t\t\tconst stderrStr = Buffer.concat(stderr).toString('utf8');\n\t\t\tif (stderrStr.trim()) {\n\t\t\t\tlogService.trace('getUnixShellEnvironment#stderr', stderrStr);\n\t\t\t}\n\n\t\t\tif (code || signal) {\n\t\t\t\treturn reject(new Error(localize('resolveShellEnvExitError', \"Unexpected exit code from spawned shell (code {0}, signal {1})\", code, signal)));\n\t\t\t}\n\n\t\t\tconst match = regex.exec(raw);\n\t\t\tconst rawStripped = match ? match[1] : '{}';\n\n\t\t\ttry {\n\t\t\t\tconst env = JSON.parse(rawStripped);\n\n\t\t\t\tif (runAsNode) {\n\t\t\t\t\tenv['ELECTRON_RUN_AS_NODE'] = runAsNode;\n\t\t\t\t} else {\n\t\t\t\t\tdelete env['ELECTRON_RUN_AS_NODE'];\n\t\t\t\t}\n\n\t\t\t\tif (noAttach) {\n\t\t\t\t\tenv['ELECTRON_NO_ATTACH_CONSOLE'] = noAttach;\n\t\t\t\t} else {\n\t\t\t\t\tdelete env['ELECTRON_NO_ATTACH_CONSOLE'];\n\t\t\t\t}\n\n\t\t\t\tdelete env['VSCODE_RESOLVING_ENVIRONMENT'];\n\n\t\t\t\t// https://github.com/microsoft/vscode/issues/22593#issuecomment-336050758\n\t\t\t\tdelete env['XDG_RUNTIME_DIR'];\n\n\t\t\t\tlogService.trace('getUnixShellEnvironment#result', env);\n\t\t\t\tresolve(env);\n\t\t\t} catch (err) {\n\t\t\t\tlogService.error('getUnixShellEnvironment#errorCaught', toErrorMessage(err));\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t});\n}\n"]}