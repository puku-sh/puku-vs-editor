{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/contextkey/test/common/parser.test.ts","vs/platform/contextkey/test/common/parser.test.ts"],"names":[],"mappings":"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","file":"parser.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { Parser } from '../../common/contextkey.js';\n\nfunction parseToStr(input: string): string {\n\tconst parser = new Parser();\n\n\tconst prints: string[] = [];\n\n\tconst print = (...ss: string[]) => { ss.forEach(s => prints.push(s)); };\n\n\tconst expr = parser.parse(input);\n\tif (expr === undefined) {\n\t\tif (parser.lexingErrors.length > 0) {\n\t\t\tprint('Lexing errors:', '\\n\\n');\n\t\t\tparser.lexingErrors.forEach(lexingError => print(`Unexpected token '${lexingError.lexeme}' at offset ${lexingError.offset}. ${lexingError.additionalInfo}`, '\\n'));\n\t\t}\n\n\t\tif (parser.parsingErrors.length > 0) {\n\t\t\tif (parser.lexingErrors.length > 0) { print('\\n --- \\n'); }\n\t\t\tprint('Parsing errors:', '\\n\\n');\n\t\t\tparser.parsingErrors.forEach(parsingError => print(`Unexpected '${parsingError.lexeme}' at offset ${parsingError.offset}.`, '\\n'));\n\t\t}\n\n\t} else {\n\t\tprint(expr.serialize());\n\t}\n\n\treturn prints.join('');\n}\n\nsuite('Context Key Parser', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest(' foo', () => {\n\t\tconst input = ' foo';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo');\n\t});\n\n\ttest('!foo', () => {\n\t\tconst input = '!foo';\n\t\tassert.deepStrictEqual(parseToStr(input), '!foo');\n\t});\n\n\ttest('foo =~ /bar/', () => {\n\t\tconst input = 'foo =~ /bar/';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo =~ /bar/');\n\t});\n\n\ttest(`foo || (foo =~ /bar/ && baz)`, () => {\n\t\tconst input = `foo || (foo =~ /bar/ && baz)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo || baz && foo =~ /bar/');\n\t});\n\n\ttest('foo || (foo =~ /bar/ || baz)', () => {\n\t\tconst input = 'foo || (foo =~ /bar/ || baz)';\n\t\tassert.deepStrictEqual(parseToStr(input), 'baz || foo || foo =~ /bar/');\n\t});\n\n\ttest(`(foo || bar) && (jee || jar)`, () => {\n\t\tconst input = `(foo || bar) && (jee || jar)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'bar && jar || bar && jee || foo && jar || foo && jee');\n\t});\n\n\ttest('foo && foo =~ /zee/i', () => {\n\t\tconst input = 'foo && foo =~ /zee/i';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo && foo =~ /zee/i');\n\t});\n\n\ttest('foo.bar==enabled', () => {\n\t\tconst input = 'foo.bar==enabled';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar == 'enabled'`);\n\t});\n\n\ttest(`foo.bar == 'enabled'`, () => {\n\t\tconst input = `foo.bar == 'enabled'`;\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar == 'enabled'`);\n\t});\n\n\ttest('foo.bar:zed==completed - equality with no space', () => {\n\t\tconst input = 'foo.bar:zed==completed';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar:zed == 'completed'`);\n\t});\n\n\ttest('a && b || c', () => {\n\t\tconst input = 'a && b || c';\n\t\tassert.deepStrictEqual(parseToStr(input), 'c || a && b');\n\t});\n\n\ttest('fooBar && baz.jar && fee.bee<K-loo+1>', () => {\n\t\tconst input = 'fooBar && baz.jar && fee.bee<K-loo+1>';\n\t\tassert.deepStrictEqual(parseToStr(input), 'baz.jar && fee.bee<K-loo+1> && fooBar');\n\t});\n\n\ttest('foo.barBaz<C-r> < 2', () => {\n\t\tconst input = 'foo.barBaz<C-r> < 2';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.barBaz<C-r> < 2`);\n\t});\n\n\ttest('foo.bar >= -1', () => {\n\t\tconst input = 'foo.bar >= -1';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo.bar >= -1');\n\t});\n\n\ttest(`key contains &nbsp: view == vsc-packages-activitybar-folders && vsc-packages-folders-loaded`, () => {\n\t\tconst input = `view == vsc-packages-activitybar-folders && vsc-packages-folders-loaded`;\n\t\tassert.deepStrictEqual(parseToStr(input), `vsc-packages-folders-loaded && view == 'vsc-packages-activitybar-folders'`);\n\t});\n\n\ttest('foo.bar <= -1', () => {\n\t\tconst input = 'foo.bar <= -1';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar <= -1`);\n\t});\n\n\ttest('!cmake:hideBuildCommand \\u0026\\u0026 cmake:enableFullFeatureSet', () => {\n\t\tconst input = '!cmake:hideBuildCommand \\u0026\\u0026 cmake:enableFullFeatureSet';\n\t\tassert.deepStrictEqual(parseToStr(input), 'cmake:enableFullFeatureSet && !cmake:hideBuildCommand');\n\t});\n\n\ttest('!(foo && bar)', () => {\n\t\tconst input = '!(foo && bar)';\n\t\tassert.deepStrictEqual(parseToStr(input), '!bar || !foo');\n\t});\n\n\ttest('!(foo && bar || boar) || deer', () => {\n\t\tconst input = '!(foo && bar || boar) || deer';\n\t\tassert.deepStrictEqual(parseToStr(input), 'deer || !bar && !boar || !boar && !foo');\n\t});\n\n\ttest(`!(!foo)`, () => {\n\t\tconst input = `!(!foo)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo');\n\t});\n\n\tsuite('controversial', () => {\n\t\t/*\n\t\t\tnew parser KEEPS old one's behavior:\n\n\t\t\told parser output: { key: 'debugState', op: '==', value: '\"stopped\"' }\n\t\t\tnew parser output: { key: 'debugState', op: '==', value: '\"stopped\"' }\n\n\t\t\tTODO@ulugbekna: we should consider breaking old parser's behavior, and not take double quotes as part of the `value` because that's not what user expects.\n\t\t*/\n\t\ttest(`debugState == \"stopped\"`, () => {\n\t\t\tconst input = `debugState == \"stopped\"`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `debugState == '\"stopped\"'`);\n\t\t});\n\n\t\t/*\n\t\t\tnew parser BREAKS old one's behavior:\n\n\t\t\told parser output: { key: 'viewItem', op: '==', value: 'VSCode WorkSpace' }\n\t\t\tnew parser output: { key: 'viewItem', op: '==', value: 'VSCode' }\n\n\t\t\tTODO@ulugbekna: since this's breaking, we can have hacky code that tries detecting such cases and replicate old parser's behavior.\n\t\t*/\n\t\ttest(` viewItem == VSCode WorkSpace`, () => {\n\t\t\tconst input = ` viewItem == VSCode WorkSpace`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected 'WorkSpace' at offset 20.\\n`);\n\t\t});\n\n\n\t});\n\n\tsuite('regex', () => {\n\n\t\ttest(`resource =~ //foo/(barr|door/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(/.*)*$/`, () => {\n\t\t\tconst input = `resource =~ //foo/(barr|door/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(/.*)*$/`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resource =~ /\\\\/foo\\\\/(barr|door\\\\/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(\\\\/.*)*$/');\n\t\t});\n\n\t\ttest(`resource =~ /((/scratch/(?!update)(.*)/)|((/src/).*/)).*$/`, () => {\n\t\t\tconst input = `resource =~ /((/scratch/(?!update)(.*)/)|((/src/).*/)).*$/`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resource =~ /((\\\\/scratch\\\\/(?!update)(.*)\\\\/)|((\\\\/src\\\\/).*\\\\/)).*$/');\n\t\t});\n\n\t\ttest(`resourcePath =~ /\\.md(\\.yml|\\.txt)*$/giym`, () => {\n\t\t\tconst input = `resourcePath =~ /\\.md(\\.yml|\\.txt)*$/giym`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resourcePath =~ /.md(.yml|.txt)*$/im');\n\t\t});\n\n\t});\n\n\tsuite('error handling', () => {\n\n\t\ttest(`/foo`, () => {\n\t\t\tconst input = `/foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token '/foo' at offset 0. Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\\\\\/'.\\n\\n --- \\nParsing errors:\\n\\nUnexpected '/foo' at offset 0.\\n`);\n\t\t});\n\n\t\ttest(`!b == 'true'`, () => {\n\t\t\tconst input = `!b == 'true'`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '==' at offset 3.\\n`);\n\t\t});\n\n\t\ttest('!foo &&  in bar', () => {\n\t\t\tconst input = '!foo &&  in bar';\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected 'in' at offset 9.\\n`);\n\t\t});\n\n\t\ttest('vim<c-r> == 1 && vim<2<=3', () => {\n\t\t\tconst input = 'vim<c-r> == 1 && vim<2<=3';\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token '=' at offset 23. Did you mean == or =~?\\n\\n --- \\nParsing errors:\\n\\nUnexpected '=' at offset 23.\\n`); // FIXME\n\t\t});\n\n\t\ttest(`foo && 'bar`, () => {\n\t\t\tconst input = `foo && 'bar`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token ''bar' at offset 7. Did you forget to open or close the quote?\\n\\n --- \\nParsing errors:\\n\\nUnexpected ''bar' at offset 7.\\n`);\n\t\t});\n\n\t\ttest(`config.foo &&  &&bar =~ /^foo$|^bar-foo$|^joo$|^jar$/ && !foo`, () => {\n\t\t\tconst input = `config.foo &&  &&bar =~ /^foo$|^bar-foo$|^joo$|^jar$/ && !foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '&&' at offset 15.\\n`);\n\t\t});\n\n\t\ttest(`!foo == 'test'`, () => {\n\t\t\tconst input = `!foo == 'test'`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '==' at offset 5.\\n`);\n\t\t});\n\n\t\ttest(`!!foo`, function () {\n\t\t\tconst input = `!!foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '!' at offset 1.\\n`);\n\t\t});\n\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { Parser } from '../../common/contextkey.js';\n\nfunction parseToStr(input: string): string {\n\tconst parser = new Parser();\n\n\tconst prints: string[] = [];\n\n\tconst print = (...ss: string[]) => { ss.forEach(s => prints.push(s)); };\n\n\tconst expr = parser.parse(input);\n\tif (expr === undefined) {\n\t\tif (parser.lexingErrors.length > 0) {\n\t\t\tprint('Lexing errors:', '\\n\\n');\n\t\t\tparser.lexingErrors.forEach(lexingError => print(`Unexpected token '${lexingError.lexeme}' at offset ${lexingError.offset}. ${lexingError.additionalInfo}`, '\\n'));\n\t\t}\n\n\t\tif (parser.parsingErrors.length > 0) {\n\t\t\tif (parser.lexingErrors.length > 0) { print('\\n --- \\n'); }\n\t\t\tprint('Parsing errors:', '\\n\\n');\n\t\t\tparser.parsingErrors.forEach(parsingError => print(`Unexpected '${parsingError.lexeme}' at offset ${parsingError.offset}.`, '\\n'));\n\t\t}\n\n\t} else {\n\t\tprint(expr.serialize());\n\t}\n\n\treturn prints.join('');\n}\n\nsuite('Context Key Parser', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest(' foo', () => {\n\t\tconst input = ' foo';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo');\n\t});\n\n\ttest('!foo', () => {\n\t\tconst input = '!foo';\n\t\tassert.deepStrictEqual(parseToStr(input), '!foo');\n\t});\n\n\ttest('foo =~ /bar/', () => {\n\t\tconst input = 'foo =~ /bar/';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo =~ /bar/');\n\t});\n\n\ttest(`foo || (foo =~ /bar/ && baz)`, () => {\n\t\tconst input = `foo || (foo =~ /bar/ && baz)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo || baz && foo =~ /bar/');\n\t});\n\n\ttest('foo || (foo =~ /bar/ || baz)', () => {\n\t\tconst input = 'foo || (foo =~ /bar/ || baz)';\n\t\tassert.deepStrictEqual(parseToStr(input), 'baz || foo || foo =~ /bar/');\n\t});\n\n\ttest(`(foo || bar) && (jee || jar)`, () => {\n\t\tconst input = `(foo || bar) && (jee || jar)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'bar && jar || bar && jee || foo && jar || foo && jee');\n\t});\n\n\ttest('foo && foo =~ /zee/i', () => {\n\t\tconst input = 'foo && foo =~ /zee/i';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo && foo =~ /zee/i');\n\t});\n\n\ttest('foo.bar==enabled', () => {\n\t\tconst input = 'foo.bar==enabled';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar == 'enabled'`);\n\t});\n\n\ttest(`foo.bar == 'enabled'`, () => {\n\t\tconst input = `foo.bar == 'enabled'`;\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar == 'enabled'`);\n\t});\n\n\ttest('foo.bar:zed==completed - equality with no space', () => {\n\t\tconst input = 'foo.bar:zed==completed';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar:zed == 'completed'`);\n\t});\n\n\ttest('a && b || c', () => {\n\t\tconst input = 'a && b || c';\n\t\tassert.deepStrictEqual(parseToStr(input), 'c || a && b');\n\t});\n\n\ttest('fooBar && baz.jar && fee.bee<K-loo+1>', () => {\n\t\tconst input = 'fooBar && baz.jar && fee.bee<K-loo+1>';\n\t\tassert.deepStrictEqual(parseToStr(input), 'baz.jar && fee.bee<K-loo+1> && fooBar');\n\t});\n\n\ttest('foo.barBaz<C-r> < 2', () => {\n\t\tconst input = 'foo.barBaz<C-r> < 2';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.barBaz<C-r> < 2`);\n\t});\n\n\ttest('foo.bar >= -1', () => {\n\t\tconst input = 'foo.bar >= -1';\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo.bar >= -1');\n\t});\n\n\ttest(`key contains &nbsp: view == vsc-packages-activitybar-folders && vsc-packages-folders-loaded`, () => {\n\t\tconst input = `view == vsc-packages-activitybar-folders && vsc-packages-folders-loaded`;\n\t\tassert.deepStrictEqual(parseToStr(input), `vsc-packages-folders-loaded && view == 'vsc-packages-activitybar-folders'`);\n\t});\n\n\ttest('foo.bar <= -1', () => {\n\t\tconst input = 'foo.bar <= -1';\n\t\tassert.deepStrictEqual(parseToStr(input), `foo.bar <= -1`);\n\t});\n\n\ttest('!cmake:hideBuildCommand \\u0026\\u0026 cmake:enableFullFeatureSet', () => {\n\t\tconst input = '!cmake:hideBuildCommand \\u0026\\u0026 cmake:enableFullFeatureSet';\n\t\tassert.deepStrictEqual(parseToStr(input), 'cmake:enableFullFeatureSet && !cmake:hideBuildCommand');\n\t});\n\n\ttest('!(foo && bar)', () => {\n\t\tconst input = '!(foo && bar)';\n\t\tassert.deepStrictEqual(parseToStr(input), '!bar || !foo');\n\t});\n\n\ttest('!(foo && bar || boar) || deer', () => {\n\t\tconst input = '!(foo && bar || boar) || deer';\n\t\tassert.deepStrictEqual(parseToStr(input), 'deer || !bar && !boar || !boar && !foo');\n\t});\n\n\ttest(`!(!foo)`, () => {\n\t\tconst input = `!(!foo)`;\n\t\tassert.deepStrictEqual(parseToStr(input), 'foo');\n\t});\n\n\tsuite('controversial', () => {\n\t\t/*\n\t\t\tnew parser KEEPS old one's behavior:\n\n\t\t\told parser output: { key: 'debugState', op: '==', value: '\"stopped\"' }\n\t\t\tnew parser output: { key: 'debugState', op: '==', value: '\"stopped\"' }\n\n\t\t\tTODO@ulugbekna: we should consider breaking old parser's behavior, and not take double quotes as part of the `value` because that's not what user expects.\n\t\t*/\n\t\ttest(`debugState == \"stopped\"`, () => {\n\t\t\tconst input = `debugState == \"stopped\"`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `debugState == '\"stopped\"'`);\n\t\t});\n\n\t\t/*\n\t\t\tnew parser BREAKS old one's behavior:\n\n\t\t\told parser output: { key: 'viewItem', op: '==', value: 'VSCode WorkSpace' }\n\t\t\tnew parser output: { key: 'viewItem', op: '==', value: 'VSCode' }\n\n\t\t\tTODO@ulugbekna: since this's breaking, we can have hacky code that tries detecting such cases and replicate old parser's behavior.\n\t\t*/\n\t\ttest(` viewItem == VSCode WorkSpace`, () => {\n\t\t\tconst input = ` viewItem == VSCode WorkSpace`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected 'WorkSpace' at offset 20.\\n`);\n\t\t});\n\n\n\t});\n\n\tsuite('regex', () => {\n\n\t\ttest(`resource =~ //foo/(barr|door/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(/.*)*$/`, () => {\n\t\t\tconst input = `resource =~ //foo/(barr|door/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(/.*)*$/`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resource =~ /\\\\/foo\\\\/(barr|door\\\\/(Foo-Bar%20Templates|Soo%20Looo)|Web%20Site%Jjj%20Llll)(\\\\/.*)*$/');\n\t\t});\n\n\t\ttest(`resource =~ /((/scratch/(?!update)(.*)/)|((/src/).*/)).*$/`, () => {\n\t\t\tconst input = `resource =~ /((/scratch/(?!update)(.*)/)|((/src/).*/)).*$/`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resource =~ /((\\\\/scratch\\\\/(?!update)(.*)\\\\/)|((\\\\/src\\\\/).*\\\\/)).*$/');\n\t\t});\n\n\t\ttest(`resourcePath =~ /\\.md(\\.yml|\\.txt)*$/giym`, () => {\n\t\t\tconst input = `resourcePath =~ /\\.md(\\.yml|\\.txt)*$/giym`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), 'resourcePath =~ /.md(.yml|.txt)*$/im');\n\t\t});\n\n\t});\n\n\tsuite('error handling', () => {\n\n\t\ttest(`/foo`, () => {\n\t\t\tconst input = `/foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token '/foo' at offset 0. Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\\\\\/'.\\n\\n --- \\nParsing errors:\\n\\nUnexpected '/foo' at offset 0.\\n`);\n\t\t});\n\n\t\ttest(`!b == 'true'`, () => {\n\t\t\tconst input = `!b == 'true'`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '==' at offset 3.\\n`);\n\t\t});\n\n\t\ttest('!foo &&  in bar', () => {\n\t\t\tconst input = '!foo &&  in bar';\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected 'in' at offset 9.\\n`);\n\t\t});\n\n\t\ttest('vim<c-r> == 1 && vim<2<=3', () => {\n\t\t\tconst input = 'vim<c-r> == 1 && vim<2<=3';\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token '=' at offset 23. Did you mean == or =~?\\n\\n --- \\nParsing errors:\\n\\nUnexpected '=' at offset 23.\\n`); // FIXME\n\t\t});\n\n\t\ttest(`foo && 'bar`, () => {\n\t\t\tconst input = `foo && 'bar`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Lexing errors:\\n\\nUnexpected token ''bar' at offset 7. Did you forget to open or close the quote?\\n\\n --- \\nParsing errors:\\n\\nUnexpected ''bar' at offset 7.\\n`);\n\t\t});\n\n\t\ttest(`config.foo &&  &&bar =~ /^foo$|^bar-foo$|^joo$|^jar$/ && !foo`, () => {\n\t\t\tconst input = `config.foo &&  &&bar =~ /^foo$|^bar-foo$|^joo$|^jar$/ && !foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '&&' at offset 15.\\n`);\n\t\t});\n\n\t\ttest(`!foo == 'test'`, () => {\n\t\t\tconst input = `!foo == 'test'`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '==' at offset 5.\\n`);\n\t\t});\n\n\t\ttest(`!!foo`, function () {\n\t\t\tconst input = `!!foo`;\n\t\t\tassert.deepStrictEqual(parseToStr(input), `Parsing errors:\\n\\nUnexpected '!' at offset 1.\\n`);\n\t\t});\n\n\t});\n\n});\n"]}