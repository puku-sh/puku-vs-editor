{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/uriIdentity/common/uriIdentityService.ts","vs/platform/uriIdentity/common/uriIdentityService.ts"],"names":[],"mappings":"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","file":"uriIdentityService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IUriIdentityService } from './uriIdentity.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { IFileService, FileSystemProviderCapabilities, IFileSystemProviderCapabilitiesChangeEvent, IFileSystemProviderRegistrationEvent } from '../../files/common/files.js';\nimport { ExtUri, IExtUri, normalizePath } from '../../../base/common/resources.js';\nimport { Event } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { quickSelect } from '../../../base/common/arrays.js';\n\nclass Entry {\n\tstatic _clock = 0;\n\ttime: number = Entry._clock++;\n\tconstructor(readonly uri: URI) { }\n\ttouch() {\n\t\tthis.time = Entry._clock++;\n\t\treturn this;\n\t}\n}\n\nexport class UriIdentityService implements IUriIdentityService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\treadonly extUri: IExtUri;\n\n\tprivate readonly _dispooables = new DisposableStore();\n\tprivate readonly _canonicalUris: Map<string, Entry>;\n\tprivate readonly _limit = 2 ** 16;\n\n\tconstructor(@IFileService private readonly _fileService: IFileService) {\n\n\t\tconst schemeIgnoresPathCasingCache = new Map<string, boolean>();\n\n\t\t// assume path casing matters unless the file system provider spec'ed the opposite.\n\t\t// for all other cases path casing matters, e.g for\n\t\t// * virtual documents\n\t\t// * in-memory uris\n\t\t// * all kind of \"private\" schemes\n\t\tconst ignorePathCasing = (uri: URI): boolean => {\n\t\t\tlet ignorePathCasing = schemeIgnoresPathCasingCache.get(uri.scheme);\n\t\t\tif (ignorePathCasing === undefined) {\n\t\t\t\t// retrieve once and then case per scheme until a change happens\n\t\t\t\tignorePathCasing = _fileService.hasProvider(uri) && !this._fileService.hasCapability(uri, FileSystemProviderCapabilities.PathCaseSensitive);\n\t\t\t\tschemeIgnoresPathCasingCache.set(uri.scheme, ignorePathCasing);\n\t\t\t}\n\t\t\treturn ignorePathCasing;\n\t\t};\n\t\tthis._dispooables.add(Event.any<IFileSystemProviderCapabilitiesChangeEvent | IFileSystemProviderRegistrationEvent>(\n\t\t\t_fileService.onDidChangeFileSystemProviderRegistrations,\n\t\t\t_fileService.onDidChangeFileSystemProviderCapabilities\n\t\t)(e => {\n\t\t\tconst oldIgnorePathCasingValue = schemeIgnoresPathCasingCache.get(e.scheme);\n\t\t\tif (oldIgnorePathCasingValue === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tschemeIgnoresPathCasingCache.delete(e.scheme);\n\t\t\tconst newIgnorePathCasingValue = ignorePathCasing(URI.from({ scheme: e.scheme }));\n\t\t\tif (newIgnorePathCasingValue === newIgnorePathCasingValue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const [key, entry] of this._canonicalUris.entries()) {\n\t\t\t\tif (entry.uri.scheme !== e.scheme) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._canonicalUris.delete(key);\n\t\t\t}\n\t\t}));\n\n\t\tthis.extUri = new ExtUri(ignorePathCasing);\n\t\tthis._canonicalUris = new Map();\n\t}\n\n\tdispose(): void {\n\t\tthis._dispooables.dispose();\n\t\tthis._canonicalUris.clear();\n\t}\n\n\tasCanonicalUri(uri: URI): URI {\n\n\t\t// (1) normalize URI\n\t\tif (this._fileService.hasProvider(uri)) {\n\t\t\turi = normalizePath(uri);\n\t\t}\n\n\t\t// (2) find the uri in its canonical form or use this uri to define it\n\t\tconst uriKey = this.extUri.getComparisonKey(uri, true);\n\t\tconst item = this._canonicalUris.get(uriKey);\n\t\tif (item) {\n\t\t\treturn item.touch().uri.with({ fragment: uri.fragment });\n\t\t}\n\n\t\t// this uri is first and defines the canonical form\n\t\tthis._canonicalUris.set(uriKey, new Entry(uri));\n\t\tthis._checkTrim();\n\n\t\treturn uri;\n\t}\n\n\tprivate _checkTrim(): void {\n\t\tif (this._canonicalUris.size < this._limit) {\n\t\t\treturn;\n\t\t}\n\n\t\tEntry._clock = 1;\n\t\tconst times = [...this._canonicalUris.values()].map(e => e.time);\n\t\tconst median = quickSelect(\n\t\t\tMath.floor(times.length / 2),\n\t\t\ttimes,\n\t\t\t(a, b) => a - b);\n\t\tfor (const [key, entry] of this._canonicalUris.entries()) {\n\t\t\t// Its important to remove the median value here (<= not <).\n\t\t\t// If we have not touched any items since the last trim, the\n\t\t\t// median will be 0 and no items will be removed otherwise.\n\t\t\tif (entry.time <= median) {\n\t\t\t\tthis._canonicalUris.delete(key);\n\t\t\t} else {\n\t\t\t\tentry.time = 0;\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IUriIdentityService, UriIdentityService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IUriIdentityService } from './uriIdentity.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { IFileService, FileSystemProviderCapabilities, IFileSystemProviderCapabilitiesChangeEvent, IFileSystemProviderRegistrationEvent } from '../../files/common/files.js';\nimport { ExtUri, IExtUri, normalizePath } from '../../../base/common/resources.js';\nimport { Event } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { quickSelect } from '../../../base/common/arrays.js';\n\nclass Entry {\n\tstatic _clock = 0;\n\ttime: number = Entry._clock++;\n\tconstructor(readonly uri: URI) { }\n\ttouch() {\n\t\tthis.time = Entry._clock++;\n\t\treturn this;\n\t}\n}\n\nexport class UriIdentityService implements IUriIdentityService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\treadonly extUri: IExtUri;\n\n\tprivate readonly _dispooables = new DisposableStore();\n\tprivate readonly _canonicalUris: Map<string, Entry>;\n\tprivate readonly _limit = 2 ** 16;\n\n\tconstructor(@IFileService private readonly _fileService: IFileService) {\n\n\t\tconst schemeIgnoresPathCasingCache = new Map<string, boolean>();\n\n\t\t// assume path casing matters unless the file system provider spec'ed the opposite.\n\t\t// for all other cases path casing matters, e.g for\n\t\t// * virtual documents\n\t\t// * in-memory uris\n\t\t// * all kind of \"private\" schemes\n\t\tconst ignorePathCasing = (uri: URI): boolean => {\n\t\t\tlet ignorePathCasing = schemeIgnoresPathCasingCache.get(uri.scheme);\n\t\t\tif (ignorePathCasing === undefined) {\n\t\t\t\t// retrieve once and then case per scheme until a change happens\n\t\t\t\tignorePathCasing = _fileService.hasProvider(uri) && !this._fileService.hasCapability(uri, FileSystemProviderCapabilities.PathCaseSensitive);\n\t\t\t\tschemeIgnoresPathCasingCache.set(uri.scheme, ignorePathCasing);\n\t\t\t}\n\t\t\treturn ignorePathCasing;\n\t\t};\n\t\tthis._dispooables.add(Event.any<IFileSystemProviderCapabilitiesChangeEvent | IFileSystemProviderRegistrationEvent>(\n\t\t\t_fileService.onDidChangeFileSystemProviderRegistrations,\n\t\t\t_fileService.onDidChangeFileSystemProviderCapabilities\n\t\t)(e => {\n\t\t\tconst oldIgnorePathCasingValue = schemeIgnoresPathCasingCache.get(e.scheme);\n\t\t\tif (oldIgnorePathCasingValue === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tschemeIgnoresPathCasingCache.delete(e.scheme);\n\t\t\tconst newIgnorePathCasingValue = ignorePathCasing(URI.from({ scheme: e.scheme }));\n\t\t\tif (newIgnorePathCasingValue === newIgnorePathCasingValue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const [key, entry] of this._canonicalUris.entries()) {\n\t\t\t\tif (entry.uri.scheme !== e.scheme) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._canonicalUris.delete(key);\n\t\t\t}\n\t\t}));\n\n\t\tthis.extUri = new ExtUri(ignorePathCasing);\n\t\tthis._canonicalUris = new Map();\n\t}\n\n\tdispose(): void {\n\t\tthis._dispooables.dispose();\n\t\tthis._canonicalUris.clear();\n\t}\n\n\tasCanonicalUri(uri: URI): URI {\n\n\t\t// (1) normalize URI\n\t\tif (this._fileService.hasProvider(uri)) {\n\t\t\turi = normalizePath(uri);\n\t\t}\n\n\t\t// (2) find the uri in its canonical form or use this uri to define it\n\t\tconst uriKey = this.extUri.getComparisonKey(uri, true);\n\t\tconst item = this._canonicalUris.get(uriKey);\n\t\tif (item) {\n\t\t\treturn item.touch().uri.with({ fragment: uri.fragment });\n\t\t}\n\n\t\t// this uri is first and defines the canonical form\n\t\tthis._canonicalUris.set(uriKey, new Entry(uri));\n\t\tthis._checkTrim();\n\n\t\treturn uri;\n\t}\n\n\tprivate _checkTrim(): void {\n\t\tif (this._canonicalUris.size < this._limit) {\n\t\t\treturn;\n\t\t}\n\n\t\tEntry._clock = 1;\n\t\tconst times = [...this._canonicalUris.values()].map(e => e.time);\n\t\tconst median = quickSelect(\n\t\t\tMath.floor(times.length / 2),\n\t\t\ttimes,\n\t\t\t(a, b) => a - b);\n\t\tfor (const [key, entry] of this._canonicalUris.entries()) {\n\t\t\t// Its important to remove the median value here (<= not <).\n\t\t\t// If we have not touched any items since the last trim, the\n\t\t\t// median will be 0 and no items will be removed otherwise.\n\t\t\tif (entry.time <= median) {\n\t\t\t\tthis._canonicalUris.delete(key);\n\t\t\t} else {\n\t\t\t\tentry.time = 0;\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IUriIdentityService, UriIdentityService, InstantiationType.Delayed);\n"]}