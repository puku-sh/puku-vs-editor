{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataProfile/electron-main/userDataProfilesHandler.ts","vs/platform/userDataProfile/electron-main/userDataProfilesHandler.ts"],"names":[],"mappings":"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","file":"userDataProfilesHandler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILifecycleMainService, } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { ICodeWindow, LoadReason } from '../../window/electron-main/window.js';\nimport { IUserDataProfilesMainService } from './userDataProfile.js';\nimport { IAnyWorkspaceIdentifier, toWorkspaceIdentifier } from '../../workspace/common/workspace.js';\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\n\nexport class UserDataProfilesHandler extends Disposable {\n\n\tconstructor(\n\t\t@ILifecycleMainService lifecycleMainService: ILifecycleMainService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesService: IUserDataProfilesMainService,\n\t\t@IWindowsMainService private readonly windowsMainService: IWindowsMainService,\n\t) {\n\t\tsuper();\n\t\tthis._register(lifecycleMainService.onWillLoadWindow(e => {\n\t\t\tif (e.reason === LoadReason.LOAD) {\n\t\t\t\tthis.unsetProfileForWorkspace(e.window);\n\t\t\t}\n\t\t}));\n\t\tthis._register(lifecycleMainService.onBeforeCloseWindow(window => this.unsetProfileForWorkspace(window)));\n\t\tthis._register(new RunOnceScheduler(() => this.cleanUpEmptyWindowAssociations(), 30 * 1000 /* after 30s */)).schedule();\n\t}\n\n\tprivate async unsetProfileForWorkspace(window: ICodeWindow): Promise<void> {\n\t\tconst workspace = this.getWorkspace(window);\n\t\tconst profile = this.userDataProfilesService.getProfileForWorkspace(workspace);\n\t\tif (profile?.isTransient) {\n\t\t\tthis.userDataProfilesService.unsetWorkspace(workspace, profile.isTransient);\n\t\t\tif (profile.isTransient) {\n\t\t\t\tawait this.userDataProfilesService.cleanUpTransientProfiles();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getWorkspace(window: ICodeWindow): IAnyWorkspaceIdentifier {\n\t\treturn window.openedWorkspace ?? toWorkspaceIdentifier(window.backupPath, window.isExtensionDevelopmentHost);\n\t}\n\n\tprivate cleanUpEmptyWindowAssociations(): void {\n\t\tconst associatedEmptyWindows = this.userDataProfilesService.getAssociatedEmptyWindows();\n\t\tif (associatedEmptyWindows.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst openedWorkspaces = this.windowsMainService.getWindows().map(window => this.getWorkspace(window));\n\t\tfor (const associatedEmptyWindow of associatedEmptyWindows) {\n\t\t\tif (openedWorkspaces.some(openedWorkspace => openedWorkspace.id === associatedEmptyWindow.id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.userDataProfilesService.unsetWorkspace(associatedEmptyWindow, false);\n\t\t}\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILifecycleMainService, } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { ICodeWindow, LoadReason } from '../../window/electron-main/window.js';\nimport { IUserDataProfilesMainService } from './userDataProfile.js';\nimport { IAnyWorkspaceIdentifier, toWorkspaceIdentifier } from '../../workspace/common/workspace.js';\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\n\nexport class UserDataProfilesHandler extends Disposable {\n\n\tconstructor(\n\t\t@ILifecycleMainService lifecycleMainService: ILifecycleMainService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesService: IUserDataProfilesMainService,\n\t\t@IWindowsMainService private readonly windowsMainService: IWindowsMainService,\n\t) {\n\t\tsuper();\n\t\tthis._register(lifecycleMainService.onWillLoadWindow(e => {\n\t\t\tif (e.reason === LoadReason.LOAD) {\n\t\t\t\tthis.unsetProfileForWorkspace(e.window);\n\t\t\t}\n\t\t}));\n\t\tthis._register(lifecycleMainService.onBeforeCloseWindow(window => this.unsetProfileForWorkspace(window)));\n\t\tthis._register(new RunOnceScheduler(() => this.cleanUpEmptyWindowAssociations(), 30 * 1000 /* after 30s */)).schedule();\n\t}\n\n\tprivate async unsetProfileForWorkspace(window: ICodeWindow): Promise<void> {\n\t\tconst workspace = this.getWorkspace(window);\n\t\tconst profile = this.userDataProfilesService.getProfileForWorkspace(workspace);\n\t\tif (profile?.isTransient) {\n\t\t\tthis.userDataProfilesService.unsetWorkspace(workspace, profile.isTransient);\n\t\t\tif (profile.isTransient) {\n\t\t\t\tawait this.userDataProfilesService.cleanUpTransientProfiles();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getWorkspace(window: ICodeWindow): IAnyWorkspaceIdentifier {\n\t\treturn window.openedWorkspace ?? toWorkspaceIdentifier(window.backupPath, window.isExtensionDevelopmentHost);\n\t}\n\n\tprivate cleanUpEmptyWindowAssociations(): void {\n\t\tconst associatedEmptyWindows = this.userDataProfilesService.getAssociatedEmptyWindows();\n\t\tif (associatedEmptyWindows.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst openedWorkspaces = this.windowsMainService.getWindows().map(window => this.getWorkspace(window));\n\t\tfor (const associatedEmptyWindow of associatedEmptyWindows) {\n\t\t\tif (openedWorkspaces.some(openedWorkspace => openedWorkspace.id === associatedEmptyWindow.id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.userDataProfilesService.unsetWorkspace(associatedEmptyWindow, false);\n\t\t}\n\t}\n\n}\n"]}