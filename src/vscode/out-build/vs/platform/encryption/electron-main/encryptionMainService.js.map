{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/encryption/electron-main/encryptionMainService.ts","vs/platform/encryption/electron-main/encryptionMainService.ts"],"names":[],"mappings":"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","file":"encryptionMainService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { safeStorage as safeStorageElectron, app } from 'electron';\nimport { isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { KnownStorageProvider, IEncryptionMainService, PasswordStoreCLIOption } from '../common/encryptionService.js';\nimport { ILogService } from '../../log/common/log.js';\n\n// These APIs are currently only supported in our custom build of electron so\n// we need to guard against them not being available.\ninterface ISafeStorageAdditionalAPIs {\n\tsetUsePlainTextEncryption(usePlainText: boolean): void;\n\tgetSelectedStorageBackend(): string;\n}\n\nconst safeStorage: typeof import('electron').safeStorage & Partial<ISafeStorageAdditionalAPIs> = safeStorageElectron;\n\nexport class EncryptionMainService implements IEncryptionMainService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\t// if this commandLine switch is set, the user has opted in to using basic text encryption\n\t\tif (app.commandLine.getSwitchValue('password-store') === PasswordStoreCLIOption.basic) {\n\t\t\tthis.logService.trace('[EncryptionMainService] setting usePlainTextEncryption to true...');\n\t\t\tsafeStorage.setUsePlainTextEncryption?.(true);\n\t\t\tthis.logService.trace('[EncryptionMainService] set usePlainTextEncryption to true');\n\t\t}\n\t}\n\n\tasync encrypt(value: string): Promise<string> {\n\t\tthis.logService.trace('[EncryptionMainService] Encrypting value...');\n\t\ttry {\n\t\t\tconst result = JSON.stringify(safeStorage.encryptString(value));\n\t\t\tthis.logService.trace('[EncryptionMainService] Encrypted value.');\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync decrypt(value: string): Promise<string> {\n\t\tlet parsedValue: { data: string };\n\t\ttry {\n\t\t\tparsedValue = JSON.parse(value);\n\t\t\tif (!parsedValue.data) {\n\t\t\t\tthrow new Error(`[EncryptionMainService] Invalid encrypted value: ${value}`);\n\t\t\t}\n\t\t\tconst bufferToDecrypt = Buffer.from(parsedValue.data);\n\n\t\t\tthis.logService.trace('[EncryptionMainService] Decrypting value...');\n\t\t\tconst result = safeStorage.decryptString(bufferToDecrypt);\n\t\t\tthis.logService.trace('[EncryptionMainService] Decrypted value.');\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tisEncryptionAvailable(): Promise<boolean> {\n\t\tthis.logService.trace('[EncryptionMainService] Checking if encryption is available...');\n\t\tconst result = safeStorage.isEncryptionAvailable();\n\t\tthis.logService.trace('[EncryptionMainService] Encryption is available: ', result);\n\t\treturn Promise.resolve(result);\n\t}\n\n\tgetKeyStorageProvider(): Promise<KnownStorageProvider> {\n\t\tif (isWindows) {\n\t\t\treturn Promise.resolve(KnownStorageProvider.dplib);\n\t\t}\n\t\tif (isMacintosh) {\n\t\t\treturn Promise.resolve(KnownStorageProvider.keychainAccess);\n\t\t}\n\t\tif (safeStorage.getSelectedStorageBackend) {\n\t\t\ttry {\n\t\t\t\tthis.logService.trace('[EncryptionMainService] Getting selected storage backend...');\n\t\t\t\tconst result = safeStorage.getSelectedStorageBackend() as KnownStorageProvider;\n\t\t\t\tthis.logService.trace('[EncryptionMainService] Selected storage backend: ', result);\n\t\t\t\treturn Promise.resolve(result);\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.error(e);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(KnownStorageProvider.unknown);\n\t}\n\n\tasync setUsePlainTextEncryption(): Promise<void> {\n\t\tif (isWindows) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported on Windows.');\n\t\t}\n\n\t\tif (isMacintosh) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported on macOS.');\n\t\t}\n\n\t\tif (!safeStorage.setUsePlainTextEncryption) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported.');\n\t\t}\n\n\t\tthis.logService.trace('[EncryptionMainService] Setting usePlainTextEncryption to true...');\n\t\tsafeStorage.setUsePlainTextEncryption(true);\n\t\tthis.logService.trace('[EncryptionMainService] Set usePlainTextEncryption to true');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { safeStorage as safeStorageElectron, app } from 'electron';\nimport { isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { KnownStorageProvider, IEncryptionMainService, PasswordStoreCLIOption } from '../common/encryptionService.js';\nimport { ILogService } from '../../log/common/log.js';\n\n// These APIs are currently only supported in our custom build of electron so\n// we need to guard against them not being available.\ninterface ISafeStorageAdditionalAPIs {\n\tsetUsePlainTextEncryption(usePlainText: boolean): void;\n\tgetSelectedStorageBackend(): string;\n}\n\nconst safeStorage: typeof import('electron').safeStorage & Partial<ISafeStorageAdditionalAPIs> = safeStorageElectron;\n\nexport class EncryptionMainService implements IEncryptionMainService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\t// if this commandLine switch is set, the user has opted in to using basic text encryption\n\t\tif (app.commandLine.getSwitchValue('password-store') === PasswordStoreCLIOption.basic) {\n\t\t\tthis.logService.trace('[EncryptionMainService] setting usePlainTextEncryption to true...');\n\t\t\tsafeStorage.setUsePlainTextEncryption?.(true);\n\t\t\tthis.logService.trace('[EncryptionMainService] set usePlainTextEncryption to true');\n\t\t}\n\t}\n\n\tasync encrypt(value: string): Promise<string> {\n\t\tthis.logService.trace('[EncryptionMainService] Encrypting value...');\n\t\ttry {\n\t\t\tconst result = JSON.stringify(safeStorage.encryptString(value));\n\t\t\tthis.logService.trace('[EncryptionMainService] Encrypted value.');\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync decrypt(value: string): Promise<string> {\n\t\tlet parsedValue: { data: string };\n\t\ttry {\n\t\t\tparsedValue = JSON.parse(value);\n\t\t\tif (!parsedValue.data) {\n\t\t\t\tthrow new Error(`[EncryptionMainService] Invalid encrypted value: ${value}`);\n\t\t\t}\n\t\t\tconst bufferToDecrypt = Buffer.from(parsedValue.data);\n\n\t\t\tthis.logService.trace('[EncryptionMainService] Decrypting value...');\n\t\t\tconst result = safeStorage.decryptString(bufferToDecrypt);\n\t\t\tthis.logService.trace('[EncryptionMainService] Decrypted value.');\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tisEncryptionAvailable(): Promise<boolean> {\n\t\tthis.logService.trace('[EncryptionMainService] Checking if encryption is available...');\n\t\tconst result = safeStorage.isEncryptionAvailable();\n\t\tthis.logService.trace('[EncryptionMainService] Encryption is available: ', result);\n\t\treturn Promise.resolve(result);\n\t}\n\n\tgetKeyStorageProvider(): Promise<KnownStorageProvider> {\n\t\tif (isWindows) {\n\t\t\treturn Promise.resolve(KnownStorageProvider.dplib);\n\t\t}\n\t\tif (isMacintosh) {\n\t\t\treturn Promise.resolve(KnownStorageProvider.keychainAccess);\n\t\t}\n\t\tif (safeStorage.getSelectedStorageBackend) {\n\t\t\ttry {\n\t\t\t\tthis.logService.trace('[EncryptionMainService] Getting selected storage backend...');\n\t\t\t\tconst result = safeStorage.getSelectedStorageBackend() as KnownStorageProvider;\n\t\t\t\tthis.logService.trace('[EncryptionMainService] Selected storage backend: ', result);\n\t\t\t\treturn Promise.resolve(result);\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.error(e);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(KnownStorageProvider.unknown);\n\t}\n\n\tasync setUsePlainTextEncryption(): Promise<void> {\n\t\tif (isWindows) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported on Windows.');\n\t\t}\n\n\t\tif (isMacintosh) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported on macOS.');\n\t\t}\n\n\t\tif (!safeStorage.setUsePlainTextEncryption) {\n\t\t\tthrow new Error('Setting plain text encryption is not supported.');\n\t\t}\n\n\t\tthis.logService.trace('[EncryptionMainService] Setting usePlainTextEncryption to true...');\n\t\tsafeStorage.setUsePlainTextEncryption(true);\n\t\tthis.logService.trace('[EncryptionMainService] Set usePlainTextEncryption to true');\n\t}\n}\n"]}