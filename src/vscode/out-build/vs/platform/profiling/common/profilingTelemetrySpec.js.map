{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/profiling/common/profilingTelemetrySpec.ts","vs/platform/profiling/common/profilingTelemetrySpec.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAKhG,OAAO,EAAE,YAAY,EAAE,MAAM,gCAAgC,CAAC;AAgC9D,MAAM,UAAU,YAAY,CAAC,IAAgB,EAAE,gBAAmC,EAAE,UAAuB,EAAE,mBAA4B;IAExI,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC;IAE9C,uBAAuB;IACvB,gBAAgB,CAAC,UAAU,CAAyD,qBAAqB,EAAE;QAC1G,YAAY;QACZ,QAAQ,EAAE,MAAM,CAAC,QAAQ;QACzB,SAAS,EAAE,MAAM,CAAC,SAAS;QAC3B,UAAU,EAAE,MAAM,CAAC,UAAU;QAC7B,YAAY,EAAE,MAAM,CAAC,QAAQ;QAC7B,OAAO,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;QACrD,gBAAgB,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,UAAU,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC;QACnF,MAAM;KACN,CAAC,CAAC;IAEH,wCAAwC;IACxC,MAAM,SAAS,GAAG,IAAI,gBAAgB,CAAC,IAAI,CAAC,CAAC;IAC7C,IAAI,mBAAmB,EAAE,CAAC;QACzB,YAAY,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;IAC3C,CAAC;SAAM,CAAC;QACP,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IAC7B,CAAC;AACF,CAAC;AAED,MAAM,gBAAiB,SAAQ,KAAK;IAGnC,YAAY,IAAgB;QAC3B,gDAAgD;QAChD,4DAA4D;QAC5D,IAAI,KAAK,CAAC,cAAc,CAAC,iBAAiB,CAAC,EAAE,CAAC;YAC7C,mDAAmD;YACnD,MAAM,GAAG,GAAG,KAA2C,CAAC,CAAC,gCAAgC;YACzF,MAAM,eAAe,GAAG,GAAG,CAAC,eAAe,CAAC;YAC5C,GAAG,CAAC,eAAe,GAAG,CAAC,CAAC;YACxB,KAAK,CAAC,uBAAuB,IAAI,CAAC,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;YACvE,GAAG,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,CAAC;aAAM,CAAC;YACP,KAAK,CAAC,uBAAuB,IAAI,CAAC,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;QACxE,CAAC;QACD,IAAI,CAAC,IAAI,GAAG,iBAAiB,CAAC;QAC9B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;QAErC,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;QACvF,IAAI,CAAC,KAAK,GAAG,WAAW,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;IAClD,CAAC;CACD","file":"profilingTelemetrySpec.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILogService } from '../../log/common/log.js';\nimport { BottomUpSample } from './profilingModel.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { errorHandler } from '../../../base/common/errors.js';\n\ntype TelemetrySampleData = {\n\tselfTime: number;\n\ttotalTime: number;\n\tpercentage: number;\n\tperfBaseline: number;\n\tfunctionName: string;\n\tcallers: string;\n\tcallersAnnotated: string;\n\tsource: string;\n};\n\ntype TelemetrySampleDataClassification = {\n\towner: 'jrieken';\n\tcomment: 'A callstack that took a long time to execute';\n\tselfTime: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Self time of the sample' };\n\ttotalTime: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total time of the sample' };\n\tpercentage: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Relative time (percentage) of the sample' };\n\tperfBaseline: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Performance baseline for the machine' };\n\tfunctionName: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The name of the sample' };\n\tcallers: { classification: 'CallstackOrException'; purpose: 'PerformanceAndHealth'; comment: 'The heaviest call trace into this sample' };\n\tcallersAnnotated: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The heaviest call trace into this sample annotated with respective costs' };\n\tsource: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The source - either renderer or an extension' };\n};\n\nexport interface SampleData {\n\tperfBaseline: number;\n\tsample: BottomUpSample;\n\tsource: string;\n}\n\nexport function reportSample(data: SampleData, telemetryService: ITelemetryService, logService: ILogService, sendAsErrorTelemtry: boolean): void {\n\n\tconst { sample, perfBaseline, source } = data;\n\n\t// send telemetry event\n\ttelemetryService.publicLog2<TelemetrySampleData, TelemetrySampleDataClassification>(`unresponsive.sample`, {\n\t\tperfBaseline,\n\t\tselfTime: sample.selfTime,\n\t\ttotalTime: sample.totalTime,\n\t\tpercentage: sample.percentage,\n\t\tfunctionName: sample.location,\n\t\tcallers: sample.caller.map(c => c.location).join('<'),\n\t\tcallersAnnotated: sample.caller.map(c => `${c.percentage}|${c.location}`).join('<'),\n\t\tsource\n\t});\n\n\t// log a fake error with a clearer stack\n\tconst fakeError = new PerformanceError(data);\n\tif (sendAsErrorTelemtry) {\n\t\terrorHandler.onUnexpectedError(fakeError);\n\t} else {\n\t\tlogService.error(fakeError);\n\t}\n}\n\nclass PerformanceError extends Error {\n\treadonly selfTime: number;\n\n\tconstructor(data: SampleData) {\n\t\t// Since the stacks are available via the sample\n\t\t// we can avoid collecting them when constructing the error.\n\t\tif (Error.hasOwnProperty('stackTraceLimit')) {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconst Err = Error as any as { stackTraceLimit: number }; // For the monaco editor checks.\n\t\t\tconst stackTraceLimit = Err.stackTraceLimit;\n\t\t\tErr.stackTraceLimit = 0;\n\t\t\tsuper(`PerfSampleError: by ${data.source} in ${data.sample.location}`);\n\t\t\tErr.stackTraceLimit = stackTraceLimit;\n\t\t} else {\n\t\t\tsuper(`PerfSampleError: by ${data.source} in ${data.sample.location}`);\n\t\t}\n\t\tthis.name = 'PerfSampleError';\n\t\tthis.selfTime = data.sample.selfTime;\n\n\t\tconst trace = [data.sample.absLocation, ...data.sample.caller.map(c => c.absLocation)];\n\t\tthis.stack = `\\n\\t at ${trace.join('\\n\\t at ')}`;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILogService } from '../../log/common/log.js';\nimport { BottomUpSample } from './profilingModel.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { errorHandler } from '../../../base/common/errors.js';\n\ntype TelemetrySampleData = {\n\tselfTime: number;\n\ttotalTime: number;\n\tpercentage: number;\n\tperfBaseline: number;\n\tfunctionName: string;\n\tcallers: string;\n\tcallersAnnotated: string;\n\tsource: string;\n};\n\ntype TelemetrySampleDataClassification = {\n\towner: 'jrieken';\n\tcomment: 'A callstack that took a long time to execute';\n\tselfTime: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Self time of the sample' };\n\ttotalTime: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total time of the sample' };\n\tpercentage: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Relative time (percentage) of the sample' };\n\tperfBaseline: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Performance baseline for the machine' };\n\tfunctionName: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The name of the sample' };\n\tcallers: { classification: 'CallstackOrException'; purpose: 'PerformanceAndHealth'; comment: 'The heaviest call trace into this sample' };\n\tcallersAnnotated: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The heaviest call trace into this sample annotated with respective costs' };\n\tsource: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The source - either renderer or an extension' };\n};\n\nexport interface SampleData {\n\tperfBaseline: number;\n\tsample: BottomUpSample;\n\tsource: string;\n}\n\nexport function reportSample(data: SampleData, telemetryService: ITelemetryService, logService: ILogService, sendAsErrorTelemtry: boolean): void {\n\n\tconst { sample, perfBaseline, source } = data;\n\n\t// send telemetry event\n\ttelemetryService.publicLog2<TelemetrySampleData, TelemetrySampleDataClassification>(`unresponsive.sample`, {\n\t\tperfBaseline,\n\t\tselfTime: sample.selfTime,\n\t\ttotalTime: sample.totalTime,\n\t\tpercentage: sample.percentage,\n\t\tfunctionName: sample.location,\n\t\tcallers: sample.caller.map(c => c.location).join('<'),\n\t\tcallersAnnotated: sample.caller.map(c => `${c.percentage}|${c.location}`).join('<'),\n\t\tsource\n\t});\n\n\t// log a fake error with a clearer stack\n\tconst fakeError = new PerformanceError(data);\n\tif (sendAsErrorTelemtry) {\n\t\terrorHandler.onUnexpectedError(fakeError);\n\t} else {\n\t\tlogService.error(fakeError);\n\t}\n}\n\nclass PerformanceError extends Error {\n\treadonly selfTime: number;\n\n\tconstructor(data: SampleData) {\n\t\t// Since the stacks are available via the sample\n\t\t// we can avoid collecting them when constructing the error.\n\t\tif (Error.hasOwnProperty('stackTraceLimit')) {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconst Err = Error as any as { stackTraceLimit: number }; // For the monaco editor checks.\n\t\t\tconst stackTraceLimit = Err.stackTraceLimit;\n\t\t\tErr.stackTraceLimit = 0;\n\t\t\tsuper(`PerfSampleError: by ${data.source} in ${data.sample.location}`);\n\t\t\tErr.stackTraceLimit = stackTraceLimit;\n\t\t} else {\n\t\t\tsuper(`PerfSampleError: by ${data.source} in ${data.sample.location}`);\n\t\t}\n\t\tthis.name = 'PerfSampleError';\n\t\tthis.selfTime = data.sample.selfTime;\n\n\t\tconst trace = [data.sample.absLocation, ...data.sample.caller.map(c => c.absLocation)];\n\t\tthis.stack = `\\n\\t at ${trace.join('\\n\\t at ')}`;\n\t}\n}\n"]}