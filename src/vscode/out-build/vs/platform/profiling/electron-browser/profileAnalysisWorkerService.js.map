{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/profiling/electron-browser/profileAnalysisWorkerService.ts","vs/platform/profiling/electron-browser/profileAnalysisWorkerService.ts"],"names":[],"mappings":"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","file":"profileAnalysisWorkerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { WebWorkerDescriptor } from '../../webWorker/browser/webWorkerDescriptor.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Proxied } from '../../../base/common/worker/webWorker.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IWebWorkerService } from '../../webWorker/browser/webWorkerService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IV8Profile } from '../common/profiling.js';\nimport { BottomUpSample } from '../common/profilingModel.js';\nimport { reportSample } from '../common/profilingTelemetrySpec.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { FileAccess } from '../../../base/common/network.js';\n\nexport const enum ProfilingOutput {\n\tFailure,\n\tIrrelevant,\n\tInteresting,\n}\n\nexport interface IScriptUrlClassifier {\n\t(scriptUrl: string): string;\n}\n\nexport const IProfileAnalysisWorkerService = createDecorator<IProfileAnalysisWorkerService>('IProfileAnalysisWorkerService');\n\nexport interface IProfileAnalysisWorkerService {\n\treadonly _serviceBrand: undefined;\n\tanalyseBottomUp(profile: IV8Profile, callFrameClassifier: IScriptUrlClassifier, perfBaseline: number, sendAsErrorTelemtry: boolean): Promise<ProfilingOutput>;\n\tanalyseByLocation(profile: IV8Profile, locations: [location: URI, id: string][]): Promise<[category: string, aggregated: number][]>;\n}\n\n\n// ---- impl\n\nclass ProfileAnalysisWorkerService implements IProfileAnalysisWorkerService {\n\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IWebWorkerService private readonly _webWorkerService: IWebWorkerService,\n\t) { }\n\n\tprivate async _withWorker<R>(callback: (worker: Proxied<IProfileAnalysisWorker>) => Promise<R>): Promise<R> {\n\n\t\tconst worker = this._webWorkerService.createWorkerClient<IProfileAnalysisWorker>(\n\t\t\tnew WebWorkerDescriptor({\n\t\t\t\tesmModuleLocation: FileAccess.asBrowserUri('vs/platform/profiling/electron-browser/profileAnalysisWorkerMain.js'),\n\t\t\t\tlabel: 'CpuProfileAnalysisWorker'\n\t\t\t})\n\t\t);\n\n\t\ttry {\n\t\t\tconst r = await callback(worker.proxy);\n\t\t\treturn r;\n\t\t} finally {\n\t\t\tworker.dispose();\n\t\t}\n\t}\n\n\tasync analyseBottomUp(profile: IV8Profile, callFrameClassifier: IScriptUrlClassifier, perfBaseline: number, sendAsErrorTelemtry: boolean): Promise<ProfilingOutput> {\n\t\treturn this._withWorker(async worker => {\n\t\t\tconst result = await worker.$analyseBottomUp(profile);\n\t\t\tif (result.kind === ProfilingOutput.Interesting) {\n\t\t\t\tfor (const sample of result.samples) {\n\t\t\t\t\treportSample({\n\t\t\t\t\t\tsample,\n\t\t\t\t\t\tperfBaseline,\n\t\t\t\t\t\tsource: callFrameClassifier(sample.url)\n\t\t\t\t\t}, this._telemetryService, this._logService, sendAsErrorTelemtry);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result.kind;\n\t\t});\n\t}\n\n\tasync analyseByLocation(profile: IV8Profile, locations: [location: URI, id: string][]): Promise<[category: string, aggregated: number][]> {\n\t\treturn this._withWorker(async worker => {\n\t\t\tconst result = await worker.$analyseByUrlCategory(profile, locations);\n\t\t\treturn result;\n\t\t});\n\t}\n}\n\n// ---- worker contract\n\nexport interface BottomUpAnalysis {\n\tkind: ProfilingOutput;\n\tsamples: BottomUpSample[];\n}\n\nexport interface CategoryAnalysis {\n\tcategory: string;\n\tpercentage: number;\n\taggregated: number;\n\toverallDuration: number;\n}\n\nexport interface IProfileAnalysisWorker {\n\t$analyseBottomUp(profile: IV8Profile): BottomUpAnalysis;\n\t$analyseByUrlCategory(profile: IV8Profile, categories: [url: URI, category: string][]): [category: string, aggregated: number][];\n}\n\nregisterSingleton(IProfileAnalysisWorkerService, ProfileAnalysisWorkerService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { WebWorkerDescriptor } from '../../webWorker/browser/webWorkerDescriptor.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Proxied } from '../../../base/common/worker/webWorker.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { IWebWorkerService } from '../../webWorker/browser/webWorkerService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IV8Profile } from '../common/profiling.js';\nimport { BottomUpSample } from '../common/profilingModel.js';\nimport { reportSample } from '../common/profilingTelemetrySpec.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { FileAccess } from '../../../base/common/network.js';\n\nexport const enum ProfilingOutput {\n\tFailure,\n\tIrrelevant,\n\tInteresting,\n}\n\nexport interface IScriptUrlClassifier {\n\t(scriptUrl: string): string;\n}\n\nexport const IProfileAnalysisWorkerService = createDecorator<IProfileAnalysisWorkerService>('IProfileAnalysisWorkerService');\n\nexport interface IProfileAnalysisWorkerService {\n\treadonly _serviceBrand: undefined;\n\tanalyseBottomUp(profile: IV8Profile, callFrameClassifier: IScriptUrlClassifier, perfBaseline: number, sendAsErrorTelemtry: boolean): Promise<ProfilingOutput>;\n\tanalyseByLocation(profile: IV8Profile, locations: [location: URI, id: string][]): Promise<[category: string, aggregated: number][]>;\n}\n\n\n// ---- impl\n\nclass ProfileAnalysisWorkerService implements IProfileAnalysisWorkerService {\n\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IWebWorkerService private readonly _webWorkerService: IWebWorkerService,\n\t) { }\n\n\tprivate async _withWorker<R>(callback: (worker: Proxied<IProfileAnalysisWorker>) => Promise<R>): Promise<R> {\n\n\t\tconst worker = this._webWorkerService.createWorkerClient<IProfileAnalysisWorker>(\n\t\t\tnew WebWorkerDescriptor({\n\t\t\t\tesmModuleLocation: FileAccess.asBrowserUri('vs/platform/profiling/electron-browser/profileAnalysisWorkerMain.js'),\n\t\t\t\tlabel: 'CpuProfileAnalysisWorker'\n\t\t\t})\n\t\t);\n\n\t\ttry {\n\t\t\tconst r = await callback(worker.proxy);\n\t\t\treturn r;\n\t\t} finally {\n\t\t\tworker.dispose();\n\t\t}\n\t}\n\n\tasync analyseBottomUp(profile: IV8Profile, callFrameClassifier: IScriptUrlClassifier, perfBaseline: number, sendAsErrorTelemtry: boolean): Promise<ProfilingOutput> {\n\t\treturn this._withWorker(async worker => {\n\t\t\tconst result = await worker.$analyseBottomUp(profile);\n\t\t\tif (result.kind === ProfilingOutput.Interesting) {\n\t\t\t\tfor (const sample of result.samples) {\n\t\t\t\t\treportSample({\n\t\t\t\t\t\tsample,\n\t\t\t\t\t\tperfBaseline,\n\t\t\t\t\t\tsource: callFrameClassifier(sample.url)\n\t\t\t\t\t}, this._telemetryService, this._logService, sendAsErrorTelemtry);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result.kind;\n\t\t});\n\t}\n\n\tasync analyseByLocation(profile: IV8Profile, locations: [location: URI, id: string][]): Promise<[category: string, aggregated: number][]> {\n\t\treturn this._withWorker(async worker => {\n\t\t\tconst result = await worker.$analyseByUrlCategory(profile, locations);\n\t\t\treturn result;\n\t\t});\n\t}\n}\n\n// ---- worker contract\n\nexport interface BottomUpAnalysis {\n\tkind: ProfilingOutput;\n\tsamples: BottomUpSample[];\n}\n\nexport interface CategoryAnalysis {\n\tcategory: string;\n\tpercentage: number;\n\taggregated: number;\n\toverallDuration: number;\n}\n\nexport interface IProfileAnalysisWorker {\n\t$analyseBottomUp(profile: IV8Profile): BottomUpAnalysis;\n\t$analyseByUrlCategory(profile: IV8Profile, categories: [url: URI, category: string][]): [category: string, aggregated: number][];\n}\n\nregisterSingleton(IProfileAnalysisWorkerService, ProfileAnalysisWorkerService, InstantiationType.Delayed);\n"]}