{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/instantiation/test/common/instantiationService.test.ts","vs/platform/instantiation/test/common/instantiationService.test.ts"],"names":[],"mappings":"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","file":"instantiationService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { dispose } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../common/descriptors.js';\nimport { createDecorator, IInstantiationService, ServicesAccessor } from '../../common/instantiation.js';\nimport { InstantiationService } from '../../common/instantiationService.js';\nimport { ServiceCollection } from '../../common/serviceCollection.js';\n\nconst IService1 = createDecorator<IService1>('service1');\n\ninterface IService1 {\n\treadonly _serviceBrand: undefined;\n\tc: number;\n}\n\nclass Service1 implements IService1 {\n\tdeclare readonly _serviceBrand: undefined;\n\tc = 1;\n}\n\nconst IService2 = createDecorator<IService2>('service2');\n\ninterface IService2 {\n\treadonly _serviceBrand: undefined;\n\td: boolean;\n}\n\nclass Service2 implements IService2 {\n\tdeclare readonly _serviceBrand: undefined;\n\td = true;\n}\n\nconst IService3 = createDecorator<IService3>('service3');\n\ninterface IService3 {\n\treadonly _serviceBrand: undefined;\n\ts: string;\n}\n\nclass Service3 implements IService3 {\n\tdeclare readonly _serviceBrand: undefined;\n\ts = 'farboo';\n}\n\nconst IDependentService = createDecorator<IDependentService>('dependentService');\n\ninterface IDependentService {\n\treadonly _serviceBrand: undefined;\n\tname: string;\n}\n\nclass DependentService implements IDependentService {\n\tdeclare readonly _serviceBrand: undefined;\n\tconstructor(@IService1 service: IService1) {\n\t\tassert.strictEqual(service.c, 1);\n\t}\n\n\tname = 'farboo';\n}\n\nclass Service1Consumer {\n\n\tconstructor(@IService1 service1: IService1) {\n\t\tassert.ok(service1);\n\t\tassert.strictEqual(service1.c, 1);\n\t}\n}\n\nclass Target2Dep {\n\n\tconstructor(@IService1 service1: IService1, @IService2 service2: Service2) {\n\t\tassert.ok(service1 instanceof Service1);\n\t\tassert.ok(service2 instanceof Service2);\n\t}\n}\n\nclass TargetWithStaticParam {\n\tconstructor(v: boolean, @IService1 service1: IService1) {\n\t\tassert.ok(v);\n\t\tassert.ok(service1);\n\t\tassert.strictEqual(service1.c, 1);\n\t}\n}\n\n\n\nclass DependentServiceTarget {\n\tconstructor(@IDependentService d: IDependentService) {\n\t\tassert.ok(d);\n\t\tassert.strictEqual(d.name, 'farboo');\n\t}\n}\n\nclass DependentServiceTarget2 {\n\tconstructor(@IDependentService d: IDependentService, @IService1 s: IService1) {\n\t\tassert.ok(d);\n\t\tassert.strictEqual(d.name, 'farboo');\n\t\tassert.ok(s);\n\t\tassert.strictEqual(s.c, 1);\n\t}\n}\n\n\nclass ServiceLoop1 implements IService1 {\n\tdeclare readonly _serviceBrand: undefined;\n\tc = 1;\n\n\tconstructor(@IService2 s: IService2) {\n\n\t}\n}\n\nclass ServiceLoop2 implements IService2 {\n\tdeclare readonly _serviceBrand: undefined;\n\td = true;\n\n\tconstructor(@IService1 s: IService1) {\n\n\t}\n}\n\nsuite('Instantiation Service', () => {\n\n\ttest('service collection, cannot overwrite', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tlet result = collection.set(IService1, null!);\n\t\tassert.strictEqual(result, undefined);\n\t\tresult = collection.set(IService1, new Service1());\n\t\tassert.strictEqual(result, null);\n\t});\n\n\ttest('service collection, add/has', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tcollection.set(IService1, null!);\n\t\tassert.ok(collection.has(IService1));\n\n\t\tcollection.set(IService2, null!);\n\t\tassert.ok(collection.has(IService1));\n\t\tassert.ok(collection.has(IService2));\n\t});\n\n\ttest('@Param - simple clase', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\t\tcollection.set(IService3, new Service3());\n\n\t\tservice.createInstance(Service1Consumer);\n\t});\n\n\ttest('@Param - fixed args', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\t\tcollection.set(IService3, new Service3());\n\n\t\tservice.createInstance(TargetWithStaticParam, true);\n\t});\n\n\ttest('service collection is live', function () {\n\n\t\tconst collection = new ServiceCollection();\n\t\tcollection.set(IService1, new Service1());\n\n\t\tconst service = new InstantiationService(collection);\n\t\tservice.createInstance(Service1Consumer);\n\n\t\tcollection.set(IService2, new Service2());\n\n\t\tservice.createInstance(Target2Dep);\n\t\tservice.invokeFunction(function (a) {\n\t\t\tassert.ok(a.get(IService1));\n\t\t\tassert.ok(a.get(IService2));\n\t\t});\n\t});\n\n\t// we made this a warning\n\t// test('@Param - too many args', function () {\n\t// \tlet service = instantiationService.create(Object.create(null));\n\t// \tservice.addSingleton(IService1, new Service1());\n\t// \tservice.addSingleton(IService2, new Service2());\n\t// \tservice.addSingleton(IService3, new Service3());\n\n\t// \tassert.throws(() => service.createInstance(ParameterTarget2, true, 2));\n\t// });\n\n\t// test('@Param - too few args', function () {\n\t// \tlet service = instantiationService.create(Object.create(null));\n\t// \tservice.addSingleton(IService1, new Service1());\n\t// \tservice.addSingleton(IService2, new Service2());\n\t// \tservice.addSingleton(IService3, new Service3());\n\n\t// \tassert.throws(() => service.createInstance(ParameterTarget2));\n\t// });\n\n\ttest('SyncDesc - no dependencies', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\n\t\tservice.invokeFunction(accessor => {\n\n\t\t\tconst service1 = accessor.get(IService1);\n\t\t\tassert.ok(service1);\n\t\t\tassert.strictEqual(service1.c, 1);\n\n\t\t\tconst service2 = accessor.get(IService1);\n\t\t\tassert.ok(service1 === service2);\n\t\t});\n\t});\n\n\ttest('SyncDesc - service with service dependency', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\t\tcollection.set(IDependentService, new SyncDescriptor<IDependentService>(DependentService));\n\n\t\tservice.invokeFunction(accessor => {\n\t\t\tconst d = accessor.get(IDependentService);\n\t\t\tassert.ok(d);\n\t\t\tassert.strictEqual(d.name, 'farboo');\n\t\t});\n\t});\n\n\ttest('SyncDesc - target depends on service future', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\t\tcollection.set(IDependentService, new SyncDescriptor<IDependentService>(DependentService));\n\n\t\tconst d = service.createInstance(DependentServiceTarget);\n\t\tassert.ok(d instanceof DependentServiceTarget);\n\n\t\tconst d2 = service.createInstance(DependentServiceTarget2);\n\t\tassert.ok(d2 instanceof DependentServiceTarget2);\n\t});\n\n\ttest('SyncDesc - explode on loop', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(ServiceLoop1));\n\t\tcollection.set(IService2, new SyncDescriptor<IService2>(ServiceLoop2));\n\n\t\tassert.throws(() => {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService1);\n\t\t\t});\n\t\t});\n\t\tassert.throws(() => {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService2);\n\t\t\t});\n\t\t});\n\n\t\ttry {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService1);\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tassert.ok(err.name);\n\t\t\tassert.ok(err.message);\n\t\t}\n\t});\n\n\ttest('Invoke - get services', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.strictEqual(accessor.get(IService1).c, 1);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\t});\n\n\ttest('Invoke - get service, optional', function () {\n\t\tconst collection = new ServiceCollection([IService1, new Service1()]);\n\t\tconst service = new InstantiationService(collection);\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.throws(() => accessor.get(IService2));\n\t\t\treturn true;\n\t\t}\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\t});\n\n\ttest('Invoke - keeping accessor NOT allowed', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tlet cached: ServicesAccessor;\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.strictEqual(accessor.get(IService1).c, 1);\n\t\t\tcached = accessor;\n\t\t\treturn true;\n\t\t}\n\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\n\t\tassert.throws(() => cached.get(IService2));\n\t});\n\n\ttest('Invoke - throw error', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tassert.throws(() => service.invokeFunction(test));\n\t});\n\n\ttest('Create child', function () {\n\n\t\tlet serviceInstanceCount = 0;\n\n\t\tconst CtorCounter = class implements Service1 {\n\t\t\tdeclare readonly _serviceBrand: undefined;\n\t\t\tc = 1;\n\t\t\tconstructor() {\n\t\t\t\tserviceInstanceCount += 1;\n\t\t\t}\n\t\t};\n\n\t\t// creating the service instance BEFORE the child service\n\t\tlet service = new InstantiationService(new ServiceCollection([IService1, new SyncDescriptor(CtorCounter)]));\n\t\tservice.createInstance(Service1Consumer);\n\n\t\t// second instance must be earlier ONE\n\t\tlet child = service.createChild(new ServiceCollection([IService2, new Service2()]));\n\t\tchild.createInstance(Service1Consumer);\n\n\t\tassert.strictEqual(serviceInstanceCount, 1);\n\n\t\t// creating the service instance AFTER the child service\n\t\tserviceInstanceCount = 0;\n\t\tservice = new InstantiationService(new ServiceCollection([IService1, new SyncDescriptor(CtorCounter)]));\n\t\tchild = service.createChild(new ServiceCollection([IService2, new Service2()]));\n\n\t\t// second instance must be earlier ONE\n\t\tservice.createInstance(Service1Consumer);\n\t\tchild.createInstance(Service1Consumer);\n\n\t\tassert.strictEqual(serviceInstanceCount, 1);\n\t});\n\n\ttest('Remote window / integration tests is broken #105562', function () {\n\n\t\tconst Service1 = createDecorator<any>('service1');\n\t\tclass Service1Impl {\n\t\t\tconstructor(@IInstantiationService insta: IInstantiationService) {\n\t\t\t\tconst c = insta.invokeFunction(accessor => accessor.get(Service2)); // THIS is the recursive call\n\t\t\t\tassert.ok(c);\n\t\t\t}\n\t\t}\n\t\tconst Service2 = createDecorator<any>('service2');\n\t\tclass Service2Impl {\n\t\t\tconstructor() { }\n\t\t}\n\n\t\t// This service depends on Service1 and Service2 BUT creating Service1 creates Service2 (via recursive invocation)\n\t\t// and then Servce2 should not be created a second time\n\t\tconst Service21 = createDecorator<any>('service21');\n\t\tclass Service21Impl {\n\t\t\tconstructor(@Service2 public readonly service2: Service2Impl, @Service1 public readonly service1: Service1Impl) { }\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[Service1, new SyncDescriptor(Service1Impl)],\n\t\t\t[Service2, new SyncDescriptor(Service2Impl)],\n\t\t\t[Service21, new SyncDescriptor(Service21Impl)],\n\t\t));\n\n\t\tconst obj = insta.invokeFunction(accessor => accessor.get(Service21));\n\t\tassert.ok(obj);\n\t});\n\n\ttest('Sync/Async dependency loop', async function () {\n\n\t\tconst A = createDecorator<A>('A');\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface A { _serviceBrand: undefined; doIt(): void }\n\t\tinterface B { _serviceBrand: undefined; b(): boolean }\n\n\t\tclass BConsumer {\n\t\t\tconstructor(@B private readonly b: B) {\n\n\t\t\t}\n\t\t\tdoIt() {\n\t\t\t\treturn this.b.b();\n\t\t\t}\n\t\t}\n\n\t\tclass AService implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tprop: BConsumer;\n\t\t\tconstructor(@IInstantiationService insta: IInstantiationService) {\n\t\t\t\tthis.prop = insta.createInstance(BConsumer);\n\t\t\t}\n\t\t\tdoIt() {\n\t\t\t\treturn this.prop.doIt();\n\t\t\t}\n\t\t}\n\n\t\tclass BService implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tconstructor(@A a: A) {\n\t\t\t\tassert.ok(a);\n\t\t\t}\n\t\t\tb() { return true; }\n\t\t}\n\n\t\t// SYNC -> explodes AImpl -> [insta:BConsumer] -> BImpl -> AImpl\n\t\t{\n\t\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t\t[A, new SyncDescriptor(AService)],\n\t\t\t\t[B, new SyncDescriptor(BService)],\n\t\t\t), true, undefined, true);\n\n\t\t\ttry {\n\t\t\t\tinsta1.invokeFunction(accessor => accessor.get(A));\n\t\t\t\tassert.ok(false);\n\n\t\t\t} catch (error) {\n\t\t\t\tassert.ok(error instanceof Error);\n\t\t\t\tassert.ok(error.message.includes('RECURSIVELY'));\n\t\t\t}\n\t\t}\n\n\t\t// ASYNC -> doesn't explode but cycle is tracked\n\t\t{\n\t\t\tconst insta2 = new InstantiationService(new ServiceCollection(\n\t\t\t\t[A, new SyncDescriptor(AService, undefined, true)],\n\t\t\t\t[B, new SyncDescriptor(BService, undefined)],\n\t\t\t), true, undefined, true);\n\n\t\t\tconst a = insta2.invokeFunction(accessor => accessor.get(A));\n\t\t\ta.doIt();\n\n\t\t\tconst cycle = insta2._globalGraph?.findCycleSlow();\n\t\t\tassert.strictEqual(cycle, 'A -> B -> A');\n\t\t}\n\t});\n\n\ttest('Delayed and events', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t}\n\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\t\tconst d1 = c.a.onDidDoIt(listener);\n\t\tconst d2 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\t\tassert.strictEqual(eventCount, 0);\n\t\td2.dispose();\n\n\t\t// instantiation happens on first call\n\t\tc.a.doIt();\n\t\tassert.strictEqual(created, true);\n\t\tassert.strictEqual(eventCount, 1);\n\n\n\t\tconst d3 = c.a.onDidDoIt(listener);\n\t\tc.a.doIt();\n\t\tassert.strictEqual(eventCount, 3);\n\n\t\tdispose([d1, d3]);\n\t});\n\n\n\ttest('Capture event before init, use after init', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t\tnoop(): void;\n\t\t}\n\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\n\t\t\tnoop(): void {\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\n\t\tconst event = c.a.onDidDoIt;\n\n\t\t// const d1 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\n\t\tc.a.noop();\n\t\tassert.strictEqual(created, true);\n\n\t\tconst d1 = event(listener);\n\n\t\tc.a.doIt();\n\n\n\t\t// instantiation happens on first call\n\t\tassert.strictEqual(eventCount, 1);\n\n\t\tdispose(d1);\n\t});\n\n\ttest('Dispose early event listener', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t}\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\n\t\tconst d1 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\t\tassert.strictEqual(eventCount, 0);\n\n\t\tc.a.doIt();\n\n\t\t// instantiation happens on first call\n\t\tassert.strictEqual(created, true);\n\t\tassert.strictEqual(eventCount, 1);\n\n\t\tdispose(d1);\n\n\t\tc.a.doIt();\n\t\tassert.strictEqual(eventCount, 1);\n\t});\n\n\n\ttest('Dispose services it created', function () {\n\t\tlet disposedA = false;\n\t\tlet disposedB = false;\n\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t\tdispose() {\n\t\t\t\tdisposedA = true;\n\t\t\t}\n\t\t}\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t\tdispose() {\n\t\t\t\tdisposedB = true;\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@A public readonly a: A,\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(a.value, b.value);\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\n\t\tinsta.dispose();\n\t\tassert.ok(c);\n\t\tassert.strictEqual(disposedA, true);\n\t\tassert.strictEqual(disposedB, false);\n\t});\n\n\ttest('Disposed service cannot be used anymore', function () {\n\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tassert.ok(c);\n\n\t\tinsta.dispose();\n\n\t\tassert.throws(() => insta.createInstance(Consumer));\n\t\tassert.throws(() => insta.invokeFunction(accessor => { }));\n\t\tassert.throws(() => insta.createChild(new ServiceCollection()));\n\t});\n\n\ttest('Child does not dispose parent', function () {\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tconst insta2 = insta1.createChild(new ServiceCollection());\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tassert.ok(insta1.createInstance(Consumer));\n\t\tassert.ok(insta2.createInstance(Consumer));\n\n\t\tinsta2.dispose();\n\n\t\tassert.ok(insta1.createInstance(Consumer)); // parent NOT disposed by child\n\t\tassert.throws(() => insta2.createInstance(Consumer));\n\t});\n\n\ttest('Parent does dispose children', function () {\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tconst insta2 = insta1.createChild(new ServiceCollection());\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tassert.ok(insta1.createInstance(Consumer));\n\t\tassert.ok(insta2.createInstance(Consumer));\n\n\t\tinsta1.dispose();\n\n\t\tassert.throws(() => insta2.createInstance(Consumer)); // child is disposed by parent\n\t\tassert.throws(() => insta1.createInstance(Consumer));\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { dispose } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../common/descriptors.js';\nimport { createDecorator, IInstantiationService, ServicesAccessor } from '../../common/instantiation.js';\nimport { InstantiationService } from '../../common/instantiationService.js';\nimport { ServiceCollection } from '../../common/serviceCollection.js';\n\nconst IService1 = createDecorator<IService1>('service1');\n\ninterface IService1 {\n\treadonly _serviceBrand: undefined;\n\tc: number;\n}\n\nclass Service1 implements IService1 {\n\tdeclare readonly _serviceBrand: undefined;\n\tc = 1;\n}\n\nconst IService2 = createDecorator<IService2>('service2');\n\ninterface IService2 {\n\treadonly _serviceBrand: undefined;\n\td: boolean;\n}\n\nclass Service2 implements IService2 {\n\tdeclare readonly _serviceBrand: undefined;\n\td = true;\n}\n\nconst IService3 = createDecorator<IService3>('service3');\n\ninterface IService3 {\n\treadonly _serviceBrand: undefined;\n\ts: string;\n}\n\nclass Service3 implements IService3 {\n\tdeclare readonly _serviceBrand: undefined;\n\ts = 'farboo';\n}\n\nconst IDependentService = createDecorator<IDependentService>('dependentService');\n\ninterface IDependentService {\n\treadonly _serviceBrand: undefined;\n\tname: string;\n}\n\nclass DependentService implements IDependentService {\n\tdeclare readonly _serviceBrand: undefined;\n\tconstructor(@IService1 service: IService1) {\n\t\tassert.strictEqual(service.c, 1);\n\t}\n\n\tname = 'farboo';\n}\n\nclass Service1Consumer {\n\n\tconstructor(@IService1 service1: IService1) {\n\t\tassert.ok(service1);\n\t\tassert.strictEqual(service1.c, 1);\n\t}\n}\n\nclass Target2Dep {\n\n\tconstructor(@IService1 service1: IService1, @IService2 service2: Service2) {\n\t\tassert.ok(service1 instanceof Service1);\n\t\tassert.ok(service2 instanceof Service2);\n\t}\n}\n\nclass TargetWithStaticParam {\n\tconstructor(v: boolean, @IService1 service1: IService1) {\n\t\tassert.ok(v);\n\t\tassert.ok(service1);\n\t\tassert.strictEqual(service1.c, 1);\n\t}\n}\n\n\n\nclass DependentServiceTarget {\n\tconstructor(@IDependentService d: IDependentService) {\n\t\tassert.ok(d);\n\t\tassert.strictEqual(d.name, 'farboo');\n\t}\n}\n\nclass DependentServiceTarget2 {\n\tconstructor(@IDependentService d: IDependentService, @IService1 s: IService1) {\n\t\tassert.ok(d);\n\t\tassert.strictEqual(d.name, 'farboo');\n\t\tassert.ok(s);\n\t\tassert.strictEqual(s.c, 1);\n\t}\n}\n\n\nclass ServiceLoop1 implements IService1 {\n\tdeclare readonly _serviceBrand: undefined;\n\tc = 1;\n\n\tconstructor(@IService2 s: IService2) {\n\n\t}\n}\n\nclass ServiceLoop2 implements IService2 {\n\tdeclare readonly _serviceBrand: undefined;\n\td = true;\n\n\tconstructor(@IService1 s: IService1) {\n\n\t}\n}\n\nsuite('Instantiation Service', () => {\n\n\ttest('service collection, cannot overwrite', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tlet result = collection.set(IService1, null!);\n\t\tassert.strictEqual(result, undefined);\n\t\tresult = collection.set(IService1, new Service1());\n\t\tassert.strictEqual(result, null);\n\t});\n\n\ttest('service collection, add/has', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tcollection.set(IService1, null!);\n\t\tassert.ok(collection.has(IService1));\n\n\t\tcollection.set(IService2, null!);\n\t\tassert.ok(collection.has(IService1));\n\t\tassert.ok(collection.has(IService2));\n\t});\n\n\ttest('@Param - simple clase', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\t\tcollection.set(IService3, new Service3());\n\n\t\tservice.createInstance(Service1Consumer);\n\t});\n\n\ttest('@Param - fixed args', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\t\tcollection.set(IService3, new Service3());\n\n\t\tservice.createInstance(TargetWithStaticParam, true);\n\t});\n\n\ttest('service collection is live', function () {\n\n\t\tconst collection = new ServiceCollection();\n\t\tcollection.set(IService1, new Service1());\n\n\t\tconst service = new InstantiationService(collection);\n\t\tservice.createInstance(Service1Consumer);\n\n\t\tcollection.set(IService2, new Service2());\n\n\t\tservice.createInstance(Target2Dep);\n\t\tservice.invokeFunction(function (a) {\n\t\t\tassert.ok(a.get(IService1));\n\t\t\tassert.ok(a.get(IService2));\n\t\t});\n\t});\n\n\t// we made this a warning\n\t// test('@Param - too many args', function () {\n\t// \tlet service = instantiationService.create(Object.create(null));\n\t// \tservice.addSingleton(IService1, new Service1());\n\t// \tservice.addSingleton(IService2, new Service2());\n\t// \tservice.addSingleton(IService3, new Service3());\n\n\t// \tassert.throws(() => service.createInstance(ParameterTarget2, true, 2));\n\t// });\n\n\t// test('@Param - too few args', function () {\n\t// \tlet service = instantiationService.create(Object.create(null));\n\t// \tservice.addSingleton(IService1, new Service1());\n\t// \tservice.addSingleton(IService2, new Service2());\n\t// \tservice.addSingleton(IService3, new Service3());\n\n\t// \tassert.throws(() => service.createInstance(ParameterTarget2));\n\t// });\n\n\ttest('SyncDesc - no dependencies', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\n\t\tservice.invokeFunction(accessor => {\n\n\t\t\tconst service1 = accessor.get(IService1);\n\t\t\tassert.ok(service1);\n\t\t\tassert.strictEqual(service1.c, 1);\n\n\t\t\tconst service2 = accessor.get(IService1);\n\t\t\tassert.ok(service1 === service2);\n\t\t});\n\t});\n\n\ttest('SyncDesc - service with service dependency', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\t\tcollection.set(IDependentService, new SyncDescriptor<IDependentService>(DependentService));\n\n\t\tservice.invokeFunction(accessor => {\n\t\t\tconst d = accessor.get(IDependentService);\n\t\t\tassert.ok(d);\n\t\t\tassert.strictEqual(d.name, 'farboo');\n\t\t});\n\t});\n\n\ttest('SyncDesc - target depends on service future', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(Service1));\n\t\tcollection.set(IDependentService, new SyncDescriptor<IDependentService>(DependentService));\n\n\t\tconst d = service.createInstance(DependentServiceTarget);\n\t\tassert.ok(d instanceof DependentServiceTarget);\n\n\t\tconst d2 = service.createInstance(DependentServiceTarget2);\n\t\tassert.ok(d2 instanceof DependentServiceTarget2);\n\t});\n\n\ttest('SyncDesc - explode on loop', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new SyncDescriptor<IService1>(ServiceLoop1));\n\t\tcollection.set(IService2, new SyncDescriptor<IService2>(ServiceLoop2));\n\n\t\tassert.throws(() => {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService1);\n\t\t\t});\n\t\t});\n\t\tassert.throws(() => {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService2);\n\t\t\t});\n\t\t});\n\n\t\ttry {\n\t\t\tservice.invokeFunction(accessor => {\n\t\t\t\taccessor.get(IService1);\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tassert.ok(err.name);\n\t\t\tassert.ok(err.message);\n\t\t}\n\t});\n\n\ttest('Invoke - get services', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.strictEqual(accessor.get(IService1).c, 1);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\t});\n\n\ttest('Invoke - get service, optional', function () {\n\t\tconst collection = new ServiceCollection([IService1, new Service1()]);\n\t\tconst service = new InstantiationService(collection);\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.throws(() => accessor.get(IService2));\n\t\t\treturn true;\n\t\t}\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\t});\n\n\ttest('Invoke - keeping accessor NOT allowed', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tlet cached: ServicesAccessor;\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tassert.ok(accessor.get(IService1) instanceof Service1);\n\t\t\tassert.strictEqual(accessor.get(IService1).c, 1);\n\t\t\tcached = accessor;\n\t\t\treturn true;\n\t\t}\n\n\t\tassert.strictEqual(service.invokeFunction(test), true);\n\n\t\tassert.throws(() => cached.get(IService2));\n\t});\n\n\ttest('Invoke - throw error', function () {\n\t\tconst collection = new ServiceCollection();\n\t\tconst service = new InstantiationService(collection);\n\t\tcollection.set(IService1, new Service1());\n\t\tcollection.set(IService2, new Service2());\n\n\t\tfunction test(accessor: ServicesAccessor) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tassert.throws(() => service.invokeFunction(test));\n\t});\n\n\ttest('Create child', function () {\n\n\t\tlet serviceInstanceCount = 0;\n\n\t\tconst CtorCounter = class implements Service1 {\n\t\t\tdeclare readonly _serviceBrand: undefined;\n\t\t\tc = 1;\n\t\t\tconstructor() {\n\t\t\t\tserviceInstanceCount += 1;\n\t\t\t}\n\t\t};\n\n\t\t// creating the service instance BEFORE the child service\n\t\tlet service = new InstantiationService(new ServiceCollection([IService1, new SyncDescriptor(CtorCounter)]));\n\t\tservice.createInstance(Service1Consumer);\n\n\t\t// second instance must be earlier ONE\n\t\tlet child = service.createChild(new ServiceCollection([IService2, new Service2()]));\n\t\tchild.createInstance(Service1Consumer);\n\n\t\tassert.strictEqual(serviceInstanceCount, 1);\n\n\t\t// creating the service instance AFTER the child service\n\t\tserviceInstanceCount = 0;\n\t\tservice = new InstantiationService(new ServiceCollection([IService1, new SyncDescriptor(CtorCounter)]));\n\t\tchild = service.createChild(new ServiceCollection([IService2, new Service2()]));\n\n\t\t// second instance must be earlier ONE\n\t\tservice.createInstance(Service1Consumer);\n\t\tchild.createInstance(Service1Consumer);\n\n\t\tassert.strictEqual(serviceInstanceCount, 1);\n\t});\n\n\ttest('Remote window / integration tests is broken #105562', function () {\n\n\t\tconst Service1 = createDecorator<any>('service1');\n\t\tclass Service1Impl {\n\t\t\tconstructor(@IInstantiationService insta: IInstantiationService) {\n\t\t\t\tconst c = insta.invokeFunction(accessor => accessor.get(Service2)); // THIS is the recursive call\n\t\t\t\tassert.ok(c);\n\t\t\t}\n\t\t}\n\t\tconst Service2 = createDecorator<any>('service2');\n\t\tclass Service2Impl {\n\t\t\tconstructor() { }\n\t\t}\n\n\t\t// This service depends on Service1 and Service2 BUT creating Service1 creates Service2 (via recursive invocation)\n\t\t// and then Servce2 should not be created a second time\n\t\tconst Service21 = createDecorator<any>('service21');\n\t\tclass Service21Impl {\n\t\t\tconstructor(@Service2 public readonly service2: Service2Impl, @Service1 public readonly service1: Service1Impl) { }\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[Service1, new SyncDescriptor(Service1Impl)],\n\t\t\t[Service2, new SyncDescriptor(Service2Impl)],\n\t\t\t[Service21, new SyncDescriptor(Service21Impl)],\n\t\t));\n\n\t\tconst obj = insta.invokeFunction(accessor => accessor.get(Service21));\n\t\tassert.ok(obj);\n\t});\n\n\ttest('Sync/Async dependency loop', async function () {\n\n\t\tconst A = createDecorator<A>('A');\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface A { _serviceBrand: undefined; doIt(): void }\n\t\tinterface B { _serviceBrand: undefined; b(): boolean }\n\n\t\tclass BConsumer {\n\t\t\tconstructor(@B private readonly b: B) {\n\n\t\t\t}\n\t\t\tdoIt() {\n\t\t\t\treturn this.b.b();\n\t\t\t}\n\t\t}\n\n\t\tclass AService implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tprop: BConsumer;\n\t\t\tconstructor(@IInstantiationService insta: IInstantiationService) {\n\t\t\t\tthis.prop = insta.createInstance(BConsumer);\n\t\t\t}\n\t\t\tdoIt() {\n\t\t\t\treturn this.prop.doIt();\n\t\t\t}\n\t\t}\n\n\t\tclass BService implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tconstructor(@A a: A) {\n\t\t\t\tassert.ok(a);\n\t\t\t}\n\t\t\tb() { return true; }\n\t\t}\n\n\t\t// SYNC -> explodes AImpl -> [insta:BConsumer] -> BImpl -> AImpl\n\t\t{\n\t\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t\t[A, new SyncDescriptor(AService)],\n\t\t\t\t[B, new SyncDescriptor(BService)],\n\t\t\t), true, undefined, true);\n\n\t\t\ttry {\n\t\t\t\tinsta1.invokeFunction(accessor => accessor.get(A));\n\t\t\t\tassert.ok(false);\n\n\t\t\t} catch (error) {\n\t\t\t\tassert.ok(error instanceof Error);\n\t\t\t\tassert.ok(error.message.includes('RECURSIVELY'));\n\t\t\t}\n\t\t}\n\n\t\t// ASYNC -> doesn't explode but cycle is tracked\n\t\t{\n\t\t\tconst insta2 = new InstantiationService(new ServiceCollection(\n\t\t\t\t[A, new SyncDescriptor(AService, undefined, true)],\n\t\t\t\t[B, new SyncDescriptor(BService, undefined)],\n\t\t\t), true, undefined, true);\n\n\t\t\tconst a = insta2.invokeFunction(accessor => accessor.get(A));\n\t\t\ta.doIt();\n\n\t\t\tconst cycle = insta2._globalGraph?.findCycleSlow();\n\t\t\tassert.strictEqual(cycle, 'A -> B -> A');\n\t\t}\n\t});\n\n\ttest('Delayed and events', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t}\n\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\t\tconst d1 = c.a.onDidDoIt(listener);\n\t\tconst d2 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\t\tassert.strictEqual(eventCount, 0);\n\t\td2.dispose();\n\n\t\t// instantiation happens on first call\n\t\tc.a.doIt();\n\t\tassert.strictEqual(created, true);\n\t\tassert.strictEqual(eventCount, 1);\n\n\n\t\tconst d3 = c.a.onDidDoIt(listener);\n\t\tc.a.doIt();\n\t\tassert.strictEqual(eventCount, 3);\n\n\t\tdispose([d1, d3]);\n\t});\n\n\n\ttest('Capture event before init, use after init', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t\tnoop(): void;\n\t\t}\n\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\n\t\t\tnoop(): void {\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\n\t\tconst event = c.a.onDidDoIt;\n\n\t\t// const d1 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\n\t\tc.a.noop();\n\t\tassert.strictEqual(created, true);\n\n\t\tconst d1 = event(listener);\n\n\t\tc.a.doIt();\n\n\n\t\t// instantiation happens on first call\n\t\tassert.strictEqual(eventCount, 1);\n\n\t\tdispose(d1);\n\t});\n\n\ttest('Dispose early event listener', function () {\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\treadonly onDidDoIt: Event<any>;\n\t\t\tdoIt(): void;\n\t\t}\n\t\tlet created = false;\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\t_doIt = 0;\n\n\t\t\t_onDidDoIt = new Emitter<this>();\n\t\t\treadonly onDidDoIt: Event<this> = this._onDidDoIt.event;\n\n\t\t\tconstructor() {\n\t\t\t\tcreated = true;\n\t\t\t}\n\n\t\t\tdoIt(): void {\n\t\t\t\tthis._doIt += 1;\n\t\t\t\tthis._onDidDoIt.fire(this);\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(@A public readonly a: A) {\n\t\t\t\t// eager subscribe -> NO service instance\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tlet eventCount = 0;\n\n\t\t// subscribing to event doesn't trigger instantiation\n\t\tconst listener = (e: any) => {\n\t\t\tassert.ok(e instanceof AImpl);\n\t\t\teventCount++;\n\t\t};\n\n\t\tconst d1 = c.a.onDidDoIt(listener);\n\t\tassert.strictEqual(created, false);\n\t\tassert.strictEqual(eventCount, 0);\n\n\t\tc.a.doIt();\n\n\t\t// instantiation happens on first call\n\t\tassert.strictEqual(created, true);\n\t\tassert.strictEqual(eventCount, 1);\n\n\t\tdispose(d1);\n\n\t\tc.a.doIt();\n\t\tassert.strictEqual(eventCount, 1);\n\t});\n\n\n\ttest('Dispose services it created', function () {\n\t\tlet disposedA = false;\n\t\tlet disposedB = false;\n\n\t\tconst A = createDecorator<A>('A');\n\t\tinterface A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass AImpl implements A {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t\tdispose() {\n\t\t\t\tdisposedA = true;\n\t\t\t}\n\t\t}\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t\tdispose() {\n\t\t\t\tdisposedB = true;\n\t\t\t}\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[A, new SyncDescriptor(AImpl, undefined, true)],\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@A public readonly a: A,\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(a.value, b.value);\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\n\t\tinsta.dispose();\n\t\tassert.ok(c);\n\t\tassert.strictEqual(disposedA, true);\n\t\tassert.strictEqual(disposedB, false);\n\t});\n\n\ttest('Disposed service cannot be used anymore', function () {\n\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tconst c: Consumer = insta.createInstance(Consumer);\n\t\tassert.ok(c);\n\n\t\tinsta.dispose();\n\n\t\tassert.throws(() => insta.createInstance(Consumer));\n\t\tassert.throws(() => insta.invokeFunction(accessor => { }));\n\t\tassert.throws(() => insta.createChild(new ServiceCollection()));\n\t});\n\n\ttest('Child does not dispose parent', function () {\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tconst insta2 = insta1.createChild(new ServiceCollection());\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tassert.ok(insta1.createInstance(Consumer));\n\t\tassert.ok(insta2.createInstance(Consumer));\n\n\t\tinsta2.dispose();\n\n\t\tassert.ok(insta1.createInstance(Consumer)); // parent NOT disposed by child\n\t\tassert.throws(() => insta2.createInstance(Consumer));\n\t});\n\n\ttest('Parent does dispose children', function () {\n\n\t\tconst B = createDecorator<B>('B');\n\t\tinterface B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1;\n\t\t}\n\t\tclass BImpl implements B {\n\t\t\t_serviceBrand: undefined;\n\t\t\tvalue: 1 = 1;\n\t\t}\n\n\t\tconst insta1 = new InstantiationService(new ServiceCollection(\n\t\t\t[B, new BImpl()],\n\t\t), true, undefined, true);\n\n\t\tconst insta2 = insta1.createChild(new ServiceCollection());\n\n\t\tclass Consumer {\n\t\t\tconstructor(\n\t\t\t\t@B public readonly b: B\n\t\t\t) {\n\t\t\t\tassert.strictEqual(b.value, 1);\n\t\t\t}\n\t\t}\n\n\t\tassert.ok(insta1.createInstance(Consumer));\n\t\tassert.ok(insta2.createInstance(Consumer));\n\n\t\tinsta1.dispose();\n\n\t\tassert.throws(() => insta2.createInstance(Consumer)); // child is disposed by parent\n\t\tassert.throws(() => insta1.createInstance(Consumer));\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}