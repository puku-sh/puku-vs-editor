{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/instantiation/test/common/instantiationServiceMock.ts","vs/platform/instantiation/test/common/instantiationServiceMock.ts"],"names":[],"mappings":"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","file":"instantiationServiceMock.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as sinon from 'sinon';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { SyncDescriptor, SyncDescriptor0 } from '../../common/descriptors.js';\nimport { GetLeadingNonServiceArgs, ServiceIdentifier, ServicesAccessor } from '../../common/instantiation.js';\nimport { InstantiationService, Trace } from '../../common/instantiationService.js';\nimport { ServiceCollection } from '../../common/serviceCollection.js';\n\ninterface IServiceMock<T> {\n\tid: ServiceIdentifier<T>;\n\tservice: any;\n}\n\nconst isSinonSpyLike = (fn: Function): fn is sinon.SinonSpy => fn && 'callCount' in fn;\n\nexport class TestInstantiationService extends InstantiationService implements IDisposable, ServicesAccessor {\n\n\tprivate _servciesMap: Map<ServiceIdentifier<any>, any>;\n\tprivate readonly _classStubs: Map<Function, any> = new Map();\n\n\tconstructor(private _serviceCollection: ServiceCollection = new ServiceCollection(), strict: boolean = false, parent?: TestInstantiationService, private _properDispose?: boolean) {\n\t\tsuper(_serviceCollection, strict, parent);\n\n\t\tthis._servciesMap = new Map<ServiceIdentifier<any>, any>();\n\t}\n\n\tpublic get<T>(service: ServiceIdentifier<T>): T {\n\t\treturn super._getOrCreateServiceInstance(service, Trace.traceCreation(false, TestInstantiationService));\n\t}\n\n\tpublic getIfExists<T>(service: ServiceIdentifier<T>): T | undefined {\n\t\ttry {\n\t\t\treturn super._getOrCreateServiceInstance(service, Trace.traceCreation(false, TestInstantiationService));\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic set<T>(service: ServiceIdentifier<T>, instance: T): T {\n\t\treturn <T>this._serviceCollection.set(service, instance);\n\t}\n\n\tpublic mock<T>(service: ServiceIdentifier<T>): T | sinon.SinonMock {\n\t\treturn <T>this._create(service, { mock: true });\n\t}\n\n\tpublic stubInstance<T>(ctor: new (...args: any[]) => T, instance: Partial<T>): void {\n\t\tthis._classStubs.set(ctor, instance);\n\t}\n\n\tpublic override createInstance<T>(descriptor: SyncDescriptor0<T>): T;\n\tpublic override createInstance<Ctor extends new (...args: any[]) => unknown, R extends InstanceType<Ctor>>(ctor: Ctor, ...args: GetLeadingNonServiceArgs<ConstructorParameters<Ctor>>): R;\n\tpublic override createInstance(ctorOrDescriptor: any | SyncDescriptor<any>, ...rest: unknown[]): unknown {\n\t\tif (this._classStubs.has(ctorOrDescriptor)) {\n\t\t\treturn this._classStubs.get(ctorOrDescriptor);\n\t\t}\n\t\treturn super.createInstance(ctorOrDescriptor, ...rest);\n\t}\n\n\tpublic stub<T>(service: ServiceIdentifier<T>, ctor: Function): T;\n\tpublic stub<T>(service: ServiceIdentifier<T>, obj: Partial<T>): T;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, ctor: Function, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, obj: Partial<T>, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T>(serviceIdentifier: ServiceIdentifier<T>, arg2: any, arg3?: string, arg4?: any): sinon.SinonStub | sinon.SinonSpy {\n\t\tconst service = typeof arg2 !== 'string' ? arg2 : undefined;\n\t\tconst serviceMock: IServiceMock<any> = { id: serviceIdentifier, service: service };\n\t\tconst property = typeof arg2 === 'string' ? arg2 : arg3;\n\t\tconst value = typeof arg2 === 'string' ? arg3 : arg4;\n\n\t\tconst stubObject = this._create(serviceMock, { stub: true }, service && !property);\n\t\tif (property) {\n\t\t\tif (stubObject[property]) {\n\t\t\t\tif (stubObject[property].hasOwnProperty('restore')) {\n\t\t\t\t\tstubObject[property].restore();\n\t\t\t\t}\n\t\t\t\tif (typeof value === 'function') {\n\t\t\t\t\tconst spy = isSinonSpyLike(value) ? value : sinon.spy(value);\n\t\t\t\t\tstubObject[property] = spy;\n\t\t\t\t\treturn spy;\n\t\t\t\t} else {\n\t\t\t\t\tconst stub = value ? sinon.stub().returns(value) : sinon.stub();\n\t\t\t\t\tstubObject[property] = stub;\n\t\t\t\t\treturn stub;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstubObject[property] = value;\n\t\t\t}\n\t\t}\n\t\treturn stubObject;\n\t}\n\n\tpublic stubPromise<T>(service?: ServiceIdentifier<T>, fnProperty?: string, value?: any): T | sinon.SinonStub;\n\tpublic stubPromise<T, V>(service?: ServiceIdentifier<T>, ctor?: any, fnProperty?: string, value?: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stubPromise<T, V>(service?: ServiceIdentifier<T>, obj?: any, fnProperty?: string, value?: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stubPromise(arg1?: any, arg2?: any, arg3?: any, arg4?: any): sinon.SinonStub | sinon.SinonSpy {\n\t\targ3 = typeof arg2 === 'string' ? Promise.resolve(arg3) : arg3;\n\t\targ4 = typeof arg2 !== 'string' && typeof arg3 === 'string' ? Promise.resolve(arg4) : arg4;\n\t\treturn this.stub(arg1, arg2, arg3, arg4);\n\t}\n\n\tpublic spy<T>(service: ServiceIdentifier<T>, fnProperty: string): sinon.SinonSpy {\n\t\tconst spy = sinon.spy();\n\t\tthis.stub(service, fnProperty, spy);\n\t\treturn spy;\n\t}\n\n\tprivate _create<T>(serviceMock: IServiceMock<T>, options: SinonOptions, reset?: boolean): any;\n\tprivate _create<T>(ctor: any, options: SinonOptions): any;\n\tprivate _create(arg1: any, options: SinonOptions, reset: boolean = false): any {\n\t\tif (this.isServiceMock(arg1)) {\n\t\t\tconst service = this._getOrCreateService(arg1, options, reset);\n\t\t\tthis._serviceCollection.set(arg1.id, service);\n\t\t\treturn service;\n\t\t}\n\t\treturn options.mock ? sinon.mock(arg1) : this._createStub(arg1);\n\t}\n\n\tprivate _getOrCreateService<T>(serviceMock: IServiceMock<T>, opts: SinonOptions, reset?: boolean): any {\n\t\tconst service: any = this._serviceCollection.get(serviceMock.id);\n\t\tif (!reset && service) {\n\t\t\tif (opts.mock && service['sinonOptions'] && !!service['sinonOptions'].mock) {\n\t\t\t\treturn service;\n\t\t\t}\n\t\t\tif (opts.stub && service['sinonOptions'] && !!service['sinonOptions'].stub) {\n\t\t\t\treturn service;\n\t\t\t}\n\t\t}\n\t\treturn this._createService(serviceMock, opts);\n\t}\n\n\tprivate _createService(serviceMock: IServiceMock<any>, opts: SinonOptions): any {\n\t\tserviceMock.service = serviceMock.service ? serviceMock.service : this._servciesMap.get(serviceMock.id);\n\t\tconst service = opts.mock ? sinon.mock(serviceMock.service) : this._createStub(serviceMock.service);\n\t\tservice['sinonOptions'] = opts;\n\t\treturn service;\n\t}\n\n\tprivate _createStub(arg: any): any {\n\t\treturn typeof arg === 'object' ? arg : sinon.createStubInstance(arg);\n\t}\n\n\tprivate isServiceMock(arg1: any): boolean {\n\t\treturn typeof arg1 === 'object' && arg1.hasOwnProperty('id');\n\t}\n\n\toverride createChild(services: ServiceCollection): TestInstantiationService {\n\t\treturn new TestInstantiationService(services, false, this);\n\t}\n\n\toverride dispose() {\n\t\tsinon.restore();\n\t\tif (this._properDispose) {\n\t\t\tsuper.dispose();\n\t\t}\n\t}\n}\n\ninterface SinonOptions {\n\tmock?: boolean;\n\tstub?: boolean;\n}\n\nexport type ServiceIdCtorPair<T> = [id: ServiceIdentifier<T>, ctorOrInstance: T | (new (...args: any[]) => T)];\n\nexport function createServices(disposables: DisposableStore, services: ServiceIdCtorPair<any>[]): TestInstantiationService {\n\tconst serviceIdentifiers: ServiceIdentifier<any>[] = [];\n\tconst serviceCollection = new ServiceCollection();\n\n\tconst define = <T>(id: ServiceIdentifier<T>, ctorOrInstance: T | (new (...args: any[]) => T)) => {\n\t\tif (!serviceCollection.has(id)) {\n\t\t\tif (typeof ctorOrInstance === 'function') {\n\t\t\t\tserviceCollection.set(id, new SyncDescriptor(ctorOrInstance as new (...args: any[]) => T));\n\t\t\t} else {\n\t\t\t\tserviceCollection.set(id, ctorOrInstance);\n\t\t\t}\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\n\tfor (const [id, ctor] of services) {\n\t\tdefine(id, ctor);\n\t}\n\n\tconst instantiationService = disposables.add(new TestInstantiationService(serviceCollection, true));\n\tdisposables.add(toDisposable(() => {\n\t\tfor (const id of serviceIdentifiers) {\n\t\t\tconst instanceOrDescriptor = serviceCollection.get(id);\n\t\t\tif (typeof instanceOrDescriptor.dispose === 'function') {\n\t\t\t\tinstanceOrDescriptor.dispose();\n\t\t\t}\n\t\t}\n\t}));\n\treturn instantiationService;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as sinon from 'sinon';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { SyncDescriptor, SyncDescriptor0 } from '../../common/descriptors.js';\nimport { GetLeadingNonServiceArgs, ServiceIdentifier, ServicesAccessor } from '../../common/instantiation.js';\nimport { InstantiationService, Trace } from '../../common/instantiationService.js';\nimport { ServiceCollection } from '../../common/serviceCollection.js';\n\ninterface IServiceMock<T> {\n\tid: ServiceIdentifier<T>;\n\tservice: any;\n}\n\nconst isSinonSpyLike = (fn: Function): fn is sinon.SinonSpy => fn && 'callCount' in fn;\n\nexport class TestInstantiationService extends InstantiationService implements IDisposable, ServicesAccessor {\n\n\tprivate _servciesMap: Map<ServiceIdentifier<any>, any>;\n\tprivate readonly _classStubs: Map<Function, any> = new Map();\n\n\tconstructor(private _serviceCollection: ServiceCollection = new ServiceCollection(), strict: boolean = false, parent?: TestInstantiationService, private _properDispose?: boolean) {\n\t\tsuper(_serviceCollection, strict, parent);\n\n\t\tthis._servciesMap = new Map<ServiceIdentifier<any>, any>();\n\t}\n\n\tpublic get<T>(service: ServiceIdentifier<T>): T {\n\t\treturn super._getOrCreateServiceInstance(service, Trace.traceCreation(false, TestInstantiationService));\n\t}\n\n\tpublic getIfExists<T>(service: ServiceIdentifier<T>): T | undefined {\n\t\ttry {\n\t\t\treturn super._getOrCreateServiceInstance(service, Trace.traceCreation(false, TestInstantiationService));\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic set<T>(service: ServiceIdentifier<T>, instance: T): T {\n\t\treturn <T>this._serviceCollection.set(service, instance);\n\t}\n\n\tpublic mock<T>(service: ServiceIdentifier<T>): T | sinon.SinonMock {\n\t\treturn <T>this._create(service, { mock: true });\n\t}\n\n\tpublic stubInstance<T>(ctor: new (...args: any[]) => T, instance: Partial<T>): void {\n\t\tthis._classStubs.set(ctor, instance);\n\t}\n\n\tpublic override createInstance<T>(descriptor: SyncDescriptor0<T>): T;\n\tpublic override createInstance<Ctor extends new (...args: any[]) => unknown, R extends InstanceType<Ctor>>(ctor: Ctor, ...args: GetLeadingNonServiceArgs<ConstructorParameters<Ctor>>): R;\n\tpublic override createInstance(ctorOrDescriptor: any | SyncDescriptor<any>, ...rest: unknown[]): unknown {\n\t\tif (this._classStubs.has(ctorOrDescriptor)) {\n\t\t\treturn this._classStubs.get(ctorOrDescriptor);\n\t\t}\n\t\treturn super.createInstance(ctorOrDescriptor, ...rest);\n\t}\n\n\tpublic stub<T>(service: ServiceIdentifier<T>, ctor: Function): T;\n\tpublic stub<T>(service: ServiceIdentifier<T>, obj: Partial<T>): T;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, ctor: Function, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, obj: Partial<T>, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T, V>(service: ServiceIdentifier<T>, property: string, value: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stub<T>(serviceIdentifier: ServiceIdentifier<T>, arg2: any, arg3?: string, arg4?: any): sinon.SinonStub | sinon.SinonSpy {\n\t\tconst service = typeof arg2 !== 'string' ? arg2 : undefined;\n\t\tconst serviceMock: IServiceMock<any> = { id: serviceIdentifier, service: service };\n\t\tconst property = typeof arg2 === 'string' ? arg2 : arg3;\n\t\tconst value = typeof arg2 === 'string' ? arg3 : arg4;\n\n\t\tconst stubObject = this._create(serviceMock, { stub: true }, service && !property);\n\t\tif (property) {\n\t\t\tif (stubObject[property]) {\n\t\t\t\tif (stubObject[property].hasOwnProperty('restore')) {\n\t\t\t\t\tstubObject[property].restore();\n\t\t\t\t}\n\t\t\t\tif (typeof value === 'function') {\n\t\t\t\t\tconst spy = isSinonSpyLike(value) ? value : sinon.spy(value);\n\t\t\t\t\tstubObject[property] = spy;\n\t\t\t\t\treturn spy;\n\t\t\t\t} else {\n\t\t\t\t\tconst stub = value ? sinon.stub().returns(value) : sinon.stub();\n\t\t\t\t\tstubObject[property] = stub;\n\t\t\t\t\treturn stub;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstubObject[property] = value;\n\t\t\t}\n\t\t}\n\t\treturn stubObject;\n\t}\n\n\tpublic stubPromise<T>(service?: ServiceIdentifier<T>, fnProperty?: string, value?: any): T | sinon.SinonStub;\n\tpublic stubPromise<T, V>(service?: ServiceIdentifier<T>, ctor?: any, fnProperty?: string, value?: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stubPromise<T, V>(service?: ServiceIdentifier<T>, obj?: any, fnProperty?: string, value?: V): V extends Function ? sinon.SinonSpy : sinon.SinonStub;\n\tpublic stubPromise(arg1?: any, arg2?: any, arg3?: any, arg4?: any): sinon.SinonStub | sinon.SinonSpy {\n\t\targ3 = typeof arg2 === 'string' ? Promise.resolve(arg3) : arg3;\n\t\targ4 = typeof arg2 !== 'string' && typeof arg3 === 'string' ? Promise.resolve(arg4) : arg4;\n\t\treturn this.stub(arg1, arg2, arg3, arg4);\n\t}\n\n\tpublic spy<T>(service: ServiceIdentifier<T>, fnProperty: string): sinon.SinonSpy {\n\t\tconst spy = sinon.spy();\n\t\tthis.stub(service, fnProperty, spy);\n\t\treturn spy;\n\t}\n\n\tprivate _create<T>(serviceMock: IServiceMock<T>, options: SinonOptions, reset?: boolean): any;\n\tprivate _create<T>(ctor: any, options: SinonOptions): any;\n\tprivate _create(arg1: any, options: SinonOptions, reset: boolean = false): any {\n\t\tif (this.isServiceMock(arg1)) {\n\t\t\tconst service = this._getOrCreateService(arg1, options, reset);\n\t\t\tthis._serviceCollection.set(arg1.id, service);\n\t\t\treturn service;\n\t\t}\n\t\treturn options.mock ? sinon.mock(arg1) : this._createStub(arg1);\n\t}\n\n\tprivate _getOrCreateService<T>(serviceMock: IServiceMock<T>, opts: SinonOptions, reset?: boolean): any {\n\t\tconst service: any = this._serviceCollection.get(serviceMock.id);\n\t\tif (!reset && service) {\n\t\t\tif (opts.mock && service['sinonOptions'] && !!service['sinonOptions'].mock) {\n\t\t\t\treturn service;\n\t\t\t}\n\t\t\tif (opts.stub && service['sinonOptions'] && !!service['sinonOptions'].stub) {\n\t\t\t\treturn service;\n\t\t\t}\n\t\t}\n\t\treturn this._createService(serviceMock, opts);\n\t}\n\n\tprivate _createService(serviceMock: IServiceMock<any>, opts: SinonOptions): any {\n\t\tserviceMock.service = serviceMock.service ? serviceMock.service : this._servciesMap.get(serviceMock.id);\n\t\tconst service = opts.mock ? sinon.mock(serviceMock.service) : this._createStub(serviceMock.service);\n\t\tservice['sinonOptions'] = opts;\n\t\treturn service;\n\t}\n\n\tprivate _createStub(arg: any): any {\n\t\treturn typeof arg === 'object' ? arg : sinon.createStubInstance(arg);\n\t}\n\n\tprivate isServiceMock(arg1: any): boolean {\n\t\treturn typeof arg1 === 'object' && arg1.hasOwnProperty('id');\n\t}\n\n\toverride createChild(services: ServiceCollection): TestInstantiationService {\n\t\treturn new TestInstantiationService(services, false, this);\n\t}\n\n\toverride dispose() {\n\t\tsinon.restore();\n\t\tif (this._properDispose) {\n\t\t\tsuper.dispose();\n\t\t}\n\t}\n}\n\ninterface SinonOptions {\n\tmock?: boolean;\n\tstub?: boolean;\n}\n\nexport type ServiceIdCtorPair<T> = [id: ServiceIdentifier<T>, ctorOrInstance: T | (new (...args: any[]) => T)];\n\nexport function createServices(disposables: DisposableStore, services: ServiceIdCtorPair<any>[]): TestInstantiationService {\n\tconst serviceIdentifiers: ServiceIdentifier<any>[] = [];\n\tconst serviceCollection = new ServiceCollection();\n\n\tconst define = <T>(id: ServiceIdentifier<T>, ctorOrInstance: T | (new (...args: any[]) => T)) => {\n\t\tif (!serviceCollection.has(id)) {\n\t\t\tif (typeof ctorOrInstance === 'function') {\n\t\t\t\tserviceCollection.set(id, new SyncDescriptor(ctorOrInstance as new (...args: any[]) => T));\n\t\t\t} else {\n\t\t\t\tserviceCollection.set(id, ctorOrInstance);\n\t\t\t}\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\n\tfor (const [id, ctor] of services) {\n\t\tdefine(id, ctor);\n\t}\n\n\tconst instantiationService = disposables.add(new TestInstantiationService(serviceCollection, true));\n\tdisposables.add(toDisposable(() => {\n\t\tfor (const id of serviceIdentifiers) {\n\t\t\tconst instanceOrDescriptor = serviceCollection.get(id);\n\t\t\tif (typeof instanceOrDescriptor.dispose === 'function') {\n\t\t\t\tinstanceOrDescriptor.dispose();\n\t\t\t}\n\t\t}\n\t}));\n\treturn instantiationService;\n}\n"]}