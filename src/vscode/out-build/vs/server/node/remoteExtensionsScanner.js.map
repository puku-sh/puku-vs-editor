{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/server/node/remoteExtensionsScanner.ts","vs/server/node/remoteExtensionsScanner.ts"],"names":[],"mappings":"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","file":"remoteExtensionsScanner.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isAbsolute, join, resolve } from '../../base/common/path.js';\nimport * as platform from '../../base/common/platform.js';\nimport { cwd } from '../../base/common/process.js';\nimport { URI } from '../../base/common/uri.js';\nimport * as performance from '../../base/common/performance.js';\nimport { Event } from '../../base/common/event.js';\nimport { IURITransformer, transformOutgoingURIs } from '../../base/common/uriIpc.js';\nimport { IServerChannel } from '../../base/parts/ipc/common/ipc.js';\nimport { ContextKeyDefinedExpr, ContextKeyEqualsExpr, ContextKeyExpr, ContextKeyExpression, ContextKeyGreaterEqualsExpr, ContextKeyGreaterExpr, ContextKeyInExpr, ContextKeyNotEqualsExpr, ContextKeyNotExpr, ContextKeyNotInExpr, ContextKeyRegexExpr, ContextKeySmallerEqualsExpr, ContextKeySmallerExpr, ContextKeyValue, IContextKeyExprMapper } from '../../platform/contextkey/common/contextkey.js';\nimport { IExtensionGalleryService, IExtensionManagementService, InstallExtensionSummary, InstallOptions } from '../../platform/extensionManagement/common/extensionManagement.js';\nimport { ExtensionManagementCLI } from '../../platform/extensionManagement/common/extensionManagementCLI.js';\nimport { IExtensionsScannerService, toExtensionDescription } from '../../platform/extensionManagement/common/extensionsScannerService.js';\nimport { ExtensionType, IExtensionDescription } from '../../platform/extensions/common/extensions.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { IUserDataProfilesService } from '../../platform/userDataProfile/common/userDataProfile.js';\nimport { IServerEnvironmentService } from './serverEnvironmentService.js';\nimport { dedupExtensions } from '../../workbench/services/extensions/common/extensionsUtil.js';\nimport { Schemas } from '../../base/common/network.js';\nimport { IRemoteExtensionsScannerService } from '../../platform/remote/common/remoteExtensionsScanner.js';\nimport { ILanguagePackService } from '../../platform/languagePacks/common/languagePacks.js';\nimport { areSameExtensions } from '../../platform/extensionManagement/common/extensionManagementUtil.js';\n\nexport class RemoteExtensionsScannerService implements IRemoteExtensionsScannerService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _whenBuiltinExtensionsReady = Promise.resolve<InstallExtensionSummary>({ failed: [] });\n\tprivate readonly _whenExtensionsReady = Promise.resolve<InstallExtensionSummary>({ failed: [] });\n\n\tconstructor(\n\t\tprivate readonly _extensionManagementCLI: ExtensionManagementCLI,\n\t\tenvironmentService: IServerEnvironmentService,\n\t\tprivate readonly _userDataProfilesService: IUserDataProfilesService,\n\t\tprivate readonly _extensionsScannerService: IExtensionsScannerService,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _extensionGalleryService: IExtensionGalleryService,\n\t\tprivate readonly _languagePackService: ILanguagePackService,\n\t\tprivate readonly _extensionManagementService: IExtensionManagementService,\n\t) {\n\t\tconst builtinExtensionsToInstall = environmentService.args['install-builtin-extension'];\n\t\tif (builtinExtensionsToInstall) {\n\t\t\t_logService.trace('Installing builtin extensions passed via args...');\n\t\t\tconst installOptions: InstallOptions = { isMachineScoped: !!environmentService.args['do-not-sync'], installPreReleaseVersion: !!environmentService.args['pre-release'] };\n\t\t\tperformance.mark('code/server/willInstallBuiltinExtensions');\n\t\t\tthis._whenExtensionsReady = this._whenBuiltinExtensionsReady = _extensionManagementCLI.installExtensions([], this._asExtensionIdOrVSIX(builtinExtensionsToInstall), installOptions, !!environmentService.args['force'])\n\t\t\t\t.then(() => {\n\t\t\t\t\tperformance.mark('code/server/didInstallBuiltinExtensions');\n\t\t\t\t\t_logService.trace('Finished installing builtin extensions');\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t}, error => {\n\t\t\t\t\t_logService.error(error);\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t});\n\t\t}\n\n\t\tconst extensionsToInstall = environmentService.args['install-extension'];\n\t\tif (extensionsToInstall) {\n\t\t\t_logService.trace('Installing extensions passed via args...');\n\t\t\tconst installOptions: InstallOptions = {\n\t\t\t\tisMachineScoped: !!environmentService.args['do-not-sync'],\n\t\t\t\tinstallPreReleaseVersion: !!environmentService.args['pre-release'],\n\t\t\t\tisApplicationScoped: true // extensions installed during server startup are available to all profiles\n\t\t\t};\n\t\t\tthis._whenExtensionsReady = this._whenBuiltinExtensionsReady\n\t\t\t\t.then(() => _extensionManagementCLI.installExtensions(this._asExtensionIdOrVSIX(extensionsToInstall), [], installOptions, !!environmentService.args['force']))\n\t\t\t\t.then(async () => {\n\t\t\t\t\t_logService.trace('Finished installing extensions');\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t}, async error => {\n\t\t\t\t\t_logService.error(error);\n\n\t\t\t\t\tconst failed: {\n\t\t\t\t\t\tid: string;\n\t\t\t\t\t\tinstallOptions: InstallOptions;\n\t\t\t\t\t}[] = [];\n\t\t\t\t\tconst alreadyInstalled = await this._extensionManagementService.getInstalled(ExtensionType.User);\n\n\t\t\t\t\tfor (const id of this._asExtensionIdOrVSIX(extensionsToInstall)) {\n\t\t\t\t\t\tif (typeof id === 'string') {\n\t\t\t\t\t\t\tif (!alreadyInstalled.some(e => areSameExtensions(e.identifier, { id }))) {\n\t\t\t\t\t\t\t\tfailed.push({ id, installOptions });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!failed.length) {\n\t\t\t\t\t\t_logService.trace(`No extensions to report as failed`);\n\t\t\t\t\t\treturn { failed: [] };\n\t\t\t\t\t}\n\n\t\t\t\t\t_logService.info(`Relaying the following extensions to install later: ${failed.map(f => f.id).join(', ')}`);\n\t\t\t\t\treturn { failed };\n\t\t\t\t});\n\t\t}\n\t}\n\n\tprivate _asExtensionIdOrVSIX(inputs: string[]): (string | URI)[] {\n\t\treturn inputs.map(input => /\\.vsix$/i.test(input) ? URI.file(isAbsolute(input) ? input : join(cwd(), input)) : input);\n\t}\n\n\twhenExtensionsReady(): Promise<InstallExtensionSummary> {\n\t\treturn this._whenExtensionsReady;\n\t}\n\n\tasync scanExtensions(\n\t\tlanguage?: string,\n\t\tprofileLocation?: URI,\n\t\tworkspaceExtensionLocations?: URI[],\n\t\textensionDevelopmentLocations?: URI[],\n\t\tlanguagePackId?: string\n\t): Promise<IExtensionDescription[]> {\n\t\tperformance.mark('code/server/willScanExtensions');\n\t\tthis._logService.trace(`Scanning extensions using UI language: ${language}`);\n\n\t\tawait this._whenBuiltinExtensionsReady;\n\n\t\tconst extensionDevelopmentPaths = extensionDevelopmentLocations ? extensionDevelopmentLocations.filter(url => url.scheme === Schemas.file).map(url => url.fsPath) : undefined;\n\t\tprofileLocation = profileLocation ?? this._userDataProfilesService.defaultProfile.extensionsResource;\n\n\t\tconst extensions = await this._scanExtensions(profileLocation, language ?? platform.language, workspaceExtensionLocations, extensionDevelopmentPaths, languagePackId);\n\n\t\tthis._logService.trace('Scanned Extensions', extensions);\n\t\tthis._massageWhenConditions(extensions);\n\n\t\tperformance.mark('code/server/didScanExtensions');\n\t\treturn extensions;\n\t}\n\n\tprivate async _scanExtensions(profileLocation: URI, language: string, workspaceInstalledExtensionLocations: URI[] | undefined, extensionDevelopmentPath: string[] | undefined, languagePackId: string | undefined): Promise<IExtensionDescription[]> {\n\t\tawait this._ensureLanguagePackIsInstalled(language, languagePackId);\n\n\t\tconst [builtinExtensions, installedExtensions, workspaceInstalledExtensions, developedExtensions] = await Promise.all([\n\t\t\tthis._scanBuiltinExtensions(language),\n\t\t\tthis._scanInstalledExtensions(profileLocation, language),\n\t\t\tthis._scanWorkspaceInstalledExtensions(language, workspaceInstalledExtensionLocations),\n\t\t\tthis._scanDevelopedExtensions(language, extensionDevelopmentPath)\n\t\t]);\n\n\t\treturn dedupExtensions(builtinExtensions, installedExtensions, workspaceInstalledExtensions, developedExtensions, this._logService);\n\t}\n\n\tprivate async _scanDevelopedExtensions(language: string, extensionDevelopmentPaths?: string[]): Promise<IExtensionDescription[]> {\n\t\tif (extensionDevelopmentPaths) {\n\t\t\treturn (await Promise.all(extensionDevelopmentPaths.map(extensionDevelopmentPath => this._extensionsScannerService.scanOneOrMultipleExtensions(URI.file(resolve(extensionDevelopmentPath)), ExtensionType.User, { language }))))\n\t\t\t\t.flat()\n\t\t\t\t.map(e => toExtensionDescription(e, true));\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate async _scanWorkspaceInstalledExtensions(language: string, workspaceInstalledExtensions?: URI[]): Promise<IExtensionDescription[]> {\n\t\tconst result: IExtensionDescription[] = [];\n\t\tif (workspaceInstalledExtensions?.length) {\n\t\t\tconst scannedExtensions = await Promise.all(workspaceInstalledExtensions.map(location => this._extensionsScannerService.scanExistingExtension(location, ExtensionType.User, { language })));\n\t\t\tfor (const scannedExtension of scannedExtensions) {\n\t\t\t\tif (scannedExtension) {\n\t\t\t\t\tresult.push(toExtensionDescription(scannedExtension, false));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _scanBuiltinExtensions(language: string): Promise<IExtensionDescription[]> {\n\t\tconst scannedExtensions = await this._extensionsScannerService.scanSystemExtensions({ language });\n\t\treturn scannedExtensions.map(e => toExtensionDescription(e, false));\n\t}\n\n\tprivate async _scanInstalledExtensions(profileLocation: URI, language: string): Promise<IExtensionDescription[]> {\n\t\tconst scannedExtensions = await this._extensionsScannerService.scanUserExtensions({ profileLocation, language, useCache: true });\n\t\treturn scannedExtensions.map(e => toExtensionDescription(e, false));\n\t}\n\n\tprivate async _ensureLanguagePackIsInstalled(language: string, languagePackId: string | undefined): Promise<void> {\n\t\tif (\n\t\t\t// No need to install language packs for the default language\n\t\t\tlanguage === platform.LANGUAGE_DEFAULT ||\n\t\t\t// The extension gallery service needs to be available\n\t\t\t!this._extensionGalleryService.isEnabled()\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst installed = await this._languagePackService.getInstalledLanguages();\n\t\t\tif (installed.find(p => p.id === language)) {\n\t\t\t\tthis._logService.trace(`Language Pack ${language} is already installed. Skipping language pack installation.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t// We tried to see what is installed but failed. We can try installing anyway.\n\t\t\tthis._logService.error(err);\n\t\t}\n\n\t\tif (!languagePackId) {\n\t\t\tthis._logService.trace(`No language pack id provided for language ${language}. Skipping language pack installation.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._logService.trace(`Language Pack ${languagePackId} for language ${language} is not installed. It will be installed now.`);\n\t\ttry {\n\t\t\tawait this._extensionManagementCLI.installExtensions([languagePackId], [], { isMachineScoped: true }, true);\n\t\t} catch (err) {\n\t\t\t// We tried to install the language pack but failed. We can continue without it thus using the default language.\n\t\t\tthis._logService.error(err);\n\t\t}\n\t}\n\n\tprivate _massageWhenConditions(extensions: IExtensionDescription[]): void {\n\t\t// Massage \"when\" conditions which mention `resourceScheme`\n\n\t\tinterface WhenUser { when?: string }\n\n\t\tinterface LocWhenUser { [loc: string]: WhenUser[] }\n\n\t\tconst _mapResourceSchemeValue = (value: string, isRegex: boolean): string => {\n\t\t\t// console.log(`_mapResourceSchemeValue: ${value}, ${isRegex}`);\n\t\t\treturn value.replace(/file/g, 'vscode-remote');\n\t\t};\n\n\t\tconst _mapResourceRegExpValue = (value: RegExp): RegExp => {\n\t\t\tlet flags = '';\n\t\t\tflags += value.global ? 'g' : '';\n\t\t\tflags += value.ignoreCase ? 'i' : '';\n\t\t\tflags += value.multiline ? 'm' : '';\n\t\t\treturn new RegExp(_mapResourceSchemeValue(value.source, true), flags);\n\t\t};\n\n\t\tconst _exprKeyMapper = new class implements IContextKeyExprMapper {\n\t\t\tmapDefined(key: string): ContextKeyExpression {\n\t\t\t\treturn ContextKeyDefinedExpr.create(key);\n\t\t\t}\n\t\t\tmapNot(key: string): ContextKeyExpression {\n\t\t\t\treturn ContextKeyNotExpr.create(key);\n\t\t\t}\n\t\t\tmapEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\tif (key === 'resourceScheme' && typeof value === 'string') {\n\t\t\t\t\treturn ContextKeyEqualsExpr.create(key, _mapResourceSchemeValue(value, false));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyEqualsExpr.create(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapNotEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\tif (key === 'resourceScheme' && typeof value === 'string') {\n\t\t\t\t\treturn ContextKeyNotEqualsExpr.create(key, _mapResourceSchemeValue(value, false));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyNotEqualsExpr.create(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapGreater(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeyGreaterExpr.create(key, value);\n\t\t\t}\n\t\t\tmapGreaterEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeyGreaterEqualsExpr.create(key, value);\n\t\t\t}\n\t\t\tmapSmaller(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeySmallerExpr.create(key, value);\n\t\t\t}\n\t\t\tmapSmallerEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeySmallerEqualsExpr.create(key, value);\n\t\t\t}\n\t\t\tmapRegex(key: string, regexp: RegExp | null): ContextKeyRegexExpr {\n\t\t\t\tif (key === 'resourceScheme' && regexp) {\n\t\t\t\t\treturn ContextKeyRegexExpr.create(key, _mapResourceRegExpValue(regexp));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyRegexExpr.create(key, regexp);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapIn(key: string, valueKey: string): ContextKeyInExpr {\n\t\t\t\treturn ContextKeyInExpr.create(key, valueKey);\n\t\t\t}\n\t\t\tmapNotIn(key: string, valueKey: string): ContextKeyNotInExpr {\n\t\t\t\treturn ContextKeyNotInExpr.create(key, valueKey);\n\t\t\t}\n\t\t};\n\n\t\tconst _massageWhenUser = (element: WhenUser) => {\n\t\t\tif (!element || !element.when || !/resourceScheme/.test(element.when)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst expr = ContextKeyExpr.deserialize(element.when);\n\t\t\tif (!expr) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst massaged = expr.map(_exprKeyMapper);\n\t\t\telement.when = massaged.serialize();\n\t\t};\n\n\t\tconst _massageWhenUserArr = (elements: WhenUser[] | WhenUser) => {\n\t\t\tif (Array.isArray(elements)) {\n\t\t\t\tfor (const element of elements) {\n\t\t\t\t\t_massageWhenUser(element);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t_massageWhenUser(elements);\n\t\t\t}\n\t\t};\n\n\t\tconst _massageLocWhenUser = (target: LocWhenUser) => {\n\t\t\tfor (const loc in target) {\n\t\t\t\t_massageWhenUserArr(target[loc]);\n\t\t\t}\n\t\t};\n\n\t\textensions.forEach((extension) => {\n\t\t\tif (extension.contributes) {\n\t\t\t\tif (extension.contributes.menus) {\n\t\t\t\t\t_massageLocWhenUser(<LocWhenUser>extension.contributes.menus);\n\t\t\t\t}\n\t\t\t\tif (extension.contributes.keybindings) {\n\t\t\t\t\t_massageWhenUserArr(<WhenUser | WhenUser[]>extension.contributes.keybindings);\n\t\t\t\t}\n\t\t\t\tif (extension.contributes.views) {\n\t\t\t\t\t_massageLocWhenUser(<LocWhenUser>extension.contributes.views);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport class RemoteExtensionsScannerChannel implements IServerChannel {\n\n\tconstructor(private service: RemoteExtensionsScannerService, private getUriTransformer: (requestContext: any) => IURITransformer) { }\n\n\tlisten(context: any, event: string): Event<any> {\n\t\tthrow new Error('Invalid listen');\n\t}\n\n\tasync call(context: any, command: string, args?: any): Promise<any> {\n\t\tconst uriTransformer = this.getUriTransformer(context);\n\t\tswitch (command) {\n\t\t\tcase 'whenExtensionsReady': return await this.service.whenExtensionsReady();\n\n\t\t\tcase 'scanExtensions': {\n\t\t\t\tconst language = args[0];\n\t\t\t\tconst profileLocation = args[1] ? URI.revive(uriTransformer.transformIncoming(args[1])) : undefined;\n\t\t\t\tconst workspaceExtensionLocations = Array.isArray(args[2]) ? args[2].map(u => URI.revive(uriTransformer.transformIncoming(u))) : undefined;\n\t\t\t\tconst extensionDevelopmentPath = Array.isArray(args[3]) ? args[3].map(u => URI.revive(uriTransformer.transformIncoming(u))) : undefined;\n\t\t\t\tconst languagePackId: string | undefined = args[4];\n\t\t\t\tconst extensions = await this.service.scanExtensions(\n\t\t\t\t\tlanguage,\n\t\t\t\t\tprofileLocation,\n\t\t\t\t\tworkspaceExtensionLocations,\n\t\t\t\t\textensionDevelopmentPath,\n\t\t\t\t\tlanguagePackId\n\t\t\t\t);\n\t\t\t\treturn extensions.map(extension => transformOutgoingURIs(extension, uriTransformer));\n\t\t\t}\n\t\t}\n\t\tthrow new Error('Invalid call');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isAbsolute, join, resolve } from '../../base/common/path.js';\nimport * as platform from '../../base/common/platform.js';\nimport { cwd } from '../../base/common/process.js';\nimport { URI } from '../../base/common/uri.js';\nimport * as performance from '../../base/common/performance.js';\nimport { Event } from '../../base/common/event.js';\nimport { IURITransformer, transformOutgoingURIs } from '../../base/common/uriIpc.js';\nimport { IServerChannel } from '../../base/parts/ipc/common/ipc.js';\nimport { ContextKeyDefinedExpr, ContextKeyEqualsExpr, ContextKeyExpr, ContextKeyExpression, ContextKeyGreaterEqualsExpr, ContextKeyGreaterExpr, ContextKeyInExpr, ContextKeyNotEqualsExpr, ContextKeyNotExpr, ContextKeyNotInExpr, ContextKeyRegexExpr, ContextKeySmallerEqualsExpr, ContextKeySmallerExpr, ContextKeyValue, IContextKeyExprMapper } from '../../platform/contextkey/common/contextkey.js';\nimport { IExtensionGalleryService, IExtensionManagementService, InstallExtensionSummary, InstallOptions } from '../../platform/extensionManagement/common/extensionManagement.js';\nimport { ExtensionManagementCLI } from '../../platform/extensionManagement/common/extensionManagementCLI.js';\nimport { IExtensionsScannerService, toExtensionDescription } from '../../platform/extensionManagement/common/extensionsScannerService.js';\nimport { ExtensionType, IExtensionDescription } from '../../platform/extensions/common/extensions.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { IUserDataProfilesService } from '../../platform/userDataProfile/common/userDataProfile.js';\nimport { IServerEnvironmentService } from './serverEnvironmentService.js';\nimport { dedupExtensions } from '../../workbench/services/extensions/common/extensionsUtil.js';\nimport { Schemas } from '../../base/common/network.js';\nimport { IRemoteExtensionsScannerService } from '../../platform/remote/common/remoteExtensionsScanner.js';\nimport { ILanguagePackService } from '../../platform/languagePacks/common/languagePacks.js';\nimport { areSameExtensions } from '../../platform/extensionManagement/common/extensionManagementUtil.js';\n\nexport class RemoteExtensionsScannerService implements IRemoteExtensionsScannerService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _whenBuiltinExtensionsReady = Promise.resolve<InstallExtensionSummary>({ failed: [] });\n\tprivate readonly _whenExtensionsReady = Promise.resolve<InstallExtensionSummary>({ failed: [] });\n\n\tconstructor(\n\t\tprivate readonly _extensionManagementCLI: ExtensionManagementCLI,\n\t\tenvironmentService: IServerEnvironmentService,\n\t\tprivate readonly _userDataProfilesService: IUserDataProfilesService,\n\t\tprivate readonly _extensionsScannerService: IExtensionsScannerService,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _extensionGalleryService: IExtensionGalleryService,\n\t\tprivate readonly _languagePackService: ILanguagePackService,\n\t\tprivate readonly _extensionManagementService: IExtensionManagementService,\n\t) {\n\t\tconst builtinExtensionsToInstall = environmentService.args['install-builtin-extension'];\n\t\tif (builtinExtensionsToInstall) {\n\t\t\t_logService.trace('Installing builtin extensions passed via args...');\n\t\t\tconst installOptions: InstallOptions = { isMachineScoped: !!environmentService.args['do-not-sync'], installPreReleaseVersion: !!environmentService.args['pre-release'] };\n\t\t\tperformance.mark('code/server/willInstallBuiltinExtensions');\n\t\t\tthis._whenExtensionsReady = this._whenBuiltinExtensionsReady = _extensionManagementCLI.installExtensions([], this._asExtensionIdOrVSIX(builtinExtensionsToInstall), installOptions, !!environmentService.args['force'])\n\t\t\t\t.then(() => {\n\t\t\t\t\tperformance.mark('code/server/didInstallBuiltinExtensions');\n\t\t\t\t\t_logService.trace('Finished installing builtin extensions');\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t}, error => {\n\t\t\t\t\t_logService.error(error);\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t});\n\t\t}\n\n\t\tconst extensionsToInstall = environmentService.args['install-extension'];\n\t\tif (extensionsToInstall) {\n\t\t\t_logService.trace('Installing extensions passed via args...');\n\t\t\tconst installOptions: InstallOptions = {\n\t\t\t\tisMachineScoped: !!environmentService.args['do-not-sync'],\n\t\t\t\tinstallPreReleaseVersion: !!environmentService.args['pre-release'],\n\t\t\t\tisApplicationScoped: true // extensions installed during server startup are available to all profiles\n\t\t\t};\n\t\t\tthis._whenExtensionsReady = this._whenBuiltinExtensionsReady\n\t\t\t\t.then(() => _extensionManagementCLI.installExtensions(this._asExtensionIdOrVSIX(extensionsToInstall), [], installOptions, !!environmentService.args['force']))\n\t\t\t\t.then(async () => {\n\t\t\t\t\t_logService.trace('Finished installing extensions');\n\t\t\t\t\treturn { failed: [] };\n\t\t\t\t}, async error => {\n\t\t\t\t\t_logService.error(error);\n\n\t\t\t\t\tconst failed: {\n\t\t\t\t\t\tid: string;\n\t\t\t\t\t\tinstallOptions: InstallOptions;\n\t\t\t\t\t}[] = [];\n\t\t\t\t\tconst alreadyInstalled = await this._extensionManagementService.getInstalled(ExtensionType.User);\n\n\t\t\t\t\tfor (const id of this._asExtensionIdOrVSIX(extensionsToInstall)) {\n\t\t\t\t\t\tif (typeof id === 'string') {\n\t\t\t\t\t\t\tif (!alreadyInstalled.some(e => areSameExtensions(e.identifier, { id }))) {\n\t\t\t\t\t\t\t\tfailed.push({ id, installOptions });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!failed.length) {\n\t\t\t\t\t\t_logService.trace(`No extensions to report as failed`);\n\t\t\t\t\t\treturn { failed: [] };\n\t\t\t\t\t}\n\n\t\t\t\t\t_logService.info(`Relaying the following extensions to install later: ${failed.map(f => f.id).join(', ')}`);\n\t\t\t\t\treturn { failed };\n\t\t\t\t});\n\t\t}\n\t}\n\n\tprivate _asExtensionIdOrVSIX(inputs: string[]): (string | URI)[] {\n\t\treturn inputs.map(input => /\\.vsix$/i.test(input) ? URI.file(isAbsolute(input) ? input : join(cwd(), input)) : input);\n\t}\n\n\twhenExtensionsReady(): Promise<InstallExtensionSummary> {\n\t\treturn this._whenExtensionsReady;\n\t}\n\n\tasync scanExtensions(\n\t\tlanguage?: string,\n\t\tprofileLocation?: URI,\n\t\tworkspaceExtensionLocations?: URI[],\n\t\textensionDevelopmentLocations?: URI[],\n\t\tlanguagePackId?: string\n\t): Promise<IExtensionDescription[]> {\n\t\tperformance.mark('code/server/willScanExtensions');\n\t\tthis._logService.trace(`Scanning extensions using UI language: ${language}`);\n\n\t\tawait this._whenBuiltinExtensionsReady;\n\n\t\tconst extensionDevelopmentPaths = extensionDevelopmentLocations ? extensionDevelopmentLocations.filter(url => url.scheme === Schemas.file).map(url => url.fsPath) : undefined;\n\t\tprofileLocation = profileLocation ?? this._userDataProfilesService.defaultProfile.extensionsResource;\n\n\t\tconst extensions = await this._scanExtensions(profileLocation, language ?? platform.language, workspaceExtensionLocations, extensionDevelopmentPaths, languagePackId);\n\n\t\tthis._logService.trace('Scanned Extensions', extensions);\n\t\tthis._massageWhenConditions(extensions);\n\n\t\tperformance.mark('code/server/didScanExtensions');\n\t\treturn extensions;\n\t}\n\n\tprivate async _scanExtensions(profileLocation: URI, language: string, workspaceInstalledExtensionLocations: URI[] | undefined, extensionDevelopmentPath: string[] | undefined, languagePackId: string | undefined): Promise<IExtensionDescription[]> {\n\t\tawait this._ensureLanguagePackIsInstalled(language, languagePackId);\n\n\t\tconst [builtinExtensions, installedExtensions, workspaceInstalledExtensions, developedExtensions] = await Promise.all([\n\t\t\tthis._scanBuiltinExtensions(language),\n\t\t\tthis._scanInstalledExtensions(profileLocation, language),\n\t\t\tthis._scanWorkspaceInstalledExtensions(language, workspaceInstalledExtensionLocations),\n\t\t\tthis._scanDevelopedExtensions(language, extensionDevelopmentPath)\n\t\t]);\n\n\t\treturn dedupExtensions(builtinExtensions, installedExtensions, workspaceInstalledExtensions, developedExtensions, this._logService);\n\t}\n\n\tprivate async _scanDevelopedExtensions(language: string, extensionDevelopmentPaths?: string[]): Promise<IExtensionDescription[]> {\n\t\tif (extensionDevelopmentPaths) {\n\t\t\treturn (await Promise.all(extensionDevelopmentPaths.map(extensionDevelopmentPath => this._extensionsScannerService.scanOneOrMultipleExtensions(URI.file(resolve(extensionDevelopmentPath)), ExtensionType.User, { language }))))\n\t\t\t\t.flat()\n\t\t\t\t.map(e => toExtensionDescription(e, true));\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate async _scanWorkspaceInstalledExtensions(language: string, workspaceInstalledExtensions?: URI[]): Promise<IExtensionDescription[]> {\n\t\tconst result: IExtensionDescription[] = [];\n\t\tif (workspaceInstalledExtensions?.length) {\n\t\t\tconst scannedExtensions = await Promise.all(workspaceInstalledExtensions.map(location => this._extensionsScannerService.scanExistingExtension(location, ExtensionType.User, { language })));\n\t\t\tfor (const scannedExtension of scannedExtensions) {\n\t\t\t\tif (scannedExtension) {\n\t\t\t\t\tresult.push(toExtensionDescription(scannedExtension, false));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _scanBuiltinExtensions(language: string): Promise<IExtensionDescription[]> {\n\t\tconst scannedExtensions = await this._extensionsScannerService.scanSystemExtensions({ language });\n\t\treturn scannedExtensions.map(e => toExtensionDescription(e, false));\n\t}\n\n\tprivate async _scanInstalledExtensions(profileLocation: URI, language: string): Promise<IExtensionDescription[]> {\n\t\tconst scannedExtensions = await this._extensionsScannerService.scanUserExtensions({ profileLocation, language, useCache: true });\n\t\treturn scannedExtensions.map(e => toExtensionDescription(e, false));\n\t}\n\n\tprivate async _ensureLanguagePackIsInstalled(language: string, languagePackId: string | undefined): Promise<void> {\n\t\tif (\n\t\t\t// No need to install language packs for the default language\n\t\t\tlanguage === platform.LANGUAGE_DEFAULT ||\n\t\t\t// The extension gallery service needs to be available\n\t\t\t!this._extensionGalleryService.isEnabled()\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst installed = await this._languagePackService.getInstalledLanguages();\n\t\t\tif (installed.find(p => p.id === language)) {\n\t\t\t\tthis._logService.trace(`Language Pack ${language} is already installed. Skipping language pack installation.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t// We tried to see what is installed but failed. We can try installing anyway.\n\t\t\tthis._logService.error(err);\n\t\t}\n\n\t\tif (!languagePackId) {\n\t\t\tthis._logService.trace(`No language pack id provided for language ${language}. Skipping language pack installation.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._logService.trace(`Language Pack ${languagePackId} for language ${language} is not installed. It will be installed now.`);\n\t\ttry {\n\t\t\tawait this._extensionManagementCLI.installExtensions([languagePackId], [], { isMachineScoped: true }, true);\n\t\t} catch (err) {\n\t\t\t// We tried to install the language pack but failed. We can continue without it thus using the default language.\n\t\t\tthis._logService.error(err);\n\t\t}\n\t}\n\n\tprivate _massageWhenConditions(extensions: IExtensionDescription[]): void {\n\t\t// Massage \"when\" conditions which mention `resourceScheme`\n\n\t\tinterface WhenUser { when?: string }\n\n\t\tinterface LocWhenUser { [loc: string]: WhenUser[] }\n\n\t\tconst _mapResourceSchemeValue = (value: string, isRegex: boolean): string => {\n\t\t\t// console.log(`_mapResourceSchemeValue: ${value}, ${isRegex}`);\n\t\t\treturn value.replace(/file/g, 'vscode-remote');\n\t\t};\n\n\t\tconst _mapResourceRegExpValue = (value: RegExp): RegExp => {\n\t\t\tlet flags = '';\n\t\t\tflags += value.global ? 'g' : '';\n\t\t\tflags += value.ignoreCase ? 'i' : '';\n\t\t\tflags += value.multiline ? 'm' : '';\n\t\t\treturn new RegExp(_mapResourceSchemeValue(value.source, true), flags);\n\t\t};\n\n\t\tconst _exprKeyMapper = new class implements IContextKeyExprMapper {\n\t\t\tmapDefined(key: string): ContextKeyExpression {\n\t\t\t\treturn ContextKeyDefinedExpr.create(key);\n\t\t\t}\n\t\t\tmapNot(key: string): ContextKeyExpression {\n\t\t\t\treturn ContextKeyNotExpr.create(key);\n\t\t\t}\n\t\t\tmapEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\tif (key === 'resourceScheme' && typeof value === 'string') {\n\t\t\t\t\treturn ContextKeyEqualsExpr.create(key, _mapResourceSchemeValue(value, false));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyEqualsExpr.create(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapNotEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\tif (key === 'resourceScheme' && typeof value === 'string') {\n\t\t\t\t\treturn ContextKeyNotEqualsExpr.create(key, _mapResourceSchemeValue(value, false));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyNotEqualsExpr.create(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapGreater(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeyGreaterExpr.create(key, value);\n\t\t\t}\n\t\t\tmapGreaterEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeyGreaterEqualsExpr.create(key, value);\n\t\t\t}\n\t\t\tmapSmaller(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeySmallerExpr.create(key, value);\n\t\t\t}\n\t\t\tmapSmallerEquals(key: string, value: ContextKeyValue): ContextKeyExpression {\n\t\t\t\treturn ContextKeySmallerEqualsExpr.create(key, value);\n\t\t\t}\n\t\t\tmapRegex(key: string, regexp: RegExp | null): ContextKeyRegexExpr {\n\t\t\t\tif (key === 'resourceScheme' && regexp) {\n\t\t\t\t\treturn ContextKeyRegexExpr.create(key, _mapResourceRegExpValue(regexp));\n\t\t\t\t} else {\n\t\t\t\t\treturn ContextKeyRegexExpr.create(key, regexp);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmapIn(key: string, valueKey: string): ContextKeyInExpr {\n\t\t\t\treturn ContextKeyInExpr.create(key, valueKey);\n\t\t\t}\n\t\t\tmapNotIn(key: string, valueKey: string): ContextKeyNotInExpr {\n\t\t\t\treturn ContextKeyNotInExpr.create(key, valueKey);\n\t\t\t}\n\t\t};\n\n\t\tconst _massageWhenUser = (element: WhenUser) => {\n\t\t\tif (!element || !element.when || !/resourceScheme/.test(element.when)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst expr = ContextKeyExpr.deserialize(element.when);\n\t\t\tif (!expr) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst massaged = expr.map(_exprKeyMapper);\n\t\t\telement.when = massaged.serialize();\n\t\t};\n\n\t\tconst _massageWhenUserArr = (elements: WhenUser[] | WhenUser) => {\n\t\t\tif (Array.isArray(elements)) {\n\t\t\t\tfor (const element of elements) {\n\t\t\t\t\t_massageWhenUser(element);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t_massageWhenUser(elements);\n\t\t\t}\n\t\t};\n\n\t\tconst _massageLocWhenUser = (target: LocWhenUser) => {\n\t\t\tfor (const loc in target) {\n\t\t\t\t_massageWhenUserArr(target[loc]);\n\t\t\t}\n\t\t};\n\n\t\textensions.forEach((extension) => {\n\t\t\tif (extension.contributes) {\n\t\t\t\tif (extension.contributes.menus) {\n\t\t\t\t\t_massageLocWhenUser(<LocWhenUser>extension.contributes.menus);\n\t\t\t\t}\n\t\t\t\tif (extension.contributes.keybindings) {\n\t\t\t\t\t_massageWhenUserArr(<WhenUser | WhenUser[]>extension.contributes.keybindings);\n\t\t\t\t}\n\t\t\t\tif (extension.contributes.views) {\n\t\t\t\t\t_massageLocWhenUser(<LocWhenUser>extension.contributes.views);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport class RemoteExtensionsScannerChannel implements IServerChannel {\n\n\tconstructor(private service: RemoteExtensionsScannerService, private getUriTransformer: (requestContext: any) => IURITransformer) { }\n\n\tlisten(context: any, event: string): Event<any> {\n\t\tthrow new Error('Invalid listen');\n\t}\n\n\tasync call(context: any, command: string, args?: any): Promise<any> {\n\t\tconst uriTransformer = this.getUriTransformer(context);\n\t\tswitch (command) {\n\t\t\tcase 'whenExtensionsReady': return await this.service.whenExtensionsReady();\n\n\t\t\tcase 'scanExtensions': {\n\t\t\t\tconst language = args[0];\n\t\t\t\tconst profileLocation = args[1] ? URI.revive(uriTransformer.transformIncoming(args[1])) : undefined;\n\t\t\t\tconst workspaceExtensionLocations = Array.isArray(args[2]) ? args[2].map(u => URI.revive(uriTransformer.transformIncoming(u))) : undefined;\n\t\t\t\tconst extensionDevelopmentPath = Array.isArray(args[3]) ? args[3].map(u => URI.revive(uriTransformer.transformIncoming(u))) : undefined;\n\t\t\t\tconst languagePackId: string | undefined = args[4];\n\t\t\t\tconst extensions = await this.service.scanExtensions(\n\t\t\t\t\tlanguage,\n\t\t\t\t\tprofileLocation,\n\t\t\t\t\tworkspaceExtensionLocations,\n\t\t\t\t\textensionDevelopmentPath,\n\t\t\t\t\tlanguagePackId\n\t\t\t\t);\n\t\t\t\treturn extensions.map(extension => transformOutgoingURIs(extension, uriTransformer));\n\t\t\t}\n\t\t}\n\t\tthrow new Error('Invalid call');\n\t}\n}\n"]}