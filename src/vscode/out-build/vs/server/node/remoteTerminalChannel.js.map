{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/server/node/remoteTerminalChannel.ts","vs/server/node/remoteTerminalChannel.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,4BAA4B,CAAC;AAC5D,OAAO,EAAE,cAAc,EAAE,MAAM,8BAA8B,CAAC;AAC9D,OAAO,EAAE,UAAU,EAAE,MAAM,gCAAgC,CAAC;AAC5D,OAAO,KAAK,IAAI,MAAM,2BAA2B,CAAC;AAClD,OAAO,KAAK,QAAQ,MAAM,+BAA+B,CAAC;AAC1D,OAAO,EAAE,GAAG,EAAE,MAAM,0BAA0B,CAAC;AAG/C,OAAO,EAAE,qBAAqB,EAAE,MAAM,sCAAsC,CAAC;AAK7E,OAAO,EAAE,oBAAoB,EAAE,MAAM,qCAAqC,CAAC;AAC3E,OAAO,EAAE,aAAa,EAAqB,MAAM,8CAA8C,CAAC;AAEhG,OAAO,EAAE,mCAAmC,EAAE,MAAM,iEAAiE,CAAC;AACtH,OAAO,EAAE,oCAAoC,EAAE,wCAAwC,EAAE,MAAM,6DAA6D,CAAC;AAE7J,OAAO,KAAK,mBAAmB,MAAM,gEAAgE,CAAC;AACtG,OAAO,EAAE,+BAA+B,EAAE,MAAM,2EAA2E,CAAC;AAC5H,OAAO,EAAE,oBAAoB,EAAE,MAAM,8BAA8B,CAAC;AAMpE,OAAO,EAAE,oBAAoB,EAAE,MAAM,4BAA4B,CAAC;AAClE,OAAO,EAAE,sCAAsC,EAAE,MAAM,uDAAuD,CAAC;AAE/G,MAAM,sBAAuB,SAAQ,+BAA+B;IACnE,YACC,GAAiC,EACjC,gBAAoC,EACpC,kBAAmC,EACnC,iBAA6C,EAC7C,gBAA6C;QAE7C,KAAK,CAAC;YACL,YAAY,EAAE,CAAC,UAAkB,EAAmB,EAAE;gBACrD,MAAM,KAAK,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC;gBAClE,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;oBAC/B,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBACrB,CAAC;gBACD,OAAO,SAAS,CAAC;YAClB,CAAC;YACD,uBAAuB,EAAE,GAAW,EAAE;gBACrC,OAAO,gBAAgB,CAAC,MAAM,CAAC;YAChC,CAAC;YACD,qBAAqB,EAAE,CAAC,SAAc,EAAE,OAAe,EAAsB,EAAE;gBAC9E,OAAO,iBAAiB,CAAC,UAAU,OAAO,EAAE,CAAC,CAAC;YAC/C,CAAC;YACD,WAAW,EAAE,GAAuB,EAAE;gBACrC,OAAO,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAChC,CAAC;YACD,UAAU,EAAE,GAAuB,EAAE;gBACpC,OAAO,GAAG,CAAC,YAAY,CAAC,CAAC;YAC1B,CAAC;YACD,WAAW,EAAE,GAAuB,EAAE;gBACrC,IAAI,kBAAkB,EAAE,CAAC;oBACxB,OAAO,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;gBAClD,CAAC;gBACD,OAAO,SAAS,CAAC;YAClB,CAAC;YACD,eAAe,EAAE,GAAuB,EAAE;gBACzC,OAAO,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAC1C,CAAC;YACD,aAAa,EAAE,GAAuB,EAAE;gBACvC,OAAO,iBAAiB,CAAC,YAAY,CAAC,CAAC;YACxC,CAAC;YACD,eAAe,EAAE,GAAuB,EAAE;gBACzC,OAAO,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAC1C,CAAC;YACD,YAAY,EAAE,KAAK,EAAC,EAAE,EAAC,EAAE;gBACxB,MAAM,SAAS,GAAG,MAAM,gBAAgB,CAAC,YAAY,EAAE,CAAC;gBACxD,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;gBAC1D,OAAO,KAAK,IAAI,EAAE,iBAAiB,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC;YACvD,CAAC;SACD,EAAE,SAAS,EAAE,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;IACpE,CAAC;CACD;AAED,MAAM,OAAO,qBAAsB,SAAQ,UAAU;IAYpD,YACkB,mBAA8C,EAC9C,WAAwB,EACxB,eAAgC,EAChC,eAAgC,EAChC,2BAAwD,EACxD,qBAA4C;QAE7D,KAAK,EAAE,CAAC;QAPS,wBAAmB,GAAnB,mBAAmB,CAA2B;QAC9C,gBAAW,GAAX,WAAW,CAAa;QACxB,oBAAe,GAAf,eAAe,CAAiB;QAChC,oBAAe,GAAf,eAAe,CAAiB;QAChC,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,0BAAqB,GAArB,qBAAqB,CAAuB;QAhBtD,eAAU,GAAG,CAAC,CAAC;QACN,qBAAgB,GAAG,IAAI,GAAG,EAIvC,CAAC;QAEY,sBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA6F,CAAC,CAAC;QACrJ,qBAAgB,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;IAWzD,CAAC;IAED,8DAA8D;IAC9D,KAAK,CAAC,IAAI,CAAC,GAAiC,EAAE,OAAqC,EAAE,IAAU;QAC9F,QAAQ,OAAO,EAAE,CAAC;YACjB,wEAAgD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAE/H,sEAA+C,CAAC,CAAC,CAAC;gBACjD,MAAM,cAAc,GAAG,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;gBACjE,OAAO,IAAI,CAAC,cAAc,CAAC,cAAc,EAAmC,IAAI,CAAC,CAAC;YACnF,CAAC;YACD,0EAAiD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACjI,8EAAmD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAErI,sEAA+C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC7H,gEAA4C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACvH,kFAAqD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACzI,kFAAqD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACzI,wGAAgE,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,8BAA8B,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAE/J,sDAAuC,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC7G,sDAAuC,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC7G,gEAA4C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACvH,oFAAsD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC3I,4DAA0C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACnH,wDAAwC,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC/G,kEAA6C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACzH,sEAA+C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC7H,wDAAwC,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAE/G,sEAA+C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAE7H,8EAAmD,CAAC,CAAC,OAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/G,4EAAkD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACnI,0FAAyD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACjJ,sFAAuD,CAAC,CAAC,OAAO,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC9G,kEAA6C,CAAC,CAAC,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC1F,wEAAgD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,EAAE,CAAC;YAChF,gEAA4C,CAAC,CAAC,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YACxF,sFAAuD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAA6B,IAAI,CAAC,CAAC;YAC7I,sFAAuD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAA6B,IAAI,CAAC,CAAC;YAC7I,wFAAwD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,sBAAsB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC/I,0FAAyD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACjJ,gFAAoD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACvI,8EAAmD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACrI,4EAAkD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACnI,8FAA2D,CAAC,CAAC,OAAO,IAAI,CAAC,0BAA0B,EAAE,CAAC;YACtG,gEAA4C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACvH,kEAA6C,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACzH,wEAAgD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAC/H,0EAAiD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACjI,sFAAuD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7H,wFAAwD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAClI,kFAAqD,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACzI,8FAA2D,CAAC,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,yBAAyB,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QACtJ,CAAC;QAED,yFAAyF;QACzF,MAAM,IAAI,KAAK,CAAC,eAAe,OAAO,YAAY,CAAC,CAAC;IACrD,CAAC;IAED,MAAM,CAAI,CAAU,EAAE,KAAiC,EAAE,IAAa;QACrE,QAAQ,KAAK,EAAE,CAAC;YACf,8EAAkD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,aAAa,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YAC1H,gFAAmD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,cAAc,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YAC5H,8FAA0D,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,qBAAqB,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YAC1I,0FAAwD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,mBAAmB,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YACtI,oHAAqE,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,gCAAgC,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YAChK,8EAAkD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,aAAa,CAAa,CAAC;YAC5G,gFAAmD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,cAAc,CAAa,CAAC;YAC9G,8EAAkD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,aAAa,CAAa,CAAC;YAC5G,kFAAoD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,eAAe,CAAa,CAAC;YAChH,wFAAuD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAa,CAAC;YAC3H,0EAAgD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAa,CAAC;YAC7F,8EAAkD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,kBAAkB,IAAI,KAAK,CAAC,IAAI,CAAa,CAAC;YAC/H,gFAAmD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAa,CAAC;QACpH,CAAC;QAED,uFAAuF;QACvF,MAAM,IAAI,KAAK,CAAC,eAAe,KAAK,YAAY,CAAC,CAAC;IACnD,CAAC;IAEO,KAAK,CAAC,cAAc,CAAC,cAA+B,EAAE,IAAqC;QAClG,MAAM,iBAAiB,GAAuB;YAC7C,IAAI,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI;YACjC,UAAU,EAAE,IAAI,CAAC,iBAAiB,CAAC,UAAU;YAC7C,IAAI,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI;YACjC,GAAG,EAAE,CACJ,OAAO,IAAI,CAAC,iBAAiB,CAAC,GAAG,KAAK,QAAQ,IAAI,OAAO,IAAI,CAAC,iBAAiB,CAAC,GAAG,KAAK,WAAW;gBAClG,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG;gBAC5B,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAC3E;YACD,GAAG,EAAE,IAAI,CAAC,iBAAiB,CAAC,GAAG;YAC/B,mBAAmB,EAAE,IAAI,CAAC,iBAAiB,CAAC,mBAAmB;YAC/D,sBAAsB,EAAE,IAAI,CAAC,iBAAiB,CAAC,sBAAsB;YACrE,IAAI,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI;YACjC,iBAAiB,EAAE,IAAI,CAAC,iBAAiB,CAAC,iBAAiB;YAC3D,UAAU,EAAE,IAAI,CAAC,iBAAiB,CAAC,UAAU;YAC7C,oCAAoC,EAAE,IAAI,CAAC,iBAAiB,CAAC,oCAAoC;SACjG,CAAC;QAGF,MAAM,OAAO,GAAG,MAAM,oBAAoB,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACtM,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QAE3C,MAAM,qBAAqB,GAAG,CAAC,aAAmC,EAAoB,EAAE;YACvF,OAAO;gBACN,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;gBACpE,IAAI,EAAE,aAAa,CAAC,IAAI;gBACxB,KAAK,EAAE,aAAa,CAAC,KAAK;gBAC1B,UAAU,EAAE,GAAG,EAAE;oBAChB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;gBACpC,CAAC;aACD,CAAC;QACH,CAAC,CAAC;QACF,MAAM,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QAC1E,MAAM,qBAAqB,GAAG,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACzH,MAAM,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACvI,MAAM,sBAAsB,GAAG,IAAI,sBAAsB,CAAC,OAAO,EAAE,gBAAgB,EAAE,kBAAkB,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,2BAA2B,CAAC,CAAC;QACnK,MAAM,gBAAgB,GAAG,mBAAmB,CAAC,sBAAsB,CAAC,qBAAqB,EAAE,OAAO,CAAC,GAAG,EAAE,sBAAsB,CAAC,CAAC;QAEhI,sBAAsB;QACtB,MAAM,UAAU,GAAG,MAAM,mBAAmB,CAAC,MAAM,CAAC,iBAAiB,EAAE,EAAE,CAAC,OAAO,EAAE,EAAE,gBAAgB,EAAE,qBAAqB,EAAE,GAAG,EAAE,IAAI,CAAC,aAAa,CAAC,yBAAyB,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACpM,iBAAiB,CAAC,GAAG,GAAG,UAAU,CAAC;QAEnC,MAAM,cAAc,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,iCAAiC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,6BAA6B,CAAC,CAAC,CAAC,+BAA+B,CAAC,CAAC;QACzK,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;QACzD,MAAM,GAAG,GAAG,MAAM,mBAAmB,CAAC,yBAAyB,CAC9D,iBAAiB,EACjB,aAAa,EACb,gBAAgB,EAChB,IAAI,CAAC,eAAe,CAAC,OAAO,EAC5B,IAAI,CAAC,aAAa,CAAC,kCAAkC,CAAC,EACtD,OAAO,CACP,CAAC;QAEF,sEAAsE;QACtE,IAAI,sCAAsC,CAAC,iBAAiB,CAAC,EAAE,CAAC;YAC/D,MAAM,OAAO,GAA+C,EAAE,CAAC;YAC/D,KAAK,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBACrD,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,wCAAwC,CAAC,CAAC,CAAC,EAAE,cAAc,EAAE,oCAAoC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAClI,CAAC;YACD,MAAM,sBAAsB,GAAG,IAAI,GAAG,CAAyC,OAAO,CAAC,CAAC;YACxF,MAAM,gBAAgB,GAAG,IAAI,mCAAmC,CAAC,sBAAsB,CAAC,CAAC;YACzF,MAAM,eAAe,GAAG,qBAAqB,CAAC,CAAC,CAAC,qBAAqB,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC;YAC/F,MAAM,gBAAgB,CAAC,yBAAyB,CAAC,GAAG,EAAE,EAAE,eAAe,EAAE,EAAE,gBAAgB,CAAC,CAAC;QAC9F,CAAC;QAED,2CAA2C;QAC3C,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,4CAA4C,EAAE,EAAE,iBAAiB,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;QAE/I,uEAAuE;QACvE,MAAM,aAAa,GAAG,qBAAqB,EAAE,CAAC;QAC9C,GAAG,CAAC,mBAAmB,GAAG,aAAa,CAAC;QAExC,MAAM,mBAAmB,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,iBAAiB,EAAE,UAAU,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,cAAc,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAC7O,MAAM,gBAAgB,GAAsB;YAC3C,cAAc,EAAE,CAAI,EAAU,EAAE,GAAG,IAAe,EAAc,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,mBAAmB,EAAE,EAAE,EAAE,IAAI,EAAE,cAAc,CAAC;SACtI,CAAC;QACF,MAAM,SAAS,GAAG,IAAI,aAAa,CAAC,gBAAgB,EAAE,IAAI,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;QACvF,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,mBAAmB,IAAI,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC;QAE7F,OAAO;YACN,oBAAoB,EAAE,mBAAmB;YACzC,yBAAyB,EAAE,iBAAiB;SAC5C,CAAC;IACH,CAAC;IAEO,eAAe,CAAI,mBAA2B,EAAE,SAAiB,EAAE,WAAsB,EAAE,cAA+B;QACjI,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,oBAAoB,EAAK,CAAC;QAE/D,MAAM,KAAK,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC;QAChC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,OAAmC,EAAE,MAAM,EAAE,cAAc,EAAE,CAAC,CAAC;QAE3G,MAAM,qBAAqB,GAAG,cAAc,CAAC,WAAW,EAAE,CAAC,GAAG,EAAE,EAAE;YACjE,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;gBAC3B,wBAAwB;gBACxB,OAAO,cAAc,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;YAC9C,CAAC;YACD,IAAI,GAAG,IAAI,GAAG,YAAY,GAAG,EAAE,CAAC;gBAC/B,OAAO,cAAc,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;YACjD,CAAC;YACD,OAAO,SAAS,CAAC;QAClB,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC;YAC3B,KAAK;YACL,mBAAmB;YACnB,SAAS;YACT,WAAW,EAAE,qBAAqB;SAClC,CAAC,CAAC;QAEH,OAAO,OAAO,CAAC;IAChB,CAAC;IAEO,kBAAkB,CAAC,KAAa,EAAE,OAAgB,EAAE,iBAA0B;QACrF,MAAM,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC9C,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QACD,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACpC,MAAM,OAAO,GAAG,cAAc,CAAC,iBAAiB,EAAE,CAAC,GAAG,EAAE,EAAE;YACzD,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;gBAC3B,wBAAwB;gBACxB,OAAO,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;YACnD,CAAC;YACD,OAAO,SAAS,CAAC;QAClB,CAAC,CAAC,CAAC;QACH,IAAI,OAAO,EAAE,CAAC;YACb,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QACtB,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACvB,CAAC;IACF,CAAC;IAEO,sBAAsB,CAAC,UAAqC;QACnE,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;IAC/D,CAAC;IAEO,KAAK,CAAC,YAAY,CAAC,WAAmB,EAAE,QAAiB,EAAE,cAAuB,EAAE,uBAAiC;QAC5H,OAAO,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,WAAW,EAAE,QAAQ,EAAE,cAAc,EAAE,uBAAuB,CAAC,IAAI,EAAE,CAAC;IAC/G,CAAC;IAEO,eAAe;QACtB,OAAO,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;IAC3B,CAAC;IAEO,WAAW,CAAC,QAAgB,EAAE,SAAwC;QAC7E,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IAC7D,CAAC;IAGO,0BAA0B;QACjC,OAAO,IAAI,CAAC,eAAe,CAAC,yBAAyB,EAAE,CAAC;IACzD,CAAC;CACD","file":"remoteTerminalChannel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { cloneAndChange } from '../../base/common/objects.js';\nimport { Disposable } from '../../base/common/lifecycle.js';\nimport * as path from '../../base/common/path.js';\nimport * as platform from '../../base/common/platform.js';\nimport { URI } from '../../base/common/uri.js';\nimport { IURITransformer } from '../../base/common/uriIpc.js';\nimport { IServerChannel } from '../../base/parts/ipc/common/ipc.js';\nimport { createRandomIPCHandle } from '../../base/parts/ipc/node/ipc.net.js';\nimport { RemoteAgentConnectionContext } from '../../platform/remote/common/remoteAgentEnvironment.js';\nimport { IPtyHostService, IShellLaunchConfig, ITerminalProfile } from '../../platform/terminal/common/terminal.js';\nimport { IGetTerminalLayoutInfoArgs, ISetTerminalLayoutInfoArgs } from '../../platform/terminal/common/terminalProcess.js';\nimport { IWorkspaceFolder } from '../../platform/workspace/common/workspace.js';\nimport { createURITransformer } from '../../base/common/uriTransformer.js';\nimport { CLIServerBase, ICommandsExecuter } from '../../workbench/api/node/extHostCLIServer.js';\nimport { IEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariable.js';\nimport { MergedEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariableCollection.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariableShared.js';\nimport { ICreateTerminalProcessArguments, ICreateTerminalProcessResult, IWorkspaceFolderData, RemoteTerminalChannelEvent, RemoteTerminalChannelRequest } from '../../workbench/contrib/terminal/common/remote/terminal.js';\nimport * as terminalEnvironment from '../../workbench/contrib/terminal/common/terminalEnvironment.js';\nimport { AbstractVariableResolverService } from '../../workbench/services/configurationResolver/common/variableResolver.js';\nimport { buildUserEnvironment } from './extensionHostConnection.js';\nimport { IServerEnvironmentService } from './serverEnvironmentService.js';\nimport { IProductService } from '../../platform/product/common/productService.js';\nimport { IExtensionManagementService } from '../../platform/extensionManagement/common/extensionManagement.js';\nimport { IConfigurationService } from '../../platform/configuration/common/configuration.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { promiseWithResolvers } from '../../base/common/async.js';\nimport { shouldUseEnvironmentVariableCollection } from '../../platform/terminal/common/terminalEnvironment.js';\n\nclass CustomVariableResolver extends AbstractVariableResolverService {\n\tconstructor(\n\t\tenv: platform.IProcessEnvironment,\n\t\tworkspaceFolders: IWorkspaceFolder[],\n\t\tactiveFileResource: URI | undefined,\n\t\tresolvedVariables: { [name: string]: string },\n\t\textensionService: IExtensionManagementService,\n\t) {\n\t\tsuper({\n\t\t\tgetFolderUri: (folderName: string): URI | undefined => {\n\t\t\t\tconst found = workspaceFolders.filter(f => f.name === folderName);\n\t\t\t\tif (found && found.length > 0) {\n\t\t\t\t\treturn found[0].uri;\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetWorkspaceFolderCount: (): number => {\n\t\t\t\treturn workspaceFolders.length;\n\t\t\t},\n\t\t\tgetConfigurationValue: (folderUri: URI, section: string): string | undefined => {\n\t\t\t\treturn resolvedVariables[`config:${section}`];\n\t\t\t},\n\t\t\tgetExecPath: (): string | undefined => {\n\t\t\t\treturn env['VSCODE_EXEC_PATH'];\n\t\t\t},\n\t\t\tgetAppRoot: (): string | undefined => {\n\t\t\t\treturn env['VSCODE_CWD'];\n\t\t\t},\n\t\t\tgetFilePath: (): string | undefined => {\n\t\t\t\tif (activeFileResource) {\n\t\t\t\t\treturn path.normalize(activeFileResource.fsPath);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetSelectedText: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['selectedText'];\n\t\t\t},\n\t\t\tgetLineNumber: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['lineNumber'];\n\t\t\t},\n\t\t\tgetColumnNumber: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['columnNumber'];\n\t\t\t},\n\t\t\tgetExtension: async id => {\n\t\t\t\tconst installed = await extensionService.getInstalled();\n\t\t\t\tconst found = installed.find(e => e.identifier.id === id);\n\t\t\t\treturn found && { extensionLocation: found.location };\n\t\t\t},\n\t\t}, undefined, Promise.resolve(os.homedir()), Promise.resolve(env));\n\t}\n}\n\nexport class RemoteTerminalChannel extends Disposable implements IServerChannel<RemoteAgentConnectionContext> {\n\n\tprivate _lastReqId = 0;\n\tprivate readonly _pendingCommands = new Map<number, {\n\t\tresolve: (value: unknown) => void;\n\t\treject: (err?: unknown) => void;\n\t\turiTransformer: IURITransformer;\n\t}>();\n\n\tprivate readonly _onExecuteCommand = this._register(new Emitter<{ reqId: number; persistentProcessId: number; commandId: string; commandArgs: unknown[] }>());\n\treadonly onExecuteCommand = this._onExecuteCommand.event;\n\n\tconstructor(\n\t\tprivate readonly _environmentService: IServerEnvironmentService,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _ptyHostService: IPtyHostService,\n\t\tprivate readonly _productService: IProductService,\n\t\tprivate readonly _extensionManagementService: IExtensionManagementService,\n\t\tprivate readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tasync call(ctx: RemoteAgentConnectionContext, command: RemoteTerminalChannelRequest, args?: any): Promise<any> {\n\t\tswitch (command) {\n\t\t\tcase RemoteTerminalChannelRequest.RestartPtyHost: return this._ptyHostService.restartPtyHost.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.CreateProcess: {\n\t\t\t\tconst uriTransformer = createURITransformer(ctx.remoteAuthority);\n\t\t\t\treturn this._createProcess(uriTransformer, <ICreateTerminalProcessArguments>args);\n\t\t\t}\n\t\t\tcase RemoteTerminalChannelRequest.AttachToProcess: return this._ptyHostService.attachToProcess.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.DetachFromProcess: return this._ptyHostService.detachFromProcess.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.ListProcesses: return this._ptyHostService.listProcesses.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetLatency: return this._ptyHostService.getLatency.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetPerformanceMarks: return this._ptyHostService.getPerformanceMarks.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.OrphanQuestionReply: return this._ptyHostService.orphanQuestionReply.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptPtyHostResolvedVariables: return this._ptyHostService.acceptPtyHostResolvedVariables.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.Start: return this._ptyHostService.start.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Input: return this._ptyHostService.input.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SendSignal: return this._ptyHostService.sendSignal.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcknowledgeDataEvent: return this._ptyHostService.acknowledgeDataEvent.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Shutdown: return this._ptyHostService.shutdown.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Resize: return this._ptyHostService.resize.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ClearBuffer: return this._ptyHostService.clearBuffer.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetInitialCwd: return this._ptyHostService.getInitialCwd.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetCwd: return this._ptyHostService.getCwd.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.ProcessBinary: return this._ptyHostService.processBinary.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.SendCommandResult: return this._sendCommandResult(args[0], args[1], args[2]);\n\t\t\tcase RemoteTerminalChannelRequest.InstallAutoReply: return this._ptyHostService.installAutoReply.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UninstallAllAutoReplies: return this._ptyHostService.uninstallAllAutoReplies.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetDefaultSystemShell: return this._getDefaultSystemShell.apply(this, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetProfiles: return this._getProfiles.apply(this, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetEnvironment: return this._getEnvironment();\n\t\t\tcase RemoteTerminalChannelRequest.GetWslPath: return this._getWslPath(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.GetTerminalLayoutInfo: return this._ptyHostService.getTerminalLayoutInfo(<IGetTerminalLayoutInfoArgs>args);\n\t\t\tcase RemoteTerminalChannelRequest.SetTerminalLayoutInfo: return this._ptyHostService.setTerminalLayoutInfo(<ISetTerminalLayoutInfoArgs>args);\n\t\t\tcase RemoteTerminalChannelRequest.SerializeTerminalState: return this._ptyHostService.serializeTerminalState.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ReviveTerminalProcesses: return this._ptyHostService.reviveTerminalProcesses.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetRevivedPtyNewId: return this._ptyHostService.getRevivedPtyNewId.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SetUnicodeVersion: return this._ptyHostService.setUnicodeVersion.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SetNextCommandId: return this._ptyHostService.setNextCommandId.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ReduceConnectionGraceTime: return this._reduceConnectionGraceTime();\n\t\t\tcase RemoteTerminalChannelRequest.UpdateIcon: return this._ptyHostService.updateIcon.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UpdateTitle: return this._ptyHostService.updateTitle.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UpdateProperty: return this._ptyHostService.updateProperty.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.RefreshProperty: return this._ptyHostService.refreshProperty.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.RequestDetachInstance: return this._ptyHostService.requestDetachInstance(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptDetachedInstance: return this._ptyHostService.acceptDetachInstanceReply(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.FreePortKillProcess: return this._ptyHostService.freePortKillProcess.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptDetachInstanceReply: return this._ptyHostService.acceptDetachInstanceReply.apply(this._ptyHostService, args);\n\t\t}\n\n\t\t// @ts-expect-error Assert command is the `never` type to ensure all messages are handled\n\t\tthrow new Error(`IPC Command ${command} not found`);\n\t}\n\n\tlisten<T>(_: unknown, event: RemoteTerminalChannelEvent, _arg: unknown): Event<T> {\n\t\tswitch (event) {\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostExitEvent: return (this._ptyHostService.onPtyHostExit || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostStartEvent: return (this._ptyHostService.onPtyHostStart || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostUnresponsiveEvent: return (this._ptyHostService.onPtyHostUnresponsive || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostResponsiveEvent: return (this._ptyHostService.onPtyHostResponsive || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostRequestResolveVariablesEvent: return (this._ptyHostService.onPtyHostRequestResolveVariables || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessDataEvent: return (this._ptyHostService.onProcessData) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessReadyEvent: return (this._ptyHostService.onProcessReady) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessExitEvent: return (this._ptyHostService.onProcessExit) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessReplayEvent: return (this._ptyHostService.onProcessReplay) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessOrphanQuestion: return (this._ptyHostService.onProcessOrphanQuestion) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnExecuteCommand: return (this.onExecuteCommand) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnDidRequestDetach: return (this._ptyHostService.onDidRequestDetach || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnDidChangeProperty: return (this._ptyHostService.onDidChangeProperty) as Event<T>;\n\t\t}\n\n\t\t// @ts-expect-error Assert event is the `never` type to ensure all messages are handled\n\t\tthrow new Error(`IPC Command ${event} not found`);\n\t}\n\n\tprivate async _createProcess(uriTransformer: IURITransformer, args: ICreateTerminalProcessArguments): Promise<ICreateTerminalProcessResult> {\n\t\tconst shellLaunchConfig: IShellLaunchConfig = {\n\t\t\tname: args.shellLaunchConfig.name,\n\t\t\texecutable: args.shellLaunchConfig.executable,\n\t\t\targs: args.shellLaunchConfig.args,\n\t\t\tcwd: (\n\t\t\t\ttypeof args.shellLaunchConfig.cwd === 'string' || typeof args.shellLaunchConfig.cwd === 'undefined'\n\t\t\t\t\t? args.shellLaunchConfig.cwd\n\t\t\t\t\t: URI.revive(uriTransformer.transformIncoming(args.shellLaunchConfig.cwd))\n\t\t\t),\n\t\t\tenv: args.shellLaunchConfig.env,\n\t\t\tuseShellEnvironment: args.shellLaunchConfig.useShellEnvironment,\n\t\t\treconnectionProperties: args.shellLaunchConfig.reconnectionProperties,\n\t\t\ttype: args.shellLaunchConfig.type,\n\t\t\tisFeatureTerminal: args.shellLaunchConfig.isFeatureTerminal,\n\t\t\ttabActions: args.shellLaunchConfig.tabActions,\n\t\t\tshellIntegrationEnvironmentReporting: args.shellLaunchConfig.shellIntegrationEnvironmentReporting,\n\t\t};\n\n\n\t\tconst baseEnv = await buildUserEnvironment(args.resolverEnv, !!args.shellLaunchConfig.useShellEnvironment, platform.language, this._environmentService, this._logService, this._configurationService);\n\t\tthis._logService.trace('baseEnv', baseEnv);\n\n\t\tconst reviveWorkspaceFolder = (workspaceData: IWorkspaceFolderData): IWorkspaceFolder => {\n\t\t\treturn {\n\t\t\t\turi: URI.revive(uriTransformer.transformIncoming(workspaceData.uri)),\n\t\t\t\tname: workspaceData.name,\n\t\t\t\tindex: workspaceData.index,\n\t\t\t\ttoResource: () => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tconst workspaceFolders = args.workspaceFolders.map(reviveWorkspaceFolder);\n\t\tconst activeWorkspaceFolder = args.activeWorkspaceFolder ? reviveWorkspaceFolder(args.activeWorkspaceFolder) : undefined;\n\t\tconst activeFileResource = args.activeFileResource ? URI.revive(uriTransformer.transformIncoming(args.activeFileResource)) : undefined;\n\t\tconst customVariableResolver = new CustomVariableResolver(baseEnv, workspaceFolders, activeFileResource, args.resolvedVariables, this._extensionManagementService);\n\t\tconst variableResolver = terminalEnvironment.createVariableResolver(activeWorkspaceFolder, process.env, customVariableResolver);\n\n\t\t// Get the initial cwd\n\t\tconst initialCwd = await terminalEnvironment.getCwd(shellLaunchConfig, os.homedir(), variableResolver, activeWorkspaceFolder?.uri, args.configuration['terminal.integrated.cwd'], this._logService);\n\t\tshellLaunchConfig.cwd = initialCwd;\n\n\t\tconst envPlatformKey = platform.isWindows ? 'terminal.integrated.env.windows' : (platform.isMacintosh ? 'terminal.integrated.env.osx' : 'terminal.integrated.env.linux');\n\t\tconst envFromConfig = args.configuration[envPlatformKey];\n\t\tconst env = await terminalEnvironment.createTerminalEnvironment(\n\t\t\tshellLaunchConfig,\n\t\t\tenvFromConfig,\n\t\t\tvariableResolver,\n\t\t\tthis._productService.version,\n\t\t\targs.configuration['terminal.integrated.detectLocale'],\n\t\t\tbaseEnv\n\t\t);\n\n\t\t// Apply extension environment variable collections to the environment\n\t\tif (shouldUseEnvironmentVariableCollection(shellLaunchConfig)) {\n\t\t\tconst entries: [string, IEnvironmentVariableCollection][] = [];\n\t\t\tfor (const [k, v, d] of args.envVariableCollections) {\n\t\t\t\tentries.push([k, { map: deserializeEnvironmentVariableCollection(v), descriptionMap: deserializeEnvironmentDescriptionMap(d) }]);\n\t\t\t}\n\t\t\tconst envVariableCollections = new Map<string, IEnvironmentVariableCollection>(entries);\n\t\t\tconst mergedCollection = new MergedEnvironmentVariableCollection(envVariableCollections);\n\t\t\tconst workspaceFolder = activeWorkspaceFolder ? activeWorkspaceFolder ?? undefined : undefined;\n\t\t\tawait mergedCollection.applyToProcessEnvironment(env, { workspaceFolder }, variableResolver);\n\t\t}\n\n\t\t// Fork the process and listen for messages\n\t\tthis._logService.debug(`Terminal process launching on remote agent`, { shellLaunchConfig, initialCwd, cols: args.cols, rows: args.rows, env });\n\n\t\t// Setup the CLI server to support forwarding commands run from the CLI\n\t\tconst ipcHandlePath = createRandomIPCHandle();\n\t\tenv.VSCODE_IPC_HOOK_CLI = ipcHandlePath;\n\n\t\tconst persistentProcessId = await this._ptyHostService.createProcess(shellLaunchConfig, initialCwd, args.cols, args.rows, args.unicodeVersion, env, baseEnv, args.options, args.shouldPersistTerminal, args.workspaceId, args.workspaceName);\n\t\tconst commandsExecuter: ICommandsExecuter = {\n\t\t\texecuteCommand: <T>(id: string, ...args: unknown[]): Promise<T> => this._executeCommand(persistentProcessId, id, args, uriTransformer)\n\t\t};\n\t\tconst cliServer = new CLIServerBase(commandsExecuter, this._logService, ipcHandlePath);\n\t\tthis._ptyHostService.onProcessExit(e => e.id === persistentProcessId && cliServer.dispose());\n\n\t\treturn {\n\t\t\tpersistentTerminalId: persistentProcessId,\n\t\t\tresolvedShellLaunchConfig: shellLaunchConfig\n\t\t};\n\t}\n\n\tprivate _executeCommand<T>(persistentProcessId: number, commandId: string, commandArgs: unknown[], uriTransformer: IURITransformer): Promise<T> {\n\t\tconst { resolve, reject, promise } = promiseWithResolvers<T>();\n\n\t\tconst reqId = ++this._lastReqId;\n\t\tthis._pendingCommands.set(reqId, { resolve: resolve as (value: unknown) => void, reject, uriTransformer });\n\n\t\tconst serializedCommandArgs = cloneAndChange(commandArgs, (obj) => {\n\t\t\tif (obj && obj.$mid === 1) {\n\t\t\t\t// this is UriComponents\n\t\t\t\treturn uriTransformer.transformOutgoing(obj);\n\t\t\t}\n\t\t\tif (obj && obj instanceof URI) {\n\t\t\t\treturn uriTransformer.transformOutgoingURI(obj);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t\tthis._onExecuteCommand.fire({\n\t\t\treqId,\n\t\t\tpersistentProcessId,\n\t\t\tcommandId,\n\t\t\tcommandArgs: serializedCommandArgs\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tprivate _sendCommandResult(reqId: number, isError: boolean, serializedPayload: unknown): void {\n\t\tconst data = this._pendingCommands.get(reqId);\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingCommands.delete(reqId);\n\t\tconst payload = cloneAndChange(serializedPayload, (obj) => {\n\t\t\tif (obj && obj.$mid === 1) {\n\t\t\t\t// this is UriComponents\n\t\t\t\treturn data.uriTransformer.transformIncoming(obj);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t\tif (isError) {\n\t\t\tdata.reject(payload);\n\t\t} else {\n\t\t\tdata.resolve(payload);\n\t\t}\n\t}\n\n\tprivate _getDefaultSystemShell(osOverride?: platform.OperatingSystem): Promise<string> {\n\t\treturn this._ptyHostService.getDefaultSystemShell(osOverride);\n\t}\n\n\tprivate async _getProfiles(workspaceId: string, profiles: unknown, defaultProfile: unknown, includeDetectedProfiles?: boolean): Promise<ITerminalProfile[]> {\n\t\treturn this._ptyHostService.getProfiles(workspaceId, profiles, defaultProfile, includeDetectedProfiles) || [];\n\t}\n\n\tprivate _getEnvironment(): platform.IProcessEnvironment {\n\t\treturn { ...process.env };\n\t}\n\n\tprivate _getWslPath(original: string, direction: 'unix-to-win' | 'win-to-unix'): Promise<string> {\n\t\treturn this._ptyHostService.getWslPath(original, direction);\n\t}\n\n\n\tprivate _reduceConnectionGraceTime(): Promise<void> {\n\t\treturn this._ptyHostService.reduceConnectionGraceTime();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { cloneAndChange } from '../../base/common/objects.js';\nimport { Disposable } from '../../base/common/lifecycle.js';\nimport * as path from '../../base/common/path.js';\nimport * as platform from '../../base/common/platform.js';\nimport { URI } from '../../base/common/uri.js';\nimport { IURITransformer } from '../../base/common/uriIpc.js';\nimport { IServerChannel } from '../../base/parts/ipc/common/ipc.js';\nimport { createRandomIPCHandle } from '../../base/parts/ipc/node/ipc.net.js';\nimport { RemoteAgentConnectionContext } from '../../platform/remote/common/remoteAgentEnvironment.js';\nimport { IPtyHostService, IShellLaunchConfig, ITerminalProfile } from '../../platform/terminal/common/terminal.js';\nimport { IGetTerminalLayoutInfoArgs, ISetTerminalLayoutInfoArgs } from '../../platform/terminal/common/terminalProcess.js';\nimport { IWorkspaceFolder } from '../../platform/workspace/common/workspace.js';\nimport { createURITransformer } from '../../base/common/uriTransformer.js';\nimport { CLIServerBase, ICommandsExecuter } from '../../workbench/api/node/extHostCLIServer.js';\nimport { IEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariable.js';\nimport { MergedEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariableCollection.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection } from '../../platform/terminal/common/environmentVariableShared.js';\nimport { ICreateTerminalProcessArguments, ICreateTerminalProcessResult, IWorkspaceFolderData, RemoteTerminalChannelEvent, RemoteTerminalChannelRequest } from '../../workbench/contrib/terminal/common/remote/terminal.js';\nimport * as terminalEnvironment from '../../workbench/contrib/terminal/common/terminalEnvironment.js';\nimport { AbstractVariableResolverService } from '../../workbench/services/configurationResolver/common/variableResolver.js';\nimport { buildUserEnvironment } from './extensionHostConnection.js';\nimport { IServerEnvironmentService } from './serverEnvironmentService.js';\nimport { IProductService } from '../../platform/product/common/productService.js';\nimport { IExtensionManagementService } from '../../platform/extensionManagement/common/extensionManagement.js';\nimport { IConfigurationService } from '../../platform/configuration/common/configuration.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { promiseWithResolvers } from '../../base/common/async.js';\nimport { shouldUseEnvironmentVariableCollection } from '../../platform/terminal/common/terminalEnvironment.js';\n\nclass CustomVariableResolver extends AbstractVariableResolverService {\n\tconstructor(\n\t\tenv: platform.IProcessEnvironment,\n\t\tworkspaceFolders: IWorkspaceFolder[],\n\t\tactiveFileResource: URI | undefined,\n\t\tresolvedVariables: { [name: string]: string },\n\t\textensionService: IExtensionManagementService,\n\t) {\n\t\tsuper({\n\t\t\tgetFolderUri: (folderName: string): URI | undefined => {\n\t\t\t\tconst found = workspaceFolders.filter(f => f.name === folderName);\n\t\t\t\tif (found && found.length > 0) {\n\t\t\t\t\treturn found[0].uri;\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetWorkspaceFolderCount: (): number => {\n\t\t\t\treturn workspaceFolders.length;\n\t\t\t},\n\t\t\tgetConfigurationValue: (folderUri: URI, section: string): string | undefined => {\n\t\t\t\treturn resolvedVariables[`config:${section}`];\n\t\t\t},\n\t\t\tgetExecPath: (): string | undefined => {\n\t\t\t\treturn env['VSCODE_EXEC_PATH'];\n\t\t\t},\n\t\t\tgetAppRoot: (): string | undefined => {\n\t\t\t\treturn env['VSCODE_CWD'];\n\t\t\t},\n\t\t\tgetFilePath: (): string | undefined => {\n\t\t\t\tif (activeFileResource) {\n\t\t\t\t\treturn path.normalize(activeFileResource.fsPath);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetSelectedText: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['selectedText'];\n\t\t\t},\n\t\t\tgetLineNumber: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['lineNumber'];\n\t\t\t},\n\t\t\tgetColumnNumber: (): string | undefined => {\n\t\t\t\treturn resolvedVariables['columnNumber'];\n\t\t\t},\n\t\t\tgetExtension: async id => {\n\t\t\t\tconst installed = await extensionService.getInstalled();\n\t\t\t\tconst found = installed.find(e => e.identifier.id === id);\n\t\t\t\treturn found && { extensionLocation: found.location };\n\t\t\t},\n\t\t}, undefined, Promise.resolve(os.homedir()), Promise.resolve(env));\n\t}\n}\n\nexport class RemoteTerminalChannel extends Disposable implements IServerChannel<RemoteAgentConnectionContext> {\n\n\tprivate _lastReqId = 0;\n\tprivate readonly _pendingCommands = new Map<number, {\n\t\tresolve: (value: unknown) => void;\n\t\treject: (err?: unknown) => void;\n\t\turiTransformer: IURITransformer;\n\t}>();\n\n\tprivate readonly _onExecuteCommand = this._register(new Emitter<{ reqId: number; persistentProcessId: number; commandId: string; commandArgs: unknown[] }>());\n\treadonly onExecuteCommand = this._onExecuteCommand.event;\n\n\tconstructor(\n\t\tprivate readonly _environmentService: IServerEnvironmentService,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _ptyHostService: IPtyHostService,\n\t\tprivate readonly _productService: IProductService,\n\t\tprivate readonly _extensionManagementService: IExtensionManagementService,\n\t\tprivate readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tasync call(ctx: RemoteAgentConnectionContext, command: RemoteTerminalChannelRequest, args?: any): Promise<any> {\n\t\tswitch (command) {\n\t\t\tcase RemoteTerminalChannelRequest.RestartPtyHost: return this._ptyHostService.restartPtyHost.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.CreateProcess: {\n\t\t\t\tconst uriTransformer = createURITransformer(ctx.remoteAuthority);\n\t\t\t\treturn this._createProcess(uriTransformer, <ICreateTerminalProcessArguments>args);\n\t\t\t}\n\t\t\tcase RemoteTerminalChannelRequest.AttachToProcess: return this._ptyHostService.attachToProcess.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.DetachFromProcess: return this._ptyHostService.detachFromProcess.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.ListProcesses: return this._ptyHostService.listProcesses.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetLatency: return this._ptyHostService.getLatency.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetPerformanceMarks: return this._ptyHostService.getPerformanceMarks.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.OrphanQuestionReply: return this._ptyHostService.orphanQuestionReply.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptPtyHostResolvedVariables: return this._ptyHostService.acceptPtyHostResolvedVariables.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.Start: return this._ptyHostService.start.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Input: return this._ptyHostService.input.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SendSignal: return this._ptyHostService.sendSignal.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcknowledgeDataEvent: return this._ptyHostService.acknowledgeDataEvent.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Shutdown: return this._ptyHostService.shutdown.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.Resize: return this._ptyHostService.resize.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ClearBuffer: return this._ptyHostService.clearBuffer.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetInitialCwd: return this._ptyHostService.getInitialCwd.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetCwd: return this._ptyHostService.getCwd.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.ProcessBinary: return this._ptyHostService.processBinary.apply(this._ptyHostService, args);\n\n\t\t\tcase RemoteTerminalChannelRequest.SendCommandResult: return this._sendCommandResult(args[0], args[1], args[2]);\n\t\t\tcase RemoteTerminalChannelRequest.InstallAutoReply: return this._ptyHostService.installAutoReply.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UninstallAllAutoReplies: return this._ptyHostService.uninstallAllAutoReplies.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetDefaultSystemShell: return this._getDefaultSystemShell.apply(this, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetProfiles: return this._getProfiles.apply(this, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetEnvironment: return this._getEnvironment();\n\t\t\tcase RemoteTerminalChannelRequest.GetWslPath: return this._getWslPath(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.GetTerminalLayoutInfo: return this._ptyHostService.getTerminalLayoutInfo(<IGetTerminalLayoutInfoArgs>args);\n\t\t\tcase RemoteTerminalChannelRequest.SetTerminalLayoutInfo: return this._ptyHostService.setTerminalLayoutInfo(<ISetTerminalLayoutInfoArgs>args);\n\t\t\tcase RemoteTerminalChannelRequest.SerializeTerminalState: return this._ptyHostService.serializeTerminalState.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ReviveTerminalProcesses: return this._ptyHostService.reviveTerminalProcesses.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.GetRevivedPtyNewId: return this._ptyHostService.getRevivedPtyNewId.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SetUnicodeVersion: return this._ptyHostService.setUnicodeVersion.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.SetNextCommandId: return this._ptyHostService.setNextCommandId.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.ReduceConnectionGraceTime: return this._reduceConnectionGraceTime();\n\t\t\tcase RemoteTerminalChannelRequest.UpdateIcon: return this._ptyHostService.updateIcon.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UpdateTitle: return this._ptyHostService.updateTitle.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.UpdateProperty: return this._ptyHostService.updateProperty.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.RefreshProperty: return this._ptyHostService.refreshProperty.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.RequestDetachInstance: return this._ptyHostService.requestDetachInstance(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptDetachedInstance: return this._ptyHostService.acceptDetachInstanceReply(args[0], args[1]);\n\t\t\tcase RemoteTerminalChannelRequest.FreePortKillProcess: return this._ptyHostService.freePortKillProcess.apply(this._ptyHostService, args);\n\t\t\tcase RemoteTerminalChannelRequest.AcceptDetachInstanceReply: return this._ptyHostService.acceptDetachInstanceReply.apply(this._ptyHostService, args);\n\t\t}\n\n\t\t// @ts-expect-error Assert command is the `never` type to ensure all messages are handled\n\t\tthrow new Error(`IPC Command ${command} not found`);\n\t}\n\n\tlisten<T>(_: unknown, event: RemoteTerminalChannelEvent, _arg: unknown): Event<T> {\n\t\tswitch (event) {\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostExitEvent: return (this._ptyHostService.onPtyHostExit || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostStartEvent: return (this._ptyHostService.onPtyHostStart || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostUnresponsiveEvent: return (this._ptyHostService.onPtyHostUnresponsive || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostResponsiveEvent: return (this._ptyHostService.onPtyHostResponsive || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnPtyHostRequestResolveVariablesEvent: return (this._ptyHostService.onPtyHostRequestResolveVariables || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessDataEvent: return (this._ptyHostService.onProcessData) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessReadyEvent: return (this._ptyHostService.onProcessReady) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessExitEvent: return (this._ptyHostService.onProcessExit) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessReplayEvent: return (this._ptyHostService.onProcessReplay) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnProcessOrphanQuestion: return (this._ptyHostService.onProcessOrphanQuestion) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnExecuteCommand: return (this.onExecuteCommand) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnDidRequestDetach: return (this._ptyHostService.onDidRequestDetach || Event.None) as Event<T>;\n\t\t\tcase RemoteTerminalChannelEvent.OnDidChangeProperty: return (this._ptyHostService.onDidChangeProperty) as Event<T>;\n\t\t}\n\n\t\t// @ts-expect-error Assert event is the `never` type to ensure all messages are handled\n\t\tthrow new Error(`IPC Command ${event} not found`);\n\t}\n\n\tprivate async _createProcess(uriTransformer: IURITransformer, args: ICreateTerminalProcessArguments): Promise<ICreateTerminalProcessResult> {\n\t\tconst shellLaunchConfig: IShellLaunchConfig = {\n\t\t\tname: args.shellLaunchConfig.name,\n\t\t\texecutable: args.shellLaunchConfig.executable,\n\t\t\targs: args.shellLaunchConfig.args,\n\t\t\tcwd: (\n\t\t\t\ttypeof args.shellLaunchConfig.cwd === 'string' || typeof args.shellLaunchConfig.cwd === 'undefined'\n\t\t\t\t\t? args.shellLaunchConfig.cwd\n\t\t\t\t\t: URI.revive(uriTransformer.transformIncoming(args.shellLaunchConfig.cwd))\n\t\t\t),\n\t\t\tenv: args.shellLaunchConfig.env,\n\t\t\tuseShellEnvironment: args.shellLaunchConfig.useShellEnvironment,\n\t\t\treconnectionProperties: args.shellLaunchConfig.reconnectionProperties,\n\t\t\ttype: args.shellLaunchConfig.type,\n\t\t\tisFeatureTerminal: args.shellLaunchConfig.isFeatureTerminal,\n\t\t\ttabActions: args.shellLaunchConfig.tabActions,\n\t\t\tshellIntegrationEnvironmentReporting: args.shellLaunchConfig.shellIntegrationEnvironmentReporting,\n\t\t};\n\n\n\t\tconst baseEnv = await buildUserEnvironment(args.resolverEnv, !!args.shellLaunchConfig.useShellEnvironment, platform.language, this._environmentService, this._logService, this._configurationService);\n\t\tthis._logService.trace('baseEnv', baseEnv);\n\n\t\tconst reviveWorkspaceFolder = (workspaceData: IWorkspaceFolderData): IWorkspaceFolder => {\n\t\t\treturn {\n\t\t\t\turi: URI.revive(uriTransformer.transformIncoming(workspaceData.uri)),\n\t\t\t\tname: workspaceData.name,\n\t\t\t\tindex: workspaceData.index,\n\t\t\t\ttoResource: () => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tconst workspaceFolders = args.workspaceFolders.map(reviveWorkspaceFolder);\n\t\tconst activeWorkspaceFolder = args.activeWorkspaceFolder ? reviveWorkspaceFolder(args.activeWorkspaceFolder) : undefined;\n\t\tconst activeFileResource = args.activeFileResource ? URI.revive(uriTransformer.transformIncoming(args.activeFileResource)) : undefined;\n\t\tconst customVariableResolver = new CustomVariableResolver(baseEnv, workspaceFolders, activeFileResource, args.resolvedVariables, this._extensionManagementService);\n\t\tconst variableResolver = terminalEnvironment.createVariableResolver(activeWorkspaceFolder, process.env, customVariableResolver);\n\n\t\t// Get the initial cwd\n\t\tconst initialCwd = await terminalEnvironment.getCwd(shellLaunchConfig, os.homedir(), variableResolver, activeWorkspaceFolder?.uri, args.configuration['terminal.integrated.cwd'], this._logService);\n\t\tshellLaunchConfig.cwd = initialCwd;\n\n\t\tconst envPlatformKey = platform.isWindows ? 'terminal.integrated.env.windows' : (platform.isMacintosh ? 'terminal.integrated.env.osx' : 'terminal.integrated.env.linux');\n\t\tconst envFromConfig = args.configuration[envPlatformKey];\n\t\tconst env = await terminalEnvironment.createTerminalEnvironment(\n\t\t\tshellLaunchConfig,\n\t\t\tenvFromConfig,\n\t\t\tvariableResolver,\n\t\t\tthis._productService.version,\n\t\t\targs.configuration['terminal.integrated.detectLocale'],\n\t\t\tbaseEnv\n\t\t);\n\n\t\t// Apply extension environment variable collections to the environment\n\t\tif (shouldUseEnvironmentVariableCollection(shellLaunchConfig)) {\n\t\t\tconst entries: [string, IEnvironmentVariableCollection][] = [];\n\t\t\tfor (const [k, v, d] of args.envVariableCollections) {\n\t\t\t\tentries.push([k, { map: deserializeEnvironmentVariableCollection(v), descriptionMap: deserializeEnvironmentDescriptionMap(d) }]);\n\t\t\t}\n\t\t\tconst envVariableCollections = new Map<string, IEnvironmentVariableCollection>(entries);\n\t\t\tconst mergedCollection = new MergedEnvironmentVariableCollection(envVariableCollections);\n\t\t\tconst workspaceFolder = activeWorkspaceFolder ? activeWorkspaceFolder ?? undefined : undefined;\n\t\t\tawait mergedCollection.applyToProcessEnvironment(env, { workspaceFolder }, variableResolver);\n\t\t}\n\n\t\t// Fork the process and listen for messages\n\t\tthis._logService.debug(`Terminal process launching on remote agent`, { shellLaunchConfig, initialCwd, cols: args.cols, rows: args.rows, env });\n\n\t\t// Setup the CLI server to support forwarding commands run from the CLI\n\t\tconst ipcHandlePath = createRandomIPCHandle();\n\t\tenv.VSCODE_IPC_HOOK_CLI = ipcHandlePath;\n\n\t\tconst persistentProcessId = await this._ptyHostService.createProcess(shellLaunchConfig, initialCwd, args.cols, args.rows, args.unicodeVersion, env, baseEnv, args.options, args.shouldPersistTerminal, args.workspaceId, args.workspaceName);\n\t\tconst commandsExecuter: ICommandsExecuter = {\n\t\t\texecuteCommand: <T>(id: string, ...args: unknown[]): Promise<T> => this._executeCommand(persistentProcessId, id, args, uriTransformer)\n\t\t};\n\t\tconst cliServer = new CLIServerBase(commandsExecuter, this._logService, ipcHandlePath);\n\t\tthis._ptyHostService.onProcessExit(e => e.id === persistentProcessId && cliServer.dispose());\n\n\t\treturn {\n\t\t\tpersistentTerminalId: persistentProcessId,\n\t\t\tresolvedShellLaunchConfig: shellLaunchConfig\n\t\t};\n\t}\n\n\tprivate _executeCommand<T>(persistentProcessId: number, commandId: string, commandArgs: unknown[], uriTransformer: IURITransformer): Promise<T> {\n\t\tconst { resolve, reject, promise } = promiseWithResolvers<T>();\n\n\t\tconst reqId = ++this._lastReqId;\n\t\tthis._pendingCommands.set(reqId, { resolve: resolve as (value: unknown) => void, reject, uriTransformer });\n\n\t\tconst serializedCommandArgs = cloneAndChange(commandArgs, (obj) => {\n\t\t\tif (obj && obj.$mid === 1) {\n\t\t\t\t// this is UriComponents\n\t\t\t\treturn uriTransformer.transformOutgoing(obj);\n\t\t\t}\n\t\t\tif (obj && obj instanceof URI) {\n\t\t\t\treturn uriTransformer.transformOutgoingURI(obj);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t\tthis._onExecuteCommand.fire({\n\t\t\treqId,\n\t\t\tpersistentProcessId,\n\t\t\tcommandId,\n\t\t\tcommandArgs: serializedCommandArgs\n\t\t});\n\n\t\treturn promise;\n\t}\n\n\tprivate _sendCommandResult(reqId: number, isError: boolean, serializedPayload: unknown): void {\n\t\tconst data = this._pendingCommands.get(reqId);\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingCommands.delete(reqId);\n\t\tconst payload = cloneAndChange(serializedPayload, (obj) => {\n\t\t\tif (obj && obj.$mid === 1) {\n\t\t\t\t// this is UriComponents\n\t\t\t\treturn data.uriTransformer.transformIncoming(obj);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t\tif (isError) {\n\t\t\tdata.reject(payload);\n\t\t} else {\n\t\t\tdata.resolve(payload);\n\t\t}\n\t}\n\n\tprivate _getDefaultSystemShell(osOverride?: platform.OperatingSystem): Promise<string> {\n\t\treturn this._ptyHostService.getDefaultSystemShell(osOverride);\n\t}\n\n\tprivate async _getProfiles(workspaceId: string, profiles: unknown, defaultProfile: unknown, includeDetectedProfiles?: boolean): Promise<ITerminalProfile[]> {\n\t\treturn this._ptyHostService.getProfiles(workspaceId, profiles, defaultProfile, includeDetectedProfiles) || [];\n\t}\n\n\tprivate _getEnvironment(): platform.IProcessEnvironment {\n\t\treturn { ...process.env };\n\t}\n\n\tprivate _getWslPath(original: string, direction: 'unix-to-win' | 'win-to-unix'): Promise<string> {\n\t\treturn this._ptyHostService.getWslPath(original, direction);\n\t}\n\n\n\tprivate _reduceConnectionGraceTime(): Promise<void> {\n\t\treturn this._ptyHostService.reduceConnectionGraceTime();\n\t}\n}\n"]}